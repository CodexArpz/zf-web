<h2>ZF-1254: Improve Zend_Pdf Text-Functions</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>New Feature</dd>

    <dt>Created:</dt>
    <dd>2007-04-12T04:21:50.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2012-11-20T21:37:58.000+0000</dd>

    <dt>Status:</dt>
    <dd>Open</dd>

    <dt>Fix version(s):</dt>
    <dd><ul></ul></dd>

    <dt>Reporter:</dt>
    <dd>
                Niko Sams (nikosams)
            </dd>

    <dt>Assignee:</dt>
    <dd>
        None
                    </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Pdf</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
        <li><a href="/issues/browse/ZF-7145">ZF-7145</a></li>
        </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
        <li><a href="/issues/secure/attachment/12127/Cell.php">Cell.php</a></li>
            <li><a href="/issues/secure/attachment/10943/Cell.php">Cell.php</a></li>
            <li><a href="/issues/secure/attachment/10831/Cell.txt">Cell.txt</a></li>
        </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>Zend_Pdf currently only has a function drawText to draw Text at a specific position.
For real-world usage it is every hard to work with this - as you have to calculate width and height of texts all the time (only possible ZF-313).</p>

<p>It would be nice to have Features like FPDF where you don't have to manually calculate everytime the y-position of the next line:
- Write: <a href="http://www.fpdf.org/en/doc/write.htm">http://www.fpdf.org/en/doc/write.htm</a>
- GetX/GetY: <a href="http://www.fpdf.org/en/doc/getx.htm">http://www.fpdf.org/en/doc/getx.htm</a> <a href="http://www.fpdf.org/en/doc/gety.htm">http://www.fpdf.org/en/doc/gety.htm</a> 
- SetX/SetY: <a href="http://www.fpdf.org/en/doc/setx.htm">http://www.fpdf.org/en/doc/setx.htm</a> <a href="http://www.fpdf.org/en/doc/sety.htm">http://www.fpdf.org/en/doc/sety.htm</a></p>

<p>Another helpful FPDF-feature is helpfull wenn creating tables:
- Cell: <a href="http://www.fpdf.org/en/doc/cell.htm">http://www.fpdf.org/en/doc/cell.htm</a>
- MultiCell: <a href="http://www.fpdf.org/en/doc/multicell.htm">http://www.fpdf.org/en/doc/multicell.htm</a></p>

<p>Additionally there exists a FPDF-Addon which allows to switch the font in a line - without having to calculate x and y positions:
- Flowing Block: <a href="http://www.fpdf.de/downloads/addons/65/">http://www.fpdf.de/downloads/addons/65/</a></p>

<hr /><p>Zend_Pdf has has many features fpdf lacks, it would be very nice if we could use Zend_Pdf
- a much better OO-Interface, fpdf is one big class
- utf8-support
- use ttf-fonts directly</p>

<p>thanks,
niko</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Bill Karwin (bkarwin) on 2007-04-12T16:06:20.000+0000</p> 
        <div class="body">
            <p>Assign to Alexander.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Alexander Veremyev (alexander) on 2007-05-25T02:48:51.000+0000</p> 
        <div class="body">
            <p>Depends on document representation model, which should be designed before.</p>

<p>Postponed to post-1.0 period</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Logan Buesching (ljbuesch) on 2007-09-25T12:09:49.000+0000</p> 
        <div class="body">
            <p>I have recently created a class that emulates the FPDF cells.  Currently, it is very basic but allows for creating of a cell, positioning the cell, and aligning text inside of the cell.  I have attached a diff that creates the functionality.  A small example is the following:</p>

<pre class="highlight"><code>
//create and attach the cell to the first page, and center in the X and Y direction
$cell=new Zend_Pdf_Cell($pdf-&gt;pages[0],Zend_Pdf_Cell::POSITION_CENTER_X | Zend_Pdf_Cell::POSITION_CENTER_Y);
//align the text in the center
$cell-&gt;addText("The quick brown fox jumped over the lazy dog.",Zend_Pdf_Cell::ALIGN_CENTER);
$cell-&gt;newLine();
//write the cell to the PDF document
$cell-&gt;write();
</code></pre>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Logan Buesching (ljbuesch) on 2007-09-25T12:10:22.000+0000</p> 
        <div class="body">
            <p>Patch for a cell class that allows simple cell creation and text alignment.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Logan Buesching (ljbuesch) on 2007-11-29T17:24:31.000+0000</p> 
        <div class="body">
            <p>I have updated the Cell.php file and fixed a few things.  Added borders and word wrapping.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Logan Buesching (ljbuesch) on 2008-03-19T21:50:20.000+0000</p> 
        <div class="body">
            <p>I have just finished up a proposal using the Zend_Pdf_Cell, any comments are welcome.  The proposal may be viewed at at <a href="http://framework.zend.com/wiki/display/ZFPROP/Zend_Pdf_Cell+-+Logan+Buesching">http://framework.zend.com/wiki/display/…</a></p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Wil Sinclair (wil) on 2008-03-25T22:06:45.000+0000</p> 
        <div class="body">
            <p>Resetting 'fix version priority' and 'fix version' to be re-evaluated for next release.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Willie Alberty (willie) on 2008-12-04T22:34:57.000+0000</p> 
        <div class="body">
            <p>Unassigning Zend_Pdf issues currently assigned to me pending decision on ZF 2.0 release timeframe and potential contribution of comprehensive changeset.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Wil Sinclair (wil) on 2008-12-08T17:00:48.000+0000</p> 
        <div class="body">
            <p>Alex, please take a look at this and resolve as necessary.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Philip Iezzi (iezzip) on 2009-08-01T02:39:21.000+0000</p> 
        <div class="body">
            <p>in _wordWrap() I've encountered endless loops resulting in a 500 server error in the following case:
A word of 1 character length (e.g. "-") would be the last word in a cell. This one character would still fit the cell width but we are trying to addText() the word plus a space separator (" "), after having calculated the word's width based on the 1-character word. We end up getting stuck in the while-loop.</p>

<p>I can't explain it any smarter as I'm having trouble with this complex recursion. But I got a quick and dirty fix for this:</p>

<pre class="highlight"><code>
173c173
&lt;           $maxTextSection=$this-&gt;_makeTextSection(array_shift($splitSection));
---
&gt;           $maxTextSection=$this-&gt;_makeTextSection(array_shift($splitSection) . ' ');
175c175
&lt;               $this-&gt;addText($maxTextSection['text'].' ');
---
&gt;               $this-&gt;addText($maxTextSection['text']);
177c177
&lt;               $maxTextSection=$this-&gt;_makeTextSection(array_shift($splitSection));
---
&gt;               $maxTextSection=$this-&gt;_makeTextSection(array_shift($splitSection) . ' ');
181c181
&lt;           $this-&gt;addText($maxTextSection['text'].' '.$restOfText);
---
&gt;           $this-&gt;addText($maxTextSection['text'].$restOfText);
</code></pre>

<p>I have updated the attached Cell.php</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Philip Iezzi (iezzip) on 2009-08-05T00:04:21.000+0000</p> 
        <div class="body">
            <p>besides, there was another bug I've fixed long time ago:</p>

<pre class="highlight"><code>
--- ZF-1254_Cell.php    2009-08-01 11:26:04.000000000 +0200
+++ Cell.php    2009-08-05 09:01:13.000000000 +0200
@@ -601,7 +601,7 @@
        for ($x=0;$xcmap-&gt;glyphNumbersForCharacters($charArray);
+       $charArray=$textSection['font']-&gt;glyphNumbersForCharacters($charArray);
        //get the lengths
        $lengths=$textSection['font']-&gt;widthsForGlyphs($charArray);
        $fontGlyphWidth=array_sum($lengths);
</code></pre>

<p>I've updated the attached Cell.php</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Gerrit Kamp (gkamp) on 2010-01-07T14:40:41.000+0000</p> 
        <div class="body">
            <p>I really like the Zend PDF functionality. It's fast and stable. But I think many users would benefit from two key features:
-Allow to parse HTML text (like here: <a href="http://fpdf.org/en/tutorial/tuto6.htm">http://fpdf.org/en/tutorial/tuto6.htm</a>)
-Allow to create tables (like above).</p>

<p>Are these types of functionality scheduled to be included in the core framework anytime soon? Without it, most PDF documents will look rather basic.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Peter Moolenaar (petermoolenaar) on 2010-01-22T03:48:57.000+0000</p> 
        <div class="body">
            <p>There is a proposal which has some very nice features related to this as well.
<a href="http://framework.zend.com/wiki/display/ZFPROP/Zend_Pdf+text+drawing+improvements+-+Nico+Edtinger">http://framework.zend.com/wiki/display/…</a></p>

<p>Maybe an idea to implement that one?</p>

        </div>
    </div>
    </div>

