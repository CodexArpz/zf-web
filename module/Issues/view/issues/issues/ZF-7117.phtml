<h2>ZF-7117: getClientIp() might be sensitive to spoofing</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2009-06-24T14:16:48.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2009-07-31T21:00:00.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul>        <li>1.9.0 (31/Jul/09)</li>
    </ul></dd>

    <dt>Reporter:</dt>
    <dd>
        None
                    </dd>

    <dt>Assignee:</dt>
    <dd>
                Jurrien Stutterheim (norm2782)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Controller</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>See <a href="https://trac.cakephp.org/ticket/5842">https://trac.cakephp.org/ticket/5842</a> for more information. Was mentioned in ZF-7092 before.</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Jurrien Stutterheim (norm2782) on 2009-06-25T15:55:23.000+0000</p> 
        <div class="body">
            <p>The concern was that the IP address might be faked by the client. The Cake issue suggests to add a flag for disabling the proxy check. With the proxy check disabled, only REMOTE_ADDR would be checked. Two issues arise with this solution:</p>

<p>1) REMOTE_ADDR is sensitive to spoofing as well
2) How do you determine whether to disable the proxy check or not?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Dolf Schimmel (Freeaqingme) (freak) on 2009-06-25T16:00:37.000+0000</p> 
        <div class="body">
            <p>This is not an issue at all (please close it as such). It should be something for the programmer to check. When for example you ban certain ip's just check for both the remote_addr and proxy ip, etc...</p>

<p>To quote a comment in the original cake issue: {quote}this is not a security exploit in Cake, but should certainly be something to be aware of when building an application.{quote}</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Jurrien Stutterheim (norm2782) on 2009-06-25T16:17:05.000+0000</p> 
        <div class="body">
            <p>You misunderstand the issue, Dolf. Also, please leave the decision to close an issue to the issue owner's own discretion.
Yes, programmers should check for things themselves and IP detection should <em>never</em> be used a a sole method of securing your application. However, the getClientIp() method should be able to give a programmer a convenient way to get the IP address and to determine if they want to check for proxies. Cake's solution is a decent approach.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Jurrien Stutterheim (norm2782) on 2009-06-25T20:35:33.000+0000</p> 
        <div class="body">
            <p>Added the option to not check HTTP_CLIENT_IP and HTTP_X_FORWARDED_FOR.
Resolved in r16304. Merged to release-1.8 in r16305</p>

        </div>
    </div>
    </div>

