<h2>ZF-2106: Problems on Zend_Controller_Router_Route with assemble and _values</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2007-10-27T08:33:15.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2007-11-17T06:48:56.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul></ul></dd>

    <dt>Reporter:</dt>
    <dd>
                Cristian Bichis (avantis)
            </dd>

    <dt>Assignee:</dt>
    <dd>
                Michal Minicki (martel)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Controller</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>Hello,</p>

<p>There is a problem with custom routes due to the way assemble function works with _values member.</p>

<p>match function is setting _values here:</p>

<pre class="highlight"><code>
                if ($name !== null) {
                    // It's a variable. Setting a value
                    $this-&gt;_values[$name] = $pathPart;
                    $unique[$name] = true;
                } else {
                    $pathStaticCount++;
                }
</code></pre>

<p>Problem is if we use assemble function to generate url's then on url to be created are automatically added params from _values</p>

<pre class="highlight"><code>
  } elseif (!$reset &amp;&amp; !$resetPart &amp;&amp; isset($this-&gt;_values[$part['name']])) {
    $url[$key] = $this-&gt;_values[$part['name']];
</code></pre>

<p>Sample: if i create a custom route and i am having these base params: page_id, language, name
 and some optional params, all links generated on a page which has a URL with an optional param then all links generated by assemble automatically contains the params from _values... Which is a bug of course...</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Cristian Bichis (avantis) on 2007-11-13T10:01:53.000+0000</p> 
        <div class="body">
            <p>No feedback yet on this problem ?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Matthew Weier O'Phinney (matthew) on 2007-11-16T14:50:19.000+0000</p> 
        <div class="body">
            <p>Assigning to Martel.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Michal Minicki (martel) on 2007-11-16T15:46:42.000+0000</p> 
        <div class="body">
            <p>I'm not sure I fully understand what you're getting at here, Cristian. Could you provide some more detailed code examples (routes) and the results you expect to get?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Cristian Bichis (avantis) on 2007-11-16T18:46:02.000+0000</p> 
        <div class="body">
            <p>Hello,</p>

<p>Route is this:</p>

<p>routes.default.type = "Imagis_Controller_Router_Route"
routes.default.route = ":seo_:page_:language_:v1_:v2"
routes.default.defaults.seo = "site description"
routes.default.defaults.page = 1
routes.default.defaults.language = ro
routes.default.defaults.v1 = 0
routes.default.defaults.v2 = 0</p>

<p>seo and page are required.</p>

<p>Ok, now on pages if i have on one of the first links on page generated by assemble language and v1 defined then ALL the links on page will get language and v1... Due to this</p>

<p>} elseif (!$reset &amp;&amp; !$resetPart &amp;&amp; isset($this-&gt;_values[$part['name']])) {
    $url[$key] = $this-&gt;_values[$part['name']];</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Michal Minicki (martel) on 2007-11-17T06:39:56.000+0000</p> 
        <div class="body">
            <p>You still haven't told me what do you expect to get.</p>

<p>Now, with your test data it works this way:</p>

<pre class="highlight"><code>
$route = new Zend_Controller_Router_Route(
  ":seo/:page/:language/:v1/:v2",
  array(
    'seo' =&gt; "site description",
    'page' =&gt; 1,
    'language' =&gt; 'ro',
    'v1' =&gt; 0,
    'v2' =&gt; 0
  )
);

$values = $route-&gt;match('desc/2/pl/3');

var_dump($values);

$url = $route-&gt;assemble();

var_dump($url);

$url = $route-&gt;assemble(array('v1' =&gt; 4));

var_dump($url);
</code></pre>

<p>Which results in:</p>

<pre class="highlight"><code>
array(5) {
  ["seo"]=&gt;
  string(4) "desc"
  ["page"]=&gt;
  string(1) "2"
  ["language"]=&gt;
  string(2) "pl"
  ["v1"]=&gt;
  string(1) "3"
  ["v2"]=&gt;
  int(0)
}
string(11) "desc/2/pl/3"
string(11) "desc/2/pl/4"
</code></pre>

<p>And it seems fine to me.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Michal Minicki (martel) on 2007-11-17T06:48:56.000+0000</p> 
        <div class="body">
            <p>More examples to show you how it's supposed to work:</p>

<pre class="highlight"><code>
$url = $route-&gt;assemble(array('v1' =&gt; null));

var_dump($url);

$url = $route-&gt;assemble(array('page' =&gt; 2), true);

var_dump($url);

$url = $route-&gt;assemble(array('v1' =&gt; 4), true);

var_dump($url);
</code></pre>

<p>Results in:</p>

<pre class="highlight"><code>
string(9) "desc/2/pl"
string(18) "site description/2"
string(23) "site description/1/ro/4"
</code></pre>

<p>If it does not resolve your issue, then please give some more detailed examples and expected values. Or better yet write a test case that I could run and see for myself. I'll reopen the ticket them.</p>

        </div>
    </div>
    </div>

