<h2>ZF-8375: Properly handle upper case language name in TMX </h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Improvement</dd>

    <dt>Created:</dt>
    <dd>2009-11-23T11:35:06.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2009-11-26T11:06:22.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul>        <li>1.10.0 (27/Jan/10)</li>
    </ul></dd>

    <dt>Reporter:</dt>
    <dd>
                Ankit Shah (akshah123)
            </dd>

    <dt>Assignee:</dt>
    <dd>
                Thomas Weidner (thomas)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Translate</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>At present, tmx file adapter simply puts whatever language name provided in the array, keeping the case of the language in the tmx file as a key in the array.</p>

<p>Therefore, if the file contains "EN", it will have $_data['EN']['test message'] = "test message - english";</p>

<p>However, a proper locale string must be "en".  So, if the xml file contains "EN", adapter does not find the message for query against locale "en".</p>

<p>It will return "test message" instead of "test message - english".  It is not efficient to change "EN" in xml to "en" as this file is generated by an editor which keeps the language as upper case.</p>

<p>ZF should do one of the following:</p>

<ol><li>Convert locale to lower case for user.</li>
<li>Error out the xml file as it is not a valid file.  (As you cannot set locate to "EN").</li>
</ol>
    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Thomas Weidner (thomas) on 2009-11-23T11:47:53.000+0000</p> 
        <div class="body">
            <ol><li><p>can not be done... it would disallow en_US as it would convert it to en_us making the same problems for region as before for language.</p></li>
<li><p>can not be done as invalid files are ignored while processing a directory search</p></li>
</ol>
        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ankit Shah (akshah123) on 2009-11-23T11:50:22.000+0000</p> 
        <div class="body">
            <p>For 1. it makes sense that the last two are upper cased.  However, is it not possible to make sure that we store en_us as en_US by simply splitting the string and making sure that first part is always lower cased and second part is always upper cased?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ankit Shah (akshah123) on 2009-11-23T11:57:00.000+0000</p> 
        <div class="body">
            <p>So, to elaborate, how about if we change line # 114 on Tmx.php from:</p>

<p>$this-&gt;_tuv = $attrib['xml:lang'];</p>

<p>to:</p>

<p>$tuv_array = explode("<em>", $attrib['xml:lang']);
$this-&gt;_tuv = strtolower($tuv_array[0]). (($tuv_array[1])?"</em>".strtoupper($tuv_array[1]):"");</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ankit Shah (akshah123) on 2009-11-23T11:59:37.000+0000</p> 
        <div class="body">
            <p>sorry properly formatted message for to:
{quote}
$tuv_array = explode("_", $attrib['xml:lang']);
$this-&gt;_tuv = strtolower($tuv_array[0]). (($tuv_array[1])?"".strtoupper($tuv_array[1]):"");
{quote}</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Thomas Weidner (thomas) on 2009-11-23T12:04:07.000+0000</p> 
        <div class="body">
            <p>Does not work as a locale can include also other informations.
And we expect that the lang attribut holds the locale information and not only the lang.</p>

<p>xml:lang could for example look like this:
ar_Arab_JE
or
de_DE_Punji</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ankit Shah (akshah123) on 2009-11-23T15:19:37.000+0000</p> 
        <div class="body">
            <p>Hi Thomas,</p>

<p>Thanks for your quick reply and attention.  I apologize if I am totally missing the point.</p>

<p>In any case, how about just simply changing the language part "EN" to lower case "en":</p>

<p>{quote}
$this-&gt;<em>tuv = strtolower($tuv_array[0]). (($tuv_array[1])?"</em>".implode("_", array_slice($tuv_array,1) ):"");
{quote}</p>

<p>I think the code definately needs to change one way or the other. If the case cannot be changed to lowercase, then xml should not be preocessed.  In my opinion, it does not make sense to process and store XML data if it cannot be accessed.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Thomas Weidner (thomas) on 2009-11-23T23:57:47.000+0000</p> 
        <div class="body">
            <p>I agree with xml:lang being an locale identifier.
That's the reason why I did not close this issue.</p>

<p>But, and this is more important for you, a locale is never uppercased.</p>

<p>This means that EN will also not be recognised afterwards.
en-us, en_us, en-US, en_US, en-us-Latn, en-us-ISO8859 and so on would then be recognised and switched to en_US.</p>

<p>In future an notice will be raised when an unidentified locale has been found. But the data will still be added. You could be in need of this feature when you extend the base class. And you could turn off the notice by an already existing option.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ankit Shah (akshah123) on 2009-11-24T07:29:33.000+0000</p> 
        <div class="body">
            <p>Thanks, Thomas.  That makes sense.  If at all possible, it would be great if you can keep the update to the class such that a person extending the tmx adapter can override behavior for matching locale by overriding a method.</p>

<p>Either way, I appreciate your time and please keep up the good work.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Thomas Weidner (thomas) on 2009-11-26T11:06:21.000+0000</p> 
        <div class="body">
            <p>New feature implemented with r19261 as described before.</p>

        </div>
    </div>
    </div>

