<h2>ZF2-405: PostgreSQL driver add quotes to the sentences and postgres can't resolve them</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2012-07-17T16:40:44.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2012-08-15T20:46:52.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul></ul></dd>

    <dt>Reporter:</dt>
    <dd>
                Rodolfo Bibolotti (rockdolfolk)
            </dd>

    <dt>Assignee:</dt>
    <dd>
                Ralph Schindler (ralph)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend\Db</li>
            <li>postgres,</li>
            <li>zend-db</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
        <li><a href="/issues/secure/attachment/15183/Album.php">Album.php</a></li>
            <li><a href="/issues/secure/attachment/15182/AlbumController.php">AlbumController.php</a></li>
            <li><a href="/issues/secure/attachment/15184/AlbumTable.php">AlbumTable.php</a></li>
            <li><a href="/issues/secure/attachment/15185/zf2-tutorial.rar">zf2-tutorial.rar</a></li>
        </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>Using ZF2b5</p>

<p>I have problems working with postgres with Zend\Db it adds quotes to the sentences and postgres can't execute them.</p>

<p>This is the error:</p>

<p>D:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Db\Adapter\Driver\Pdo\Statement.php:214</p>

<p>SQLSTATE[42P01]: Undefined table: 7 ERROR: no existe la relación «zf2tutorial.album»
LINE 1: SELECT "zf2tutorial.album".* FROM "zf2tutorial.album"
                                          ^</p>

<p>I executed the same sentence in pgsql and throws that same error. Then I removed the quotes and it works fine.</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Ralph Schindler (ralph) on 2012-07-17T16:44:28.000+0000</p> 
        <div class="body">
            <p>What is the full reproduction of this issue?  What method are you calling?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Rodolfo Bibolotti (rockdolfolk) on 2012-07-18T04:32:33.000+0000</p> 
        <div class="body">
            <p>Hi,</p>

<p>This is the message in the browser:</p>

<hr /><p>An error occurred
An error occurred during execution; please try again later.
Additional information:
Zend\Db\Adapter\Exception\InvalidQueryException
File:
C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Db\Adapter\Driver\Pdo\Statement.php:216
Message:
Statement could not be executed
Stack trace:</p>

<h1>0 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Db\TableGateway\AbstractTableGateway.php(235): Zend\Db\Adapter\Driver\Pdo\Statement-&gt;execute()</h1>

<h1>1 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Db\TableGateway\AbstractTableGateway.php(210): Zend\Db\TableGateway\AbstractTableGateway-&gt;executeSelect(Object(Zend\Db\Sql\Select))</h1>

<h1>2 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Db\TableGateway\AbstractTableGateway.php(197): Zend\Db\TableGateway\AbstractTableGateway-&gt;selectWith(Object(Zend\Db\Sql\Select))</h1>

<h1>3 C:\Sistemas\zf\zf2\zf2-tutorial\module\Album\src\Album\Model\AlbumTable.php(24): Zend\Db\TableGateway\AbstractTableGateway-&gt;select()</h1>

<h1>4 C:\Sistemas\zf\zf2\zf2-tutorial\module\Album\src\Album\Controller\AlbumController.php(17): Album\Model\AlbumTable-&gt;fetchAll()</h1>

<h1>5 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Mvc\Controller\AbstractActionController.php(150): Album\Controller\AlbumController-&gt;indexAction()</h1>

<h1>6 [internal function]: Zend\Mvc\Controller\AbstractActionController-&gt;execute(Object(Zend\Mvc\MvcEvent))</h1>

<h1>7 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\EventManager\EventManager.php(465): call_user_func(Array, Object(Zend\Mvc\MvcEvent))</h1>

<h1>8 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\EventManager\EventManager.php(205): Zend\EventManager\EventManager-&gt;triggerListeners('dispatch', Object(Zend\Mvc\MvcEvent), Object(Closure))</h1>

<h1>9 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Mvc\Controller\AbstractActionController.php(117): Zend\EventManager\EventManager-&gt;trigger('dispatch', Object(Zend\Mvc\MvcEvent), Object(Closure))</h1>

<h1>10 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Mvc\DispatchListener.php(151): Zend\Mvc\Controller\AbstractActionController-&gt;dispatch(Object(Zend\Http\PhpEnvironment\Request), Object(Zend\Http\PhpEnvironment\Response))</h1>

<h1>11 [internal function]: Zend\Mvc\DispatchListener-&gt;onDispatch(Object(Zend\Mvc\MvcEvent))</h1>

<h1>12 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\EventManager\EventManager.php(465): call_user_func(Array, Object(Zend\Mvc\MvcEvent))</h1>

<h1>13 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\EventManager\EventManager.php(205): Zend\EventManager\EventManager-&gt;triggerListeners('dispatch', Object(Zend\Mvc\MvcEvent), Object(Closure))</h1>

<h1>14 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Mvc\Application.php(317): Zend\EventManager\EventManager-&gt;trigger('dispatch', Object(Zend\Mvc\MvcEvent), Object(Closure))</h1>

<h1>15 C:\Sistemas\zf\zf2\zf2-tutorial\public\index.php(12): Zend\Mvc\Application-&gt;run()</h1>

<h1>16 {main}</h1>

<p>Previous exceptions:
PDOException
File:
C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Db\Adapter\Driver\Pdo\Statement.php:214
Message:
SQLSTATE[42P01]: Undefined table: 7 ERROR:  no existe la relación «zf2tutorial.album»
LINE 1: SELECT "zf2tutorial.album".* FROM "zf2tutorial.album"
                                          ^
Stack trace:</p>

<h1>0 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Db\Adapter\Driver\Pdo\Statement.php(214): PDOStatement-&gt;execute()</h1>

<h1>1 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Db\TableGateway\AbstractTableGateway.php(235): Zend\Db\Adapter\Driver\Pdo\Statement-&gt;execute()</h1>

<h1>2 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Db\TableGateway\AbstractTableGateway.php(210): Zend\Db\TableGateway\AbstractTableGateway-&gt;executeSelect(Object(Zend\Db\Sql\Select))</h1>

<h1>3 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Db\TableGateway\AbstractTableGateway.php(197): Zend\Db\TableGateway\AbstractTableGateway-&gt;selectWith(Object(Zend\Db\Sql\Select))</h1>

<h1>4 C:\Sistemas\zf\zf2\zf2-tutorial\module\Album\src\Album\Model\AlbumTable.php(24): Zend\Db\TableGateway\AbstractTableGateway-&gt;select()</h1>

<h1>5 C:\Sistemas\zf\zf2\zf2-tutorial\module\Album\src\Album\Controller\AlbumController.php(17): Album\Model\AlbumTable-&gt;fetchAll()</h1>

<h1>6 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Mvc\Controller\AbstractActionController.php(150): Album\Controller\AlbumController-&gt;indexAction()</h1>

<h1>7 [internal function]: Zend\Mvc\Controller\AbstractActionController-&gt;execute(Object(Zend\Mvc\MvcEvent))</h1>

<h1>8 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\EventManager\EventManager.php(465): call_user_func(Array, Object(Zend\Mvc\MvcEvent))</h1>

<h1>9 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\EventManager\EventManager.php(205): Zend\EventManager\EventManager-&gt;triggerListeners('dispatch', Object(Zend\Mvc\MvcEvent), Object(Closure))</h1>

<h1>10 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Mvc\Controller\AbstractActionController.php(117): Zend\EventManager\EventManager-&gt;trigger('dispatch', Object(Zend\Mvc\MvcEvent), Object(Closure))</h1>

<h1>11 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Mvc\DispatchListener.php(151): Zend\Mvc\Controller\AbstractActionController-&gt;dispatch(Object(Zend\Http\PhpEnvironment\Request), Object(Zend\Http\PhpEnvironment\Response))</h1>

<h1>12 [internal function]: Zend\Mvc\DispatchListener-&gt;onDispatch(Object(Zend\Mvc\MvcEvent))</h1>

<h1>13 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\EventManager\EventManager.php(465): call_user_func(Array, Object(Zend\Mvc\MvcEvent))</h1>

<h1>14 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\EventManager\EventManager.php(205): Zend\EventManager\EventManager-&gt;triggerListeners('dispatch', Object(Zend\Mvc\MvcEvent), Object(Closure))</h1>

<h1>15 C:\Sistemas\zf\zf2\zf2-tutorial\vendor\zendframework\zendframework\library\Zend\Mvc\Application.php(317): Zend\EventManager\EventManager-&gt;trigger('dispatch', Object(Zend\Mvc\MvcEvent), Object(Closure))</h1>

<h1>16 C:\Sistemas\zf\zf2\zf2-tutorial\public\index.php(12): Zend\Mvc\Application-&gt;run()</h1>

<h1>17 {main}</h1>

<hr /><p>This is the error:</p>

<p>SQLSTATE[42P01]: Undefined table: 7 ERROR:  no existe la relación «zf2tutorial.album»
LINE 1: SELECT "zf2tutorial.album".* FROM "zf2tutorial.album"
                                          ^</p>

<p>This is the connection in zf2-tutorial\config\autoload:</p>

<p>&lt;?php
return array(
    'db' =&gt; array(
            'driver' =&gt; 'Pdo_Pgsql',
            'database' =&gt; 'pruebas',
            'username' =&gt; 'rusuario',
            'password' =&gt; 'rusuario',
            'hostname' =&gt; 'windows-db'
    ),
    'service_manager' =&gt; array(
        'factories' =&gt; array(
            'Zend\Db\Adapter\Adapter' =&gt; 'Zend\Db\Adapter\AdapterServiceFactory',
        ),
    ),
);</p>

<p>Thanks.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ralph Schindler (ralph) on 2012-08-14T15:48:04.000+0000</p> 
        <div class="body">
            <p>I realize you are using Akrabat's ZF2 Tutorial, but what exactly is the API call to Zend\Db\Sql that is causing this error?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Rodolfo Bibolotti (rockdolfolk) on 2012-08-15T03:53:44.000+0000</p> 
        <div class="body">
            <p>Yes, is the akrabat's ZF2 tutorial but using postgres.</p>

<p>The sentence is</p>

<pre><code>    return new ViewModel(array(
            'albums' =&gt; $this-&gt;getAlbumTable()-&gt;fetchAll(), 
</code></pre>

<p>in the AlbumController.</p>

<p>I'm attaching the AlbumController class, the Album class and the AlbumTable class</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Rodolfo Bibolotti (rockdolfolk) on 2012-08-15T03:56:59.000+0000</p> 
        <div class="body">
            <p>AlbumController is in 
C:\Sistemas\zf\zf2\zf2-tutorial\module\Album\src\Album\Controller</p>

<p>Album and AlbumTable are in 
C:\Sistemas\zf\zf2\zf2-tutorial\module\Album\src\Album\Model</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Rodolfo Bibolotti (rockdolfolk) on 2012-08-15T04:05:01.000+0000</p> 
        <div class="body">
            <p>this is the whole project. It is not complete because in the tutorial I can't continue from this test:</p>

<p><a href="http://zf2-tutorial/album">http://zf2-tutorial/album</a></p>

<p>this is the virtual host:</p>

<p>
    ServerName zf2-tutorial
    DocumentRoot <a>c:/sistemas/zf/zf2/zf2-tutorial/public</a>
    SetEnv APPLICATION_ENV "development"
    
        DirectoryIndex index.php
        AllowOverride All
        Order allow,deny
        Allow from all
    </p>

<p>Thanks.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ralph Schindler (ralph) on 2012-08-15T16:28:53.000+0000</p> 
        <div class="body">
            <p>I've downloaded Akrabats tutorial and I can confirm it works on Postgresql.  If you find it doesn't work still, please file issues with his project here:</p>

<p><a href="https://github.com/akrabat/zf2-tutorial/">https://github.com/akrabat/zf2-tutorial/</a></p>

<p>-ralph</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Rodolfo Bibolotti (rockdolfolk) on 2012-08-15T20:46:52.000+0000</p> 
        <div class="body">
            <p>thanks Ralph.
I dowloaded all the tutorial and I works well (after some intents) when I don't use a schema. Is there a way to specify a schema in ZF2?</p>

        </div>
    </div>
    </div>

