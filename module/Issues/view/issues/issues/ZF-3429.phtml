<h2>ZF-3429: Dangerous use of lastInsertId and lastSequenceId</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Docs:  Problem</dd>

    <dt>Created:</dt>
    <dd>2008-06-10T05:47:33.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2008-06-15T21:29:53.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul></ul></dd>

    <dt>Reporter:</dt>
    <dd>
                Ric C (lionheart33806)
            </dd>

    <dt>Assignee:</dt>
    <dd>
                Ralph Schindler (ralph)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Db</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>Hi,</p>

<p>Well, I'm not a "Zend Framework" developper but I saw a big problem in the doc.</p>

<p>In <a href="http://framework.zend.com/manual/en/zend.db.html">http://framework.zend.com/manual/en/zend.db.html</a>, we can see :</p>

<p>$db-&gt;insert('bugs', $data);</p>

<p>// return the last value generated by sequence 'bugs_id_gen'.
$id = $db-&gt;lastSequenceId('bugs_id_gen');</p>

<p>I read the ZF code and I think I can say that using lastInsertId and lastSequenceId, we can't be sure that the ids are the ones created for the insert command.</p>

<p>Ex : If 2 clients do an insert and then do a lastInsertId (or lastSequenceId), they will have the same id !
It seems that the "good-created" ids are in the returned value of the insert.</p>

<p>Please correct this !</p>

<p>The problem is the same in french version.</p>

<p>Thanks</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by julien PAULI (doctorrock83) on 2008-06-10T08:28:12.000+0000</p> 
        <div class="body">
            <p>mmm I don't think so.
LasterInsertId() should be client aware and fully atomic. That's the main difference between lastInsertId() and some kind of select(max(id)) from table.</p>

<p>Perhaps I'm wrong, I dont know all RDBMs</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ric C (lionheart33806) on 2008-06-12T08:08:37.000+0000</p> 
        <div class="body">
            <p>Well, I read more about my "issue".</p>

<p>Finally, I didn't know that for <em>Oracle CURRVAL</em> worked only in the current session. In fact, CURRVAL is linked to the NEXTVAL previously used.
So, it can't happen multiple users problems.</p>

<p>Sorry for my intervention, you can close the issue.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by julien PAULI (doctorrock83) on 2008-06-12T08:18:42.000+0000</p> 
        <div class="body">
            <p>Not an issue</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Wil Sinclair (wil) on 2008-06-15T21:29:53.000+0000</p> 
        <div class="body">
            <p>Updating to comply with new IT component conventions.</p>

        </div>
    </div>
    </div>

