<h2>ZF-2684: Zend_Mail wrong encode of  mail subject, if it contain underscore</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2008-02-18T23:56:27.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2011-08-03T15:55:56.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul>        <li> 1.5.2 (15/May/08)</li>
    </ul></dd>

    <dt>Reporter:</dt>
    <dd>
        None
                    </dd>

    <dt>Assignee:</dt>
    <dd>
                Satoru Yoshida (satoruyoshida)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Mail</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>I cannot decode mail subject in Japanese at OutlookExpress and Gmail.
I think encoding for '_' (underscore) is wrong.</p>

<p>function _encodeHeader()
 $quotedValue = str_replace(array('?', ' '), array('=3F', '=20'), $quotedValue);</p>

<p>fix like this
 $quotedValue = str_replace(array('?', ' ', '_'), array('=3F', '=20', '=5F'), $quotedValue);</p>

<p>I check correctly at OE and Gmail.</p>

<p>thank you</p>

<p>(Ref)
The "Q" encoding defined in RFC2047
4.2.2
The 8-bit hexadecimal value 20 (e.g., ISO-8859-1 SPACE) may be represented as "_" (underscore, ASCII 95.). (This character may not pass through some internetwork mail gateways, but its use will greatly enhance readability of "Q" encoded data with mail readers that do not support this encoding.) Note that the "_" always represents hexadecimal 20, even if the SPACE character occupies a different code position in the character set in use.</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by old of Satoru Yoshida (yoshida@zend.co.jp) on 2008-04-14T08:50:40.000+0000</p> 
        <div class="body">
            <p>Thank you for report. Fixed in SVN r9222</p>

        </div>
    </div>
    </div>

