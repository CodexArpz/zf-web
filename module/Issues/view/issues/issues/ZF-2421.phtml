<h2>ZF-2421: Zend_InfoCard tests give 2 warnings before 1 fatal error</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Unit Tests: Problem</dd>

    <dt>Created:</dt>
    <dd>2008-01-11T10:54:12.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2008-03-21T16:25:48.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul>        <li>1.5.0 (17/Mar/08)</li>
    </ul></dd>

    <dt>Reporter:</dt>
    <dd>
                Darby Felton (darby)
            </dd>

    <dt>Assignee:</dt>
    <dd>
                Darby Felton (darby)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_InfoCard</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
        <li><a href="/issues/browse/ZF-2328">ZF-2328</a></li>
        </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>The unit test suite for Zend_InfoCard fails with a fatal error:</p>

<pre class="literal">
phpunit --verbose --report Zend_InfoCard_AllTests Zend_InfoCard_AllTests &gt; Zend_InfoCard_AllTests.out 2&gt;&amp;1
</pre>

<p>I get the following output:</p>

<pre class="literal">
PHPUnit 3.2.8 by Sebastian Bergmann.

Zend Framework - Zend_InfoCard
 Zend_InfoCard_AssertionTest
 ..

 Zend_InfoCard_ProcessTest
 .
Warning: base64_decode() expects exactly 1 parameter, 2 given in c:\Documents and Settings\dfelton\My Documents\SVN Remo
te\Zend Framework\trunk\library\Zend\InfoCard\Xml\SecurityTokenReference.php on line 154

Call Stack:
    0.0405   1. {main}() c:\wamp\php\PEAR\PHPUnit\TextUI\Command.php:0
    7.1995   2. PHPUnit_TextUI_Command::main() c:\wamp\php\PEAR\PHPUnit\TextUI\Command.php:528
    8.5641   3. PHPUnit_TextUI_TestRunner-&gt;doRun() c:\wamp\php\PEAR\PHPUnit\TextUI\Command.php:112
    8.5660   4. PHPUnit_Framework_TestSuite-&gt;run() C:\wamp\php\PEAR\PHPUnit\TextUI\TestRunner.php:298
    9.5484   5. PHPUnit_Framework_TestSuite-&gt;run() C:\wamp\php\PEAR\PHPUnit\Framework\TestSuite.php:633
    9.6111   6. PHPUnit_Framework_TestSuite-&gt;runTest() C:\wamp\php\PEAR\PHPUnit\Framework\TestSuite.php:650
    9.6111   7. PHPUnit_Framework_TestCase-&gt;run() C:\wamp\php\PEAR\PHPUnit\Framework\TestSuite.php:670
    9.6111   8. PHPUnit_Framework_TestResult-&gt;run() C:\wamp\php\PEAR\PHPUnit\Framework\TestCase.php:351
    9.6116   9. PHPUnit_Framework_TestCase-&gt;runBare() C:\wamp\php\PEAR\PHPUnit\Framework\TestResult.php:597
    9.6212  10. PHPUnit_Framework_TestCase-&gt;runTest() C:\wamp\php\PEAR\PHPUnit\Framework\TestCase.php:376
    9.6215  11. ReflectionMethod-&gt;invoke() C:\wamp\php\PEAR\PHPUnit\Framework\TestCase.php:449
    9.6215  12. Zend_InfoCard_ProcessTest-&gt;testStandAloneProcess() c:\Documents and Settings\dfelton\My Documents\SVN Re
mote\Zend Framework\trunk\tests\Zend\InfoCard\ProcessTest.php:0
    9.6340  13. Zend_InfoCard-&gt;process() c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Framework\trunk\
tests\Zend\InfoCard\ProcessTest.php:130
    9.6343  14. Zend_InfoCard-&gt;_extractSignedToken() c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Fram
ework\trunk\library\Zend\InfoCard.php:409
    9.7970  15. Zend_InfoCard_Xml_SecurityTokenReference-&gt;getKeyReference() c:\Documents and Settings\dfelton\My Documen
ts\SVN Remote\Zend Framework\trunk\library\Zend\InfoCard.php:371
    9.7983  16. base64_decode() c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Framework\trunk\library\Z
end\InfoCard\Xml\SecurityTokenReference.php:154

.
Warning: base64_decode() expects exactly 1 parameter, 2 given in c:\Documents and Settings\dfelton\My Documents\SVN Remo
te\Zend Framework\trunk\library\Zend\InfoCard\Xml\SecurityTokenReference.php on line 154

Call Stack:
    0.0405   1. {main}() c:\wamp\php\PEAR\PHPUnit\TextUI\Command.php:0
    7.1995   2. PHPUnit_TextUI_Command::main() c:\wamp\php\PEAR\PHPUnit\TextUI\Command.php:528
    8.5641   3. PHPUnit_TextUI_TestRunner-&gt;doRun() c:\wamp\php\PEAR\PHPUnit\TextUI\Command.php:112
    8.5660   4. PHPUnit_Framework_TestSuite-&gt;run() C:\wamp\php\PEAR\PHPUnit\TextUI\TestRunner.php:298
    9.5484   5. PHPUnit_Framework_TestSuite-&gt;run() C:\wamp\php\PEAR\PHPUnit\Framework\TestSuite.php:633
    9.8108   6. PHPUnit_Framework_TestSuite-&gt;runTest() C:\wamp\php\PEAR\PHPUnit\Framework\TestSuite.php:650
    9.8109   7. PHPUnit_Framework_TestCase-&gt;run() C:\wamp\php\PEAR\PHPUnit\Framework\TestSuite.php:670
    9.8109   8. PHPUnit_Framework_TestResult-&gt;run() C:\wamp\php\PEAR\PHPUnit\Framework\TestCase.php:351
    9.8114   9. PHPUnit_Framework_TestCase-&gt;runBare() C:\wamp\php\PEAR\PHPUnit\Framework\TestResult.php:597
    9.8198  10. PHPUnit_Framework_TestCase-&gt;runTest() C:\wamp\php\PEAR\PHPUnit\Framework\TestCase.php:376
    9.8201  11. ReflectionMethod-&gt;invoke() C:\wamp\php\PEAR\PHPUnit\Framework\TestCase.php:449
    9.8201  12. Zend_InfoCard_ProcessTest-&gt;testPlugins() c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend
Framework\trunk\tests\Zend\InfoCard\ProcessTest.php:0
    9.8336  13. Zend_InfoCard-&gt;process() c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Framework\trunk\
tests\Zend\InfoCard\ProcessTest.php:149
    9.8339  14. Zend_InfoCard-&gt;_extractSignedToken() c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Fram
ework\trunk\library\Zend\InfoCard.php:409
    9.8530  15. Zend_InfoCard_Xml_SecurityTokenReference-&gt;getKeyReference() c:\Documents and Settings\dfelton\My Documen
ts\SVN Remote\Zend Framework\trunk\library\Zend\InfoCard.php:371
    9.8547  16. base64_decode() c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Framework\trunk\library\Z
end\InfoCard\Xml\SecurityTokenReference.php:154


Fatal error: Class 'Zend_InfoCard_Cipher_Symmetric_Adapter_AES256CBC' not found in c:\Documents and Settings\dfelton\My
Documents\SVN Remote\Zend Framework\trunk\tests\Zend\InfoCard\ProcessTest.php on line 157

Call Stack:
    0.0405   1. {main}() c:\wamp\php\PEAR\PHPUnit\TextUI\Command.php:0
    7.1995   2. PHPUnit_TextUI_Command::main() c:\wamp\php\PEAR\PHPUnit\TextUI\Command.php:528
    8.5641   3. PHPUnit_TextUI_TestRunner-&gt;doRun() c:\wamp\php\PEAR\PHPUnit\TextUI\Command.php:112
    8.5660   4. PHPUnit_Framework_TestSuite-&gt;run() C:\wamp\php\PEAR\PHPUnit\TextUI\TestRunner.php:298
    9.5484   5. PHPUnit_Framework_TestSuite-&gt;run() C:\wamp\php\PEAR\PHPUnit\Framework\TestSuite.php:633
    9.8108   6. PHPUnit_Framework_TestSuite-&gt;runTest() C:\wamp\php\PEAR\PHPUnit\Framework\TestSuite.php:650
    9.8109   7. PHPUnit_Framework_TestCase-&gt;run() C:\wamp\php\PEAR\PHPUnit\Framework\TestSuite.php:670
    9.8109   8. PHPUnit_Framework_TestResult-&gt;run() C:\wamp\php\PEAR\PHPUnit\Framework\TestCase.php:351
    9.8114   9. PHPUnit_Framework_TestCase-&gt;runBare() C:\wamp\php\PEAR\PHPUnit\Framework\TestResult.php:597
    9.8198  10. PHPUnit_Framework_TestCase-&gt;runTest() C:\wamp\php\PEAR\PHPUnit\Framework\TestCase.php:376
    9.8201  11. ReflectionMethod-&gt;invoke() C:\wamp\php\PEAR\PHPUnit\Framework\TestCase.php:449
    9.8201  12. Zend_InfoCard_ProcessTest-&gt;testPlugins() c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend
Framework\trunk\tests\Zend\InfoCard\ProcessTest.php:0
</pre>

<p>Running WinXP, PHP 5.1.4; I can provide more information about my environment upon request.</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by John Coggeshall (coogle) on 2008-02-05T15:16:15.000+0000</p> 
        <div class="body">
            <p>The second parameter of base64_decode isn't available unless you have PHP 5.2.0+ so I added a version check to make sure before moving forward..</p>

<p><a href="http://www.php.net/base64_decode">http://www.php.net/base64_decode</a></p>

<p>I would just remove the strict-check, but considering the security/identity nature of the component I think being as strict as possible makes sense here..</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Darby Felton (darby) on 2008-02-29T09:20:10.000+0000</p> 
        <div class="body">
            <p>Reopening issue with new but strongly correlated test results:</p>

<pre class="literal">
There were 3 errors:

1) testStandAloneProcess(Zend_InfoCard_ProcessTest)
base64_decode() expects exactly 1 parameter, 2 given
c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Framework\trunk\library\Zend\InfoCard.php:387
c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Framework\trunk\library\Zend\InfoCard.php:409
c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Framework\trunk\tests\Zend\InfoCard\ProcessTest.php:130

2) testPlugins(Zend_InfoCard_ProcessTest)
base64_decode() expects exactly 1 parameter, 2 given
c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Framework\trunk\library\Zend\InfoCard.php:387
c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Framework\trunk\library\Zend\InfoCard.php:409
c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Framework\trunk\tests\Zend\InfoCard\ProcessTest.php:149

3) testClaims(Zend_InfoCard_ProcessTest)
base64_decode() expects exactly 1 parameter, 2 given
c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Framework\trunk\library\Zend\InfoCard.php:387
c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Framework\trunk\library\Zend\InfoCard.php:409
c:\Documents and Settings\dfelton\My Documents\SVN Remote\Zend Framework\trunk\tests\Zend\InfoCard\ProcessTest.php:170
</pre>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Darby Felton (darby) on 2008-03-06T14:49:11.000+0000</p> 
        <div class="body">
            <p>Fixed with <a href="http://framework.zend.com/fisheye/changelog/Zend_Framework/?cs=8600">SVN r8600</a>.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Darby Felton (darby) on 2008-03-06T14:52:01.000+0000</p> 
        <div class="body">
            <p>Fixed for 1.5.0RC2 with <a href="http://framework.zend.com/fisheye/changelog/Zend_Framework/?cs=8601">SVN r8601</a>.</p>

        </div>
    </div>
    </div>

