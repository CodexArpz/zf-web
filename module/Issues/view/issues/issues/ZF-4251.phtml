<h2>ZF-4251: Zend_Db_Adapter_Pdo_Mssql doeas not support both LIMIT and DISTINCT in the same query</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2008-09-11T08:26:08.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2009-08-24T10:50:25.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul>        <li>1.9.2 (25/Aug/09)</li>
    </ul></dd>

    <dt>Reporter:</dt>
    <dd>
                Zsolt Gyöngyösi (gyongyeee)
            </dd>

    <dt>Assignee:</dt>
    <dd>
                Ralph Schindler (ralph)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Db</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>MsSql does not support OFFSET parameter for LIMIT.
Zend_Db_Adapter_Pdo_Mssql implements a workaround by using the original query as a subquery, so it prepends and appends the required code to the original query.
Zend_Db_Adapter_Pdo_Mssql-&gt;limit method not takes care of the DISTINCT clause, so generates 
... (SELECT TOP xx DISTINCT ... like query, but the correct syntax would be ...( SELECT DISTINCT TOP xx ...</p>

<p>Possible correction use '/^SELECT\s+(DISTINCT\s+)?/i' regular expression insead of  '/^SELECT\s/i'</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Ralph Schindler (ralph) on 2009-08-21T07:03:04.000+0000</p> 
        <div class="body">
            <p>A fix has been supplied in r17713, please test.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ralph Schindler (ralph) on 2009-08-24T10:50:25.000+0000</p> 
        <div class="body">
            <p>Fixed in release branch 1.9</p>

        </div>
    </div>
    </div>

