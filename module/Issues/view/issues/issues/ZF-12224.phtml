<h2>ZF-12224: Zend_Json::fromXml creates empty json string</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2012-05-21T22:40:22.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2012-08-07T13:17:39.000+0000</dd>

    <dt>Status:</dt>
    <dd>Open</dd>

    <dt>Fix version(s):</dt>
    <dd><ul></ul></dd>

    <dt>Reporter:</dt>
    <dd>
                lindon (lindon)
            </dd>

    <dt>Assignee:</dt>
    <dd>
                Matthew Weier O'Phinney (matthew)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Json</li>
            <li>Zend_Json::fromXml()</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>I have extracted an xml (xmp) string from a jpeg photo and successfully loaded it to create a DOMDocument in php. When I export the xml string from the DOMDocument (using $xmlstring = $xmldocument-&gt;saveXML()) and try to create a json string using Zend_Json::fromXml($xmlstring), I get the following "empty" json string:
{"RDF":""}</p>

<p>Same thing happens when I use the xml string directly (ie without loading to a DOMDocument first). There aren't many recursion levels in the string (2 or 3) and I'm able to manipulate the DOMDocument in php without any issues.</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Frank Brückner (frosch) on 2012-05-22T08:56:31.000+0000</p> 
        <div class="body">
            <p>Can you post the XML string here?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by lindon (lindon) on 2012-05-24T03:54:50.000+0000</p> 
        <div class="body">
            <p>Here's the xml string:</p>

<p>www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;
      123000000/100003000000/10000</p>

<pre><code>     &lt;tiff:ResolutionUnit&gt;2&lt;/tiff:ResolutionUnit&gt;
     &lt;tiff:Make&gt;NIKON CORPORATION&lt;/tiff:Make&gt;
     &lt;tiff:Model&gt;NIKON D200&lt;/tiff:Model&gt;
     &lt;tiff:NativeDigest&gt;256,257,258,259,262,274,277,284,530,531,282,283,296,301,318,319,529,532,306,270,271,272,305,315,33432;B47C241E53ED5D64CA700180D73CEC2B&lt;/tiff:NativeDigest&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description xmlns:xap="http://ns.adobe.com/xap/1.0/" rdf:about=""&gt;
     &lt;xap:ModifyDate&gt;2006-09-08T16:55:07-04:00&lt;/xap:ModifyDate&gt;

     &lt;xap:CreatorTool&gt;Adobe Photoshop CS2 Windows&lt;/xap:CreatorTool&gt;
     &lt;xap:CreateDate&gt;2006-08-29T09:42:26-04:00&lt;/xap:CreateDate&gt;
     &lt;xap:MetadataDate&gt;2006-09-08T16:55:07-04:00&lt;/xap:MetadataDate&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description xmlns:exif="http://ns.adobe.com/exif/1.0/" rdf:about=""&gt;
     &lt;exif:ExifVersion&gt;0221&lt;/exif:ExifVersion&gt;
     &lt;exif:FlashpixVersion&gt;0100&lt;/exif:FlashpixVersion&gt;

     &lt;exif:CompressedBitsPerPixel&gt;4/1&lt;/exif:CompressedBitsPerPixel&gt;
     &lt;exif:PixelXDimension&gt;800&lt;/exif:PixelXDimension&gt;
     &lt;exif:PixelYDimension&gt;536&lt;/exif:PixelYDimension&gt;
     &lt;exif:DateTimeOriginal&gt;2006-08-29T09:42:26-04:00&lt;/exif:DateTimeOriginal&gt;
     &lt;exif:DateTimeDigitized&gt;2006-08-29T09:42:26-04:00&lt;/exif:DateTimeDigitized&gt;
     &lt;exif:ExposureTime&gt;10/1000&lt;/exif:ExposureTime&gt;

     &lt;exif:FNumber&gt;56/10&lt;/exif:FNumber&gt;
     &lt;exif:ExposureProgram&gt;2&lt;/exif:ExposureProgram&gt;
     &lt;exif:ExposureBiasValue&gt;0/6&lt;/exif:ExposureBiasValue&gt;
     &lt;exif:MaxApertureValue&gt;41/10&lt;/exif:MaxApertureValue&gt;
     &lt;exif:MeteringMode&gt;2&lt;/exif:MeteringMode&gt;
     &lt;exif:LightSource&gt;0&lt;/exif:LightSource&gt;

     &lt;exif:FocalLength&gt;520/10&lt;/exif:FocalLength&gt;
     &lt;exif:SensingMethod&gt;2&lt;/exif:SensingMethod&gt;
     &lt;exif:FileSource&gt;3&lt;/exif:FileSource&gt;
     &lt;exif:SceneType&gt;1&lt;/exif:SceneType&gt;
     &lt;exif:CustomRendered&gt;0&lt;/exif:CustomRendered&gt;
     &lt;exif:ExposureMode&gt;0&lt;/exif:ExposureMode&gt;

     &lt;exif:WhiteBalance&gt;0&lt;/exif:WhiteBalance&gt;
     &lt;exif:DigitalZoomRatio&gt;1/1&lt;/exif:DigitalZoomRatio&gt;
     &lt;exif:FocalLengthIn35mmFilm&gt;78&lt;/exif:FocalLengthIn35mmFilm&gt;
     &lt;exif:SceneCaptureType&gt;0&lt;/exif:SceneCaptureType&gt;
     &lt;exif:GainControl&gt;0&lt;/exif:GainControl&gt;
     &lt;exif:Contrast&gt;0&lt;/exif:Contrast&gt;

     &lt;exif:Saturation&gt;0&lt;/exif:Saturation&gt;
     &lt;exif:Sharpness&gt;0&lt;/exif:Sharpness&gt;
     &lt;exif:SubjectDistanceRange&gt;0&lt;/exif:SubjectDistanceRange&gt;
     &lt;exif:GPSVersionID&gt;0.0.2.2&lt;/exif:GPSVersionID&gt;
     &lt;exif:ISOSpeedRatings&gt;
        &lt;rdf:Seq&gt;
           &lt;rdf:li&gt;100&lt;/rdf:li&gt;

        &lt;/rdf:Seq&gt;
     &lt;/exif:ISOSpeedRatings&gt;
     &lt;exif:Flash rdf:parseType="Resource"&gt;
        &lt;exif:Fired&gt;False&lt;/exif:Fired&gt;
        &lt;exif:Return&gt;0&lt;/exif:Return&gt;
        &lt;exif:Mode&gt;0&lt;/exif:Mode&gt;
        &lt;exif:Function&gt;False&lt;/exif:Function&gt;

        &lt;exif:RedEyeMode&gt;False&lt;/exif:RedEyeMode&gt;
     &lt;/exif:Flash&gt;
     &lt;exif:ColorSpace&gt;-1&lt;/exif:ColorSpace&gt;
     &lt;exif:NativeDigest&gt;36864,40960,40961,37121,37122,40962,40963,37510,40964,36867,36868,33434,33437,34850,34852,34855,34856,37377,37378,37379,37380,37381,37382,37383,37384,37385,37386,37396,41483,41484,41486,41487,41488,41492,41493,41495,41728,41729,41730,41985,41986,41987,41988,41989,41990,41991,41992,41993,41994,41995,41996,42016,0,2,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20,22,23,24,25,26,27,28,30;47A06DE371320245089B1A1DAA388AC7&lt;/exif:NativeDigest&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description xmlns:xapMM="http://ns.adobe.com/xap/1.0/mm/" rdf:about=""&gt;
     &lt;xapMM:DocumentID&gt;uuid:EABB739A6F3FDB11AB45EE04CB17DD9C&lt;/xapMM:DocumentID&gt;

     &lt;xapMM:InstanceID&gt;uuid:8911EA4E7C3FDB11AB45EE04CB17DD9C&lt;/xapMM:InstanceID&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description xmlns:dc="http://purl.org/dc/elements/1.1/" rdf:about=""&gt;
     &lt;dc:format&gt;image/jpeg&lt;/dc:format&gt;
     &lt;dc:creator&gt;
        &lt;rdf:Seq&gt;
           &lt;rdf:li&gt;Matt Turner&lt;/rdf:li&gt;

        &lt;/rdf:Seq&gt;
     &lt;/dc:creator&gt;
     &lt;dc:title&gt;
        &lt;rdf:Alt&gt;
           &lt;rdf:li xml:lang="x-default"&gt;maine boat&lt;/rdf:li&gt;
        &lt;/rdf:Alt&gt;
     &lt;/dc:title&gt;
     &lt;dc:subject&gt;

        &lt;rdf:Bag&gt;
           &lt;rdf:li&gt;boat&lt;/rdf:li&gt;
           &lt;rdf:li&gt;reflection&lt;/rdf:li&gt;
           &lt;rdf:li&gt;row&lt;/rdf:li&gt;
           &lt;rdf:li&gt;wood&lt;/rdf:li&gt;
        &lt;/rdf:Bag&gt;
     &lt;/dc:subject&gt;

  &lt;/rdf:Description&gt;
  &lt;rdf:Description xmlns:photoshop="http://ns.adobe.com/photoshop/1.0/" rdf:about=""&gt;
     &lt;photoshop:ColorMode&gt;3&lt;/photoshop:ColorMode&gt;
     &lt;photoshop:AuthorsPosition&gt;Mr&lt;/photoshop:AuthorsPosition&gt;
     &lt;photoshop:History/&gt;
  &lt;/rdf:Description&gt;
</code></pre>

<p></p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Frank Brückner (frosch) on 2012-05-24T08:12:25.000+0000</p> 
        <div class="body">
            <p><a href="http://groups.google.com/group/comp.lang.php/browse_thread/thread/d2a9b29ee21f7403/c6b24b6d398ece2c">This is a {{SimpleXML}} problem.</a></p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by lindon (lindon) on 2012-05-29T01:14:20.000+0000</p> 
        <div class="body">
            <p>Thanks for looking at this. Not too sure about the answer you found though. When I step through the code, the problem seems to be in the _processXml function in Zend/Json.php. In that function the $children variable doesn't work for the example above (and perhaps anytime namespaces are used?).</p>

<p>When namespaces are used, I think you would need to start with one of the following:
//either get all namespaces used at once
//the below would return an array of 8 namespaces for the above xml: rdf, tiff, xap, exif, xapMM, dc, xml, photoshop
$ns = $simpleXmlElementObject-&gt;getNamespaces(true);</p>

<p>//or to start with just the top level namespace
//the below would return an array with a single namespace for the above xml: rdf
$ns = $simpleXmlElementObject-&gt;getNamespaces();</p>

<p>//then get children by iterating through the namespaces
//for the above xml, the below would return 6 children for the rdf namespace
foreach($ns as $namespace =&gt; $url) {
    $children = $simpleXmlElementObject-&gt;children($namespace, true);
}</p>

<p>With the existing code, $children is 0, which seems to be the reason an empty string is returned.</p>

<p>The answer you linked to suggested the colons in the xml tags caused a problem in SimpleXML. Not sure what problem is being referred to - the colons signify the use of namespaces and SimpleXML can easily return the part before the colon (the namespace), or the part after (the name).
Thanks again for your help.
lindon</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Tamlyn Rhodes (tamlyn) on 2012-08-07T13:17:39.000+0000</p> 
        <div class="body">
            <p>I don't think this is a problem with SimpleXML. The comp.lang.php discussion linked above is very old, possibly from before SimpleXML supported namespaced elements which it definitely does do now as explained by @lindon.</p>

<p>It would be very useful if Zend_Json could handle namespaces.</p>

        </div>
    </div>
    </div>

