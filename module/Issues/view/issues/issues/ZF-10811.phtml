<h2>ZF-10811: Zend_Ldap work properly in windows but crash in centos</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2010-12-11T15:16:06.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2012-08-27T17:00:03.000+0000</dd>

    <dt>Status:</dt>
    <dd>Open</dd>

    <dt>Fix version(s):</dt>
    <dd><ul></ul></dd>

    <dt>Reporter:</dt>
    <dd>
                Ramlan Gustian (rampog)
            </dd>

    <dt>Assignee:</dt>
    <dd>
                Stefan Gehrig (sgehrig)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Ldap</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>dear all
the php terminated scripts when connect to Active Directory Windows when invalid credential
but when i try
in windows return
"0x31 (Invalid credentials; 80090308: LdapErr: DSID-0C0903A9, comment: AcceptSecurityContext error, data 52e, v1db0): administratord@domain.myhost.com"</p>

<p>capture of my code
$options = array(
'host' =&gt; '10.10.10.110',
'username' =&gt; 'administratord',
'password' =&gt; 'P@ssw0rd',
'accountDomainName' =&gt; 'domain.myhost.com',
'accountCanonicalForm' =&gt; 4,
'optReferrals' =&gt; 0,
'baseDn' =&gt; 'DC=domain,DC=myhost,DC=com'
);
$ldap=new Zend_Ldap($options);
$connected = $ldap-&gt;connect();
$data = $ldap-&gt;getResource();
var_dump($data);</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Stefan Gehrig (sgehrig) on 2010-12-12T22:58:42.000+0000</p> 
        <div class="body">
            <p>Could you please make sure, that ext/ldap (that's the LDAP PHP extension) is working correctly on your CentOs machine? Try to connect to the server using the core ldap_*-functions.
Check you php.ini for any configuration parameters present - also check phpinfo(); for the ext/ldap.</p>

<p>It's quite uncommon that Zend_Ldap brings down the whole script by itself without any error message.</p>

<p>Please also do a check on your error log. If you disabled error logging, please turn it on, so that PHP low-level errors are logged to a file (alternatively switch display_errors on so that PHP low-level errors are displayed on screen),</p>

<p>We'd need a lot mor information to do some debugging on this one.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ramlan Gustian (rampog) on 2010-12-12T23:34:26.000+0000</p> 
        <div class="body">
            <p>Hi Stefan Gehrig 
i am very pleasure for reply
i have created new case in ticketing support but still no reply
i also have attach files that support tools generate</p>

<p>all is well connecting to Active Directory both windows &amp; my centOs machine if valid username &amp; password</p>

<p>but only invalid credential in my CentOs machine terminated scripts</p>

<p>i check in /usr/local/zend/var/log/php.log nothing change when i execute that invalid credential</p>

<p>for info</p>

<p>centOs machine 
PHP Version 5.3.1</p>

<p>display_errors - On
error_log - /usr/local/zend/var/log/php.log<br />
error_reporting - E_ALL</p>

<p>should i place files that generated by zend CE support tools is possible here?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Stefan Gehrig (sgehrig) on 2010-12-13T04:40:22.000+0000</p> 
        <div class="body">
            <p>Strange... Please post as much information as possible (remove such things as usernames, password and server addresses / names if possible).</p>

<p>What does</p>

<pre class="highlight"><code>
var_dump($connected);
</code></pre>

<p>print (inserted before the second-to-last line)?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ramlan Gustian (rampog) on 2010-12-13T19:02:51.000+0000</p> 
        <div class="body">
            <p>return like this when i var_dump for invalid credential but i should be place before</p>

<pre class="highlight"><code>

object(Zend_Ldap)#142 (6) { ["_connectString":"Zend_Ldap":private]=&gt; string(19) "ldap://10.10.10.110" ["_options"]=&gt; array(15) { ["host"]=&gt; string(12) "10.10.10.110" ["port"]=&gt; int(0) ["useSsl"]=&gt; bool(false) ["username"]=&gt; string(14) "administratord" ["password"]=&gt; string(8) "P@ssw0rd" ["bindRequiresDn"]=&gt; bool(false) ["baseDn"]=&gt; string(20) "DC=ibm,DC=myhost,DC=com" ["accountCanonicalForm"]=&gt; int(4) ["accountDomainName"]=&gt; string(11) "ibm.myhost.com" ["accountDomainNameShort"]=&gt; NULL ["accountFilterFormat"]=&gt; NULL ["allowEmptyPassword"]=&gt; bool(false) ["useStartTls"]=&gt; bool(false) ["optReferrals"]=&gt; bool(false) ["tryUsernameSplit"]=&gt; bool(true) } ["_resource":protected]=&gt; resource(141) of type (ldap link) ["_boundUser":protected]=&gt; bool(false) ["_rootDse":protected]=&gt; NULL ["_schema":protected]=&gt; NULL } 

for info
i use zf version 1.10.3
scripts terminated in
zend/ldap.php on line 204 </code></pre>

<p>when invalid credential</p>

<p>may be could help</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Stefan Gehrig (sgehrig) on 2010-12-14T06:13:48.000+0000</p> 
        <div class="body">
            <p>OK... We're closing in...</p>

<p>Please check your phpinfo(); and post the "ldap"-section, which should give you something like</p>

<pre class="highlight"><code>
ldap

LDAP Support    enabled
RCS Version $Id: ldap.c 299434 2010-05-17 20:09:42Z pajoye $
Total Links 0/unlimited
API Version 3001
Vendor Name OpenLDAP
Vendor Version  20411
SASL Support    Enabled

Directive   Local Value Master Value
ldap.max_links  Unlimited   Unlimited
</code></pre>

<p>Perhaps your version of ext/ldap has not been built with OpenLDAP 2.x.x OR Netscape Directory SDK x.x which means that the ldap_get_option() function might not be available or not working properly.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ramlan Gustian (rampog) on 2010-12-15T00:11:50.000+0000</p> 
        <div class="body">
            <p>LDAP Support    enabled
RCS Version     $Id: ldap.c 287897 2009-08-30 15:33:59Z iliaa $
Total Links     0/unlimited
API Version     3001
Vendor Name     OpenLDAP
Vendor Version  20420</p>

<p>Directive   Local Value Master Value
ldap.max_links  Unlimited   Unlimited</p>

<p>may be could help</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Stefan Gehrig (sgehrig) on 2010-12-15T11:27:54.000+0000</p> 
        <div class="body">
            <p>Not what I "hoped" for...</p>

<p>Do you have any other Linux machine on hand to try the code? What AD server are you authenticating against (Windows Server 2003, Windows Server 2008)?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ramlan Gustian (rampog) on 2010-12-15T20:07:54.000+0000</p> 
        <div class="body">
            <p>Windows Server 2008
any recommendation what php version that work properly
for doing authentication through LDAP Active Directory
that you have tried?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Stefan Gehrig (sgehrig) on 2010-12-16T00:00:23.000+0000</p> 
        <div class="body">
            <p>Do you have any possibility to run the Zend_Ldap unit tests on both of your machines?</p>

<p>I actually managed to run all the tests successfully from a Windows machine (PHP 5.2.x) connecting to OpenLDAP, Windows 2003 R2 and Windows 2008 and from a Mac (PHP 5.3.3) connecting to OpenLDAP and Windows 2003 R2. Unfortunately I don't have a Windows 2008 virtual machine available, so I cannot test PHP 5.3.3 against the Windows 2008 AD.</p>

<p>Hard to debug...</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ramlan Gustian (rampog) on 2011-01-10T00:33:16.000+0000</p> 
        <div class="body">
            <p>ok tks for help,, temporary solution,, 
i've use php classic (ldap_bin) not using zend_auth_ldap</p>

<p>it work properly both windows &amp; centos</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Andreas Heigl (heiglandreas) on 2012-08-27T17:00:03.000+0000</p> 
        <div class="body">
            <p>Is this still an issue?</p>

<p>If so, what happens, if you remove the "@" before the ldap_get_options. Any helpful error messages?</p>

        </div>
    </div>
    </div>

