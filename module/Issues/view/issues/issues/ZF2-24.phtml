<h2>ZF2-24: &quot;static function factory&quot; &amp; PluginBroker </h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2011-06-30T13:57:08.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2012-06-06T22:43:47.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul></ul></dd>

    <dt>Reporter:</dt>
    <dd>
                Kazusuke Sasezaki (sasezaki)
            </dd>

    <dt>Assignee:</dt>
    <dd>
                Ralph Schindler (ralph)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend\Paginator</li>
            <li>zf-crteam-padraic</li>
            <li>zf-crteam-priority</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>I found a issue about ZF2's plugin architecture.</p>

<p>At present, some components provides the static factory method,
of course, these are upgraded ​​by upgrade of the loader,
(From ZF1's pluingLoader to ZF2's PluginBroker)</p>

<p>For example, at Paginator.</p>

<pre class="highlight"><code>
$pluginLoader = self::getAdapterLoader();
$adapterClassName = $pluginLoader-&gt;load($adapter);
return new self(new $adapterClassName($data));
</code></pre>

<pre class="highlight"><code>
$broker = self::getAdapterBroker();
$adapter = $broker-&gt;load($adapter, array($data));
return new self($adapter);
</code></pre>

<p>Had making change above. However, in the case of this ZF2,</p>

<p>-&gt;load($adapter,</p>

<p>Loaded the adapter object at the point of above.</p>

<p>So, adapter name object which once loaded will use  the first data with or without cause those data is different.</p>

<pre class="highlight"><code>
var_dump(count(Paginator\Paginator::factory(5)-&gt;getAdapter())); // 5
var_dump(count(Paginator\Paginator::factory(6)-&gt;getAdapter())); // 5
</code></pre>

<p>If you run Paginator's unittest-code, you can find where it fails actually.</p>

<p>Point to be a problem is,"static function factory()" would use an adapter object that is generated first.I think, the Object generated by "factory" method are considered to be absolutely new.</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Kazusuke Sasezaki (sasezaki) on 2011-06-30T14:04:45.000+0000</p> 
        <div class="body">
            <p>If only to pass the existing tests,
<a href="https://github.com/sasezaki/zf2/commit/df53edde76e4ee96e7c09a3190666d112b56e9fd#L0L204">https://github.com/sasezaki/zf2/…</a>
applying modify such as. But, this will not good.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Matthew Weier O'Phinney (matthew) on 2011-06-30T15:03:16.000+0000</p> 
        <div class="body">
            <p>This has been marked as a todo item for some time. Ralph was able to find a workable solution within the DI component that I hope to adapt for the PluginBroker as well. If you would like to look at that solution (it's in the InstanceManager) and try and apply it, I'd be happy to review your work.</p>

<p>The main reason we haven't prioritized it is that it's actually relatively rare to need to pull the same class with different arguments from the same broker. However, clearly, it <em>is</em> a use case, so if we can address it, we should.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Benoît Durand (intiilapa) on 2011-09-03T08:16:37.000+0000</p> 
        <div class="body">
            <p>Add code tags.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Maks 3w (maks3w) on 2012-06-06T22:43:47.000+0000</p> 
        <div class="body">
            <p>Seems to be fixed. I tested the code and works fine.</p>

        </div>
    </div>
    </div>

