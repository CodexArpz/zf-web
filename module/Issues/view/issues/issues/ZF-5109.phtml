<h2>ZF-5109: Search_Lucene prevents code coverage from being executed</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Unit Tests: Problem</dd>

    <dt>Created:</dt>
    <dd>2008-11-30T11:14:54.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2009-02-09T04:36:38.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul></ul></dd>

    <dt>Reporter:</dt>
    <dd>
                Thomas Weidner (thomas)
            </dd>

    <dt>Assignee:</dt>
    <dd>
                Alexander Veremyev (alexander)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Search_Lucene</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
        <li><a href="/issues/browse/ZF-5379">ZF-5379</a></li>
        </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>When running any unittestbed with code coverage Search_Lucene raises an exception even when it is not included within the testbed.</p>

<pre class="highlight"><code>
C:\3rdParty\Zend Framework\tests&gt;phpunit --coverage-html C:\temp\repor
t Zend_CurrencyTest
PHPUnit 3.3.4 by Sebastian Bergmann.

.............

Time: 18 seconds

OK (13 tests, 98 assertions)

Generating code coverage report, this may take a moment.
Fatal error: Class 'Zend_Search_Lucene_Analysis_Analyzer_Common' not found in C:
\3rdParty\Zend Framework\library\Zend\Search\Lucene\Analysis\Analyzer\
Common\Utf8.php on line 35

Call Stack:
    0.0025     230408   1. {main}() C:\3rdParty\php\PEAR\PHPUnit\TextU
I\Command.php:0
    0.5037    4230664   2. PHPUnit_TextUI_Command::main() C:\3rdParty\
php\PEAR\PHPUnit\TextUI\Command.php:707
   88.1818    6354928   3. PHPUnit_TextUI_TestRunner-&gt;doRun() C:\3rdPa
rty\php\PEAR\PHPUnit\TextUI\Command.php:131
  106.9842    7137680   4. PHPUnit_Util_Report::render() C:\3rdParty\p
hp\PEAR\PHPUnit\TextUI\TestRunner.php:424
  106.9845    7138648   5. PHPUnit_Framework_TestResult-&gt;getCodeCoverageInformat
ion() C:\3rdParty\php\PEAR\PHPUnit\Util\Report.php:97
  106.9845    7138648   6. PHPUnit_Util_Filter::getFilteredCodeCoverage() C:\
3rdParty\php\PEAR\PHPUnit\Framework\TestResult.php:549
  112.6066   57190056   7. include_once('C:\3rdParty\Zend Framework\li
brary\Zend\Search\Lucene\Analysis\Analyzer\Common\Text\CaseInsensitive.php') C:\
Voxtronic\3rdParty\php\PEAR\PHPUnit\Util\Filter.php:354
  112.6084   57206136   8. require_once('C:\3rdParty\Zend Framework\li
brary\Zend\Search\Lucene\Analysis\Analyzer\Common\Text.php') C:\3rdPar
ty\Zend Framework\library\Zend\Search\Lucene\Analysis\Analyzer\Common\Text\CaseI
nsensitive.php:24
  112.6099   57216024   9. require_once('C:\3rdParty\Zend Framework\li
brary\Zend\Search\Lucene\Analysis\Analyzer\Common.php') C:\3rdParty\Ze
nd Framework\library\Zend\Search\Lucene\Analysis\Analyzer\Common\Text.php:24
  112.6117   57238008  10. require_once('C:\3rdParty\Zend Framework\li
brary\Zend\Search\Lucene\Analysis\Analyzer.php') C:\3rdParty\Zend Fram
ework\library\Zend\Search\Lucene\Analysis\Analyzer\Common.php:24
  112.6153   57275784  11. require_once('C:\3rdParty\Zend Framework\li
brary\Zend\Search\Lucene\Analysis\Analyzer\Common\Utf8.php') C:\3rdPar
ty\Zend Framework\library\Zend\Search\Lucene\Analysis\Analyzer.php:27
</code></pre>

<p>Trunk at r12964, PHP 5.2.5, WinXP, PHPUNIT 3.3.4</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Wil Sinclair (wil) on 2008-12-04T15:51:17.000+0000</p> 
        <div class="body">
            <p>Alex, are you experiencing this problem? If not, can you please isolate the environment-specific problem that Thomas is seeing?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Wil Sinclair (wil) on 2008-12-30T07:02:45.000+0000</p> 
        <div class="body">
            <p>Alex, what is the status on this? Thomas, are you still having this problem? Let's get this fixed or close it.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Mickael Perraud (mikaelkael) on 2008-12-30T07:16:18.000+0000</p> 
        <div class="body">
            <p>I haven't seen this issue before opening ZF-5379, see ZF-5379 for patch</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Thomas Weidner (thomas) on 2008-12-30T10:36:44.000+0000</p> 
        <div class="body">
            <p>It works with r13479 on trunk.
Issue has been fixed by someone without being closed.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Alexander Veremyev (alexander) on 2009-02-09T04:36:38.000+0000</p> 
        <div class="body">
            <p>The problem is probably caused by cyclic require_once() references used in the analysis system and some bug within phpunit/xdebug.</p>

<p>I'm closing issue now, please reopen if problem appears again.</p>

        </div>
    </div>
    </div>

