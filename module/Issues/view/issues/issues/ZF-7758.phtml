<h2>ZF-7758: Zend_Db_Table and join = table/alias lowercased</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2009-09-02T06:53:04.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2009-10-30T11:01:36.000+0000</dd>

    <dt>Status:</dt>
    <dd>Closed</dd>

    <dt>Fix version(s):</dt>
    <dd><ul></ul></dd>

    <dt>Reporter:</dt>
    <dd>
        None
                    </dd>

    <dt>Assignee:</dt>
    <dd>
                Ramon Henrique Ornelas (ramon)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Db_Table</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>Adapter used: Pdo_Pgsql
Tablename: camelCase
Code:</p>

<pre class="highlight"><code> 
$select = $xTable-&gt;select()
            -&gt;setIntegrityCheck(false)
            -&gt;from($xTable, array('action' =&gt; 'name'))
            -&gt;joinInner...
</code></pre>

<p>Error: SQLSTATE[42P01]: Undefined table: 7 ERROR: missing FROM-clause entry for table "camelcase" #table is lowercased</p>

<p>Manual query</p>

<pre class="highlight"><code> 
$select = $xTable-&gt;select()
            -&gt;setIntegrityCheck(false)
            -&gt;from('camelCase', array('action' =&gt; 'name'))
            -&gt;joinInner...
</code></pre>

<p>will work as expected.</p>

<p>Edit:
Same problem with aliasing.</p>

<pre class="highlight"><code>
-&gt;joinLeft(array('pGroups' =&gt; 'groups')... #pGroups will become pgroups
</code></pre>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Ramon Henrique Ornelas (ramon) on 2009-10-25T17:27:11.000+0000</p> 
        <div class="body">
            <p>Not issue in ZF.</p>

<p>See <a href="http://framework.zend.com/manual/en/zend.db.table.html#zend.db.table.introduction">http://framework.zend.com/manual/en/…</a></p>

<p>See <a href="http://www.postgresql.org/docs/8.4/interactive/errcodes-appendix.html">http://postgresql.org/docs/8.4/…</a></p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Marek (xorock) on 2009-10-28T10:42:40.000+0000</p> 
        <div class="body">
            <p>Why it's not a ZF issue? Postgresql error code 42P01 means UNDEFINED TABLE. Table is defined as protected $_name = 'camelCase'; Query generated by ZF tries to access table which name is lowercased to "camelcase" and thus exception is thrown. As You can see this only happens when object is passed to select-&gt;from method.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ramon Henrique Ornelas (ramon) on 2009-10-29T10:36:20.000+0000</p> 
        <div class="body">
            <p>I performed several tests.</p>

<p>In version 1.9.2 and in trunk no problem.</p>

<p>Analize the string generated Zend_Db_Table_Select.</p>

<p>Can help.</p>

<p>--query error
SELECT "camelCase".* FROM camelCase; --error: SQL state: 42P01</p>

<p>--query error
SELECT camelCase.* FROM "camelCase"; --error: SQL state: 42P01</p>

<p>--query success
SELECT "camelCase".* FROM "camelCase";</p>

<p>Note quotation marks in the table.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Marek (xorock) on 2009-10-30T09:32:34.000+0000</p> 
        <div class="body">
            <p>Yes, with simple select this is ok, but try inner join.</p>

<pre class="highlight"><code>
CREATE TABLE some."teSt"
(
  id integer NOT NULL DEFAULT nextval('some."teSt_id_seq"'::regclass),
  CONSTRAINT "teSt_pkey" PRIMARY KEY (id)
)

class Default_Model_DbTable_Test extends Zend_Db_Table_Abstract {
  protected $_name = 'teSt';
}

$xTable = new Default_Model_DbTable_Test();
$select = $xTable-&gt;select()
            -&gt;setIntegrityCheck(false)
            -&gt;from($xTable, array('action' =&gt; 'name'))
#fetch - this is ok, profiler: SELECT "teSt"."name" AS "action" FROM "some"."teSt"

$select = $xTable-&gt;select()
            -&gt;setIntegrityCheck(false)
            -&gt;from($xTable, array('action' =&gt; 'name'))
            -&gt;joinInner('a', 'a.id = teSt.id');
#fetch - SQLSTATE[42P01]: Undefined table: 7 ERROR: missing FROM-clause entry for table "test" LINE 2: INNER JOIN...
</code></pre>

<p>Please ask if You need some more info.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ramon Henrique Ornelas (ramon) on 2009-10-30T11:01:35.000+0000</p> 
        <div class="body">
            <p>your code</p>

<pre class="highlight"><code>  
$select = $table-&gt;select()
           -&gt;setIntegrityCheck(false)
           -&gt;from($table, array('action' =&gt; 'name'))
           -&gt;joinInner('a', 'a.id = teSt.id');
</code></pre>

<p>alter for</p>

<pre class="highlight"><code>
$select = $table-&gt;select()
           -&gt;setIntegrityCheck(false)
           -&gt;from($table, array('action' =&gt; 'name'))
           -&gt;joinInner('a', 'a.id = "teSt".id');
</code></pre>

<p>problem in
-&gt;joinInner('a', 'a.id = teSt.id');</p>

        </div>
    </div>
    </div>

