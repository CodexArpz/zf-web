<h2>ZF-7259: problem method getCountSelect()</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2009-07-14T06:07:19.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2009-11-02T06:58:36.000+0000</dd>

    <dt>Status:</dt>
    <dd>Closed</dd>

    <dt>Fix version(s):</dt>
    <dd><ul></ul></dd>

    <dt>Reporter:</dt>
    <dd>
                Ramon Henrique Ornelas (ramon)
            </dd>

    <dt>Assignee:</dt>
    <dd>
                Jurrien Stutterheim (norm2782)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Paginator</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
        <li><a href="/issues/browse/ZF-7127">ZF-7127</a></li>
            <li><a href="/issues/browse/ZF-7689">ZF-7689</a></li>
        </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>i am find an problem using Zend_Paginator_Adapter_DbSelect, 
my object is used the WHERE and launched an exception</p>

<p>added to the method getCountSelect</p>

<p>$rowCount-&gt;reset(Zend_Db_Select::WHERE)</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Jurrien Stutterheim (norm2782) on 2009-07-14T12:23:34.000+0000</p> 
        <div class="body">
            <p>Could you give more information? What's the exception? What's your query? Could you try and reproduce this with the latest version from SVN?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ramon Henrique Ornelas (ramon) on 2009-07-14T21:22:00.000+0000</p> 
        <div class="body">
            <p>exception launched Zend_Db_Statement_Exception,<br />
i am with the latest version,</p>

<p>problem query generated by  getCountSelect</p>

<p>query passed object select</p>

<p>SELECT d.id,number_document ,type_document ,date_publication ,link FROM "key_word" AS "kw" 
 INNER JOIN "word_document" AS "wd" ON kw.id = wd.key_word_id
 INNER JOIN "document" AS "d" ON d.id = wd.document_id
 INNER JOIN "type_document" AS "td" ON td.id = d.type_document_id
 WHERE (wd.id IN( 48, 21, 56, 47 )) 
 GROUP BY "d"."id", "number_document", "type_document", "date_publication", "link") AS "wd"</p>

<p>query generated</p>

<p>SELECT COUNT(1) AS "zend_paginator_row_count" FROM 
(SELECT d.id,number_document ,type_document ,date_publication ,link FROM "key_word" AS "kw" 
 INNER JOIN "word_document" AS "wd" ON kw.id = wd.key_word_id
 INNER JOIN "document" AS "d" ON d.id = wd.document_id
 INNER JOIN "type_document" AS "td" ON td.id = d.type_document_id
 WHERE (wd.id IN( 48, 21, 56, 47 )) 
 GROUP BY "d"."id", "number_document", "type_document", "date_publication", "link") AS "wd" 
 WHERE (wd.id IN( 48, 21, 56, 47 ))</p>

<p>if this ($isDistinct &amp;&amp; count($columnParts) &gt; 1) || count($groupParts) &gt; 1 || !empty($havingParts)</p>

<p>resolved added $rowCount-&gt;reset(Zend_Db_Select::WHERE)</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Jurrien Stutterheim (norm2782) on 2009-07-14T21:29:05.000+0000</p> 
        <div class="body">
            <p>What is the exception message? What is the stack trace? Did you try and reproduce this with the latest version from SVN?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ramon Henrique Ornelas (ramon) on 2009-07-15T12:29:26.000+0000</p> 
        <div class="body">
            <p>Message
SQLSTATE[42703]: Undefined column: 7 ERROR: column wd.id does not exist LINE 9:"link") AS "wd"
WHERE (wd.id IN( 48, 21, 56, 47 ))</p>

<p>tested with the latest version from SVN, version used 1.8.4</p>

<p>problem code generated 
SELECT COUNT(1) AS "zend_paginator_row_count" FROM 
( SELECT id FROM test AS t WHERE test_id = 10 )  AS t  WHERE test_id = 10</p>

<p>Note the last condition is duplicated, is necessary  reset object select where.</p>

<p>the correct in my opine would</p>

<p>SELECT COUNT(1) AS "zend_paginator_row_count" FROM 
( SELECT id FROM test AS t WHERE test_id = 10 )  AS t</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ramon Henrique Ornelas (ramon) on 2009-07-18T07:46:54.000+0000</p> 
        <div class="body">
            <p>sorry please, problem version used,
with this if</p>

<p>if (($isDistinct &amp;&amp; count($columnParts) &gt; 1) || count($groupParts) &gt; 1 || !empty($havingParts)) {
                $rowCount-&gt;reset(Zend_Db_Select::FROM);</p>

<pre><code>            $rowCount-&gt;from($this-&gt;_select);
</code></pre>

<p>}</p>

<p>in version of the svn, creates a new object Zend_Db_Select</p>

<p>if (($isDistinct &amp;&amp; count($columnParts) &gt; 1) || count($groupParts) &gt; 1 || !empty($havingParts)) {
                $rowCount = $db-&gt;select()-&gt;from($this-&gt;_select);
}</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Jurrien Stutterheim (norm2782) on 2009-07-18T21:39:14.000+0000</p> 
        <div class="body">
            <p>Did that solve the problem?</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ramon Henrique Ornelas (ramon) on 2009-07-19T07:46:16.000+0000</p> 
        <div class="body">
            <p>resolved problem, version used was the problem</p>

<p>please, close issue</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Jurrien Stutterheim (norm2782) on 2009-07-19T12:46:10.000+0000</p> 
        <div class="body">
            <p>Thanks : )</p>

        </div>
    </div>
    </div>

