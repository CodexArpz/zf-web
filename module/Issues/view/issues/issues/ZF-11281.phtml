<h2>ZF-11281: PHP notice when calling isSuccess() on a Zend_Service_Twitter response</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2011-04-12T10:13:23.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2011-05-03T14:30:47.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul>        <li>1.11.6 (05/May/11)</li>
    </ul></dd>

    <dt>Reporter:</dt>
    <dd>
        None
                    </dd>

    <dt>Assignee:</dt>
    <dd>
                Adam Lundrigan (adamlundrigan)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Rest_Client</li>
            <li>Zend_Service_Twitter</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
        <li><a href="/issues/secure/attachment/13925/ZF-11281.patch">ZF-11281.patch</a></li>
        </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>I'm unsure whether this is a bug in the Twitter service, Zend_Rest_Client_Result, or the result of  non-standard behaviour in the Twitter API itself.</p>

<p>Consider this code:</p>

<pre class="highlight"><code>
$api = new Zend_Service_Twitter([...]);

$params = array(
    'since_id' =&gt; '12345' // &lt;-- id of latest tweet
);
$response = $api-&gt;status-&gt;userTimeline($params);
if ($response-&gt;isSuccess()) {
    //
}
</code></pre>

<p>if this query returns tweets, everything works fine. If there are no tweets in the result (e.g. nothing has been posted since the tweet specified), the following PHP notice is generated by the isSuccess() call:</p>

<p>{quote}
Notice: Undefined offset: 0 in /path/to/zf/Zend/Rest/Client/Result.php on line 184
{quote}</p>

<p>The cause seems to be the getStatus() call in Zend_Rest_Client_Result, which is running an xpath query looking for a field called 'status' in the XML response.</p>

<p>If the response does contain tweets the XML looks a little like this:</p>

<pre class="highlight"><code>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
..12345
        [...]
    ..12344
        [...]
    
    [etc.]
</code></pre>

<p>If no tweets are returned, the XML looks like this:</p>

<pre class="highlight"><code>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
</code></pre>

<p>It seems like Zend_Rest_Client_Result is expecting there to be a string field called status in the XML response, and for the Twitter service this works by fluke most of the time simply because the responses usually include tweets, which are in a block called . When there are no tweets in the result the notice is generated.</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Adam Lundrigan (adamlundrigan) on 2011-04-29T02:59:37.000+0000</p> 
        <div class="body">
            <p>Simple fix.  I've attached a patch which checks to see if $status[0] exists and returns false if it doesn't.</p>

<p>Reproducing test suite is included in patch.</p>

<p>Running ZF test suite showed no ill-effects from this patch.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Adam Lundrigan (adamlundrigan) on 2011-04-29T03:08:05.000+0000</p> 
        <div class="body">
            <p>Fix in trunk r23884 (PHP files) and r23890 (added forgotten XML file)</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Satoru Yoshida (satoruyoshida) on 2011-05-03T09:41:26.000+0000</p> 
        <div class="body">
            <p>Hello, Adam. I will push [solve] button as proxy for You.
If You want to release at next mini, You can merge these commits from trunk to 1.11 branch.</p>

<p>Thanks.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ralph Schindler (ralph) on 2011-05-03T14:18:42.000+0000</p> 
        <div class="body">
            <p>Not merged yet, merging shortly.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Ralph Schindler (ralph) on 2011-05-03T14:30:47.000+0000</p> 
        <div class="body">
            <p>Fixed in release branch 1.11 at r23966</p>

        </div>
    </div>
    </div>

