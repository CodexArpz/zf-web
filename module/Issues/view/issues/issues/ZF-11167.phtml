<h2>ZF-11167: Have Zend_Json::encode check for a toArray() method as well</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Improvement</dd>

    <dt>Created:</dt>
    <dd>2011-03-12T20:32:42.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2012-05-12T19:04:00.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul>        <li>1.12.0 (27/Aug/12)</li>
            <li>Next Major Release ()</li>
    </ul></dd>

    <dt>Reporter:</dt>
    <dd>
        None
                    </dd>

    <dt>Assignee:</dt>
    <dd>
                Adam Lundrigan (adamlundrigan)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Json</li>
            <li>zf-crteam-padraic</li>
            <li>zf-crteam-priority</li>
            <li>zf-crteam-review</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
        <li><a href="/issues/secure/attachment/14623/ZF-11167_adamlundrigan.patch">ZF-11167_adamlundrigan.patch</a></li>
        </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>Currently Zend_Json checks for the presence of a toJson() method when an object is involved:</p>

<pre class="highlight"><code>ublic static function encode($valueToEncode, $cycleCheck = false, $options = array())
    {
        if (is_object($valueToEncode) &amp;&amp; method_exists($valueToEncode, 'toJson')) {
            return $valueToEncode-&gt;toJson();
        }</code></pre>

<p>My suggestion would be to alternatively also check for the presence of a toArray() object since these exist more often then tojson() methods and can be encoded just as well.</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Adam Lundrigan (adamlundrigan) on 2011-08-28T03:16:13.000+0000</p> 
        <div class="body">
            <p>Attached patch for implementation + unit tests.  Will commit to SVN once sufficient feedback has been received and (any) necessary modifications made.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by PÃ¡draic Brady (padraic) on 2011-08-28T13:43:06.000+0000</p> 
        <div class="body">
            <p>I've reviewed the patch and confirm it operates as intended. Recommend committing to trunk (need to check with Matthew on adding to release branch as it adds to the API). Please ensure a ZF2 git pull request including matching changes is issued for ZF2 before resolving.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Adam Lundrigan (adamlundrigan) on 2011-08-28T15:31:13.000+0000</p> 
        <div class="body">
            <p>Committed to trunk r24419</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Adam Lundrigan (adamlundrigan) on 2011-08-28T20:06:08.000+0000</p> 
        <div class="body">
            <p>Opened pull request on {{zendframework:zf2}} branch {{master}}
<a href="https://github.com/zendframework/zf2/pull/362">https://github.com/zendframework/zf2/pull/362</a></p>

        </div>
    </div>
    </div>

