<h2>ZF-856: Zend_LocaleTest Test failing</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Unit Tests: Problem</dd>

    <dt>Created:</dt>
    <dd>2007-02-05T05:26:46.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2007-07-05T14:43:44.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul>        <li>0.8.0 (21/Feb/07)</li>
    </ul></dd>

    <dt>Reporter:</dt>
    <dd>
                Sebastian Nohn (nohn)
            </dd>

    <dt>Assignee:</dt>
    <dd>
                Thomas Weidner (thomas)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Locale</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>1) testgetScriptList(Zend_LocaleTest)
Script Display not returned
Failed asserting that  is equal to .
/home/sebastian/Work/ZendFramework/tests/Zend/LocaleTest.php:222</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Sebastian Nohn (nohn) on 2007-02-05T05:26:56.000+0000</p> 
        <div class="body">
            <p>2) testToNumber(Zend_Locale_FormatTest)
string 0,1234567 expected
Failed asserting that &lt;string:0,1234567&gt; is equal to &lt;string:0.1.234.567&gt;.
/home/sebastian/Work/ZendFramework/tests/Zend/Locale/FormatTest.php:80</p>

<p>3) testToFloat(Zend_Locale_FormatTest)
string 0,1234567 expected
Failed asserting that &lt;string:0,1234567&gt; is equal to &lt;string:0.1.234.567&gt;.
/home/sebastian/Work/ZendFramework/tests/Zend/Locale/FormatTest.php:154</p>

<p>4) testtoInteger(Zend_Locale_FormatTest)
string 0 expected
Failed asserting that &lt;</p>
        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Thomas Weidner (thomas) on 2007-02-05T05:38:42.000+0000</p> 
        <div class="body">
            <p>Please use the latest branch (I18N Branch) to verify if the failure is still there or already fixed.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Sebastian Nohn (nohn) on 2007-02-05T05:45:47.000+0000</p> 
        <div class="body">
            <p>It's latest HEAD:
sebastian@h939937:~/Work/ZendFramework$ svn up
At revision 3196.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Thomas Weidner (thomas) on 2007-02-05T07:11:30.000+0000</p> 
        <div class="body">
            <p>This is the core but not the branch...</p>

<p>You are using the trunk, but I asked you to test with the branch:
<a href="http://framework.zend.com/svn/framework/branch/i18n-pre0.8">http://framework.zend.com/svn/framework/…</a></p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Thomas Weidner (thomas) on 2007-02-06T07:07:32.000+0000</p> 
        <div class="body">
            <p>Please test this issue with SVN 3233.</p>

<p>On problems please give us information on your system, phpversion and systems standard language and location.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Sebastian Nohn (nohn) on 2007-02-06T07:18:50.000+0000</p> 
        <div class="body">
            <p>Still failing:</p>

<p>2) testToNumber(Zend_Locale_FormatTest)
string 0,1234567 expected
Failed asserting that &lt;string:0,1234567&gt; is equal to &lt;string:0.1.234.567&gt;.
/home/sebastian/Work/ZendFramework/tests/Zend/Locale/FormatTest.php:80</p>

<p>3) testToFloat(Zend_Locale_FormatTest)
string 0,1234567 expected
Failed asserting that &lt;string:0,1234567&gt; is equal to &lt;string:0.1.234.567&gt;.
/home/sebastian/Work/ZendFramework/tests/Zend/Locale/FormatTest.php:155</p>

<p>4) testToNumberFormat(Zend_Locale_FormatTest)
string 0,1234567 expected
Failed asserting that &lt;string:0,1234567&gt; is equal to &lt;string:0.1.234.567&gt;.
/home/sebastian/Work/ZendFramework/tests/Zend/Locale/FormatTest.php:507</p>

<p>$ svn up
At revision 3233.</p>

<p>Ubuntu 6.06 LTS (Server)</p>

<p>$ uname -a
Linux 2.6.15-26-686 #1 SMP PREEMPT Fri Sep 8 20:16:40 UTC 2006 i686 GNU/Linux</p>

<p>$ /opt/php/bin/php -v
PHP 5.2.0 with Suhosin-Patch 0.9.6.1 (cli) (built: Dec 25 2006 12:32:03)
Copyright (c) 1997-2006 The PHP Group
Zend Engine v2.2.0, Copyright (c) 1998-2006 Zend Technologies
    with Xdebug v2.0.0RC3-dev, Copyright (c) 2002, 2003, 2004, 2005, 2006, 2007, by Derick Rethans
    with Suhosin v0.9.16, Copyright (c) 2002-2006, by Hardened-PHP Project</p>

<p>$ locale
LANG=en_US
LC_CTYPE="en_US"
LC_NUMERIC="en_US"
LC_TIME="en_US"
LC_COLLATE="en_US"
LC_MONETARY="en_US"
LC_MESSAGES="en_US"
LC_PAPER="en_US"
LC_NAME="en_US"
LC_ADDRESS="en_US"
LC_TELEPHONE="en_US"
LC_MEASUREMENT="en_US"
LC_IDENTIFICATION="en_US"
LC_ALL=</p>

<p>$ phpunit --version
PHPUnit 3.0.2 by Sebastian Bergmann.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Thomas Weidner (thomas) on 2007-02-06T09:22:34.000+0000</p> 
        <div class="body">
            <p>It seems that your Data directory is missing several data files or they are truncated or corrupted.
Can you please give us the result of following code:</p>

<p>require_once 'Zend/Locale.php';</p>

<p>print Zend_Locale::isLocale('de_AT');
print_r (Zend_Locale_Data::getContent('de_AT', 'decimalnumberformat');</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Sebastian Nohn (nohn) on 2007-02-06T09:28:18.000+0000</p> 
        <div class="body">
            <p>$ php -d include_path=Work/ZendFramework/library/ test.php
de_ATArray
(
    [default] =&gt; #,##0.###
)</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Thomas Weidner (thomas) on 2007-02-06T13:09:41.000+0000</p> 
        <div class="body">
            <p>2 things to verify:</p>

<p>Is the ICONV library enabled ?
Is the BCMATH library enabled ?</p>

<p>The CLDR is ok, but the math helper class produces wrong results.
Can you try to enable BCMATH temporary and look if the problems are gone ?</p>

<p>Both issues (856/854) look if they are BCMATH related.
If BCMATH is not enabled an internal function makes the calculations and throws an exception if the result extends float values.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Gavin (gavin) on 2007-02-06T13:10:17.000+0000</p> 
        <div class="body">
            <p>{quote}
1) testgetScriptList(Zend_LocaleTest)
Script Display not returned
Failed asserting that  is equal to .
/home/sebastian/Work/ZendFramework/tests/Zend/LocaleTest.php:222
{quote}</p>

<p>Fixed here:
<a href="http://framework.zend.com/fisheye/browse/Zend_Framework/trunk/tests/Zend/LocaleTest.php?r1=2913&amp;r2=3222">http://framework.zend.com/fisheye/browse/…</a></p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Thomas Weidner (thomas) on 2007-02-06T16:12:35.000+0000</p> 
        <div class="body">
            <p>Sebastian:</p>

<p>SVN 3244 should fix the problems...
Please verify this on your machine.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Sebastian Nohn (nohn) on 2007-02-07T01:03:16.000+0000</p> 
        <div class="body">
            <p>Works (3255)</p>

        </div>
    </div>
    </div>

