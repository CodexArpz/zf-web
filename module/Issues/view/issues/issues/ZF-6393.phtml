<h2>ZF-6393: Wrong AMF0_AMF3 reference counting</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2009-04-23T08:25:16.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2009-06-16T14:36:54.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul>        <li>1.8.4 (23/Jun/09)</li>
    </ul></dd>

    <dt>Reporter:</dt>
    <dd>
        None
                    </dd>

    <dt>Assignee:</dt>
    <dd>
                Wade Arnold (wadearnold)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Amf</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
        <li><a href="/issues/browse/ZF-5049">ZF-5049</a></li>
            <li><a href="/issues/browse/ZF-5382">ZF-5382</a></li>
        </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
        <li><a href="/issues/secure/attachment/11886/Amf0_Deserializer.patch">Amf0_Deserializer.patch</a></li>
        </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>If there is more than one body part in a mixed AMF0/AMF3 message, and there are complex parameters (Anonymous and Typed objects) used, The requests will fail.
The reason is, that the AMF3 protocol restarts reference counting when it switches from AMF0 to AMF3 mode, but the current AMF0 deserializer reuses the last used AMF3 deserializer, and therefore doesn't restart reference counting.</p>

<p>This bug is also the reason for bug ZF-5049/5382</p>

<p>I attached a patch which fixes the problem.</p>

<p>Regards Stefan</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Andreas Adam (acadam71) on 2009-05-28T09:11:01.000+0000</p> 
        <div class="body">
            <p>Great Work Stefan! All our problem are blowing away!
Now it runs fine!</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Wade Arnold (wadearnold) on 2009-06-16T14:36:54.000+0000</p> 
        <div class="body">
            <p>Patch has been added to the standard trunk and will be updated with the next mini release of ZF</p>

        </div>
    </div>
    </div>

