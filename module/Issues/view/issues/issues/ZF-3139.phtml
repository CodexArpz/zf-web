<h2>ZF-3139: Consumer doesn't handle 1.1 delegation properly.</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2008-04-18T00:49:21.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2008-04-18T08:12:50.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul></ul></dd>

    <dt>Reporter:</dt>
    <dd>
        None
                    </dd>

    <dt>Assignee:</dt>
    <dd>
                Dmitry Stogov (dmitry)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_OpenId</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>In 1.1 OpenId (livejournal and myopenid.net are examples) delegation must be handled outside of the claimed_id which comes back as the id of the provider rather than the actual openid.  To get around this, we've had to use $_SESSION to store the original identifier entered by the user.</p>

<p>After verify() returns true, we check If the original identifier doesn't match the claimed id.  If it doesn't, we re-perform discovery on it.  If the claimed_id matches the realId of the original identifier, then we assume that it really is verified.</p>

<p>Otherwise, we use the claimed id.</p>

<p>It would be optimal if the claimed_id that came out of verify() was already based on that process.  But it would require the use $_SESSION to do so.</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Dmitry Stogov (dmitry) on 2008-04-18T01:41:27.000+0000</p> 
        <div class="body">
            <p>This bug must be already fixed in SVN trunk. Could you please verify it and close the bug in case of success.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Paul Huff (phuff) on 2008-04-18T01:56:33.000+0000</p> 
        <div class="body">
            <p>Yeah, sorry, I didn't look at recent fixes before submitting this set of bugs, sorry.</p>

<p>This is a dupe, and it appears fixed in SVN.  I can't really test, because we're about to launch and I don't have a good test bed right now.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Dmitry Stogov (dmitry) on 2008-04-18T08:12:50.000+0000</p> 
        <div class="body">
            <p>No problem, just reopen the bug if it doesn't work for you or open a new one but add a test case.
Anyway, thank you very much for your reports.</p>

        </div>
    </div>
    </div>

