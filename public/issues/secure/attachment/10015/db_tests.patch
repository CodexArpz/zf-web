<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" dir="ltr">
<head>
 <title>#36: db_tests.patch - Zend Framework: Developer</title><link rel="start" href="/developer/wiki" />
	<link rel="search" href="/developer/search" />
	<link rel="help" href="/developer/wiki/TracGuide" />
	<link rel="stylesheet" href="/trac/chrome/css/trac.css" type="text/css" />
	<link rel="stylesheet" href="/trac/chrome/css/diff.css" type="text/css" />
	<link rel="stylesheet" href="/trac/chrome/css/code.css" type="text/css" />
	<link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
	<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />
	<link rel="up" href="/developer/ticket/36" title="Ticket #36" />
	<link rel="alternate" href="/developer/attachment/ticket/36/db_tests.patch?format=raw" title="Original Format" type="text/x-diff" />
	
 <link rel="stylesheet" type="text/css" href="/css/screen.css" />
 <link rel="stylesheet" type="text/css" href="/css/developer.css" />
 <script type="text/javascript" src="/trac/chrome/js/trac.js"></script>
</head>

<body>
<div id="container" align="center">
<div id="header">
	<div class="top"><h1 id="logo"><a href="/" title="Home"><span>Zend Framework</span>&nbsp;</a></h1></div>

	<ul id="nav" class="button">
		<li><a href="/home" title="Download">Home</a></li>
		<li><a href="/download" title="Download">Download</a></li>
		<li><a href="/roadmap" title="Roadmap">Roadmap</a></li>
		<li><a href="/faq" title="FAQ">FAQ</a></li>
		<li class="selected"><a href="/developer" title="Developer">Developer</a></li>
		<li><a href="/manual" title="Manual">Manual</a></li>
	</ul><div class="clearfix"></div>
	<div class="clearfix"></div>
</div>
</div>

<h1>This is the <font color=red><b>OLD</b></font> system.  Please use our <a href="/wiki/display/ZFDEV/Home">new system.</a></h1>





<div id="mainnav2" class="nav"><ul><li class="first"><a href="/developer/browser">Browse Source</a></li><li><a href="/developer/report/1">View Active Tickets</a></li><li><a href="/developer/newticket" accesskey="7">New Ticket</a></li><li><a href="/developer/timeline" accesskey="2">Timeline</a></li><li class="last"><a href="/developer/search" accesskey="4">Search</a></li></ul></div>
<div id="main">




<div id="ctxtnav" class="nav"></div>

<div id="content" class="attachment">


 <h1><a href="/developer/ticket/36">Ticket #36</a>: db_tests.patch</h1>
 <div id="preview">
   


<div class="diff"><ul class="entries"><li class="entry">
  <h2>TestConfiguration.php.dist</h2>
  <table class="inline" summary="Differences" cellspacing="0">
   <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
   <thead><tr>
    <th>old</th>
    <th>new</th>
    <th>&nbsp;</th>
   </tr></thead><tbody><tr><th>30</th><th>30</th><td class="l"><span></span>&nbsp;</td></tr><tr><th>31</th><th>31</th><td class="l"><span></span>&nbsp;</td></tr><tr><th>32</th><th>32</th><td class="l"><span>/**</span>&nbsp;</td></tr></tbody><tbody class="mod"><tr class="first"><th>33</th><th>&nbsp;</th><td class="l">&nbsp;* @todo Pgsql, Mssql, etc.&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>33</th><td class="r">&nbsp;* Zend_Db_Adapter_Pdo_Mssql&nbsp;</td></tr></tbody><tbody><tr><th>34</th><th>34</th><td class="l"><span>&nbsp;*/</span>&nbsp;</td></tr></tbody><tbody class="add"><tr class="first"><th>&nbsp;</th><th>35</th><td class="r"><ins>define('TESTS_ZEND_DB_ADAPTER_PDO_MSSQL_ENABLED',&nbsp; false);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>36</th><td class="r"><ins>define('TESTS_ZEND_DB_ADAPTER_PDO_MSSQL_HOSTNAME', '127.0.0.1');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>37</th><td class="r"><ins>define('TESTS_ZEND_DB_ADAPTER_PDO_MSSQL_USERNAME', null);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>38</th><td class="r"><ins>define('TESTS_ZEND_DB_ADAPTER_PDO_MSSQL_PASSWORD', null);</ins>&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>39</th><td class="r"><ins>define('TESTS_ZEND_DB_ADAPTER_PDO_MSSQL_DATABASE', 'test');</ins>&nbsp;</td></tr></tbody><tbody><tr><th>35</th><th>40</th><td class="l"><span></span>&nbsp;</td></tr><tr><th>36</th><th>41</th><td class="l"><span></span>&nbsp;</td></tr><tr><th>37</th><th>42</th><td class="l"><span>/**</span>&nbsp;</td></tr></tbody><tbody class="add"><tr class="first"><th>&nbsp;</th><th>43</th><td class="r"><ins>&nbsp;* @todo Pgsql, etc.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>44</th><td class="r"><ins>&nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>45</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>46</th><td class="r"><ins></ins>&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>47</th><td class="r"><ins>/**</ins>&nbsp;</td></tr></tbody><tbody><tr><th>38</th><th>48</th><td class="l"><span>&nbsp;* Zend_HttpClient</span>&nbsp;</td></tr><tr><th>39</th><th>49</th><td class="l"><span>&nbsp;*</span>&nbsp;</td></tr><tr><th>40</th><th>50</th><td class="l"><span>&nbsp;* IMPORTANT: If this option is enabled, the Zend_HttpClient test suite</span>&nbsp;</td></tr></tbody>
  </table>
 </li><li class="entry">
  <h2>Zend/AllTests.php</h2>
  <table class="inline" summary="Differences" cellspacing="0">
   <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
   <thead><tr>
    <th>old</th>
    <th>new</th>
    <th>&nbsp;</th>
   </tr></thead><tbody><tr><th>15</th><th>15</th><td class="l"><span>require_once 'Zend/Pdf/AllTests.php';</span>&nbsp;</td></tr><tr><th>16</th><th>16</th><td class="l"><span>require_once 'Zend/UriTest.php';</span>&nbsp;</td></tr><tr><th>17</th><th>17</th><td class="l"><span>require_once 'Zend/Uri/AllTests.php';</span>&nbsp;</td></tr></tbody><tbody class="add"><tr class="first last"><th>&nbsp;</th><th>18</th><td class="r"><ins>require_once 'Zend/Db/AllTests.php';</ins>&nbsp;</td></tr></tbody><tbody><tr><th>18</th><th>19</th><td class="l"><span></span>&nbsp;</td></tr><tr><th>19</th><th>20</th><td class="l"><span>class Zend_AllTests</span>&nbsp;</td></tr><tr><th>20</th><th>21</th><td class="l"><span>{</span>&nbsp;</td></tr></tbody>
     <tbody class="skipped">
      <tr><th>&hellip;</th><th>&hellip;</th><td>&nbsp;</td></tr>
     </tbody><tbody><tr><th>36</th><th>37</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; $suite-&gt;addTestSuite('Zend_UriTest');</span>&nbsp;</td></tr><tr><th>37</th><th>38</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; $suite-&gt;addTest(Zend_Uri_AllTests::suite());</span>&nbsp;</td></tr><tr><th>38</th><th>39</th><td class="l"><span></span>&nbsp;</td></tr></tbody><tbody class="add"><tr class="first"><th>&nbsp;</th><th>40</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $suite-&gt;addTestSuite('Zend_DbTest');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>41</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $suite-&gt;addTest(Zend_Db_AllTests::suite());</ins>&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>42</th><td class="r"><ins></ins>&nbsp;</td></tr></tbody><tbody><tr><th>39</th><th>43</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; return $suite;</span>&nbsp;</td></tr><tr><th>40</th><th>44</th><td class="l"><span>&nbsp; &nbsp; }</span>&nbsp;</td></tr><tr><th>41</th><th>45</th><td class="l"><span>}</span>&nbsp;</td></tr></tbody>
  </table>
 </li><li class="entry">
  <h2>Zend/Db/Adapter/Pdo/MssqlTest.php</h2>
  <table class="inline" summary="Differences" cellspacing="0">
   <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
   <thead><tr>
    <th>old</th>
    <th>new</th>
    <th>&nbsp;</th>
   </tr></thead><tbody class="add"><tr class="first"><th>&nbsp;</th><th>1</th><td class="r"><ins>&lt;?php</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>2</th><td class="r"><ins>/**</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>3</th><td class="r"><ins>&nbsp;* @package&nbsp; &nbsp; Zend_Db</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>4</th><td class="r"><ins>&nbsp;* @subpackage UnitTests</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>5</th><td class="r"><ins>&nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>6</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>7</th><td class="r"><ins>/**</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>8</th><td class="r"><ins>&nbsp;* Common class is DB independant</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>9</th><td class="r"><ins>&nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>10</th><td class="r"><ins>require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'Common.php';</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>11</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>12</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>13</th><td class="r"><ins>/**</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>14</th><td class="r"><ins>&nbsp;* @package&nbsp; &nbsp; Zend_Db_Adapter_Pdo_MssqlTest</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>15</th><td class="r"><ins>&nbsp;* @subpackage UnitTests</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>16</th><td class="r"><ins>&nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>17</th><td class="r"><ins>class Zend_Db_Adapter_Pdo_MssqlTest extends Zend_Db_Adapter_Pdo_Common</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>18</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>19</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>20</th><td class="r"><ins>&nbsp; &nbsp; function getCreatTableSQL()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>21</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>22</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; return 'CREATE TABLE&nbsp; '. self::TableName . '</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>23</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (id int IDENTITY, title varchar(100), subTitle varchar (100), body text, date_created datetime)';</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>24</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>25</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>26</th><td class="r"><ins>&nbsp; &nbsp; function getDriver()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>27</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>28</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; return 'pdoMssql';</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>29</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>30</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>31</th><td class="r"><ins>&nbsp; &nbsp; function getParams()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>32</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>33</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $params = array ('host'&nbsp; &nbsp; &nbsp;=&gt; TESTS_ZEND_DB_ADAPTER_PDO_MSSQL_HOSTNAME,</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>34</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'username' =&gt; TESTS_ZEND_DB_ADAPTER_PDO_MSSQL_USERNAME,</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>35</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'password' =&gt; TESTS_ZEND_DB_ADAPTER_PDO_MSSQL_PASSWORD,</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>36</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'dbname'&nbsp; &nbsp;=&gt; TESTS_ZEND_DB_ADAPTER_PDO_MSSQL_DATABASE);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>37</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>38</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; return $params;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>39</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>40</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>41</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>42</th><td class="r"><ins>&nbsp; &nbsp; public function testQuote()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>43</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>44</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // test double quotes are fine</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>45</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $value = $this-&gt;_db-&gt;quote('St John&#34;s Wort');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>46</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(&#34;'St John\&#34;s Wort'&#34;, $value);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>47</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>48</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // test that single quotes are escaped with another single quote</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>49</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $value = $this-&gt;_db-&gt;quote('St John\'s Wort');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>50</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(&#34;'St John''s Wort'&#34;, $value);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>51</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>52</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // quote an array</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>53</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $value = $this-&gt;_db-&gt;quote(array(&#34;it's&#34;, 'all', 'right!'));</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>54</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(&#34;'it''s', 'all', 'right!'&#34;, $value);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>55</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>56</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>57</th><td class="r"><ins>&nbsp; &nbsp; public function testQuoteInto()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>58</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>59</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // test double quotes are fine</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>60</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $value = $this-&gt;_db-&gt;quoteInto('id=?', 'St John&#34;s Wort');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>61</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(&#34;id='St John\&#34;s Wort'&#34;, $value);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>62</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>63</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // test that single quotes are escaped with another single quote</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>64</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $value = $this-&gt;_db-&gt;quoteInto('id = ?', 'St John\'s Wort');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>65</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(&#34;id = 'St John''s Wort'&#34;, $value);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>66</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>67</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>68</th><td class="r"><ins>&nbsp; &nbsp; public function testQuoteIdentifier()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>69</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>70</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $value = $this-&gt;_db-&gt;quoteIdentifier('table_name');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>71</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(&#34;[table_name]&#34;, $value);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>72</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>73</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $value = $this-&gt;_db-&gt;quoteIdentifier('table_[]_name');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>74</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(&#34;[table_[]]_name]&#34;, $value);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>75</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>76</th><td class="r"><ins></ins>&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>77</th><td class="r"><ins>}</ins>&nbsp;</td></tr></tbody>
  </table>
 </li><li class="entry">
  <h2>Zend/Db/Adapter/Pdo/MysqlTest.php</h2>
  <table class="inline" summary="Differences" cellspacing="0">
   <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
   <thead><tr>
    <th>old</th>
    <th>new</th>
    <th>&nbsp;</th>
   </tr></thead><tbody class="add"><tr class="first"><th>&nbsp;</th><th>1</th><td class="r"><ins>&lt;?php</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>2</th><td class="r"><ins>/**</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>3</th><td class="r"><ins>&nbsp;* @package&nbsp; &nbsp; Zend_Db</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>4</th><td class="r"><ins>&nbsp;* @subpackage UnitTests</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>5</th><td class="r"><ins>&nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>6</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>7</th><td class="r"><ins>/**</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>8</th><td class="r"><ins>&nbsp;* Common class is DB independant</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>9</th><td class="r"><ins>&nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>10</th><td class="r"><ins>require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'Common.php';</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>11</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>12</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>13</th><td class="r"><ins>/**</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>14</th><td class="r"><ins>&nbsp;* @package&nbsp; &nbsp; Zend_Db_Adapter_Pdo_MysqlTest</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>15</th><td class="r"><ins>&nbsp;* @subpackage UnitTests</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>16</th><td class="r"><ins>&nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>17</th><td class="r"><ins>class Zend_Db_Adapter_Pdo_MysqlTest extends Zend_Db_Adapter_Pdo_Common</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>18</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>19</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>20</th><td class="r"><ins>&nbsp; &nbsp; function getCreatTableSQL()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>21</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>22</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; return 'CREATE TABLE&nbsp; '. self::TableName . '</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>23</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (id int IDENTITY, title varchar(100), subTitle varchar (100), body text, date_created datetime)';</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>24</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>25</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>26</th><td class="r"><ins>&nbsp; &nbsp; function getDriver()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>27</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>28</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; return 'pdoMysql';</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>29</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>30</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>31</th><td class="r"><ins>&nbsp; &nbsp; function getParams()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>32</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>33</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $params = array ('host'&nbsp; &nbsp; &nbsp;=&gt; TESTS_ZEND_DB_ADAPTER_PDO_MYSQL_HOSTNAME,</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>34</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'username' =&gt; TESTS_ZEND_DB_ADAPTER_PDO_MYSQL_USERNAME,</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>35</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'password' =&gt; TESTS_ZEND_DB_ADAPTER_PDO_MYSQL_PASSWORD,</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>36</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'dbname'&nbsp; &nbsp;=&gt; TESTS_ZEND_DB_ADAPTER_PDO_MYSQL_DATABASE);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>37</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>38</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; return $params;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>39</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>40</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>41</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>42</th><td class="r"><ins>&nbsp; &nbsp; public function testQuote()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>43</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>44</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // test double quotes are fine</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>45</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $value = $this-&gt;_db-&gt;quote('St John&#34;s Wort');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>46</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(&#34;'St John\&#34;s Wort'&#34;, $value);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>47</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>48</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // test that single quotes are escaped with another single quote</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>49</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $value = $this-&gt;_db-&gt;quote('St John\'s Wort');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>50</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(&#34;'St John''s Wort'&#34;, $value);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>51</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>52</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // quote an array</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>53</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $value = $this-&gt;_db-&gt;quote(array(&#34;it's&#34;, 'all', 'right!'));</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>54</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(&#34;'it''s', 'all', 'right!'&#34;, $value);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>55</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>56</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>57</th><td class="r"><ins>&nbsp; &nbsp; public function testQuoteInto()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>58</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>59</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // test double quotes are fine</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>60</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $value = $this-&gt;_db-&gt;quoteInto('id=?', 'St John&#34;s Wort');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>61</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(&#34;id='St John\&#34;s Wort'&#34;, $value);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>62</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>63</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // test that single quotes are escaped with another single quote</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>64</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $value = $this-&gt;_db-&gt;quoteInto('id = ?', 'St John\'s Wort');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>65</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(&#34;id = 'St John''s Wort'&#34;, $value);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>66</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>67</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>68</th><td class="r"><ins>&nbsp; &nbsp; public function testQuoteIdentifier()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>69</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>70</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $value = $this-&gt;_db-&gt;quoteIdentifier('table_name');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>71</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(&#34;[table_name]&#34;, $value);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>72</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>73</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $value = $this-&gt;_db-&gt;quoteIdentifier('table_[]_name');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>74</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(&#34;[table_[]]_name]&#34;, $value);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>75</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>76</th><td class="r"><ins></ins>&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>77</th><td class="r"><ins>}</ins>&nbsp;</td></tr></tbody>
  </table>
 </li><li class="entry">
  <h2>Zend/Db/Adapter/Pdo/Common.php</h2>
  <table class="inline" summary="Differences" cellspacing="0">
   <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
   <thead><tr>
    <th>old</th>
    <th>new</th>
    <th>&nbsp;</th>
   </tr></thead><tbody class="add"><tr class="first"><th>&nbsp;</th><th>1</th><td class="r"><ins>&lt;?php</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>2</th><td class="r"><ins>/**</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>3</th><td class="r"><ins>&nbsp;* @package&nbsp; &nbsp; Zend_Db</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>4</th><td class="r"><ins>&nbsp;* @subpackage UnitTests</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>5</th><td class="r"><ins>&nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>6</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>7</th><td class="r"><ins>/**</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>8</th><td class="r"><ins>&nbsp;* Common class is DB independant</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>9</th><td class="r"><ins>&nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>10</th><td class="r"><ins>require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . '..' . DIRECTORY_SEPARATOR . 'Common.php';</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>11</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>12</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>13</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>14</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>15</th><td class="r"><ins>/**</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>16</th><td class="r"><ins>&nbsp;* @package&nbsp; &nbsp; Zend_Db_Adapter_Pdo_Common</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>17</th><td class="r"><ins>&nbsp;* @subpackage UnitTests</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>18</th><td class="r"><ins>&nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>19</th><td class="r"><ins>abstract class Zend_Db_Adapter_Pdo_Common extends Zend_Db_Adapter_Common</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>20</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>21</th><td class="r"><ins>}</ins>&nbsp;</td></tr></tbody>
  </table>
 </li><li class="entry">
  <h2>Zend/Db/Adapter/Common.php</h2>
  <table class="inline" summary="Differences" cellspacing="0">
   <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
   <thead><tr>
    <th>old</th>
    <th>new</th>
    <th>&nbsp;</th>
   </tr></thead><tbody class="add"><tr class="first"><th>&nbsp;</th><th>1</th><td class="r"><ins>&lt;?php</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>2</th><td class="r"><ins>/**</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>3</th><td class="r"><ins>&nbsp;* @package&nbsp; &nbsp; Zend_Db</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>4</th><td class="r"><ins>&nbsp;* @subpackage UnitTests</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>5</th><td class="r"><ins>&nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>6</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>7</th><td class="r"><ins>/**</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>8</th><td class="r"><ins>&nbsp;* Zend_Db</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>9</th><td class="r"><ins>&nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>10</th><td class="r"><ins>require_once 'Zend/Db.php';</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>11</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>12</th><td class="r"><ins>/**</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>13</th><td class="r"><ins>&nbsp;* PHPUnit2 test case</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>14</th><td class="r"><ins>&nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>15</th><td class="r"><ins>require_once 'PHPUnit2/Framework/TestCase.php';</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>16</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>17</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>18</th><td class="r"><ins>/**</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>19</th><td class="r"><ins>&nbsp;* @package&nbsp; &nbsp; Zend_Db_Adapter_Pdo_Common</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>20</th><td class="r"><ins>&nbsp;* @subpackage UnitTests</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>21</th><td class="r"><ins>&nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>22</th><td class="r"><ins>abstract class Zend_Db_Adapter_Common extends PHPUnit2_Framework_TestCase</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>23</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>24</th><td class="r"><ins>&nbsp; &nbsp; const TableName = 'zf_test_table';</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>25</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>26</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>27</th><td class="r"><ins>&nbsp; &nbsp; abstract function getCreatTableSQL();</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>28</th><td class="r"><ins>&nbsp; &nbsp; abstract function getParams();</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>29</th><td class="r"><ins>&nbsp; &nbsp; abstract function getDriver();</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>30</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>31</th><td class="r"><ins>&nbsp; &nbsp; /**</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>32</th><td class="r"><ins>&nbsp; &nbsp; &nbsp;* @var Zend_Db_Adapter_Pdo_Abstract</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>33</th><td class="r"><ins>&nbsp; &nbsp; &nbsp;*/</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>34</th><td class="r"><ins>&nbsp; &nbsp; protected $_db;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>35</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>36</th><td class="r"><ins>&nbsp; &nbsp; protected function getDropTableSQL()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>37</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>38</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; return 'DROP TABLE ' . self::TableName;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>39</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>40</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>41</th><td class="r"><ins>&nbsp; &nbsp; protected function createTestTable()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>42</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>43</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;_db-&gt;query($this-&gt;getCreatTableSQL());</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>44</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>45</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $sql = 'INSERT INTO ' . self::TableName . &#34; (title, subTitle, body, date_created)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>46</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VALUES ('News Item 1', 'Sub title 1', 'This is body 1', '2006-05-01 11:11:11')&#34;;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>47</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;_db-&gt;query($sql);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>48</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>49</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $sql = 'INSERT INTO ' . self::TableName . &#34; (title, subTitle, body, date_created)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>50</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VALUES ('News Item 2', 'Sub title 2', 'This is body 2', '2006-05-02 12:12:12')&#34;;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>51</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;_db-&gt;query($sql);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>52</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>53</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>54</th><td class="r"><ins>&nbsp; &nbsp; function setUp()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>55</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>56</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // open a new connection</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>57</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;_db = Zend_Db::factory('pdoMssql', $this-&gt;getParams());</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>58</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>59</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // create a test table and populate it</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>60</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;createTestTable();</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>61</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>62</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>63</th><td class="r"><ins>&nbsp; &nbsp; function tearDown()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>64</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>65</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // drop test table</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>66</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;_db-&gt;query($this-&gt;getDropTableSQL());</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>67</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>68</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // close the PDO connection</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>69</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $connection = $this-&gt;_db-&gt;getConnection();</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>70</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $connection = null;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>71</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;_db = null;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>72</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>73</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>74</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>75</th><td class="r"><ins>&nbsp; &nbsp; function testFetchAll()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>76</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>77</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $result = $this-&gt;_db-&gt;query('SELECT * FROM ' . self::TableName . ' WHERE date_created &gt; :placeholder',</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>78</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array('placeholder' =&gt; '2006-01-01')</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>79</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>80</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>81</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $rows = $result-&gt;fetchAll();</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>82</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(2, count($rows));</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>83</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals('1', $rows[0]['id']);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>84</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>85</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>86</th><td class="r"><ins>&nbsp; &nbsp; function testFieldNamesAreLowercase()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>87</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>88</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $result = $this-&gt;_db-&gt;query('SELECT * FROM ' . self::TableName . ' WHERE date_created &gt; :placeholder',</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>89</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array('placeholder' =&gt; '2006-01-01')</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>90</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>91</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>92</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // use the PDOStatement $result to fetch all rows as an array</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>93</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $row = $result-&gt;fetch();</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>94</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>95</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(5, count($row)); // correct number of fields</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>96</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals('1', $row['id']); // correct data</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>97</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertTrue(array_key_exists('subtitle', $row)); // &#34;subTitle&#34; is now &#34;subtitle&#34;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>98</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertFalse(array_key_exists('subTitle', $row)); // &#34;subTitle&#34; is not a key</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>99</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>100</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>101</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>102</th><td class="r"><ins>&nbsp; &nbsp; function testInsert()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>103</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>104</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $row = array (</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>105</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'title' =&gt; 'News Item 3',</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>106</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'subTitle' =&gt; 'Sub title 3',</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>107</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'body' =&gt; 'This is body 1',</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>108</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'date_created' =&gt; '2006-05-03 13:13:13'</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>109</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>110</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $rows_affected = $this-&gt;_db-&gt;insert(self::TableName, $row);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>111</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $last_insert_id = $this-&gt;_db-&gt;lastInsertId();</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>112</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;assertEquals(3, $last_insert_id); // correct id has been set</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>113</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>114</th><td class="r"><ins></ins>&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>115</th><td class="r"><ins>}</ins>&nbsp;</td></tr></tbody>
  </table>
 </li><li class="entry">
  <h2>Zend/Db/AllTests.php</h2>
  <table class="inline" summary="Differences" cellspacing="0">
   <colgroup><col class="lineno" /><col class="lineno" /><col class="content" /></colgroup>
   <thead><tr>
    <th>old</th>
    <th>new</th>
    <th>&nbsp;</th>
   </tr></thead><tbody class="add"><tr class="first"><th>&nbsp;</th><th>1</th><td class="r"><ins>&lt;?php</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>2</th><td class="r"><ins>if (!defined('PHPUnit2_MAIN_METHOD')) {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>3</th><td class="r"><ins>&nbsp; &nbsp; define('PHPUnit2_MAIN_METHOD', 'Zend_Db_AllTests::main');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>4</th><td class="r"><ins>}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>5</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>6</th><td class="r"><ins>require_once 'PHPUnit2/Framework/TestSuite.php';</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>7</th><td class="r"><ins>//require_once 'PHPUnit2/TextUI/TestRunner.php';</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>8</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>9</th><td class="r"><ins>if(TESTS_ZEND_DB_ADAPTER_PDO_MSSQL_ENABLED == true) {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>10</th><td class="r"><ins>&nbsp; &nbsp; require_once 'Zend/Db/Adapter/Pdo/MssqlTest.php';</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>11</th><td class="r"><ins>}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>12</th><td class="r"><ins>if(TESTS_ZEND_DB_ADAPTER_PDO_MYSQL_ENABLED == true) {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>13</th><td class="r"><ins>&nbsp; &nbsp; require_once 'Zend/Db/Adapter/Pdo/MysqlTest.php';</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>14</th><td class="r"><ins>}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>15</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>16</th><td class="r"><ins>class Zend_Db_AllTests</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>17</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>18</th><td class="r"><ins>&nbsp; &nbsp; public static function main()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>19</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>20</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; PHPUnit2_TextUI_TestRunner::run(self::suite());</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>21</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>22</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>23</th><td class="r"><ins>&nbsp; &nbsp; public static function suite()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>24</th><td class="r"><ins>&nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>25</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; $suite = new PHPUnit2_Framework_TestSuite('Zend Framework - Zend_Db');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>26</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>27</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if(TESTS_ZEND_DB_ADAPTER_PDO_MSSQL_ENABLED == true) {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>28</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $suite-&gt;addTestSuite('Zend_Db_Adapter_Pdo_MssqlTest');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>29</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>30</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if(TESTS_ZEND_DB_ADAPTER_PDO_MYSQL_ENABLED == true) {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>31</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $suite-&gt;addTestSuite('Zend_Db_Adapter_Pdo_MysqlTest');</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>32</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>33</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>34</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; return $suite;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>35</th><td class="r"><ins>&nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>36</th><td class="r"><ins>}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>37</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>38</th><td class="r"><ins>if (PHPUnit2_MAIN_METHOD == 'Zend_Db_AllTests::main') {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>39</th><td class="r"><ins>&nbsp; &nbsp; Zend_Db_AllTests::main();</ins>&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>40</th><td class="r"><ins>}</ins>&nbsp;</td></tr></tbody>
  </table>
 </li>
</ul></div>

 </div>
 


</div>
<script type="text/javascript">searchHighlight()</script>
<div id="altlinks"><h3>Download in other formats:</h3><ul><li class="first last"><a href="/developer/attachment/ticket/36/db_tests.patch?format=raw">Original Format</a></li></ul></div>

</div>

<div>
<form id="search" action="/developer/search" method="get">
 <div>
  <label for="proj-search">Search:</label>
  <input type="text" id="proj-search" name="q" size="30" accesskey="f" value="" />
  <input type="submit" value="Search in Developer" />
  <input type="hidden" name="wiki" value="on" />
  <input type="hidden" name="changeset" value="on" />
  <input type="hidden" name="ticket" value="on" />
 </div>
</form>
</div>

<div id="footer"><div id="siteinfo">Copyright &copy; 2006 by Zend Technologies, All rights reserved. | Trac by <a href="http://projects.edgewall.com/trac/">Edgewall Software</a></div></div>

 </body>
</html>

