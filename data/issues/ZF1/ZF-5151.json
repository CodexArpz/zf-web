{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5151",
    "key": "ZF-5151",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_File_Transfer_Http:: receive() and not required file"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5151\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-12-03T10:49:29.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                "name": "laurent melmoux",
                "displayName": "Laurent Melmoux",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-12-03T09:28:22.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-12-05T03:47:25.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "With the current implementation of  Zend_File_Transfer_Http:: receive() in the case of a **not require file** there is **no way to know** if the move of the temporary file to its destination have succeed or not.\n\nThis can happen for example when there is no write access on the destination folder.\n\nHere is a possible patch :\n\n{code}\n\n\n\n\/\/ Check for empty file\nif (empty($content['tmp_name'])) {\n    if ($content['options']['ignoreNoFile']) {\n        $this->_files[$file]['received'] = true;\n        $this->_files[$file]['filtered'] = true;\n    } else {\n        $this->_files[$file]['received'] = false;\n        return false;\n    }\n} \/\/ Should never return false when it's tested by the upload validator\nelseif (! move_uploaded_file($content['tmp_name'], ($directory . $content['name']))) {\n    $this->_files[$file]['received'] = false;\n    return false;\n}\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5151\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10260",
                    "id": 10260,
                    "description": "Minor Release",
                    "name": "1.7.0",
                    "userReleaseDate": "17\/Nov\/08",
                    "archived": false,
                    "releaseDate": "2008-11-17",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10320",
                    "id": 10320,
                    "name": "Zend_File_Transfer",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26925",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "If there is no access to the temporary directory you will get an exception when you set the destination or the rename filter.\n\nAnd if the file has succeeded can be detected with the isUploaded \/ isValid \/ isReceived \/ isFiltered methods.\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-12-03T10:43:23.000+0000",
                    "updated": "2008-12-03T10:43:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26940",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "body": "With the last stable release 1.7.1 my files aren't saved and no exception is thrown when my save directory have no write access.\nI'm using \n\n{code}\n$this->_form->getElement('photo')->setDestination($_SERVER['DOCUMENT_ROOT'] . 'medias\/news\/photos');\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "created": "2008-12-04T00:42:37.000+0000",
                    "updated": "2008-12-04T00:42:37.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26941",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "body": "The problem still remains:\nif a file with ['ignoreNoFile'] == true  is submitted and *move_uploaded_file* fails it will be consider received anyway :(",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "created": "2008-12-04T01:12:23.000+0000",
                    "updated": "2008-12-04T01:12:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26943",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "body": "Thomas I don't want to bother you ;-),\n\nbut in Zend_File_Transfer_Adapter_Abstract::setDestination()\nin conjunction to is_dir() you could had a check to see if the directory have write access",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "created": "2008-12-04T02:41:06.000+0000",
                    "updated": "2008-12-04T02:41:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26955",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "And what has this to do with receive and not required files ?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-12-04T10:46:56.000+0000",
                    "updated": "2008-12-04T10:46:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26956",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Provocant question:\nWhy do you manually set a directory when you do not have write access to it ?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-12-04T10:58:20.000+0000",
                    "updated": "2008-12-04T10:58:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/27062",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "body": "{quote}Why do you manually set a directory when you do not have write access to it ? {quote}\n\nUsually this happen when you go on production and forgot to chmod the directory. But a better place for this check is setDestination() \n\n{quote}And what has this to do with receive and not required files ? {quote}\n\nWell with the current implementation if my file have the option 'ignoreNoFile'  and even if I did submit one, if submit move_uploaded_file failed the file will be set at received",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "created": "2008-12-04T23:45:43.000+0000",
                    "updated": "2008-12-04T23:45:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/27067",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "body": "There is an error in my code above it shoud be : \\\\ \\\\\n{code}\n           \/\/ Check for empty file\n            if (empty($content['tmp_name'])) {\n                if ($content['options']['ignoreNoFile']) {\n                    $this->_files[$file]['received'] = true;\n                    $this->_files[$file]['filtered'] = true;\n                    return true;\n                } else {\n                    $this->_files[$file]['received'] = false;\n                    return false;\n                }\n            } \n\n            \/\/ Should never return false when it's tested by the upload validator\n            if (! move_uploaded_file($content['tmp_name'], ($directory . $content['name']))) {\n                $this->_files[$file]['received'] = false;\n                return false;\n            }\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "created": "2008-12-05T03:47:23.000+0000",
                    "updated": "2008-12-05T03:47:23.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5151\/transitions"
}