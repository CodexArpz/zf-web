{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3398",
    "key": "ZF-3398",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Translate - Zend_Translate_Adapter_Db - Making it work "
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3398\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/3",
                "name": "Duplicate"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-06-05T11:26:51.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=harabanar",
                "name": "harabanar",
                "displayName": "Helgi Hrafn Halld\u00f3rsson",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-06-05T10:58:18.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-06-06T04:08:48.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Looking at Zend_Translate, it would be nice to have Zend_Translate_Adapter_Db where the $data would be a Zend_Db_Table_Abstract, and you could specify the columns for messageId, message and locale. \n\nMy coworkers and I have looked at this and made some adjustments to the Zend_Translate::setAdapter function since it does not allow other adapters then specified in the function. As well as setting the $_cache and $_adapter variables as protected if Zend_Translate will be overwritten. Here is a patch\n\n{code}\nIndex: Translate.php\n===================================================================\n--- Translate.php\t(revision 9612)\n+++ Translate.php\t(working copy)\n@@ -52,14 +52,19 @@\n      *\n      * @var Zend_Translate_Adapter\n      *\/\n-    private $_adapter;\n-    private static $_cache = null;\n+    protected $_adapter;\n+    \/**\n+     * Cache to store to\n+     *\n+     * @var Zend_Cache_Core\n+     *\/\n+    protected static $_cache = null;\n \n \n     \/**\n      * Generates the standard translation object\n      *\n-     * @param  string              $adapter  Adapter to use\n+     * @param  string|Zend_Translate_Adapter $adapter  Adapter to use\n      * @param  array               $data     Translation source data for the adapter\n      *                                       Depends on the Adapter\n      * @param  string|Zend_Locale  $locale   OPTIONAL locale to use\n@@ -75,7 +80,7 @@\n     \/**\n      * Sets a new adapter\n      *\n-     * @param  string              $adapter  Adapter to use\n+     * @param  string|Zend_Translate_Adapter $adapter  Adapter to use\n      * @param  string|array        $data     Translation data\n      * @param  string|Zend_Locale  $locale   OPTIONAL locale to use\n      * @param  array               $options  OPTIONAL Options to use\n@@ -83,42 +88,54 @@\n      *\/\n     public function setAdapter($adapter, $data, $locale = null, array $options = array())\n     {\n-        switch (strtolower($adapter)) {\n-            case 'array':\n-                $adapter = 'Zend_Translate_Adapter_Array';\n-                break;\n-            case 'csv':\n-                $adapter = 'Zend_Translate_Adapter_Csv';\n-                break;\n-            case 'gettext':\n-                $adapter = 'Zend_Translate_Adapter_Gettext';\n-                break;\n-            case 'qt':\n-                $adapter = 'Zend_Translate_Adapter_Qt';\n-                break;\n-            case 'tbx':\n-                $adapter = 'Zend_Translate_Adapter_Tbx';\n-                break;\n-            case 'tmx':\n-                $adapter = 'Zend_Translate_Adapter_Tmx';\n-                break;\n-            case 'xliff':\n-                $adapter = 'Zend_Translate_Adapter_Xliff';\n-                break;\n-            case 'xmltm':\n-                $adapter = 'Zend_Translate_Adapter_XmlTm';\n-                break;\n-        }\n+        if(is_string($adapter)) {\n+            switch (strtolower($adapter)) {\n+                case self::AN_ARRAY:\n+                    $adapter = 'Zend_Translate_Adapter_Array';\n+                    break;\n+                case self::AN_CSV :\n+                    $adapter = 'Zend_Translate_Adapter_Csv';\n+                    break;\n+                case self::AN_GETTEXT :\n+                    $adapter = 'Zend_Translate_Adapter_Gettext';\n+                    break;\n+                case self::AN_QT :\n+                    $adapter = 'Zend_Translate_Adapter_Qt';\n+                    break;\n+                case self::AN_TBX :\n+                    $adapter = 'Zend_Translate_Adapter_Tbx';\n+                    break;\n+                case self::AN_TMX :\n+                    $adapter = 'Zend_Translate_Adapter_Tmx';\n+                    break;\n+                case self::AN_XLIFF :\n+                    $adapter = 'Zend_Translate_Adapter_Xliff';\n+                    break;\n+                case self::AN_XMLTM :\n+                    $adapter = 'Zend_Translate_Adapter_XmlTm';\n+                    break;\n+                default:\n+                    require_once 'Zend\/Translate\/Exception.php';\n+                    throw new Zend_Translate_Exception(\n+                        \"Adapter '\" . $adapter . \"' can not be automatically loaded\"\n+                    );\n+            }\n \n-        Zend_Loader::loadClass($adapter);\n-        if (self::$_cache !== null) {\n-            call_user_func(array($adapter, 'setCache'), self::$_cache);\n+            Zend_Loader::loadClass($adapter);\n+\n+            if (self::$_cache !== null) {\n+                call_user_func(array($adapter, 'setCache'), self::$_cache);\n+            }\n+\n+            $this->_adapter = new $adapter($data, $locale, $options);\n         }\n-        $this->_adapter = new $adapter($data, $locale, $options);\n-        if (!$this->_adapter instanceof Zend_Translate_Adapter) {\n-            require_once 'Zend\/Translate\/Exception.php';\n-            throw new Zend_Translate_Exception(\"Adapter \" . $adapter . \" does not extend Zend_Translate_Adapter'\");\n+        else if($adapter instanceof Zend_Translate_Adapter) {\n+        \t$this->_adapter = $adapter;\n+        \treturn ;\n         }\n+\n+        require_once 'Zend\/Translate\/Exception.php';\n+        throw new Zend_Translate_Exception(\"Adapter must be set\");\n     }\n\n{code}\n\n\nThen again .. the Zend_Translate_Adapter_Db ..\n\n{code}<?php\n\n\/** Zend_Locale *\/\nrequire_once 'Zend\/Locale.php';\n\n\/** Zend_Translate_Adapter *\/\nrequire_once 'Zend\/Translate\/Adapter.php';\n\nclass Zend_Translate_Adapter_Db extends Zend_Translate_Adapter\n{\n\t\/**\n\t * The table colums\n\t *\n\t * @var Array\n\t *\/\n\tprotected $tableColumns = array(\n\t\t'messageId'\t=> 'messageId',\n\t\t'locale'\t=> 'locale',\n\t\t'message'\t=> 'message'\n\t);\n\n    \/**\n     * Generates the adapter\n     *\n     * @param  string|array|Zend_Db_Table $data Translation database table name and table columns\n     * \t\t\t\t\t\t\t\t\t\tfor this adapter\n     * @param  string|Zend_Locale $locale  (optional) Locale\/Language to set, identical with Locale\n     *                                     identifiers see Zend_Locale for more information\n     * @param  array $options (optional) Options for the adaptor\n     * @throws Zend_Translate_Exception\n     * @return void\n     *\/\n\tpublic function __construct($data, $locale = null, array $options = array())\n\t{\n\t\tif (!is_array($data)) {\n\t\t\t$newData['dbTable'] = $data;\n\t\t\t$data = $newData;\n\t\t\tunset($newData);\n\t\t}\n\n\t\tif (isset($data['tableColumns'])) {\n\t\t\t$this->setTableColumns((array) $data['tableColumns']);\n\t\t\tunset($data['tableColumns']);\n\t\t}\n\n\t\tparent::__construct($data['dbTable'], $locale, $options);\n\t}\n\n\t\/**\n\t * Set the table columns\n\t *\n\t * @param array $columns\n\t *\/\n\tpublic function setTableColumns(array $columns)\n\t{\n\t\tforeach ($columns as $column => $value) {\n\t\t\tif (array_key_exists($column, $this->tableColumns))\n\t\t\t\t$this->tableColumns[$column] = $value;\n\t\t}\n\t}\n\n    \/**\n     * Load translation data\n     *\n     * @param  mixed   $dbTable   The database table model\n     * @param  string  $locale    Locale to add data for, identical with locale identifier,\n     * @param  array   $option    OPTIONAL Options to use\n     * @throws Zend_Translate_Exception\n     * @return void\n     *\/\n    protected function _loadTranslationData($dbTable, $locale, array $options = array())\n    {\n        $options = array_merge($this->_options, $options);\n\n        if (is_string($dbTable)) {\n        \trequire_once 'Zend\/Loader.php';\n        \tZend_Loader::loadClass($dbTable);\n\t\t\t$dbTable = new $dbTable;\n        }\n\n        if (! $dbTable instanceof Zend_Db_Table_Abstract) {\n        \trequire_once 'Zend\/Translate\/Exception.php';\n        \tthrow new Zend_Translate_Exception(\n        \t\t\"Database table must be instance of 'Zend_Db_Table_Abstract'\"\n        \t);\n        }\n\n\t\tif ($options['clear'] || !isset($this->_translate[$locale])) {\n\t\t\t$this->_translate[$locale] = array();\n\t\t}\n\n\t\t$colMessageId = $this->tableColumns['messageId'];\n\t\t$colLocale = $this->tableColumns['locale'];\n\t\t$colMessage = $this->tableColumns['message'];\n\n\t\t$translates = $dbTable->fetchAll(\n\t\t\tarray(\n\t\t\t\t\"$colLocale = ?\" => $locale\n\t\t\t),\n\t\t\tarray(\n\t\t\t\t$colMessageId\n\t\t\t)\n\t\t);\n\n\t\tforeach ($translates as $translate) {\n\t\t\t$messageId = $translate->$colMessageId;\n\t\t\t$this->_translate[$translate->$colLocale][$messageId] = $translate->$colMessage;\n\t\t}\n    }\n\n    \/**\n     * returns the adapters name\n     *\n     * @return string\n     *\/\n    public function toString()\n    {\n        return 'Db';\n    }\n}\n{code}\n\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3398\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-2248",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2248",
                    "type": {
                        "name": "Duplicate",
                        "direction": "OUTBOUND",
                        "description": "duplicates"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10181",
                    "id": 10181,
                    "description": "Mini Release",
                    "name": " 1.5.2",
                    "userReleaseDate": "15\/May\/08",
                    "archived": true,
                    "releaseDate": "2008-05-15",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10099",
                    "id": 10099,
                    "name": "Zend_Translate",
                    "description": "Provides translation functionality, based on standards such as TMX and Gettext.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22149",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Duplicate of existing issue ZF-2248.\nCan not be integrated as described here because it breaks existing model.\n\nPlease be patient until the official adapter is released.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-06-05T11:26:50.000+0000",
                    "updated": "2008-06-05T11:26:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22155",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=harabanar",
                        "name": "harabanar",
                        "displayName": "Helgi Hrafn Halld\u00f3rsson",
                        "active": true
                    },
                    "body": "then again .. why not fix the Zend_Translate so it can be easily be overwritten, as shown above. The setAdapter function does not allow other adapters then specified in the _switch_ statement. The patch I proposed makes that possible :D",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=harabanar",
                        "name": "harabanar",
                        "displayName": "Helgi Hrafn Halld\u00f3rsson",
                        "active": true
                    },
                    "created": "2008-06-06T01:35:05.000+0000",
                    "updated": "2008-06-06T01:35:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22157",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "First:\nYou can easily specify your own adapter even with existing model.\nJust extend Zend_Translate_Adapter.\nThere is no need of changing it for this reason.\nThis is simply OOP and described within the manual.\n\nZend_Translate MUST NOT BE EXTENDED... \nYou will also not extend Zend_Db but only Zend_Db_Table for example.\n\nSecond:\nZend_Translate is actually being reworked and will not exist as is in future. This changes will break BC with 2.0 but make additional features possible.\n\nThird:\nOnly viewing your patch I see several problems which would pop up when viewing the change in a broader environment.\nIt seems to fit only for one or two usecases.\n\nFourth:\nAs Zend_Translate is one of the CORE components, NO CODE will be integrated without being reviewed, documented, tested, tested, and of course tested in different environments.\n\nFifth:\nIn the original issue an link has been set to lead to this ticket. So it is not forgotten. Maybe parts of it will be used for the sql adapter but this will be checked as soon as the basework is finished and all available code segments are reviewed, including yours.\n\nSo please be patient until all work has been done. ;-)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-06-06T03:31:05.000+0000",
                    "updated": "2008-06-06T03:31:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22158",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=harabanar",
                        "name": "harabanar",
                        "displayName": "Helgi Hrafn Halld\u00f3rsson",
                        "active": true
                    },
                    "body": "Thank you for your comments, and of course you're working on all of this :D\n\nWhen looking over the setAdapter function in Zend_Translate I dont't see the possibility to use a adapter that I would create even if I extend Zend_Translate_Adapter. Because the _switch_ statement only allows the predefined Zend_Translate_Adapters. But anyways I wanted at least to submit this issue for people to think about, and I have surtenly done that :D\n\nthank you for your responses. ;)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=harabanar",
                        "name": "harabanar",
                        "displayName": "Helgi Hrafn Halld\u00f3rsson",
                        "active": true
                    },
                    "created": "2008-06-06T04:08:48.000+0000",
                    "updated": "2008-06-06T04:08:48.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3398\/transitions"
}