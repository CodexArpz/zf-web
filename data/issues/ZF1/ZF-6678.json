{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6678",
    "key": "ZF-6678",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Http_Client_Adapter_Curl returning HTTP headers in body"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6678\/votes",
                "votes": 2,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10340",
                    "id": 10340,
                    "description": "Mini Release",
                    "name": "1.8.4",
                    "userReleaseDate": "23\/Jun\/09",
                    "archived": false,
                    "releaseDate": "2009-06-23",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-06-12T14:27:53.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                "name": "jordanryanmoore",
                "displayName": "Jordan Ryan Moore",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-05-15T10:39:34.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-06-12T14:27:51.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When an HTTP server responds with \"HTTP\/1.1 100 Continue\", it can also contain additional headers before the next \"HTTP\/1.1 ****\". This isn't handled properly by Zend_Http_Client_Adapter_Curl::write(). Near the end of the method, it just strips \"HTTP\/1.1 100 Continue\\r\\n\\r\\n\" from the response. Instead, the response should be removed until it finds the next \"HTTP\/1.1 ****\" in the response.\n\nThe problem this creates is that the response object contains the second set of headers in the body. I found this problem when trying to use the cURL adapter with UPS web services."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/1",
                "name": "Blocker"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6678\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                "name": "beberlei",
                "displayName": "Benjamin Eberlei",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11972",
                    "filename": "Curl.php.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                        "name": "jordanryanmoore",
                        "displayName": "Jordan Ryan Moore",
                        "active": true
                    },
                    "created": "2009-06-02T11:55:16.000+0000",
                    "size": 1579,
                    "mimeType": "text\/x-patch",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11972\/Curl.php.patch"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11932",
                    "filename": "Curl.php.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                        "name": "jordanryanmoore",
                        "displayName": "Jordan Ryan Moore",
                        "active": true
                    },
                    "created": "2009-05-15T14:26:29.000+0000",
                    "size": 1193,
                    "mimeType": "text\/x-patch",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11932\/Curl.php.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10241",
                    "id": 10241,
                    "description": "Minor Release",
                    "name": "1.8.0",
                    "userReleaseDate": "30\/Apr\/09",
                    "archived": false,
                    "releaseDate": "2009-04-30",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10310",
                    "id": 10310,
                    "description": "Mini Release",
                    "name": "1.8.1",
                    "userReleaseDate": "12\/May\/09",
                    "archived": false,
                    "releaseDate": "2009-05-12",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10015",
                    "id": 10015,
                    "name": "Zend_Http_Client",
                    "description": "performs HTTP requests",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31028",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Assigning to Benjamin Eberlei (who authored the curl adapter)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-05-15T10:59:11.000+0000",
                    "updated": "2009-05-15T10:59:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31038",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "Hm, that is a hard one.\n\nThe API of Zend Http makes it hard to work with Curl 100 states. I see what i can come up with :-)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2009-05-15T12:03:16.000+0000",
                    "updated": "2009-05-15T12:03:16.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31048",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                        "name": "jordanryanmoore",
                        "displayName": "Jordan Ryan Moore",
                        "active": true
                    },
                    "body": "The attached patch resolves the issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                        "name": "jordanryanmoore",
                        "displayName": "Jordan Ryan Moore",
                        "active": true
                    },
                    "created": "2009-05-15T14:26:34.000+0000",
                    "updated": "2009-05-15T14:26:34.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31523",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "Can you send me an example HTTP ping pong that executes parts of the patched code? I have applied the patch locally and it seems not to interfere with the tests (all still passing). The new code also executes for several tests, but all those worked before also. I need an example of how i get the old code to fail :-)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2009-06-01T03:47:06.000+0000",
                    "updated": "2009-06-01T03:47:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31527",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                        "name": "jordanryanmoore",
                        "displayName": "Jordan Ryan Moore",
                        "active": true
                    },
                    "body": "Here's the HTTP response that was causing the problem:\n\nHTTP\/1.1 100 Continue\nExpires: Mon, 01 Jun 2009 15:10:45 GMT\nCache-Control: max-age=0, no-cache, no-store\nPragma: no-cache\n\nHTTP\/1.1 200 OK\nServer: Apache\/2.0.52 (Red Hat) mod_ssl\/2.0.52 OpenSSL\/0.9.7a\nContent-Length: 9226\nContent-Type: text\/xml\nExpires: Mon, 01 Jun 2009 15:10:46 GMT\nCache-Control: max-age=0, no-cache, no-store\nPragma: no-cache\nDate: Mon, 01 Jun 2009 15:10:46 GMT\nConnection: keep-alive\n\n<?xml version=\"1.0\" ?>\nThe rest of the body goes here...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                        "name": "jordanryanmoore",
                        "displayName": "Jordan Ryan Moore",
                        "active": true
                    },
                    "created": "2009-06-01T08:13:42.000+0000",
                    "updated": "2009-06-01T08:13:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31532",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=drock",
                        "name": "drock",
                        "displayName": "Derek Gallo",
                        "active": true
                    },
                    "body": "This issue is more broad than just the HTTP\/1.1 100 Continue case.  You can get similar problems when trying to use the curl adapter to perform HTTP Digest Authentication.  Curl will make a first request to the server to poll it for the appropriate nonce value to perform that hash.  After this it sends another request with the appropriate credentials.  Curl returns both sets of headers however, one for the 401 Authorization Required and then a second for the 220 OK response.\n\nZend_Http_Client is including the second 200 OK response headers as part of the response body since they are after the first double newlines.  Additionally Zend_Http_Client is interpreting the first HTTP\/1.1 401 as the response and falsely indicating that there was an error.\n\nHere is some code that can reproduce the problem:\n\n\n$curl_adapter = new Zend_Http_Client_Adapter_Curl();\n\n$curl_adapter->setCurlOption(CURLOPT_HTTPAUTH,CURLAUTH_ANY);\n$curl_adapter->setCurlOption(CURLOPT_USERPWD,\"user:password\");\n\n$http_client = new Zend_Http_Client('http:\/\/domain.com\/digest\/auth\/url');\n$http_client->setAdapter($curl_adapter);\n\n$response = $http_client->request();\n\nThe provided path will only fix the HTTP\/1.1 100 Continue case since it specifically looks for the 100 code to remove.  A more general solution is required as it appears Curl returns the headers for every request it makes.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=drock",
                        "name": "drock",
                        "displayName": "Derek Gallo",
                        "active": true
                    },
                    "created": "2009-06-01T10:36:36.000+0000",
                    "updated": "2009-06-01T10:36:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31555",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                        "name": "jordanryanmoore",
                        "displayName": "Jordan Ryan Moore",
                        "active": true
                    },
                    "body": "Attached a more general solution.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                        "name": "jordanryanmoore",
                        "displayName": "Jordan Ryan Moore",
                        "active": true
                    },
                    "created": "2009-06-02T11:55:17.000+0000",
                    "updated": "2009-06-02T11:55:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31813",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "Applied Jordans patchs, fixed in r16035 and merged back into 1.8 release branch. Thank you!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2009-06-12T14:27:51.000+0000",
                    "updated": "2009-06-12T14:27:51.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6678\/transitions"
}