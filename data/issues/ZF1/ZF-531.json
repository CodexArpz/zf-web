{
    "expand": "html",
    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-531",
    "key": "ZF-531",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Search is too slow"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-531\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/version\/10040",
                    "id": 10040,
                    "description": "Preview Release; MVC maturation, HTTP client, Gdata",
                    "name": "0.6.0",
                    "userReleaseDate": "16\/Dec\/06",
                    "archived": true,
                    "releaseDate": "2006-12-16",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2006-11-14T19:07:22.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                "name": "alexander",
                "displayName": "Alexander Veremyev",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2006-11-10T14:49:46.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-05T14:43:27.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "It's initially reported by Garth Gillespie in FW-General mailing list: http:\/\/framework.zend.com\/wiki\/display\/ZFMLGEN\/mail\/9328\n\nSearch for two-terms multi-term query through 40K records index takes 40-90 seconds.\n\nTest system is dual Xeon 2.4 with 2GB ram.\n\nThe same query takes ~1.5 seconds in other environment and on less powerful system.\n\nNumber of hits is ~8000.\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-531\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                "name": "alexander",
                "displayName": "Alexander Veremyev",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/attachment\/10150",
                    "filename": "Filesystem.php",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2006-11-13T06:16:13.000+0000",
                    "size": 5551,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/framework.zend.com\/issues\/secure\/attachment\/10150\/Filesystem.php"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/attachment\/10149",
                    "filename": "sl-index-opt.tar.gz",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2006-11-13T06:14:31.000+0000",
                    "size": 6219041,
                    "mimeType": "application\/x-gzip",
                    "content": "http:\/\/framework.zend.com\/issues\/secure\/attachment\/10149\/sl-index-opt.tar.gz"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/attachment\/10148",
                    "filename": "sl-index.tar.gz",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2006-11-13T06:11:08.000+0000",
                    "size": 6621471,
                    "mimeType": "application\/x-gzip",
                    "content": "http:\/\/framework.zend.com\/issues\/secure\/attachment\/10148\/sl-index.tar.gz"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/component\/10021",
                    "id": 10021,
                    "name": "Zend_Search_Lucene",
                    "description": "pure PHP robust, general purpose text search engine",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11287",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=garth.gillespie",
                        "name": "garth.gillespie",
                        "displayName": "Garth Gillespie",
                        "active": true
                    },
                    "body": "Thanks Alex.\n\nI have made two new indexes for testing, one optimized, one not.\n\nThey can be downloaded at\n\n(not optimized)\nhttp:\/\/www.superlawyers.com:8080\/sl-index.tar.gz\n\n(optimized)\nhttp:\/\/www.superlawyers.com:8080\/sl-index-opt.tar.gz\n\nBoth indexes open locally with Luke.\n\nTest search times on website\n\nunoptimized index\n\n+altanta - 63 seconds - 1772 results\n+los +angeles - 170 seconds - 4096 results\n+los +angeles +barbanel - 1.03 seconds - 2 results\n\noptimized index\n\n+altanta - 16 seconds - 1141 results\n+los +angeles - 20 seconds - 1462 results\n+los +angeles +barbanel - .4 seconds - 1 results\n\n i can't explain the different result amounts between the indexes.\n\nsystem is dual xeon 2.4 - 2gb ram - kernel 2.6.9",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=garth.gillespie",
                        "name": "garth.gillespie",
                        "displayName": "Garth Gillespie",
                        "active": true
                    },
                    "created": "2006-11-10T16:25:26.000+0000",
                    "updated": "2006-11-10T16:25:26.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11288",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=garth.gillespie",
                        "name": "garth.gillespie",
                        "displayName": "Garth Gillespie",
                        "active": true
                    },
                    "body": "I'll also add, I did upgrade to php 5.2 - so I do not have Optimizer being loaded ...",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=garth.gillespie",
                        "name": "garth.gillespie",
                        "displayName": "Garth Gillespie",
                        "active": true
                    },
                    "created": "2006-11-10T16:27:43.000+0000",
                    "updated": "2006-11-10T16:27:43.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11307",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "body": "As I see unoptimized and optimized indices are different. Both indices are OK\n\nI made another optimized index by optimizing sl-index.tar.gz index.\nI'll attach sl-index.tar.gz and its optimized version to the issue.\n\n'+los +angeles' query takes ~1.4 seconds with unoptimized index and ~1.14 with optimized.\n\nI've prepared special version of library\/Zend\/Search\/Lucene\/Storage\/File\/FileSystem.php file, which calculates overall IO time.\nThis calculation takes time itself and increases query execution time:\n'+los +angeles' unoptimized index - 1.4 => 2.8sec   calculated IO time - ~0.8sec\n'+los +angeles' optimized index - 1.14 => 2.3sec   calculated IO time - ~0.6sec\n\nto get calculated IO time use:\n----------------\necho \"IO time: \" . (Zend_Search_Lucene_Storage_File_Filesystem::$zendSearchLuceneIOTime) . \"\\n\";\n----------------\n\nPlease test attached FileSystem.php file with your queries.\n",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2006-11-13T06:05:40.000+0000",
                    "updated": "2006-11-13T06:05:40.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11308",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "body": "Unoptimized index",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2006-11-13T06:11:08.000+0000",
                    "updated": "2006-11-13T06:11:08.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11309",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "body": "Optimized index",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2006-11-13T06:14:31.000+0000",
                    "updated": "2006-11-13T06:14:31.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11310",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "body": "library\/Zend\/Search\/Lucene\/Storage\/File\/Filesystem.php",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2006-11-13T06:16:13.000+0000",
                    "updated": "2006-11-13T06:16:13.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11311",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=garth.gillespie",
                        "name": "garth.gillespie",
                        "displayName": "Garth Gillespie",
                        "active": true
                    },
                    "body": "Hi Alexander,\n\nUsing your optimized index and modified Filesystem.php I get ..\n\n'+los +angeles' optimized index => Overall Search Time - 106.22253298759 sec -- IO time: 0.38657212257385\n\nI don't think this is an IO issue.\n\nDid you see my question about Zend Optimizer?  Could that make a difference?  ",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=garth.gillespie",
                        "name": "garth.gillespie",
                        "displayName": "Garth Gillespie",
                        "active": true
                    },
                    "created": "2006-11-13T11:25:13.000+0000",
                    "updated": "2006-11-13T11:25:13.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11312",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=garth.gillespie",
                        "name": "garth.gillespie",
                        "displayName": "Garth Gillespie",
                        "active": true
                    },
                    "body": "Just an observation: \n\nWhen I enter enough search terms to get a small result set (<100) - the search times are good (<2 sec).\n\nIs there anything about how the result sets are handled that might be problematic on some systems?",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=garth.gillespie",
                        "name": "garth.gillespie",
                        "displayName": "Garth Gillespie",
                        "active": true
                    },
                    "created": "2006-11-13T11:42:56.000+0000",
                    "updated": "2006-11-13T11:42:56.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11315",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=garth.gillespie",
                        "name": "garth.gillespie",
                        "displayName": "Garth Gillespie",
                        "active": true
                    },
                    "body": "Further tests:\n\nI setup another linux environment on my local machine.  Intel Core 2 Duo - 2.13Ghz and 2GB ram.\n\nApache (2.2.3) and PHP (5.2.0) configured as they are on the server\n\n'+los +angeles' optimized index => Overall Search Time - 37.82331609726 sec - IO time: 0.14364194869995 (+4000) results\n\nwhile faster than our server, still too slow for production.\n\nmy php configure is ...\n\n.\/configure -v --with-apxs2=\/usr\/local\/apache2\/bin\/apxs \\\n--with-mysql=\/usr\/lib --with-config-file-path=\/etc\/httpd \\\n--with-regex=php --with-gettext --with-gd \\\n--with-libxml-dir=\/usr\/lib \\\n--enable-memcache \\\n--without-sqlite --enable-sockets \\\n--with-expat-dir=\/usr --with-zlib \\\n--with-iconv --with-xsl --enable-bcmath \\\n--with-curl=\/usr\/local\/lib\n",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=garth.gillespie",
                        "name": "garth.gillespie",
                        "displayName": "Garth Gillespie",
                        "active": true
                    },
                    "created": "2006-11-13T14:43:02.000+0000",
                    "updated": "2006-11-13T14:43:02.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11528",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Changing fix version to 0.6.0.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2006-11-13T15:26:54.000+0000",
                    "updated": "2006-11-13T15:26:54.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11550",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "body": "I've got the the same behavior (search too slow) with PHP V5.2. So I've reproduced the problem.\n\nPHP 5.1.3RC3 - ~1sec\nPHP 5.2.1-dev - 95sec\n",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2006-11-14T15:25:58.000+0000",
                    "updated": "2006-11-14T15:25:58.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11553",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "body": "The problem was in objects comparison.\n\nZend_Search_Lucene::find() method uses array_multisort() to sort hits array. array_multisort() compares array entries to sort them in appropriate order.\nIf entries in the first array (actually scores array) are equal, it tries to compare entries from the next array. It was hits array.\n\nEach hit object has a protected property, which refers to the index object. Index is large and complex object, which refers to several others large and complex objects :)\nIndex reference is always the same for the same hits set. Thus all index object properties were compared recursively! :)\n\nSomething was changed in PHP object comparison behavior for PHP 5.2\nComparison of the first listed object property (which is actually 'protected $_index;' property) is involved before any other. It causes this nightmare.\n\n\nI've added ids array to list of compared arrays. Ids are always unique, so objects will never be compared.\nIt solves the problem. It also make this sorting faster for PHP 5.1.x\n\nFix is committed into SVN and also will be available with next [nightly snapshot|http:\/\/framework.zend.com\/download\/snapshot].\n",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2006-11-14T19:07:22.000+0000",
                    "updated": "2006-11-14T19:07:22.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11555",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=garth.gillespie",
                        "name": "garth.gillespie",
                        "displayName": "Garth Gillespie",
                        "active": true
                    },
                    "body": "You rock Alexander.\n\n'+los +angeles' optimized index => Overall Search Time - 1.6485729217529 sec - IO time: 0.31546688079834 (+4000) results\n\nThanks very much.  You can close this issue!\n\n-Garth",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=garth.gillespie",
                        "name": "garth.gillespie",
                        "displayName": "Garth Gillespie",
                        "active": true
                    },
                    "created": "2006-11-14T20:17:00.000+0000",
                    "updated": "2006-11-14T20:17:00.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-531\/transitions"
}