{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5721",
    "key": "ZF-5721",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Annoying to debug test cases, Zend_Test_PHPUnit::dispatch() never throws FC exceptions"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5721\/votes",
                "votes": 11,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                "name": "gnanderson",
                "displayName": "Graham Anderson",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-02-10T03:36:06.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-06-10T04:04:28.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Zend_Test_PHPUnit::dispatch() will always set the FC throw exceptions flag to false, this makes debugging test cases slightly more annoying and lengthy. Allowing the front controller to throw exceptions when using this method would help when tracking down any bugs in the text cases and\/or the bootstraping required for testing controllers.\n\nHere's a diff with a trivial fix\n\ndiff --git a\/library\/Zend\/Test\/PHPUnit\/ControllerTestCase.php b\/library\/Zend\/Test\/PHPUnit\/ControllerTestCase.php\nindex 3885e00..67ecf76 100644\n--- a\/library\/Zend\/Test\/PHPUnit\/ControllerTestCase.php\n+++ b\/library\/Zend\/Test\/PHPUnit\/ControllerTestCase.php\n@@ -146,7 +146,7 @@ abstract class Zend_Test_PHPUnit_ControllerTestCase extends PHPUnit_Framework_Te\n      * @param  string|null $url\n      * @return void\n      *\/\n-    public function dispatch($url = null)\n+    public function dispatch($url = null, $throwExceptions = false)\n     {\n         \/\/ redirector should not exit\n         $redirector = Zend_Controller_Action_HelperBroker::getStaticHelper('redirector');\n@@ -165,7 +165,7 @@ abstract class Zend_Test_PHPUnit_ControllerTestCase extends PHPUnit_Framework_Te\n         $this->frontController\n              ->setRequest($request)\n              ->setResponse($this->getResponse())\n-             ->throwExceptions(false)\n+             ->throwExceptions($throwExceptions)\n              ->returnResponse(false);\n         $this->frontController->dispatch();\n     }\n\n\n\n\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/5",
                "name": "Trivial"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5721\/watchers",
                "isWatching": false,
                "watchCount": 5
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10312",
                    "id": 10312,
                    "name": "Zend_Test_PHPUnit",
                    "description": "PHPUnit test scaffolding for ZF MVC applications",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28721",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                        "name": "gnanderson",
                        "displayName": "Graham Anderson",
                        "active": true
                    },
                    "body": "oops, wikified version of the diff \n{noformat}\n\ndiff --git a\/library\/Zend\/Test\/PHPUnit\/ControllerTestCase.php b\/library\/Zend\/Test\/PHPUnit\/ControllerTestCase.php\nindex 3885e00..67ecf76 100644\n--- a\/library\/Zend\/Test\/PHPUnit\/ControllerTestCase.php\n+++ b\/library\/Zend\/Test\/PHPUnit\/ControllerTestCase.php\n@@ -146,7 +146,7 @@ abstract class Zend_Test_PHPUnit_ControllerTestCase extends PHPUnit_Framework_Te\n      * @param  string|null $url\n      * @return void\n      *\/\n-    public function dispatch($url = null)\n+    public function dispatch($url = null, $throwExceptions = false)\n     {\n         \/\/ redirector should not exit\n         $redirector = Zend_Controller_Action_HelperBroker::getStaticHelper('redirector');\n@@ -165,7 +165,7 @@ abstract class Zend_Test_PHPUnit_ControllerTestCase extends PHPUnit_Framework_Te\n         $this->frontController\n              ->setRequest($request)\n              ->setResponse($this->getResponse())\n-             ->throwExceptions(false)\n+             ->throwExceptions($throwExceptions)\n              ->returnResponse(false);\n         $this->frontController->dispatch();\n     }\n{noformat}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                        "name": "gnanderson",
                        "displayName": "Graham Anderson",
                        "active": true
                    },
                    "created": "2009-02-10T03:38:47.000+0000",
                    "updated": "2009-02-10T03:38:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28889",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=giorgiosironi",
                        "name": "giorgiosironi",
                        "displayName": "Giorgio Sironi",
                        "active": true
                    },
                    "body": "I also had the same problem. IMHO the throwExceptions argument might be true by default. Test are executed in a command line environment, so there's no point is wrapping an exception in a error controller or similar one.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=giorgiosironi",
                        "name": "giorgiosironi",
                        "displayName": "Giorgio Sironi",
                        "active": true
                    },
                    "created": "2009-02-17T08:22:19.000+0000",
                    "updated": "2009-02-17T08:22:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28892",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "You know that you can always check the request object for the error_handler parameter, and pull the exception from that object, right? ;)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-02-17T09:13:26.000+0000",
                    "updated": "2009-02-17T09:13:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29046",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=giorgiosironi",
                        "name": "giorgiosironi",
                        "displayName": "Giorgio Sironi",
                        "active": true
                    },
                    "body": "...OK (127 tests, 331 assertions)\nI have many integration tests and I just want to know quickly is something has exploded and front controller is serving a beatiful page (with menu and header and a nice formatted 40+ rows stacktrace in the middle) instead of the correct page. :)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=giorgiosironi",
                        "name": "giorgiosironi",
                        "displayName": "Giorgio Sironi",
                        "active": true
                    },
                    "created": "2009-02-24T00:40:13.000+0000",
                    "updated": "2009-02-24T00:40:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30247",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rott",
                        "name": "rott",
                        "displayName": "Mike Rheinheimer",
                        "active": true
                    },
                    "body": "I threw in my vote for this issue too.  I had a view partial that was trying to load a partialLoop file that was unable to be found:\n\n    echo $this->partialLoop('viewPartialLoop.phtml', $this->publicCats);\n\nThe directory where viewPartialLoop.phtml is located was not in my include path.  The exception I should have recieved was:\n\n    Fatal error: Uncaught exception 'Zend_View_Exception' with message 'script 'viewPartialLoop.phtml' not found in path ...\n\nMy testcase was only doing this:\n\n        $this->dispatch('\/Categories\/view');\n        $this->assertQueryContentContains( 'dd', 'bridals' );\n\nThe error I got was much more obscure, because ControllerTestCase sets frontController->throwExceptions(false):\n\n        Zend_Dom_Exception: Error parsing document (type == docHtml)\n        <path>ZendFramework-1.7.7\\library\\Zend\\Dom\\Query.php:190\n\nThis problem turned out to be very difficult to debug.  I had to fire up a server, and point my config, etc, to the proper databases, and hit that controller\/action to see the real problem.  Alternatively, I could have just modified ControllerTestCase just long enough to see the real issue.\n\nI think there are three possible solutions:\n\n1)  do as Matthew says and check the request object for the error_handler param and pull any exceptions (for EVERY controller dispatch test, ugh)\n2)  extend the ControllerTestCase class and override the dispatch function (again, ugh -- because ControllerTestCase->dispatch could change in the future)\n3)  ControllerTestCase should allow users to specify the 'throwExceptions\" for the frontController object (PREFERRED -- and this is what I was trying to do in various ways until I finally looked at the ControllerTestCase->dispatch function)\n\nThat's my 2 cents.  Thanks!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rott",
                        "name": "rott",
                        "displayName": "Mike Rheinheimer",
                        "active": true
                    },
                    "created": "2009-04-18T20:59:21.000+0000",
                    "updated": "2009-04-18T20:59:21.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30248",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rott",
                        "name": "rott",
                        "displayName": "Mike Rheinheimer",
                        "active": true
                    },
                    "body": "The ideal solution is to perhaps let me do this:\n\n{code}\nclass MyControllerTestCase extends Zend_Test_PHPUnit_ControllerTestCase\n{\n\n    \/**\n     * I use this setUp method so make sure the front controller has the right default module configured,\n     * as well as preventing the error handler from getting called.\n     *\/\n    \/\/ override\n    public function setUp()\n    {\n        parent::setUp();\n        $config = Zend_Registry::get('config');\n        $this->frontController->setControllerDirectory(array(\n                'default' => $config->document_root . '\/..\/application\/default\/controllers'\n                ));\n        \/\/ TODO: ideally, I'd like to be able to do the next three lines, but until http:\/\/framework.zend.com\/issues\/browse\/ZF-5721 is fixed,\n        \/\/ these are meaningless because Zend_Test_PHPUnit_ControllerTestCase->dispatch sets these every time:\n        $this->frontController->setParam('noErrorHandler', true);\n        $this->frontController->throwExceptions(true);\n        $this->frontController->returnResponse(true);\n    }\n\n}\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rott",
                        "name": "rott",
                        "displayName": "Mike Rheinheimer",
                        "active": true
                    },
                    "created": "2009-04-18T21:46:24.000+0000",
                    "updated": "2009-04-18T21:46:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34592",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "@Matthew:\n\nhow about adding a second parameter:\n\n{code}\npublic function dispatch($url, $throwExceptions=false)\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2009-09-18T01:17:11.000+0000",
                    "updated": "2009-09-18T01:17:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41572",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dragonbe",
                        "name": "dragonbe",
                        "displayName": "Michelangelo van Dam",
                        "active": true
                    },
                    "body": "For as long as I've been using ZF, I always have my testing environment report, log errors and throw exceptions. \r\n\r\nThe minimum I have set up in my \"testing\" section of my application.ini is the following:\r\n{code}\r\n[testing : production]\r\nphpSettings.display_startup_errors = 1\r\nphpSettings.display_errors = 1\r\nresources.frontController.params.displayExceptions = 1\r\n{code}\r\n\r\nOne point of mentioning is that I use PHPUnit on CLI or within a CI system, but that shouldn't make a difference since tests are tests, no matter where they're run.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dragonbe",
                        "name": "dragonbe",
                        "displayName": "Michelangelo van Dam",
                        "active": true
                    },
                    "created": "2010-07-17T12:31:44.000+0000",
                    "updated": "2010-07-17T12:31:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44344",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ashawley",
                        "name": "ashawley",
                        "displayName": "Aaron S. Hawley",
                        "active": true
                    },
                    "body": "I agree that this should be fixed.  Why not just let the user decide.\r\n\r\n{noformat}\r\nIndex: library\/Zend\/Test\/PHPUnit\/ControllerTestCase.php\r\n===================================================================\r\n--- library\/Zend\/Test\/PHPUnit\/ControllerTestCase.php\t(revision 23692)\r\n+++ library\/Zend\/Test\/PHPUnit\/ControllerTestCase.php\t(working copy)\r\n@@ -196,7 +196,6 @@\r\n         $this->frontController\r\n              ->setRequest($request)\r\n              ->setResponse($this->getResponse())\r\n-             ->throwExceptions(false)\r\n              ->returnResponse(false);\r\n \r\n         if ($this->bootstrap instanceof Zend_Application) {\r\n{noformat}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ashawley",
                        "name": "ashawley",
                        "displayName": "Aaron S. Hawley",
                        "active": true
                    },
                    "created": "2011-02-11T08:22:08.000+0000",
                    "updated": "2011-02-11T08:22:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/45831",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=andras",
                        "name": "andras",
                        "displayName": "Andras Gyomrey",
                        "active": true
                    },
                    "body": "Please, this isn't a huge change. Even the patch is provided. When is it going to be commited?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=andras",
                        "name": "andras",
                        "displayName": "Andras Gyomrey",
                        "active": true
                    },
                    "created": "2011-04-06T20:13:18.000+0000",
                    "updated": "2011-04-06T20:13:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51031",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=makiemoo",
                        "name": "makiemoo",
                        "displayName": "Matt Makins",
                        "active": true
                    },
                    "body": "Like Matthew Weier O'Phinney states use the error_handler param for debugging.\r\n\r\nThis works in my tests:\r\n\r\n\/\/ get the errors\r\n$errors = $this->request->getParam('error_handler');\r\n\/\/ throw the exception so it is apparent on cli when running tests\r\nthrow new Zend_Exception($errors->exception);",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=makiemoo",
                        "name": "makiemoo",
                        "displayName": "Matt Makins",
                        "active": true
                    },
                    "created": "2012-06-08T10:47:42.000+0000",
                    "updated": "2012-06-08T10:47:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51050",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ashawley",
                        "name": "ashawley",
                        "displayName": "Aaron S. Hawley",
                        "active": true
                    },
                    "body": "Adding two-lines of code to unit tests is just an admission that this is indeed broken.\r\n\r\nI want to use the config file as [~dragonbe] suggests, not add two-lines of code to every unit test or worse have to have maintain a base class that my unit tests inherit from.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ashawley",
                        "name": "ashawley",
                        "displayName": "Aaron S. Hawley",
                        "active": true
                    },
                    "created": "2012-06-10T04:04:28.000+0000",
                    "updated": "2012-06-10T04:04:28.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5721\/transitions"
}