{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9862",
    "key": "ZF-9862",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Form get\/setElementsBelongTo() doing bad"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9862\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-05-21T17:36:44.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jer",
                "name": "jer",
                "displayName": "boris",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-05-19T13:09:07.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-05-21T17:36:45.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I saw this patch [ZF-9593] and something wrong with it\r\n\r\nIf both form and it's subform set isArray(true)\r\n{code}\r\n$form = new Zend_Form(array(\r\n\t'name' => 'main',\r\n\t'isArray' => true,\r\n\r\n\t'subforms' => array(\r\n\t\t'subform1' => new Zend_Form_SubForm(array(\r\n\t\t\t'name' => 'sub1',\r\n\t\t\t'isArray' => true,\r\n\r\n\t\t\t'elements' => array(\r\n\t\t\t\tarray(\r\n\t\t\t\t\t'text',\r\n\t\t\t\t\t'test',\r\n\t\t\t\t\tarray('required' => true)\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t)\r\n\t))\r\n));\r\n\r\n$subform2 = new Zend_Form_SubForm(array(\r\n\t'isArray' => true,\r\n\t'name' => 'sub2')\r\n);\r\n\r\n$subform2->addElement(\r\n\t'text',\r\n\t'test',\r\n\tarray('required' => true)\r\n);\r\n\r\n$form\r\n\t->addSubForm($subform2, 'subform2')\r\n\t->addDecorator('FormErrors')\r\n\t->isValid(array())\r\n;\r\n\r\nprint '<pre>';\r\nprint_r($messages = $form->getMessages());\r\n\/\/ output:\r\n\/\/    [main] => Array\r\n\/\/            [subform1] => Array\r\n\/\/                    [test] => Array\r\n\/\/                            [isEmpty] => Value is required and can't be empty\r\n\/\/            [subform2] => Array\r\n\/\/                    [test] => Array\r\n\/\/                            [isEmpty] => Value is required and can't be empty\r\n\/\/ all fine!\r\n\r\nprint_r($values = $form->getValues());\r\n\/\/    [main] => Array\r\n\/\/            [subform1] => Array\r\n\/\/                    [test] => \"\"\r\n\/\/            [subform2] => Array\r\n\/\/                    [sub2] => Array\t\t\/\/ extra level !!!\r\n\/\/                            [test] => \"\"\r\n\r\n\/\/ formElements decorator calls to setElementsBelongTo() many times\r\n$form->renderFormElements();\r\n\r\nprint_r($messages2 = $form->getMessages());\r\n\/\/    [main] => Array\r\n\/\/            [main] => Array\t\t\/\/ not a typo - its repeated !!!\r\n\/\/                    [subform1] => Array\r\n\/\/                            [test] => Array\r\n\/\/                                    [isEmpty] => Value is required and can't be empty\r\n\/\/                    [subform2] => Array\r\n\/\/                            [test] => Array\r\n\/\/                                    [isEmpty] => Value is required and can't be empty\r\n\r\nprint_r($values2 = $form->getValues());\r\n\/\/    [main] => Array\r\n\/\/            [main] => Array\t\t\/\/ !!!\r\n\/\/                    [subform1] => Array\r\n\/\/                            [test] => \r\n\/\/                    [subform2] => Array\r\n\/\/                            [test] => \r\n\r\n\/\/ will render nothing after FormElements decorator cause getMessages() returns garbage\r\n$form->renderFormErrors();\r\nprint '<\/pre>';\r\n\r\n{code}\r\n\r\ntested with subforms set isArray(false) - results are the same"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9862\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                "name": "alab",
                "displayName": "Christian Albrecht",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-9593",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9593",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-9863",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9863",
                    "type": {
                        "name": "Dependency",
                        "direction": "INBOUND",
                        "description": "is dependecy of"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-9863",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9863",
                    "type": {
                        "name": "Sub-Task",
                        "direction": "OUTBOUND"
                    }
                }
            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10451",
                    "id": 10451,
                    "description": "Mini Release",
                    "name": "1.10.4",
                    "userReleaseDate": "28\/Apr\/10",
                    "archived": false,
                    "releaseDate": "2010-04-28",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40579",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                        "name": "alab",
                        "displayName": "Christian Albrecht",
                        "active": true
                    },
                    "body": "First problem, the extra array levels fixed in r22217 and merged into 1.10 release branch.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                        "name": "alab",
                        "displayName": "Christian Albrecht",
                        "active": true
                    },
                    "created": "2010-05-20T15:30:56.000+0000",
                    "updated": "2010-05-20T15:30:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40596",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                        "name": "alab",
                        "displayName": "Christian Albrecht",
                        "active": true
                    },
                    "body": "The second, the repeated array keys, is a result of the lines\r\n{code:title=Zend_Form::getMessages}\r\n...\r\n        if (!$suppressArrayNotation && $this->isArray()) {\r\n            $messages = $this->_attachToArray($messages, $this->getElementsBelongTo());\r\n        }\r\n...\r\n{code}\r\nwhich after calling renderFormElements cause the returned array to have repeated main keys.\r\n\r\nA workaround could be to call $form->getMessages(null, true) to suppress Array Notation,\r\ncannot think of an easy solution at the moment.\r\n\r\nThe questions that arise are:\r\n- why do you need to set isArray on the main form?\r\n- why do you have to call renderFormElements before getValues and getMessages?\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                        "name": "alab",
                        "displayName": "Christian Albrecht",
                        "active": true
                    },
                    "created": "2010-05-21T08:52:08.000+0000",
                    "updated": "2010-05-21T08:52:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40602",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jer",
                        "name": "jer",
                        "displayName": "boris",
                        "active": true
                    },
                    "body": "1. I have 3 main forms on the page which are actually same form with different set of subforms and these are zend_dojo_forms - subforms are rendered in a contentpane decorator (and I can't remove it - I need it for my client-site js) and if subforms have the same name contentpanes have the same id and dojo throws 'duplicate identifier'. To not to invent a new name for the same subform in each main form, I've set main form isArray to prepend all fields with it's name.\r\n\r\n2. FormErrors decorator calls to getMeassages(). I've just added it to form, and it was pushed last in decorators chain far after FormElements. And when nothing was rendered I've started to dig to this bug.\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jer",
                        "name": "jer",
                        "displayName": "boris",
                        "active": true
                    },
                    "created": "2010-05-21T12:10:11.000+0000",
                    "updated": "2010-05-21T12:10:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40603",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jer",
                        "name": "jer",
                        "displayName": "boris",
                        "active": true
                    },
                    "body": "P.S. anyway even if I've removed a contentpane decorator - elements in subforms would have duplicating ids - so no workaround, only setting different names by any means",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jer",
                        "name": "jer",
                        "displayName": "boris",
                        "active": true
                    },
                    "created": "2010-05-21T12:18:19.000+0000",
                    "updated": "2010-05-21T12:18:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40626",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                        "name": "alab",
                        "displayName": "Christian Albrecht",
                        "active": true
                    },
                    "body": "Fixed in trunk r22238 and merged into release branch",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                        "name": "alab",
                        "displayName": "Christian Albrecht",
                        "active": true
                    },
                    "created": "2010-05-21T17:36:44.000+0000",
                    "updated": "2010-05-21T17:36:44.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9862\/transitions"
}