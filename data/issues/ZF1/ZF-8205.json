{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8205",
    "key": "ZF-8205",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Loader_Autoloader_Resource Namespace Separator"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8205\/votes",
                "votes": 10,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mute",
                "name": "mute",
                "displayName": "Keith Pope",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-11-02T08:24:35.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-01-08T08:25:16.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Add getter \/ setter for the namespace separator in the Zend_Loader_Autoloader_Resource class, this then makes it easy to switch to loading 5.3 namespaced resources.\r\n\r\nThis would help with Doctrine 2 integration as it loads 5.3 namespaced entities."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8205\/watchers",
                "isWatching": false,
                "watchCount": 8
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-9016",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9016",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                },
                {
                    "issueKey": "ZF-7907",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7907",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-9604",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9604",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12848",
                    "filename": "Resource.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=trashofmasters",
                        "name": "trashofmasters",
                        "displayName": "Andrea Turso",
                        "active": false
                    },
                    "created": "2010-03-07T08:14:18.000+0000",
                    "size": 2307,
                    "mimeType": "text\/x-patch",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12848\/Resource.diff"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12846",
                    "filename": "ResourceTest.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=trashofmasters",
                        "name": "trashofmasters",
                        "displayName": "Andrea Turso",
                        "active": false
                    },
                    "created": "2010-03-07T07:58:25.000+0000",
                    "size": 943,
                    "mimeType": "text\/x-patch",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12846\/ResourceTest.diff"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12847",
                    "filename": "ZendLoaderAutoloaderResourceNamespaceModelTest.php",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=trashofmasters",
                        "name": "trashofmasters",
                        "displayName": "Andrea Turso",
                        "active": false
                    },
                    "created": "2010-03-07T07:58:25.000+0000",
                    "size": 1134,
                    "mimeType": "application\/x-httpd-php",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12847\/ZendLoaderAutoloaderResourceNamespaceModelTest.php"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12845",
                    "filename": "ZF-8205.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=trashofmasters",
                        "name": "trashofmasters",
                        "displayName": "Andrea Turso",
                        "active": false
                    },
                    "created": "2010-03-07T07:58:24.000+0000",
                    "size": 2144,
                    "mimeType": "text\/x-patch",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12845\/ZF-8205.diff"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12533",
                    "filename": "ZF-8205.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mute",
                        "name": "mute",
                        "displayName": "Keith Pope",
                        "active": true
                    },
                    "created": "2009-12-22T09:30:12.000+0000",
                    "size": 6332,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12533\/ZF-8205.diff"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10001",
                    "id": 10001,
                    "name": "Zend_Loader",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37140",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mute",
                        "name": "mute",
                        "displayName": "Keith Pope",
                        "active": true
                    },
                    "body": "Hi,\r\n\r\nI am attaching a prototype patch for this, this is only a very quick first implementation so see what you think. I may need to expand the tests etc...\r\n\r\nThx\r\n\r\nKeith",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mute",
                        "name": "mute",
                        "displayName": "Keith Pope",
                        "active": true
                    },
                    "created": "2009-12-22T09:30:12.000+0000",
                    "updated": "2009-12-22T09:30:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39048",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=trashofmasters",
                        "name": "trashofmasters",
                        "displayName": "Andrea Turso",
                        "active": false
                    },
                    "body": "Hi,\r\n\r\nI tried to roll my own patch to Zend_Loader_Autoloader_Resource when I found this report and then applied the diff to avoid reinventing the _proverbial wheel_.\r\n\r\nWith the files successfully patched, loading namespaced classes is working as expected, although the resource loader *_doesn't seem to be able to load class files_*\r\n\r\nFor instance, in a module bootstrap file:\r\n{code:title=application\/modules\/forums\/Bootstrap.php}\r\n$moduleLoader = new Zend_Application_Module_Autoloader(\r\n    array(\r\n        'namespace' => 'Forum',\r\n        'basePath' => __DIR__,\r\n    )\r\n);\r\n$moduleLoader->setNamespaceSeparator('\\\\');\r\n$moduleLoader->addResourceType('entity', 'models', 'Model');\r\n{code}\r\n\r\n{code:title=application\/modules\/forums\/controllers\/IndexController.php}\r\n$autoloader = $this->getInvokeArg('bootstrap')\r\n                   ->getResource('modules')\r\n                   ->offsetGet('forums')\r\n                   ->getResource('Autoloader');\r\n\r\n\/\/ tries to load \\Forums_Model\\Post, fail!\r\n$autoloader->getModel('Post');\r\n\r\n\/\/ tries to load \\Forums\\Model\\Post, which is okay, however raises the error\r\n\/\/ Class '\\Forums\\Model\\Post' not found in \/usr\/local\/lib\/php\/Zend\/Loader\/Autoloader\/Resource.php\r\n$autoloader->getEntity('Post');\r\n\r\n{code}\r\n\r\nWe should find a way to make the two implementation to cooperate when PHP5.3 namespaced classes are requested together with classic namespaced classes.\r\n\r\nWhen I was brainstorming for the patch a solution that popped in my mind was:\r\n{code:title=Zend\/Loader\/Autloader\/Resource.php}\r\n\/\/ Explicitly tells the loader to use PHP5.3 namespace\r\n$moduleLoader->addResourceType('resorurceName', 'resourceFolder', '\\Resource');\r\n\r\n\/\/ Triggers the classic loader. Which results in a #epic fail#\r\n$moduleLoader->addResourceTYpe('resourceName', 'resourceFolder', 'Resource');\r\n{code}\r\nThe first call will load \\Forums\\Resource\\<resource> when the second will load Forums_Resource_<resource>.\r\n\r\nThe patch could do something like this:\r\n\r\nIn {{Zend_Loader_Autoloader_Resource#addResourceType}}\r\n* Check if the $namespace has the heading \\\r\n** Remove the heading \\ in order return to the classic $namespace\r\n** Mark the $resource as *namespaced*\r\n{code}\r\n+ if ('\\\\' == substr($namespace, 0, 1)) {\r\n+     $this->_namespacedResources = ...\r\n+ }\r\n{code}\r\n\r\nIn {{Zend_Loader_Autoloader_Resource#load}}\r\n* Before instantiating the the resource check if it's namespaced\r\n** Alter the $class name to reflect the Fully Qualified Name.\r\n{code}\r\n+ if (<resource is namespaced>) {\r\n+    $klass = '\\\\' . str_replace('_', '\\\\', $class);\r\n+    $this->_resources[$class] = new $klass;\r\n+ } else {\r\n     $this->_resources[$class] = new $class;\r\n+ }\r\n{code}\r\n\r\nWith this trick the autoloader will autoload the file in the classical way because the class is underscored and the namespace is only \"unveiled\" when instantiating the resource.\r\nFor instance:\r\n{code}\r\n$resourceLoader->setNamespace('MyApp_');\r\n$resourceLoader->addResourceType('entities', 'folder\/entities', '\\Entity');\r\n$resourceLoader->addResourceType('models', 'folder\/models', 'Model');\r\n\r\n\/\/ Will autoload MyApp\/folder\/entities\/User.php and instantiates MyApp\\Entity\\User class\r\n$resourceLoader->getEntity('User');\r\n\r\n\/\/ Will autoload MyApp\/folder\/models\/Post.php and instantiates MyApp_Model_Post class\r\n$resourceLoader->getModel('Post');\r\n{code}\r\n\r\nWhat do you think about it?\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=trashofmasters",
                        "name": "trashofmasters",
                        "displayName": "Andrea Turso",
                        "active": false
                    },
                    "created": "2010-03-06T19:17:10.000+0000",
                    "updated": "2010-03-06T23:05:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39063",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=trashofmasters",
                        "name": "trashofmasters",
                        "displayName": "Andrea Turso",
                        "active": false
                    },
                    "body": "This is a na\u00efve implementation of my solution, it does compose the namespace in the correct class path and does tell namespaced resources apart although it cannot autoload the file and therefore instantiate the Fully Qualified Name class.\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=trashofmasters",
                        "name": "trashofmasters",
                        "displayName": "Andrea Turso",
                        "active": false
                    },
                    "created": "2010-03-07T07:58:25.000+0000",
                    "updated": "2010-03-07T07:58:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39064",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=trashofmasters",
                        "name": "trashofmasters",
                        "displayName": "Andrea Turso",
                        "active": false
                    },
                    "body": "I had to *hardcode* a call to {{Zend_Loader_Autoloader_Resource#autoload($class)}} to load the required file and then instantiate the FQN class.\r\n\r\nI attached the file Resource.diff, it contains all the changes I made to the {{Zend_Loader_Autoloader_Resource}} class, the test is in the previous {{ResourceTest.diff}} file.\r\nThe ResourceTest has just one more test method I'm no Test-Driven so if you find this solution appropriate I suggest you to write another bunch of tests, just to be sure that the patch works with a wide range of use-cases.\r\n\r\nCya\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=trashofmasters",
                        "name": "trashofmasters",
                        "displayName": "Andrea Turso",
                        "active": false
                    },
                    "created": "2010-03-07T08:14:18.000+0000",
                    "updated": "2010-03-07T08:16:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39128",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=trashofmasters",
                        "name": "trashofmasters",
                        "displayName": "Andrea Turso",
                        "active": false
                    },
                    "body": "As I said in my previous comments, my patch doesn't seem to be able to autoload classes when instantiated directly, for example:\r\n{code}\r\n\/\/ Autoload correcly the class contained in application\/modules\/forums\/models\/Post.php\r\n$myPost = new \\Forums\\Model\\Post();\r\n{code}\r\nended in _Fatal Error: class \\Forums\\Model\\Post not found ..._ while loading it with the load($resource, $class) worked.\r\n\r\nI hacked the *Zend_Loader_Autoloader* and found out that applying the following patch made the Autoloader autoload my classes flawlessly.\r\n{code}\r\n---   library\/Zend\/Loader\/Autoloader.php\t2010-01-06 03:05:09.000000000 +0100\r\n+++   \/usr\/lib\/php\/Zend\/Loader\/Autoloader.php\t2010-03-09 20:35:44.000000000 +0100\r\n@@ -115,6 +115,10 @@\r\n     {\r\n         $self = self::getInstance();\r\n \r\n+\tif (false !== strpos($class, '\\\\')) {\r\n+\t    $class = str_replace('\\\\', '_', $class);\r\n+\t}\r\n+\r\n         foreach ($self->getClassAutoloaders($class) as $autoloader) {\r\n             if ($autoloader instanceof Zend_Loader_Autoloader_Interface) {\r\n                 if ($autoloader->autoload($class)) {\r\n\r\n{code}\r\n\r\nI wouldn't rely on my previous patch to {{Zend\/Loader\/Autoloader\/Resource.php}} as it was just a _proof of concept_ to test resource loading.\r\n\r\nI'd like to hear your opinions and if I'm heading the right way.\r\n\r\nBye",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=trashofmasters",
                        "name": "trashofmasters",
                        "displayName": "Andrea Turso",
                        "active": false
                    },
                    "created": "2010-03-09T11:50:38.000+0000",
                    "updated": "2010-03-09T11:50:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43972",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dv",
                        "name": "dv",
                        "displayName": "Dmitry",
                        "active": true
                    },
                    "body": "I'm pretty sure there is no need to \"hack\" Zend_Loader_Autoloader.\r\n\r\nJust use your custom autoloader. \r\nAlso don't forget about resource autoloader for accessing classes with \"Application_Model\" into directory \"applicatiom\/models\".\r\n\r\n{code:title=Bootstrap|borderStyle=solid}\r\nclass Bootstrap extends Zend_Application_Bootstrap_Bootstrap\r\n{\r\n\r\n    protected function _initAutoload()\r\n    {\r\n        $applicationAutoloader = new Zend_Application_Module_Autoloader(array(\r\n            'namespace' => 'Application_',\r\n            'basePath'  => dirname(__FILE__),\r\n        ));\r\n\r\n        $autoloader = Zend_Loader_Autoloader::getInstance();\r\n        $autoloader->pushAutoloader(array('Bootstrap', 'modelsAutoload'), 'Application\\\\Model\\\\');\r\n    }\r\n\r\n    static public function modelsAutoload($className)\r\n    {\r\n        Zend_Loader_Autoloader::autoload(str_replace('\\\\', '_', $className));\r\n    }\r\n\r\n}\r\n{code} ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dv",
                        "name": "dv",
                        "displayName": "Dmitry",
                        "active": true
                    },
                    "created": "2011-01-08T08:25:16.000+0000",
                    "updated": "2011-01-08T08:25:16.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8205\/transitions"
}