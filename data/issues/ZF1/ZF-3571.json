{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3571",
    "key": "ZF-3571",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "when calling \"update\" - don't default to updating all rows if no WHERE specified"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3571\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-11-05T00:12:08.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cole.snodgrass",
                "name": "cole.snodgrass",
                "displayName": "Cole Snodgrass",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-07-03T10:54:28.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-11-24T10:04:50.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Maybe it's just me but it seems like a poor idea to automatically update every row in a table if no (or something that equates to '') WHERE conditional is specified.  In my opinion it would be a better design to explicitly require the user to state that all rows would be updated.  This would help to reduce accidentally updating all of the rows in a table in the event that the code generating the WHERE clause is buggy and doesn't properly set it.\r\n\r\nFor example, if I execute the following code:\r\n{code}\r\nclass Models_User extends Zend_Db_Table_Abstract {}\r\n\r\n$db = Zend_Db::factory(...);\r\n$mUser = new Models_User(array('db' => $db));\r\n\r\n$values = array('password' => 'omgwtfbbq');\r\n$where = array();\r\n\r\n\/\/ $users should contain an array of user ids, \r\n\/\/ but assume that there is a bug where this array is not being filled correctly\r\n$users = array();\r\nforeach ($users as $user) {\r\n    $where[] = \"user_id = $user\";\r\n}\r\n\r\n$mUser->update($values, $where);\r\n{code}\r\n\r\nall the rows in the table would have been updated to have the same password due to my error of not setting the $where array correctly.\r\n\r\nIn my opinion the user should have to explicitly specify that they want all rows in the table to be updated.  I believe this should be done through either a class constant (e.g. Zend_Db_Adapter::UPDATE_ALL), having to pass a WHERE clause of \"1=1\",  or the addition of a new updateAll function (in both the Zend_Db_Adapter and Zend_Db_Table_Abstract classes)."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/6",
                "name": "N\/A"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3571\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjh_ca",
                "name": "mjh_ca",
                "displayName": "Marc Hodgins",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-9298",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9298",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                },
                {
                    "issueKey": "ZF-10740",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10740",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10174",
                    "id": 10174,
                    "description": "Mini Release",
                    "name": "1.5.1",
                    "userReleaseDate": "25\/Mar\/08",
                    "archived": true,
                    "releaseDate": "2008-03-25",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10181",
                    "id": 10181,
                    "description": "Mini Release",
                    "name": " 1.5.2",
                    "userReleaseDate": "15\/May\/08",
                    "archived": true,
                    "releaseDate": "2008-05-15",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10012",
                    "id": 10012,
                    "name": "Zend_Db",
                    "description": "interfaces, APIs, and adapters for various third-party data stores",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10133",
                    "id": 10133,
                    "name": "Zend_Db_Table",
                    "description": "Lightweight OO interface to database tables and rowsets.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34508",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bittarman",
                        "name": "bittarman",
                        "displayName": "Ryan Mauger",
                        "active": true
                    },
                    "body": "I don't think this should be done at all.\n\nIn SQL you are not required to add a WHERE clause at all, and should you not add a WHERE clause, all rows will be updated.\n\nRequiring the user to add '1=1' or to call a different method to do this is pretty ridiculous, as it is requiring the addition of something not required by SQL.\n\nAll of the Zend_Db components pretty well reflect the way that you expect a DBMS to work, and this should be kept. I would not expect to explicitly tell the DB that I want all rows updated, instead I would expect to have to explicitly provide the where clause.\n\nAlso this would be a fairly large BC break, and as such, if it is implemented, I would hope it is not until 2.0.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bittarman",
                        "name": "bittarman",
                        "displayName": "Ryan Mauger",
                        "active": true
                    },
                    "created": "2009-09-17T06:07:26.000+0000",
                    "updated": "2009-09-17T06:07:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40177",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ronny+stalker",
                        "name": "ronny stalker",
                        "displayName": "jw",
                        "active": true
                    },
                    "body": "I agree that this is an issue. I have not used the Zend Adaptor because of this. Even with careful testing, it is too easy to do a typo that could wipe out a whole table.\r\n\r\n@Ryan Mauger - In SQL it would throw an error if you submitted a query like :\r\n{code} \r\n\"UPDATE tblEvents SET colIsSoldOut='1' WHERE\"\r\n{code} \r\n\r\nI believe BC could be solved by adding a, sister, '*Where()' methods like so:\r\n{code} \r\n\/\/as normal - no change to BC of interface\r\n$n = $db->update('bugs', $data, 'bug_id = 2'); \r\n\r\n\/\/this however, throws Exception if WHERE clause is null or resolves to 'all rows'\r\n$n = $db->updateWhere('bugs', $data, 'bug_id = 2'); \r\n{code} \r\nand\r\n{code} \r\n\/\/as normal - no change to BC of interface\r\n$n = $db->delete('bugs', 'bug_id = 3'); \r\n\r\n\/\/this however, throws Exception if WHERE clause is null or resolves to 'all rows'\r\n$n = $db->deleteWhere('bugs', 'bug_id = 3'); \r\n{code} \r\n-------\r\n\r\nBasically solving the issue by adding a stricter method that we can explicitly use \r\n\r\na few name ideas for the sister methods:\r\n{code} \r\n$db->deleteWhere(..)\r\n$db->deleteForceWhere(..)\r\n$db->deleteWhereStrict(..)\r\n$db->deleteWhereRows(..)\r\netc.\r\n{code} \r\n\r\n-------\r\n\r\nDangerous Examples where (i fear) current interface can cause data loss - note i have not actually tried it out\r\n{code} \r\n\r\nclass SuperClass {\r\n private $_where= null;\r\n\r\n function getWhere()\r\n  {\r\n  return $this->_where;\r\n  }\r\n\r\n function update($whereStr)\r\n  {\r\n  $this->setWhere($whereStr);\r\n  $this->doQuery();\r\n  }\r\n }\r\n\r\n\r\nclass SubClass extends SuperClass {\r\n protected $_where= null;\r\n\r\n\r\n function setWhere($str)\r\n  {\r\n  $this->_where = $str;\r\n  }\r\n\r\n function doQuery()\r\n  {\r\n  ...\r\n  \/\/deletes all rows cos getWhere() always returns null\r\n  $n = $db->update('bugs', $this->getWhere());\r\n\r\n  \/\/would warn if deleting all rows\r\n  $n = $db->updateWhere('bugs', $this->getWhere());\r\n  }\r\n }\r\n{code} \r\n\r\n--------\r\n\r\nExample two\r\n{code} \r\n$where = 'bug_id = 3';\r\n\r\n\/\/deletes all rows cos $where is a typo\r\n$n = $db->delete('bugs', $_where);\r\n\r\n\/\/would warn if deleting all rows\r\n$n = $db->deleteWhere('bugs', $_where);\r\n{code} \r\n\r\n------\r\nExample 3\r\n\r\nhttp:\/\/framework.zend.com\/issues\/browse\/ZF-174\r\n\r\n-----\r\nExample 4\r\n\r\nhttp:\/\/framework.zend.com\/issues\/browse\/ZF-9298",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ronny+stalker",
                        "name": "ronny stalker",
                        "displayName": "jw",
                        "active": true
                    },
                    "created": "2010-04-22T00:04:04.000+0000",
                    "updated": "2010-04-22T00:50:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40180",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=croensch",
                        "name": "croensch",
                        "displayName": "Christoph Roensch",
                        "active": true
                    },
                    "body": "@cole: why not check!\r\n{code}\r\n\/\/ $users should contain an array of user ids, \r\n\/\/ but assume that there is a bug where this array is not being filled correctly\r\n$users = array();\r\nforeach ($users as $user) {\r\n    $where[] = \"user_id = $user\";\r\n}\r\n\r\nif( !empty($where) )\r\n{\r\n    $mUser->update($values, $where);\r\n}\r\n{code}\r\n\r\n@jw: i see no use in example 1, either the class is cranking with user data in setWhere or it is not generating usable where via logic.\r\nExample 2 would be eliminated by testing. Also as long as you don't have initalized a $_where variable a good configured development php would print out a notice for you.\r\n\r\nI'm not in a high horse attitude to say that all errors must be eliminated by testing or proving code to be optimal, but i'd say we should not take it too far. These classes are meant to be efficient, they should not double check if a given $where is an empty array or null.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=croensch",
                        "name": "croensch",
                        "displayName": "Christoph Roensch",
                        "active": true
                    },
                    "created": "2010-04-22T02:47:03.000+0000",
                    "updated": "2010-04-22T02:47:03.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42836",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjh_ca",
                        "name": "mjh_ca",
                        "displayName": "Marc Hodgins",
                        "active": true
                    },
                    "body": "Cleaning up old tickets.  ZF-9298 was closed as \"not an issue\" and this the identical issue.  The current behavior is the intended behavior - perhaps you could open a \"documentation improvement\" ticket if you feel this needs to be more clear.  But, it is not inconsistent with SQL - running an UPDATE without a WHERE clause will update all rows.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjh_ca",
                        "name": "mjh_ca",
                        "displayName": "Marc Hodgins",
                        "active": true
                    },
                    "created": "2010-11-05T00:12:09.000+0000",
                    "updated": "2010-11-05T00:12:09.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3571\/transitions"
}