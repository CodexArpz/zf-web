{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5728",
    "key": "ZF-5728",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Set session will be overwritten."
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5728\/votes",
                "votes": 2,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10360",
                    "id": 10360,
                    "description": "Minor Release",
                    "name": "1.10.0",
                    "userReleaseDate": "27\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-27",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-11-27T17:43:53.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=puli",
                "name": "puli",
                "displayName": "Puli Kutya",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-02-10T08:22:30.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-03-01T01:25:23.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "captcha_session"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "We have setSession() function where we can save the session into the $this->_session, but the generate() function simply overwrites what we kept here: $this->_session. There must be another way to handle this issue. If you protect the $this->_session, then don't provide public setSession().\n{code}\n\/**\n * Zend_Captcha_Word\n *\/\n\npublic function setSession(Zend_Session_Namespace $session)\n{\n\t$this->_session = $session;\n\treturn $this;\n}\n\npublic function generate()\n{\n\t\/\/****\/\/\n\t$this->_session = null;\n\t\/\/****\/\/\n\t$id             = $this->_generateRandomId();\n\t$this->_setId($id);\n\t$word           = $this->_generateWord();\n\t$this->_setWord($word);\n\treturn $id;\n}\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/2",
                "name": "Critical"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5728\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stas",
                "name": "stas",
                "displayName": "Stanislav Malyshev",
                "active": false
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10340",
                    "id": 10340,
                    "name": "Zend_Captcha",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33987",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thalaric",
                        "name": "thalaric",
                        "displayName": "Jonathan Haskins",
                        "active": true
                    },
                    "body": "I ran into this bug today and it took me 3 hours of thinking I was doing it wrong before I located the problem in zend. I fixed it by commenting out $this->_session = null;",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thalaric",
                        "name": "thalaric",
                        "displayName": "Jonathan Haskins",
                        "active": true
                    },
                    "created": "2009-08-27T04:37:34.000+0000",
                    "updated": "2009-08-27T04:37:34.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36513",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stas",
                        "name": "stas",
                        "displayName": "Stanislav Malyshev",
                        "active": false
                    },
                    "body": "The problem here is that when we use generate(), a captcha with new ID is generated and new session object is created, named by this ID. \r\nHowever, in many cases isValid() is called before generate() - such as when old captcha failed and we need to generate a new one. \r\nIn this case, however, if we keep old session object, then the data will not be written into this object but to the object for the old ID which was created before that, and then when captcha comes back in the next request, it would not be able to find this new object, since only thing it has is the ID, and you didn't write the data into the session with that ID - you wrote it to some other place, with old ID. \r\nsetSession() is useful when doing isValid(), but for generate it should create a new session, so you better use _sessionClass if change is needed.\r\n\r\nI could however try to fix your use case, but for that I would need some short script demonstrating it, so I could check that both default usage and your scenario works well.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stas",
                        "name": "stas",
                        "displayName": "Stanislav Malyshev",
                        "active": false
                    },
                    "created": "2009-11-25T17:58:00.000+0000",
                    "updated": "2009-11-25T17:58:00.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36520",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thalaric",
                        "name": "thalaric",
                        "displayName": "Jonathan Haskins",
                        "active": true
                    },
                    "body": "Here's an example of how I am using it (non-working unless commented out as per above). I believe the reason I used a separate session for the captcha is because of ZF-5806.\r\n\r\nController:\r\n$figlet = array(\r\n\t\t'name' => 'captcha',\r\n\t\t'wordLen' => 6,\r\n\t\t'timeout' => 300,\r\n\t\t'outputWidth' => 600,\r\n\t\t'font' => '\/lib\/figlet\/univers.flf'\r\n\t\t);\r\n$captcha = new Zend_Captcha_Figlet($figlet);\r\n$captcha->setSession(new Zend_Session_Namespace('captcha'));\r\n\r\nif ($this->_request->isPost()) {\r\n\tif ($captcha->isValid($_POST)) {\r\n\t\techo 'captcha passed';\r\n\t}\r\n}\r\n\r\n$this->view->captcha_id = $captcha->generate();\r\n$this->view->assign('captcha', $captcha->render(new Zend_View()));\r\n\r\nView:\r\n<?=$this->captcha?>\r\n<input type=\"hidden\" name=\"captcha[id]\" value=\"<?=$this->captcha_id?>\" \/>\r\n<input type=\"text\" name=\"captcha[input]\" size=25 value=\"\">\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thalaric",
                        "name": "thalaric",
                        "displayName": "Jonathan Haskins",
                        "active": true
                    },
                    "created": "2009-11-26T01:34:22.000+0000",
                    "updated": "2009-11-26T01:34:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36547",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stas",
                        "name": "stas",
                        "displayName": "Stanislav Malyshev",
                        "active": false
                    },
                    "body": "OK, this should be working in trunk now. Please check if it does what you wanted.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stas",
                        "name": "stas",
                        "displayName": "Stanislav Malyshev",
                        "active": false
                    },
                    "created": "2009-11-27T17:43:53.000+0000",
                    "updated": "2009-11-27T17:43:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38891",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ota",
                        "name": "ota",
                        "displayName": "Ota Mares",
                        "active": true
                    },
                    "body": "Oh great that this got fixed now, my report was flaged as no issue, whyever.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ota",
                        "name": "ota",
                        "displayName": "Ota Mares",
                        "active": true
                    },
                    "created": "2010-03-01T01:25:22.000+0000",
                    "updated": "2010-03-01T01:25:22.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5728\/transitions"
}