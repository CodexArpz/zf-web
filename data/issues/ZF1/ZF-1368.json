{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1368",
    "key": "ZF-1368",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "General table names processing: applying prefix"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1368\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10023",
                    "id": 10023,
                    "description": "Release Candidate 1",
                    "name": "1.0.0 RC1",
                    "userReleaseDate": "28\/May\/07",
                    "archived": true,
                    "releaseDate": "2007-05-28",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-05-10T11:18:18.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eugenep",
                "name": "eugenep",
                "displayName": "Eugene Panaitov",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-05-09T19:16:07.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-05T14:44:09.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "The situation is: we have some code implemented for one project and we need to put another project in the same database with same table names. Good idea is to use prefixes for table names (say, if the new project is called `tracker`, the prefix should look like `tra_` and all tables will have names like `tra_cms_pages` and so on). Possibly this can be done by applying schema rules, but not for Mysqli imlementation (in current 0.9.3 version).\n\nWe can simply change all table name values for each Table_Abstract successor, OR we can just add a new value `prefix` in Adapter config:\n\n{code}\n$config = array (\n    'host'     => \"hostname\",\n    'username' => \"user\",\n    'password' => \"pass\",\n    'dbname'   => \"database\",\n    'prefix' => \"prefix_\"\n);\n\n$dbAdapter = Zend_Db::factory('Mysqli', $config); \n{code}\n\nThen, we need to take stock of this new value in Table_Abstract.php:\n\n{code}\nIndex: Abstract.php\n===================================================================\n--- Abstract.php\t(revision 4776)\n+++ Abstract.php\t(working copy)\n@@ -45,6 +45,7 @@\n \n     const SCHEMA           = 'schema';\n     const NAME             = 'name';\n+    const PREFIX           = 'prefix';\n     const PRIMARY          = 'primary';\n     const COLS             = 'cols';\n     const METADATA         = 'metadata';\n@@ -101,6 +102,13 @@\n     protected $_name;\n \n     \/**\n+     * The prefix to use for full table name (default null means no prefix).\n+     *\n+     * @var string\n+     *\/\n+    protected $_prefix = null;\n+\n+    \/**\n      * The table column names derived from Zend_Db_Adapter_Abstract::describeTable().\n      *\n      * @var array\n@@ -223,6 +231,11 @@\n             $this->_name = $config[self::NAME];\n         }\n \n+        \/\/ set default prefix if supplied\n+        if (isset($config[self::PREFIX])) {\n+            $this->_prefix = $config[self::PREFIX];\n+        }\n+\n         \/\/ set primary key name if supplied\n         if (isset($config[self::PRIMARY])) {\n             $this->_primary = (array) $config[self::PRIMARY];\n@@ -519,9 +532,15 @@\n     {\n         if (strpos($this->_name, '.')) {\n             list($schemaName, $tableName) = explode('.', $this->_name);\n+            \/\/ apply the prefix if defined\n+            if (!is_null($this->_prefix)) {\n+                $tableName = $this->_prefix.$tableName;\n+            }\n             $this->_schema = $schemaName;\n             $this->_name = $tableName;\n         } else {\n+            \/\/ apply the prefix if defined\n+            if (!is_null($this->_prefix)) $this->_name = $this->_prefix.$this->_name;\n             $schemaName = $this->_schema;\n             $tableName = $this->_name;\n         }\n@@ -1027,3 +1046,4 @@\n     }\n \n }\n+\n{code}\n\nThat's all. So now if we have a lot of Table_Abstracts in models\/ with names, no need to change them all, we can just apply a prefix to all of them:\n\n{code}\nclass Table extends Zend_Db_Table_Abstract {\n\t\n\tprotected $_name = \"table\"; \n{code}\n\nAnd the table name after applying the prefix will look like \n`prefix_table`."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1368\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                "name": "bkarwin",
                "displayName": "Bill Karwin",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-827",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-827",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-1017",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1017",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10080",
                    "id": 10080,
                    "description": "Beta Release; bug fixes",
                    "name": "0.9.3",
                    "userReleaseDate": "05\/May\/07",
                    "archived": true,
                    "releaseDate": "2007-05-05",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10133",
                    "id": 10133,
                    "name": "Zend_Db_Table",
                    "description": "Lightweight OO interface to database tables and rowsets.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14539",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "I really don't think it's appropriate to solve this use case in Zend_Db.  \nBut this is the third time someone has submitted the request.  I'll consider it.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-05-09T19:26:02.000+0000",
                    "updated": "2007-05-09T19:26:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14541",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "See also ZF-1017.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-05-09T19:27:23.000+0000",
                    "updated": "2007-05-09T19:27:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14542",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "See also ZF-827",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-05-09T19:27:39.000+0000",
                    "updated": "2007-05-09T19:27:39.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14543",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Change component to Zend_Db_Table.\n\nChange very long code sample to minimal patch.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-05-09T19:39:05.000+0000",
                    "updated": "2007-05-09T19:39:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14544",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eugenep",
                        "name": "eugenep",
                        "displayName": "Eugene Panaitov",
                        "active": true
                    },
                    "body": "You are right, Bill, it's not a goal of Framework, but as you see this is very minor fix, only a few lines to change..\n\nUserland here is changing all Table_Abstract's $_name variables, that is not so quick as adding new variable to adapter config.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eugenep",
                        "name": "eugenep",
                        "displayName": "Eugene Panaitov",
                        "active": true
                    },
                    "created": "2007-05-09T19:46:47.000+0000",
                    "updated": "2007-05-09T19:46:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14545",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "The argument that it belongs in userland code:\n\nIf your application supports variable table names, you should list the tables in some central place in your application, and apply prefixes there.  Then you can utilize these variable table names in all queries throughout your application.\n\n{code}\n$tableName = array(\n  'bugs'        => 'bugs',\n  'accounts' => 'accounts'\n  ...other tables for your application...\n);\n\n\/\/ read config file into $config object,\n\/\/ and update the table name map:\nif ($config->db->prefix) {\n  foreach ($tableName as &$name) {\n    $name = $config->db->prefix . $name;\n  }\n}\n\n\n\/\/ this works for Zend_Db_Table:\n$bugsTable = new Bugs(array('name' => $tableName['bugs']));\n\n\/\/ this works for Zend_Db_Select:\n$select = $db->select()->from($tableName['bugs']);\n\n\/\/ this works for adapter methods too:\n$result = $db->fetchAll(\"SELECT * FROM {$tableName['bugs']}\");\n$db->insert($tableName['bugs'], $data);\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-05-09T20:20:36.000+0000",
                    "updated": "2007-05-09T20:20:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14547",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eugenep",
                        "name": "eugenep",
                        "displayName": "Eugene Panaitov",
                        "active": true
                    },
                    "body": "Good idea, Bill, thanks.\n\nAnother solutions looks like:\n\n{code}\n<?php\n\nZend_Loader::loadClass(\"Zend_Db_Table_Abstract\");\n\nclass Table extends Zend_Db_Table_Abstract {\n\t\n\tfunction __construct() {\n\t\t\n\t\t$table = get_class($this);\n\t\t\n\t\t$tableName = Config::$tableNames[$table];\n\t\t\n\t\tif (isset(Config::$database['prefix'])) $tableName = Config::$database['prefix'].$tableName;\n\t\t\n\t\tparent::__construct(array(Zend_Db_Table_Abstract::NAME => $tableName));\n\t\t\n\t}\n\t\n\t\n}\n\n?>\n{code}\n\nThen, just extend class Table and use it like $table = new MyTable(); MyTable class will get its name automatically.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eugenep",
                        "name": "eugenep",
                        "displayName": "Eugene Panaitov",
                        "active": true
                    },
                    "created": "2007-05-10T06:31:11.000+0000",
                    "updated": "2007-05-10T06:31:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14548",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "You should do something with array_merge() in that constructor, otherwise you can't pass options to your tables.\n\nOk, good -- you have a couple of ways of employing this behavior in your application.\n\nBut it's not a feature we will add to Zend_Db.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-05-10T11:18:18.000+0000",
                    "updated": "2007-05-10T11:18:18.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1368\/transitions"
}