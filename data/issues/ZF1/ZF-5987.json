{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5987",
    "key": "ZF-5987",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Dijit parsing before store creation results in FilteringSelect and ComboBox dijits not working properly."
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5987\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-03-13T08:37:17.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=furiousoyster",
                "name": "furiousoyster",
                "displayName": "David Kidd",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-03-10T15:20:49.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-07-21T08:31:51.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "If a ComboBox or FilteringSelect element is parsed before its store has been instantiated, it won't use the store.  In previous versions of ZF, the ordering of dojo.addOnLoad functions put store creation before dijit parsing.  In 1.7.6, dijits are parsed first (I believe this is because of [#ZF-4587]).  This means forms using ComboBoxes and FilteringSelects which used to work in 1.7.5 no longer work correctly.\n\nThe following code, produced by 1.7.6 does _not_ work:\n\n{code}\ndojo.require(\"custom.AutocompleteReadStore\");\ndojo.require(\"dijit.form.FilteringSelect\");\ndojo.require(\"dijit.form.Form\");\ndojo.require(\"dojo.parser\");\ndojo.addOnLoad(function() {\n    dojo.forEach(zendDijits, function(info) {\n        var n = dojo.byId(info.id);\n        if (null != n) {\n            dojo.attr(n, dojo.mixin({ id: info.id }, info.params));\n        }\n    });\n    dojo.parser.parse();\n});\ndojo.addOnLoad(function() {\n    autocompleter = new custom.AutocompleteReadStore({\"url\":\"http:\\\/\\\/foo.com\\\/userautocomplete\",\"requestMethod\":\"get\"});\n});\nvar autocompleter;\nvar zendDijits = [{\"id\":\"author_id\",\"params\":{\"store\":\"autocompleter\",\"dojoType\":\"dijit.form.FilteringSelect\"}},{\"id\":\"the_form\",\"params\":{\"dojoType\":\"dijit.form.Form\"}}];\n{code}\n\nThe following, created by 1.7.5, however, _does_ work:\n\n{code}\ndojo.require(\"custom.AutocompleteReadStore\");\ndojo.require(\"dijit.form.FilteringSelect\");\ndojo.require(\"dijit.form.Form\");\ndojo.require(\"dojo.parser\");\ndojo.addOnLoad(function() {\n    autocompleter = new custom.AutocompleteReadStore({\"url\":\"http:\\\/\\\/foo.com\\\/userautocomplete\",\"requestMethod\":\"get\"});\n});\ndojo.addOnLoad(function() {\n    dojo.forEach(zendDijits, function(info) {\n        var n = dojo.byId(info.id);\n        if (null != n) {\n            dojo.attr(n, dojo.mixin({ id: info.id }, info.params));\n        }\n    });\n    dojo.parser.parse();\n});\nvar autocompleter;\nvar zendDijits = [{\"id\":\"author_id\",\"params\":{\"store\":\"autocompleter\",\"dojoType\":\"dijit.form.FilteringSelect\"}},{\"id\":\"the_form\",\"params\":{\"dojoType\":\"dijit.form.Form\"}}];\n{code}\n\nBoth examples result from the following addition to a Zend_Dojo_Form:\n\n{code}\n$author_fld = new Zend_Dojo_Form_Element_FilteringSelect( \n\t\t\t\t'author_id',\n\t\t\t\tarray(\n\t\t\t\t    'label'     => 'Author:',\n\t\t\t\t\n\t\t\t\t    \/\/ The javascript identifier for the data store:\n\t\t\t\t    'storeId'   => 'autocompleter',\n\t\t\t\t\n\t\t\t\t    \/\/ The class type for the data store:\n\t\t\t\t    'storeType' => 'custom.AutocompleteReadStore',\n\t\t\t\t\n\t\t\t\t    \/\/ Parameters to use when initializing the data store:\n\t\t\t\t    'storeParams' => array(\n\t\t\t\t        'url'           => 'http:\/\/foo.com\/userautocomplete',\n\t\t\t\t        'requestMethod' => 'get',\n\t\t\t\t    ),\n\t\t\t));\n\t\t\t\n$form->addElement( $author_fld );\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5987\/watchers",
                "isWatching": false,
                "watchCount": 7
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-6018",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6018",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10290",
                    "id": 10290,
                    "description": "Mini Release",
                    "name": "1.7.6",
                    "userReleaseDate": "02\/Mar\/09",
                    "archived": false,
                    "releaseDate": "2009-03-02",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10026",
                    "id": 10026,
                    "name": "Zend_View",
                    "description": "View portion of the ZF MVC",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29431",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ewahlstr",
                        "name": "ewahlstr",
                        "displayName": "Erik Wahlstrom",
                        "active": true
                    },
                    "body": "I am experiencing the same side-effects from the new changes in 1.7.6.  Funny because I remember wanting the onLoadCaptureStart to function in this manner so we could utilize dojo.connect statements on parsed widgets - didn't foresee this problem though...\n\nIt appears as if the prependOnLoad() method of the Dojo view helper would solve this problem - simply create the data store like so:\n\n<code>\n$this->dojo()->prependOnLoad('function(){newMentorStore = new dojo.data.ItemFileReadStore();}');\n<\/code>\n\nFor me, however, the dojo.onLoad() script that this generates is still placed after the ZF parsing function like so:\n\n<code>\ndojo.addOnLoad(function() {\n    dojo.forEach(zendDijits, function(info) {\n        var n = dojo.byId(info.id);\n        if (null != n) {\n            dojo.attr(n, dojo.mixin({ id: info.id }, info.params));\n        }\n    });\n    dojo.parser.parse();\n});\n    dojo.addOnLoad(function(){newMentorStore = new dojo.data.ItemFileReadStore();});\n\n<\/code>",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ewahlstr",
                        "name": "ewahlstr",
                        "displayName": "Erik Wahlstrom",
                        "active": true
                    },
                    "created": "2009-03-12T02:45:37.000+0000",
                    "updated": "2009-03-12T02:45:37.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29432",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ewahlstr",
                        "name": "ewahlstr",
                        "displayName": "Erik Wahlstrom",
                        "active": true
                    },
                    "body": "I was just able to find a work-around for this issue that might help in brainstorming for a solution...\n\nInstead of assigning the store to the dojo widget using the Zend_Dojo_Form view helper method:\n\n<pre>\n    $mentorSelectionForm->addElement('filteringSelect', 'child_primary_mentor', array(\n                                     'label'        => 'Primary Mentor',\n                                     'onChange'     => 'mentorSelectionChanged',\n                                     'store'        => 'mentorStore',\n                                     'searchAttr'   => 'mentor_name'\n                                    ));\n<\/pre>\n\nCreate the element without assigning the store and in the dojo()->onLoadCaptureStart() (since we can now grab our widgets using dijit.byId) create the store as usual and then assign it to the widget like so:\n\n<pre>\n    mentorStore = new dojo.data.ItemFileReadStore({\n      url: '\/blablabla',\n      clearOnClose: true\n    });\n    dijit.byId('child_primary_mentor').attr('store', mentorStore);\n<\/pre>",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ewahlstr",
                        "name": "ewahlstr",
                        "displayName": "Erik Wahlstrom",
                        "active": true
                    },
                    "created": "2009-03-12T03:05:11.000+0000",
                    "updated": "2009-03-12T03:05:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29459",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Fixed in trunk and 1.7 release branch",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-03-13T08:37:17.000+0000",
                    "updated": "2009-03-13T08:37:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29733",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=denis.baklikov",
                        "name": "denis.baklikov",
                        "displayName": "Denis Baklikov",
                        "active": true
                    },
                    "body": "This issue is not fixed. Can you please check it again?\n\nI have got JavaScript error: *'dojo.data is undefined'* after migrating to ZF 1.7.7.\nIt seems that JavaScript tried to create new instance of dojo.data.ItemFileReadStore, but it is not loaded yet.\n\nItemFileReadStore instance should be created after page load, using dojo.addOnLoad method.\nI think that using *prependOnLoad* (look at the first comment) instead of *addJavascript* (in ComboBox.php line 142).\n\nThe following code was generated by Dojo View helper:\n{code}\ndojo.require(\"dojo.data.ItemFileReadStore\");\ndojo.require(\"dijit.form.FilteringSelect\");\ndojo.require(\"dijit.form.CurrencyTextBox\");\ndojo.require(\"dijit.form.NumberTextBox\");\ndojo.require(\"dijit.form.Textarea\");\ndojo.require(\"dijit.form.Button\");\ndojo.require(\"dijit.Dialog\");\ndojo.require(\"dijit.ColorPalette\");\ndojo.require(\"dojo.parser\");\n\ndojo.addOnLoad(function() {\n    dojo.forEach(zendDijits, function(info) {\n        var n = dojo.byId(info.id);\n        if (null != n) {\n            dojo.attr(n, dojo.mixin({ id: info.id }, info.params));\n        }\n    });\n    dojo.parser.parse();\n});\n\nvar manufacturerStore = new dojo.data.ItemFileReadStore({\"url\":\"\\\/manufacturer\\\/list\"});\nvar modelStore = new dojo.data.ItemFileReadStore({\"url\":\"\\\/model\\\/list\"});\nvar zendDijits = [{\"id\":\"manufacturer\",\"params\":{\"label\":\"Manufacturer\",\"store\":\"manufacturerStore\",\"dijitParams\":{\"searchAttr\":\"name\",\"ignoreCase\":\"true\",\"autocomplete\":\"true\"},\"dojoType\":\"dijit.form.FilteringSelect\"}},{\"id\":\"model\",\"params\":{\"label\":\"Models\",\"store\":\"modelStore\",\"dijitParams\":{\"searchAttr\":\"name\",\"ignoreCase\":\"true\",\"autocomplete\":\"true\"},\"dojoType\":\"dijit.form.FilteringSelect\"}},{\"id\":\"price\",\"params\":{\"currency\":\"USD\",\"required\":\"true\",\"dojoType\":\"dijit.form.CurrencyTextBox\"}},{\"id\":\"year\",\"params\":{\"places\":0,\"constraints\":\"{\\\"min\\\":1970,\\\"max\\\":2009,\\\"pattern\\\":\\\"####\\\"}\",\"required\":\"true\",\"dojoType\":\"dijit.form.NumberTextBox\"}},{\"id\":\"mileage\",\"params\":{\"places\":4,\"dojoType\":\"dijit.form.NumberTextBox\"}},{\"id\":\"description\",\"params\":{\"required\":\"true\",\"style\":\"width: 200px;\",\"dojoType\":\"dijit.form.Textarea\"}},{\"id\":\"save\",\"params\":{\"label\":\"\\u0414\\u043e\\u0431\\u0430\\u0432\\u0438\\u0442\\u044c\",\"dojoType\":\"dijit.form.Button\"}}];\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=denis.baklikov",
                        "name": "denis.baklikov",
                        "displayName": "Denis Baklikov",
                        "active": true
                    },
                    "created": "2009-03-25T22:48:48.000+0000",
                    "updated": "2009-03-25T22:48:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31796",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mangelp",
                        "name": "mangelp",
                        "displayName": "Miguel Angel Perez",
                        "active": true
                    },
                    "body": "Hello,\n\nI'm having problems with this issue that still exists in ZF 1.8.3, is there any chance of having it really fixed soon?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mangelp",
                        "name": "mangelp",
                        "displayName": "Miguel Angel Perez",
                        "active": true
                    },
                    "created": "2009-06-12T06:19:43.000+0000",
                    "updated": "2009-06-12T06:19:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31961",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Please see ZF-6148 -- a solution is now in trunk and the 1.8 release branch, and will release with 1.8.4.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-06-18T11:22:49.000+0000",
                    "updated": "2009-06-18T11:22:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32796",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=iconmans",
                        "name": "iconmans",
                        "displayName": "Raj Mudaliar",
                        "active": true
                    },
                    "body": "Hi again,\n\nI'm having save problems with ZF 1.8.4.  Looks like the code is not yet in 1.8.4\n\nPlease update,\n\nThanks,",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=iconmans",
                        "name": "iconmans",
                        "displayName": "Raj Mudaliar",
                        "active": true
                    },
                    "created": "2009-07-21T08:31:51.000+0000",
                    "updated": "2009-07-21T08:31:51.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5987\/transitions"
}