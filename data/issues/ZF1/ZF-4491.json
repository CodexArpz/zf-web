{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4491",
    "key": "ZF-4491",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Support the new Microsoft URL Rewrite Module for IIS 7.0"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/2",
                "name": "New Feature",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4491\/votes",
                "votes": 2,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10510",
                    "id": 10510,
                    "description": "Minor Release",
                    "name": "1.12.0",
                    "userReleaseDate": "27\/Aug\/12",
                    "archived": false,
                    "releaseDate": "2012-08-27",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-06-14T17:23:43.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=erwind",
                "name": "erwind",
                "displayName": "Erwin Derksen",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-10-05T10:21:15.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-06-14T17:23:43.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "IIS7",
                "Microsoft",
                "Module",
                "Rewrite"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Microsoft  has recently released its own rewrite module for IIS7.0. (See: http:\/\/learn.iis.net\/page.aspx\/460\/using-url-rewrite-module\/). I was trying to get it to work with your quick start application and found out that it is not completely working as expected. This because this new module uses the HTTP_X_ORIGINAL_URL header instead of the HTTP_X_REWRITE_URL header as used by the isapi_rewrite extension. As a consequence I always got the index controller and action for every request made and thus never got the error page for calls to bogus controllers\/actions. Exception: when using the http:\/\/localhost\/myapplication\/index.php\/controller\/action syntax, it already works fine.\r\n\r\nAs a newbie to the Zend framework I have no idea if what I did is correct and works in all cases, but as an experienced developer I managed to get it to work by doing a global  search for all uses of HTTP_X_REWRITE_URL and adding an additional if branch for the HTTP_X_ORIGINAL_URL as well:\r\n\r\nFind results:\r\nZend\\Controller\\Request\\Apache404.php(50):            if (isset($_SERVER['HTTP_X_REWRITE_URL'])) { \/\/ check this first so IIS will catch\r\nZend\\Controller\\Request\\Apache404.php(51):                $requestUri = $_SERVER['HTTP_X_REWRITE_URL'];\r\nZend\\Controller\\Request\\Http.php(381):     * $_SERVER['HTTP_X_REWRITE_URL'], or $_SERVER['ORIG_PATH_INFO'] + $_SERVER['QUERY_STRING'].\r\nZend\\Controller\\Request\\Http.php(389):            if (isset($_SERVER['HTTP_X_REWRITE_URL'])) { \/\/ check this first so IIS will catch\r\nZend\\Controller\\Request\\Http.php(390):                $requestUri = $_SERVER['HTTP_X_REWRITE_URL'];\r\nZend\\OpenId.php(110):        if (isset($_SERVER['HTTP_X_REWRITE_URL'])) {\r\nZend\\OpenId.php(111):            $url .= $_SERVER['HTTP_X_REWRITE_URL'];\r\n\r\nChanges made (this is for OpenId.php, other files have similar changes) (basically add an if elseif for the new HTTP_X_ORIGINAL_URL header):\r\n        if (isset($_SERVER['HTTP_X_ORIGINAL_URL'])) { \/\/ check this first so IIS will catch\r\n            $url .= $_SERVER['HTTP_X_ORIGINAL_URL'];\r\n        } elseif  (isset($_SERVER['HTTP_X_REWRITE_URL'])) { \/\/ check this first so IIS will catch\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4491\/watchers",
                "isWatching": false,
                "watchCount": 5
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "FixForZF1.12"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                "name": "rob",
                "displayName": "Rob Allen",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10201",
                    "id": 10201,
                    "description": "Mini Release",
                    "name": "1.6.1",
                    "userReleaseDate": "15\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-15",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10011",
                    "id": 10011,
                    "name": "Zend_Controller",
                    "description": "front controller, including router and dispatcher",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29495",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=breich",
                        "name": "breich",
                        "displayName": "Brian Reich",
                        "active": true
                    },
                    "body": "The simplest way that I've found to get around this issue is to add the following lines to my bootstrap file, prior to any calls to Zend_Controller_Front::getInstance():\n\n\/*\n * For IIS 7.0 Rewrite Module - allows use of \"clean\" URL syntax instead of\n * index.php\/controller\/action\/ by copying original URL value set by the rewrite\n * module to the server variable expected by the Rewrite Router.\n *\/\nif (isset($_SERVER['HTTP_X_ORIGINAL_URL'])) {\n    \n    $_SERVER['HTTP_X_REWRITE_URL'] = $_SERVER['HTTP_X_ORIGINAL_URL'];\n}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=breich",
                        "name": "breich",
                        "displayName": "Brian Reich",
                        "active": true
                    },
                    "created": "2009-03-16T09:41:47.000+0000",
                    "updated": "2009-03-16T09:41:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33408",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=brunobbmagalhaes",
                        "name": "brunobbmagalhaes",
                        "displayName": "Bruno B B Magalh\u00e3es",
                        "active": true
                    },
                    "body": "To fix this issue, the method setRequestUri within Zend_Controller_Request_Http class must be changed as this (line 383):\n\n{code} \n    \/**\n     * Set the REQUEST_URI on which the instance operates\n     *\n     * If no request URI is passed, uses the value in $_SERVER['REQUEST_URI'],\n     * $_SERVER['HTTP_X_ORIGINAL_URL'], or $_SERVER['HTTP_X_REWRITE_URL'], or $_SERVER['ORIG_PATH_INFO'] + $_SERVER['QUERY_STRING'].\n     *\n     * @param string $requestUri\n     * @return Zend_Controller_Request_Http\n     *\/\n    public function setRequestUri($requestUri = null)\n    {\n        if ($requestUri === null) {\n            if (isset($_SERVER['HTTP_X_ORIGINAL_URL'])) { \/\/ check IIS 7.x with Microsoft Rewrite Module\n                $requestUri = $_SERVER['HTTP_X_ORIGINAL_URL'];\n            elseif (isset($_SERVER['HTTP_X_REWRITE_URL'])) { \/\/ check IIS with ISAPI_Rewrite, etc\n                $requestUri = $_SERVER['HTTP_X_REWRITE_URL'];\n            } elseif (isset($_SERVER['REQUEST_URI'])) {\n                $requestUri = $_SERVER['REQUEST_URI'];\n                \/\/ Http proxy reqs setup request uri with scheme and host [and port] + the url path, only use url path\n                $schemeAndHttpHost = $this->getScheme() . ':\/\/' . $this->getHttpHost();\n                if (strpos($requestUri, $schemeAndHttpHost) === 0) {\n                    $requestUri = substr($requestUri, strlen($schemeAndHttpHost));\n                }\n            } elseif (isset($_SERVER['ORIG_PATH_INFO'])) { \/\/ IIS 5.0, PHP as CGI\n                $requestUri = $_SERVER['ORIG_PATH_INFO'];\n                if (!empty($_SERVER['QUERY_STRING'])) {\n                    $requestUri .= '?' . $_SERVER['QUERY_STRING'];\n                }\n            } else {\n                return $this;\n            }\n        } elseif (!is_string($requestUri)) {\n            return $this;\n        } else {\n            \/\/ Set GET items, if available\n            if (false !== ($pos = strpos($requestUri, '?'))) {\n                \/\/ Get key => value pairs and set $_GET\n                $query = substr($requestUri, $pos + 1);\n                parse_str($query, $vars);\n                $this->setQuery($vars);\n            }\n        }\n\n        $this->_requestUri = $requestUri;\n        return $this;\n    }\n{code} \n\nI've already tested it in a development server running Windows Server 2003 SP3  + IIS 7.0 + Rewrite Module, and worked as expercted.\n\nBest Regards,\nBruno B B Magalh\u00e3es",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=brunobbmagalhaes",
                        "name": "brunobbmagalhaes",
                        "displayName": "Bruno B B Magalh\u00e3es",
                        "active": true
                    },
                    "created": "2009-08-12T09:23:03.000+0000",
                    "updated": "2009-08-12T09:25:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33478",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Reopening, as no patch has been applied. :)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-08-15T13:57:52.000+0000",
                    "updated": "2009-08-15T13:57:52.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50905",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=iunruh",
                        "name": "iunruh",
                        "displayName": "Ian Unruh",
                        "active": true
                    },
                    "body": "This needs to be fixed. IIS 7.0+ is default in Windows Server 2003, Server 2008, Server 2008 R2, and Windows 7. This issue affects anyone using those operating systems with IIS and the URL Rewrite module.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=iunruh",
                        "name": "iunruh",
                        "displayName": "Ian Unruh",
                        "active": true
                    },
                    "created": "2012-05-31T16:05:23.000+0000",
                    "updated": "2012-05-31T16:05:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51094",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=evan.pro",
                        "name": "evan.pro",
                        "displayName": "Evan Coury",
                        "active": true
                    },
                    "body": "This is fixed in ZF2 with [PR 1424|https:\/\/github.com\/zendframework\/zf2\/pull\/1424].",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=evan.pro",
                        "name": "evan.pro",
                        "displayName": "Evan Coury",
                        "active": true
                    },
                    "created": "2012-06-13T16:57:37.000+0000",
                    "updated": "2012-06-13T16:57:37.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51121",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frosch",
                        "name": "frosch",
                        "displayName": "Frank Br\u00fcckner",
                        "active": true
                    },
                    "body": "Fixed in svn [r24842|http:\/\/framework.zend.com\/code\/revision.php?repname=Zend+Framework&rev=24842] by rob (Rob Allen).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frosch",
                        "name": "frosch",
                        "displayName": "Frank Br\u00fcckner",
                        "active": true
                    },
                    "created": "2012-06-14T17:22:47.000+0000",
                    "updated": "2012-06-14T17:22:47.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4491\/transitions"
}