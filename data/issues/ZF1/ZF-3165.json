{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3165",
    "key": "ZF-3165",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Date\/Zend_TimeSync: Undefined index: offset"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3165\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10240",
                    "id": 10240,
                    "description": "Minor Release",
                    "name": "1.6.0",
                    "userReleaseDate": "02\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-02",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-05-15T11:05:19.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ziegenberg",
                "name": "ziegenberg",
                "displayName": "Christoph Ziegenberg",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-04-23T04:33:53.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-09-02T10:38:58.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I used the timeserver \"ntp:\/\/ntps1-1.rz.uni-osnabrueck.de\" for some tests and it worked fine, but today I got the following error:\nNotice: Undefined index: offset in [...]Zend\\Date.php on line 273\n\nThe result is a valid instance of the Zend_TimeSync_Protocol, but the getInfo() method returns an empty array.\n\nThe code:\n...\n$serverlist = array(\n    'ntp:\/\/ntps1-1.rz.uni-osnabrueck.de',\n    'ntp:\/\/swisstime.ethz.ch',\n ); \n         \n$server = new Zend_TimeSync($serverlist);\n$servers = $server->getIterator();\n        \nZend_Date::setOptions(array('timesync' => $servers[0]));\n..."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3165\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10174",
                    "id": 10174,
                    "description": "Mini Release",
                    "name": "1.5.1",
                    "userReleaseDate": "25\/Mar\/08",
                    "archived": true,
                    "releaseDate": "2008-03-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10110",
                    "id": 10110,
                    "name": "Zend_TimeSync",
                    "description": "Get time from time server, e.g. NTP.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21401",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Are you sure the timeserver works ?\nCan you dump us the $server object ?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-04-23T05:15:00.000+0000",
                    "updated": "2008-04-23T05:15:00.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21404",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ziegenberg",
                        "name": "ziegenberg",
                        "displayName": "Christoph Ziegenberg",
                        "active": true
                    },
                    "body": "I don't think that the servers are valid (at the moment), but that's not the problem. \n\nI passed a valid instance of the Zend_TimeSync_Protocol (althougth the server isn't valid), and Zend_Date expects that an array key  exists which does not exist - so this should be checked and throw an exception. I know the posted code isn't a good way (got it from an tutorial) - if I use the getServer() method I can check if there is a valid server or not.\n\nHere's the $server object:\n\nobject(Zend_TimeSync)#319 (3) {\n  [\"_timeservers:protected\"]=>\n  array(2) {\n    [0]=>\n    object(Zend_TimeSync_Ntp)#312 (5) {\n      [\"_port:protected\"]=>\n      int(123)\n      [\"_socket:protected\"]=>\n      NULL\n      [\"_exceptions:protected\"]=>\n      NULL\n      [\"_timeserver:protected\"]=>\n      string(34) \"udp:\/\/ntps1-1.rz.uni-osnabrueck.de\"\n      [\"_info:protected\"]=>\n      array(0) {\n      }\n    }\n    [1]=>\n    object(Zend_TimeSync_Ntp)#311 (5) {\n      [\"_port:protected\"]=>\n      int(123)\n      [\"_socket:protected\"]=>\n      NULL\n      [\"_exceptions:protected\"]=>\n      NULL\n      [\"_timeserver:protected\"]=>\n      string(23) \"udp:\/\/swisstime.ethz.ch\"\n      [\"_info:protected\"]=>\n      array(0) {\n      }\n    }\n  }\n  [\"_current:protected\"]=>\n  NULL\n  [\"_allowedSchemes:protected\"]=>\n  array(2) {\n    [0]=>\n    string(3) \"Ntp\"\n    [1]=>\n    string(4) \"Sntp\"\n  }\n}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ziegenberg",
                        "name": "ziegenberg",
                        "displayName": "Christoph Ziegenberg",
                        "active": true
                    },
                    "created": "2008-04-23T06:40:43.000+0000",
                    "updated": "2008-04-23T06:40:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21410",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "No, the thing is that Zend_TimeSync should throw an exception when no time can be evaluated, and not Zend_Date.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-04-23T07:44:23.000+0000",
                    "updated": "2008-04-23T07:44:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21411",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Where does the code you used come from ???\n\nIt can not have worked in my opinion.\nWhen you look at the manual you will see where the problem is.\n\nSee this code from the manual:\n{code}\n<?php\n    require_once 'Zend\/TimeSync.php';\n    $server = new Zend_TimeSync('0.pool.ntp.org');\n    print $server->getDate()->getIso();\n{code}]\n\nZend_Timesync returns you a Zend_Date object and not reverse.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-04-23T07:57:24.000+0000",
                    "updated": "2008-04-23T07:57:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21412",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ziegenberg",
                        "name": "ziegenberg",
                        "displayName": "Christoph Ziegenberg",
                        "active": true
                    },
                    "body": "Zend_Date does not return a Zend_Timesync object, but uses it as an option for all instances of Zend_Date to correct times (Zend_Date_DateObject::$_defaultOffset).\n\n{quote}Normally the clocks from servers and computers differ from each other. Zend_Date  is able to handle such problems with the help of Zend_TimeSync. You can set a timeserver with Zend_Date::setOptions(array('timesync' => $timeserver)); which will set the offset between the own actual timestamp and the real actual timestamp for all instances of Zend_Date. Using this option does not change the timestamp of existing instances. So best usage is to set it within the bootstrap file.{quote}\n\nSee here: http:\/\/framework.zend.com\/manual\/en\/zend.date.overview.html#zend.date.options.timesync\n\n(PS: Dunno where the code was from)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ziegenberg",
                        "name": "ziegenberg",
                        "displayName": "Christoph Ziegenberg",
                        "active": true
                    },
                    "created": "2008-04-23T09:55:04.000+0000",
                    "updated": "2008-04-23T09:55:04.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21424",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "To get your code working you should simply call getDate after assigning the wished timeserver.\n\nBeside, your code is wrong in another point.\n\nYou create a timesync object with 2 servers for redundancy.\nBut then you assign only one server to Zend_Date which results in problems when exact this server can not be reached.\n\nAssign the Zend_TimeSync object to Zend_Date.\ngetIterator makes no sense in this point... the code is wrong.\n\nAlso before attaching it to Zend_Date you have to receive the timesync which means that you call getDate and then assign it to Zend_Date.\n\nThis way your code will work.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-04-23T12:53:15.000+0000",
                    "updated": "2008-04-23T12:53:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21428",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ziegenberg",
                        "name": "ziegenberg",
                        "displayName": "Christoph Ziegenberg",
                        "active": true
                    },
                    "body": "{quote}But then you assign only one server to Zend_Date which results in problems when exact this server can not be reached.{quote}\nThat's right. If a valid server ist found, the code works.\n\n{quote}Assign the Zend_TimeSync object to Zend_Date.{quote}\nEver tried this? Then you'll get an exception with the message \"Instance of Zend_TimeSync expected\" - although it's checked for an instance of \"Zend_TimeSync_Protocol\" (and \"Zend_TimeSync\" isn't). So there is definitely an error in the code.\n\n{quote}getIterator makes no sense in this point... the code is wrong.{quote}\nThat's right, as I already mentioned before this is not a good solution, but it's a fact that an valid instance of an object is given and that the Zend_Date class expects that there is a variable which does not exist and which is not checked.\n\n{quote}Also before attaching it to Zend_Date you have to receive the timesync which means that you call getDate and then assign it to Zend_Date.{quote}\nSounds strange and unhandy. If that is right, it should be mentioned in the manual - or done automatically by Zend_date::setOption().\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ziegenberg",
                        "name": "ziegenberg",
                        "displayName": "Christoph Ziegenberg",
                        "active": true
                    },
                    "created": "2008-04-24T02:29:30.000+0000",
                    "updated": "2008-04-24T02:29:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21429",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ziegenberg",
                        "name": "ziegenberg",
                        "displayName": "Christoph Ziegenberg",
                        "active": true
                    },
                    "body": "It's really neccessary, that the method getDate() ist called, so that's the final soulution, which is not documented:\n\n{code}\n...\n            $serverlist = array(\n                'ntp:\/\/0.de.pool.ntp.org',\n                'ntp:\/\/1.de.pool.ntp.org',\n                'ntp:\/\/2.de.pool.ntp.org',\n                'ntp:\/\/3.de.pool.ntp.org',\n                'ntp:\/\/4.de.pool.ntp.org',\n            ); \n            $server = new Zend_TimeSync($serverlist);\n            $server->getDate(); \/\/ sets the valid server\n            \n            $selected_server = $server->getServer(); \/\/throws an exception if no valid server found\n            \n            Zend_Date::setOptions(array('timesync' => $selected_server));\n...\n{code}\n\nBut there are still errors in Zend_Date:\n- a wrong instance check (or a wrong error message)\n- a missing check for the array key \"offset\"\n\nHere's my fix, which allows to use an instance of \"Zend_TimeSync\" or \"Zend_TimeSync_Protocol\", with a corrected exception message, and with a check for the missing key:\n\n{code}\n...\n                    case 'timesync' :\n                        if ($value instanceof Zend_TimeSync) {\n                            try {\n                                $value = $value->getServer();\n                            }\n                            catch (Zend_TimeSync_Exception $e) {\n                                $value->getDate();\n                                $value = $value->getServer();\n                            }\n                        }\n                        if (!$value instanceof Zend_TimeSync_Protocol) {\n                            require_once 'Zend\/Date\/Exception.php';\n                            throw new Zend_Date_Exception(\"Instance of Zend_TimeSync_Protocol expected\");\n                        }\n                        $date = $value->getInfo();\n                        if (isset($date['offset']))\n                        {\n                            parent::$_defaultOffset = $date['offset'];\n                        }\n                        break;\n...\n{code}\n\nThis allowes the following use:\n{code}\n...\n            $serverlist = array(\n                'ntp:\/\/0.de.pool.ntp.org',\n                'ntp:\/\/1.de.pool.ntp.org',\n                'ntp:\/\/2.de.pool.ntp.org',\n                'ntp:\/\/3.de.pool.ntp.org',\n                'ntp:\/\/4.de.pool.ntp.org',\n            ); \n            $server = new Zend_TimeSync($serverlist);\n            $server->getDate(); \/\/ sets the valid server\n            \n            Zend_Date::setOptions(array('timesync' => $server));\n...\n{code}\n\nor just\n\n{code}\n...\n            $serverlist = array(\n                'ntp:\/\/0.de.pool.ntp.org',\n                'ntp:\/\/1.de.pool.ntp.org',\n                'ntp:\/\/2.de.pool.ntp.org',\n                'ntp:\/\/3.de.pool.ntp.org',\n                'ntp:\/\/4.de.pool.ntp.org',\n            ); \n            $server = new Zend_TimeSync($serverlist);\n\n            Zend_Date::setOptions(array('timesync' => $server));\n...\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ziegenberg",
                        "name": "ziegenberg",
                        "displayName": "Christoph Ziegenberg",
                        "active": true
                    },
                    "created": "2008-04-24T02:55:20.000+0000",
                    "updated": "2008-04-24T02:55:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21432",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "I havn't had said that we will not fix it... I only showed you a solution to your problem beside this error.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-04-24T03:11:50.000+0000",
                    "updated": "2008-04-24T03:11:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21433",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ziegenberg",
                        "name": "ziegenberg",
                        "displayName": "Christoph Ziegenberg",
                        "active": true
                    },
                    "body": "Okay ;)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ziegenberg",
                        "name": "ziegenberg",
                        "displayName": "Christoph Ziegenberg",
                        "active": true
                    },
                    "created": "2008-04-24T03:19:02.000+0000",
                    "updated": "2008-04-24T03:19:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21770",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Fixed with r9460",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-05-15T11:05:19.000+0000",
                    "updated": "2008-05-15T11:05:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23954",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Updating for the 1.6.0 release.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-09-02T10:38:58.000+0000",
                    "updated": "2008-09-02T10:38:58.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3165\/transitions"
}