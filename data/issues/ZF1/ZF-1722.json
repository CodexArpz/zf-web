{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1722",
    "key": "ZF-1722",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Acl assertions broken when inheritance is required (ie DepthFirstSearch)"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField",
            "value": {
                "timeoriginalestimate": 7200,
                "timeestimate": 7200
            }
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1722\/votes",
                "votes": 10,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10350",
                    "id": 10350,
                    "description": "Mini Release",
                    "name": "1.9.1",
                    "userReleaseDate": "11\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-11",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-08-14T13:20:51.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-07-14T21:45:52.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-09-29T07:22:54.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Reproduction code\n\n{code}\nwebdeveloper@webdevelopment ~\/testing $ cat test_aclwhoswho.php \n<?php\n\nrequire_once 'Zend\/Acl.php';\nrequire_once 'Zend\/Acl\/Role.php';\nrequire_once 'Zend\/Acl\/Resource.php';\n\nclass HasIQFor implements Zend_Acl_Assert_Interface\n{\n    public function assert(Zend_Acl $acl, Zend_Acl_Role_Interface $role = null,\n                           Zend_Acl_Resource_Interface $resource = null, $privilege = null)\n    {\n        echo \"digging deeper\";\n        echo var_dump($role);\n    }\n}\n\nclass Acl_Child implements Zend_Acl_Role_Interface { public function getRoleId() { return 'Child'; } }\nclass Acl_Parent implements Zend_Acl_Role_Interface { public function getRoleId() { return 'Parent'; } }\n\n$acl = new Zend_Acl();\n$acl->addRole(new Zend_Acl_Role('Child'))\n    ->addRole(new Zend_Acl_Role('Parent'), 'Child')\n    ->add(new Zend_Acl_Resource('Toy'))\n    ->add(new Zend_Acl_Resource('PokerGame'))\n    ->allow('Child', 'Toy', 'Play', new HasIQFor())\n    ->allow('Parent', 'PokerGame', 'Play', new HasIQFor());\n\n$child = new Acl_Child();\n$mommy = new Acl_Parent();\n\necho \"Children and toys?\\n\"; echo $acl->isAllowed($child, 'Toy', 'Play');\necho \"\\n\\nChildren and poker?\\n\"; echo $acl->isAllowed($child, 'PokerGame', 'Play');\necho \"\\n\\nParents and toys?\\n\"; echo $acl->isAllowed($mommy, 'Toy', 'Play');\necho \"\\n\\nParents and poker?\\n\"; echo $acl->isAllowed($mommy, 'PokerGame', 'Play');\n\nwebdeveloper@webdevelopment ~\/testing $ php test_aclwhoswho.php \nChildren and toys?\ndigging deeperobject(Zend_Acl_Role)#2 (1) {\n  [\"_roleId:protected\"]=>\n  string(5) \"Child\"\n}\n\n\nChildren and poker?\n\n\nParents and toys?\ndigging deeperobject(Zend_Acl_Role)#2 (1) {\n  [\"_roleId:protected\"]=>\n  string(5) \"Child\"\n}\n\n\nParents and poker?\ndigging deeperobject(Zend_Acl_Role)#4 (1) {\n  [\"_roleId:protected\"]=>\n  string(6) \"Parent\"\n}\n{code}\n\nyou can notice the problem in the 3rd case where when trying to determine if the parent has the IQ to play with the toy, the parent object is not passed to the assertion."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1722\/watchers",
                "isWatching": false,
                "watchCount": 10
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-5425",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5425",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                },
                {
                    "issueKey": "ZF-1721",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1721",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-3390",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3390",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                },
                {
                    "issueKey": "ZF-4460",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4460",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-1765",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1765",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10031",
                    "id": 10031,
                    "description": "Major Release",
                    "name": "1.0.0",
                    "userReleaseDate": "30\/Jun\/07",
                    "archived": true,
                    "releaseDate": "2007-06-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10070",
                    "id": 10070,
                    "name": "Zend_Acl",
                    "description": "Access control list authorization component",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15984",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Postponing to after 1.0.1.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-07-26T11:55:20.000+0000",
                    "updated": "2007-07-26T11:55:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/16122",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "We should resolve this for 1.1.0.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-08-01T15:02:36.000+0000",
                    "updated": "2007-08-01T15:02:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/17001",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "But why is this a problem? The rule is satisfied by the Child role and since there is no ACL specifically for Parents on the Toy then Zend_Acl returns true.\n\nWouldn't performance suffer if Zend_Acl iterates through the whole inheritance only to come to the same conclusion that it did in the first place? Or do you see a use case where a custom Assertion will need to query this hierarchy to supply a more qualitative answer?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2007-09-27T17:44:42.000+0000",
                    "updated": "2007-09-27T17:44:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/17015",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Hey Simon,\n  The problem i specifically notice (from above) is in test case number 3.  If I am writing custom assertions, then my assertion (if applied) should always get the exact object that i proposed when i asked if it \"isAllowed\".\n\n{code}\n\/\/ IF I DO:\n$acl->isAllowed($mommy, 'Toy', 'Play'); \/\/ where mommy is of type (class Acl_Parent)\n{code}\n\nI should expect any assertions that were triggered as a result of that exact query should indeed get teh exact object i passed into the query.  The reason for that expectation is in case I want to call some Acl_Parent specific methods in order to assert that what is queried should be allowed or not.\n\nI see no direct performance impact, its simply a matter of whats being passed to the assertion.\n\nas far as this statement: > Or do you see a use case where a custom Assertion will need to query this hierarchy to supply a more qualitative answer?\n\nAssertions don't query the inheritance chain, its actually the other way around, currently the inheritance chain is iterated in order to trigger the appropriate assertion.\n\nmake sense?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2007-09-28T11:49:12.000+0000",
                    "updated": "2007-09-28T11:49:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22713",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lagitus",
                        "name": "lagitus",
                        "displayName": "Martin P\u00e4rtel",
                        "active": true
                    },
                    "body": "This is still not fixed in 1.5.2, and is still quite irritating when trying to write any non-trivial assertions.\n\nOne workaround:\nInherit Zend_Acl, override isAllowed(), store the parameters in a private member and make them available through a new method, say, \"getLastRequest()\". Then, in an assertion, get them using something like:\nlist($role, $resource, $privilege) = $acl->getLastRequest();\n\n(It's a good idea to make sure getLastRequest() always returns objects, even if a string was passed to isAllowed().)\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lagitus",
                        "name": "lagitus",
                        "displayName": "Martin P\u00e4rtel",
                        "active": true
                    },
                    "created": "2008-07-01T10:14:48.000+0000",
                    "updated": "2008-07-01T10:14:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33083",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Fix in trunk as of r17317, please test.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2009-07-30T18:41:14.000+0000",
                    "updated": "2009-07-30T18:41:14.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1722\/transitions"
}