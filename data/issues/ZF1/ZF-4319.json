{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4319",
    "key": "ZF-4319",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "solution for Transfer-Adapter's file-hashmap structure defect, supporting subforms"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/5",
                "name": "Sub-task",
                "subtask": true
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4319\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10260",
                    "id": 10260,
                    "description": "Minor Release",
                    "name": "1.7.0",
                    "userReleaseDate": "17\/Nov\/08",
                    "archived": false,
                    "releaseDate": "2008-11-17",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-09-25T10:33:56.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=trixiyue",
                "name": "trixiyue",
                "displayName": "Trixi Yue",
                "active": true
            }
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-09-17T09:41:19.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-11-13T14:10:28.000+0000"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "The problem which causes file upload to fail is about the internal key naming of upload files. For subforms files are mapped to a key-array-pair rather than a key-string-pair. So no string hashmap is built internal.\n\nFor me following fix works fine. I've tested with nested subform depths 0 to 3.\n\nTestcode:\n{noformat} \n\t\t\/\/ Creating form\n\t\t$form = new Zend_Form();\n\t\t$form->setEnctype('multipart\/form-data');\n\t\t\n\t\t\/\/ File Upload Element\n\t\t$element = new Zend_Form_Element_File('file1', array('label' => 'Datei'));\n\t\t$element->setRequired(TRUE);\n\n\t\t\/\/ Test1: no subform\n\t\t$form->addElement($element);\n\t\t\n\t\t\/\/ Test2: simple subform\n\t\t\/\/$subformFile = new Zend_Form_SubForm();\n\t\t\/\/$subformFile->addElement($element);\n\t\t\/\/$form->addSubform($subformFile, 'subformFile');\n\t\t\n\t\t\/\/ Test3: one nested subform\n\t\t\/\/$subformFile = new Zend_Form_SubForm();\n\t\t\/\/$subformFile->addElement($element);\n\t\t\/\/$subform1 = new Zend_Form_SubForm();\n\t\t\/\/$subform1->addSubform($subformFile, 'subformFile');\n\t\t\/\/$form->addSubform($subform1, 'subform1');\n\t\t\n\t\t\/\/ Test4: doublenested subform\n\t\t\/\/$subformFile = new Zend_Form_SubForm();\n\t\t\/\/$subformFile->addElement($element);\n\t\t\/\/$subform1 = new Zend_Form_SubForm();\n\t\t\/\/$subform1->addSubform($subformFile, 'subformFile');\n\t\t\/\/$subform2 = new Zend_Form_SubForm();\n\t\t\/\/$subform2->addSubform($subform1, 'subform1');\n\t\t\/\/$form->addSubform($subform2, 'subform2');\n\t\t\n\t\t\/\/ Test5: triplenested subform\n\t\t\/\/$subformFile = new Zend_Form_SubForm();\n\t\t\/\/$subformFile->addElement($element);\n\t\t\/\/$subform1 = new Zend_Form_SubForm();\n\t\t\/\/$subform1->addSubform($subformFile, 'subformFile');\n\t\t\/\/$subform2 = new Zend_Form_SubForm();\n\t\t\/\/$subform2->addSubform($subform1, 'subform1');\n\t\t\/\/$subform3 = new Zend_Form_SubForm();\n\t\t\/\/$subform3->addSubform($subform2, 'subform2');\n\t\t\/\/$form->addSubform($subform3, 'subform3');\n{noformat} \n\nFix in Zend_File_Transfer_Adapter_Http:\n{noformat} \n    \/**\n     * Building file key an returns value, includes nested subform support.\n     * \n     * Example:\n     * \t\tThe given key looks like this:\n     * \t\t'subform3__subform2'\n     * \t\t\n     * \t\tThe given array looks like this:\n     * \t\tarray(1) {\n     * \t\t\t\t[\"subform1\"]=>\n     * \t\t\t\tarray(1) {\n     * \t\t\t\t\t[\"subformFile\"]=>\n     * \t\t\t\t\tarray(1) {\n     * \t\t\t\t\t\t[\"file1\"]=>\n     * \t\t\t\t\t\tstring(0) \"\/uploaded\/file.ext\"\n     * \t\t\t\t\t}\n     * \t\t\t\t}\n     * \t\t}\n     * \t\t\n     * \t\tThe returned key would be:\n     * \t\t'subform3__subform2__subform1__subformFile__file1'\n     * \t\t\n     * \t\tThe returned value would be: '\/uploaded\/file.ext'\n     * \n     * @param array $fileKeyValue\n     * @param string $key Return key\n     * @return string Value\n     *\/\n    protected function _getFileKeyValue(array $fileKeyValue, &$key) {\n    \tlist($keyAppend, $innerFileKeyValue) = each($fileKeyValue);\n    \t$key .= '__'.$keyAppend;\n    \t\n    \tif (is_array($innerFileKeyValue)) {\n    \t\t$innerFileKeyValue = $this->_getFileKeyValue($innerFileKeyValue, $key);\n    \t}\n    \t\n    \treturn $innerFileKeyValue;\n    }\n\n    \/**\n     * Prepare the $_FILES array to match the internal syntax of one file per entry\n     *\n     * @param  array $files\n     * @return array\n     *\/\n    protected function _prepareFiles(array $files = array())\n    {\n        $result = array();\n        foreach ($files as $form => $content) {\n            if (is_array($content['name'])) {\n                foreach ($content as $param => $file) {\n\t            \t$key = $form;\n\t            \t$value = $this->_getFileKeyValue($content[$param], $key);\n\t            \t$result[$key][$param] = $value;\n                }\n            } else {\n                $result[$form] = $content;\n            }\n        }\n        return $result;\n    }\n{noformat} \n\n\n=====================================================================================================\n\nDamned, i didn't look to multiple files. Sorry.\n\nI don't know why, but i don't have rights to comment any issues here, so let me append my answer. Hope it helps.\n\nTestcode (not patched, just ZF 1.6.0):\n{noformat} \n\t\t\/\/ Creating form\n\t\t$form = new Zend_Form();\n\t\t$form->setEnctype('multipart\/form-data');\n\t\t\n\t\t\/\/ 2 File Upload Elements\n\t\t$element = new Zend_Form_Element_File('file1', array('label' => 'Datei'));\n\t\t$element->setRequired(TRUE);\n\t\t$element2 = new Zend_Form_Element_File('file2', array('label' => 'Datei2'));\n\t\t$element2->setRequired(TRUE);\n\n\t\t\/\/ triplenested subform - 2 elements\t\t\n\t\t$subformFile = new Zend_Form_SubForm();\n\t\t$subformFile->addElement($element);\n\t\t$subformFile->addElement($element2);\n\t\t$subform1 = new Zend_Form_SubForm();\n\t\t$subform1->addSubform($subformFile, 'subformFile');\n\t\t$subform2 = new Zend_Form_SubForm();\n\t\t$subform2->addSubform($subform1, 'subform1');\n\t\t$subform3 = new Zend_Form_SubForm();\n\t\t$subform3->addSubform($subform2, 'subform2');\n\t\t$form->addSubform($subform3, 'subform3');\n\t\t\n\t\tvar_dump($_FILES);\n\t\tvar_dump($element->getFullyQualifiedName());\n\t\tvar_dump($element->getId());\n\t\t\n\t\tvar_dump($element2->getFullyQualifiedName());\n\t\tvar_dump($element2->getId());\n\t\t\n\t\tvar_dump($subformFile->getFullyQualifiedName());\n\t\tvar_dump($subformFile->getId());\n\t\t\n\t\tvar_dump($subform1->getFullyQualifiedName());\n\t\tvar_dump($subform1->getId());\n\t\t\n\t\tvar_dump($subform2->getFullyQualifiedName());\n\t\tvar_dump($subform2->getId());\n\t\t\n\t\tvar_dump($subform3->getFullyQualifiedName());\n\t\tvar_dump($subform3->getId());\n\t\t\n\t\tvar_dump($form->getFullyQualifiedName());\n\t\tvar_dump($form->getId());\n{noformat}\n\ndump:\n{noformat} \narray(1) {\n  [\"subform3\"]=>\n  array(5) {\n    [\"name\"]=>\n    array(1) {\n      [\"subform2\"]=>\n      array(1) {\n        [\"subform1\"]=>\n        array(1) {\n          [\"subformFile\"]=>\n          array(2) {\n            [\"file1\"]=>\n            string(0) \"\"\n            [\"file2\"]=>\n            string(0) \"\"\n          }\n        }\n      }\n    }\n    [\"type\"]=>\n    array(1) {\n      [\"subform2\"]=>\n      array(1) {\n        [\"subform1\"]=>\n        array(1) {\n          [\"subformFile\"]=>\n          array(2) {\n            [\"file1\"]=>\n            string(0) \"\"\n            [\"file2\"]=>\n            string(0) \"\"\n          }\n        }\n      }\n    }\n    [\"tmp_name\"]=>\n    array(1) {\n      [\"subform2\"]=>\n      array(1) {\n        [\"subform1\"]=>\n        array(1) {\n          [\"subformFile\"]=>\n          array(2) {\n            [\"file1\"]=>\n            string(0) \"\"\n            [\"file2\"]=>\n            string(0) \"\"\n          }\n        }\n      }\n    }\n    [\"error\"]=>\n    array(1) {\n      [\"subform2\"]=>\n      array(1) {\n        [\"subform1\"]=>\n        array(1) {\n          [\"subformFile\"]=>\n          array(2) {\n            [\"file1\"]=>\n            int(4)\n            [\"file2\"]=>\n            int(4)\n          }\n        }\n      }\n    }\n    [\"size\"]=>\n    array(1) {\n      [\"subform2\"]=>\n      array(1) {\n        [\"subform1\"]=>\n        array(1) {\n          [\"subformFile\"]=>\n          array(2) {\n            [\"file1\"]=>\n            int(0)\n            [\"file2\"]=>\n            int(0)\n          }\n        }\n      }\n    }\n  }\n}\nstring(5) \"file1\"\nstring(5) \"file1\"\nstring(5) \"file2\"\nstring(5) \"file2\"\nstring(11) \"subformFile\"\nstring(11) \"subformFile\"\nstring(8) \"subform1\"\nstring(8) \"subform1\"\nstring(8) \"subform2\"\nstring(8) \"subform2\"\nstring(8) \"subform3\"\nstring(8) \"subform3\"\nNULL\nNULL\n{noformat}\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4319\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "parent": {
            "name": "parent",
            "type": "issuelinks",
            "value": {
                "issueKey": "ZF-4102",
                "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4102",
                "type": {
                    "name": "Parent",
                    "direction": "INBOUND"
                }
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10240",
                    "id": 10240,
                    "description": "Minor Release",
                    "name": "1.6.0",
                    "userReleaseDate": "02\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-02",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10320",
                    "id": 10320,
                    "name": "Zend_File_Transfer",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24566",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "I'm sorry, but this is not a proper solution.\nSet 2 file elements in every form\/subform and you will see why your solution does not work.\n\nBut you can help me out:\nCan you give me your $_FILES array using this 3-nested form (with 2 file elements) ?\nAlso the value of getFullyQualifiedName() and getId() would be interesting.\nAnd when you set a different name and a different id in the form.\n\nThe solution I have worked out will be available in a few days because we always need unittests and documentation before doing a commit.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-09-17T22:33:29.000+0000",
                    "updated": "2008-09-17T22:33:29.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24656",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "This solution does not work.\nA working solution has been added with r11518",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-09-25T10:33:51.000+0000",
                    "updated": "2008-09-25T10:33:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26371",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Changing issues in preparation for the 1.7.0 release.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-11-13T14:10:28.000+0000",
                    "updated": "2008-11-13T14:10:28.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4319\/transitions"
}