{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11374",
    "key": "ZF-11374",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Override default translation for Zend_Validator"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11374\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/5",
                "name": "Cannot Reproduce"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10980",
                    "id": 10980,
                    "description": "Mini Release",
                    "name": "1.11.10",
                    "userReleaseDate": "04\/Aug\/11",
                    "archived": false,
                    "releaseDate": "2011-08-04",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-07-30T20:30:14.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=egeste",
                "name": "egeste",
                "displayName": "Egest\u00e9",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-05-13T18:18:55.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-07-30T20:30:14.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "Zend_Form",
                "Zend_Locale",
                "Zend_Translate",
                "Zend_Validate"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I'm using Zend_Locale and Zend_Translate in a custom class\r\n\r\n{code:title=library\/pplib\/Locale.php|borderStyle=solid}\r\nclass pplib_Locale extends Zend_Locale {\r\n\t\r\n\tprotected $_translate;\r\n\t\r\n\tpublic function __construct() {\r\n\t\t$locale = $this->findLocale();\r\n\t\t$auth = Zend_Auth::getInstance();\r\n\t\tif(($user = $auth->getIdentity()) !== null) {\r\n\t\t\t$locale = $user->getLocale();\r\n\t\t}\r\n\t\tparent::__construct($locale);\r\n\t\t$this->_translate = new Zend_Translate(array(\r\n\t\t\t'adapter'\t\t\t=>'gettext', \r\n            'content'\t\t\t=> APPLICATION_PATH.'\/languages\/',\r\n            'scan'\t\t\t\t=> 'directory',\r\n            'locale'\t\t\t=> $locale,\r\n            'clear'\t\t\t\t=> true,\r\n            'reload'\t\t\t=> true\r\n\t\t));\r\n\t\tZend_Registry::set('pplib_Locale', $this);\r\n\t}\r\n\t\r\n\tpublic function getTranslate() {\r\n\t\treturn $this->_translate;\r\n\t}\r\n\t\r\n}\r\n{code}\r\n\r\nand initializing the default translater in Bootstrap\r\n\r\n{code:title=application\/Bootstrap.php|borderStyle=solid}\r\nclass Bootstrap extends Zend_Application_Bootstrap_Bootstrap\r\n{\r\n[..]\r\n\tprotected function _initLocale() {\r\n\t\t$locale = new pplib_Locale();\r\n\t\tZend_Form::setDefaultTranslator($locale->getTranslate());\r\n\t}\r\n[..]\r\n}\r\n{code}\r\n\r\nand I want to override the translation for a form validator error message.\r\n\r\n{code:title=forms\/Login.php|borderStyle=solid}\r\nclass Application_Form_Login extends Zend_Form\r\n{\r\n    public function init() {\r\n[..]\r\n\t\t$password = new Zend_Form_Element_Password('password');\r\n\t\t$password->setLabel($view->translate('PP_PASSWORD'))\r\n\t\t\t->setRequired(true)\r\n\t\t\t->setAllowEmpty(false)\r\n\t\t\t->addFilter('StringTrim')\r\n\t\t\t->addValidator('StringLength', false, array(8))\r\n\t\t\t->addValidator('Regex', false, array(\r\n\t\t\t\t\"\/[..]\/\"\r\n\t\t\t))\r\n\t\t\t->getValidator('Regex')\r\n\t\t\t\t->setDisableTranslator(true)\r\n\t\t\t\t->setMessage($view->translate('PP_PASSWORD_CHARS'), 'regexNotMatch');\r\n\t\t\r\n[..]\r\n    }\t\r\n}\r\n{code}\r\n\r\nthis does not work - the validator still uses the default translation. Is this a bug or correct behavior? Is it possible to override a default translation?"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11374\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "default",
                "override",
                "translation"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10580",
                    "id": 10580,
                    "description": "Mini Release",
                    "name": "1.11.6",
                    "userReleaseDate": "05\/May\/11",
                    "archived": false,
                    "releaseDate": "2011-05-05",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10140",
                    "id": 10140,
                    "name": "Zend_Validate",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46592",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "\"Does not work\" is useless.\r\nWhat did you do?\r\nWhat result did you expect?\r\nWhat result did you get?\r\nWhat is the content of the locale?\r\nWas the requested locale detected by Zend_Translate?\r\n\r\nand so on...\r\nPS: Zend_Locale does NOT TRANSLATE. Using it to translate things is bad behaviour and should really be avoided to prevent method-quirks.\r\nPPS: You disabled translation for the validator... why do you expect to get translated content with a disabled translator?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2011-05-14T14:30:51.000+0000",
                    "updated": "2011-05-14T14:30:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46595",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "Egest\u00e9 - what do you mean with ... _the validator still uses the default translation_? Class' default or something else? In other words, is the output error \"*'%value%' does not match against pattern '%pattern%'*\" or something else? \r\n\r\nbq. PPS: You disabled translation for the validator... why do you expect to get translated content with a disabled translator?\r\n\r\nI think he disabled the translator to prevent possible double translation. However, as said, this issue is pretty much incomplete for me too.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-05-15T11:42:55.000+0000",
                    "updated": "2011-05-15T11:42:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46596",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=egeste",
                        "name": "egeste",
                        "displayName": "Egest\u00e9",
                        "active": true
                    },
                    "body": "I didn't think I had left any room for ambiguity, did either of you read the source code I posted in the ticket? Can you see that there's source code in this ticket?.. I will try to explain without using code and assume you cannot see the code I posted...\r\n\r\nWhat I'm doing is extending an instance of Zend_Locale and using it as a wrapper for other locale-specific classes, in this case I'm using it for translation. In the future I plan to also use it for timezone, currencies etc. The name of my Zend_Locale wrapper class is pplib_Locale. The pplib_Locale class creates and stores an instance of Zend_Translate with the following params:\r\n*adapter = gettext\r\n*content = APPLICATION_PATH.'\/languages\/'\r\n*scan = directory\r\n*locale = $locale (This is either the default locale, a detected locale, or a user-specified locale)\r\n*clear = true\r\n*reload = true\r\n\r\nOnce I have instantiated all the params I want in pplib_Locale, I save it to the registry.\r\nZend_Registry::set('pplib_Locale', $this);\r\n\r\nThen, in Bootstrap, I set the defaul translator for Zend_Form to the translator I initialized in pplib_Locale, like so:\r\nZend_Form::setDefaultTranslator($locale->getTranslate()); \/\/ $locale is a valid pplib_Locale, created one line above it in bootstrap\r\n\r\nIn my gettext files, I have created entries for the various default error messages in various Zend_Validate classes. For example: In the Zend_Validate_Regex class, the error message \"key\" 'regexNotMatch' has been translated to \"Invalid input.\".\r\n\r\nIf I stop here, all my translations work. You don't need to know my locale, you don't need to know anything more than if I stop here all my translations work. My problem has nothing to do with getting translations to work.\r\n\r\nMoving on to the issue...\r\n\r\nThere is one specific form for which I would like to OVERRIDE the default translation for a validation error. The form is my login form, the field is my password field, and the validator is the Regex validator, as you may or may not have seen in the source code I posted.\r\n\r\nI have tried to set the error message manually via:\r\n$element->getValidator('Regex')->setMessage('PP_PASSWORD_CHARS', 'regexNotMatch').\r\nI expected the translated output of a 'regexNotMatch' error for this form>element>validator to then be the translated text for the gettext key 'PP_PASSWORD_CHARS', but it still gives the default 'regexNotMatch' error message \"Invalid input.\"\r\n\r\nSo I tried to disable the default translator for the validator via:\r\n$element->getValidator('Regex')->setDisableTranslator(true)->setMessage($view->translate('PP_PASSWORD_CHARS'), 'regexNotMatch');\r\nI expected the validators default translator to be disabled, and instead use my translate view helper to set the error message manually for the validation error 'regexNotMatch'. This, too, still outputs the default 'regexNotMatch' error message \"Invalid input.\"",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=egeste",
                        "name": "egeste",
                        "displayName": "Egest\u00e9",
                        "active": true
                    },
                    "created": "2011-05-15T15:46:30.000+0000",
                    "updated": "2011-05-15T15:46:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46597",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "My humble guess is that if error message key, like *regexNotMatch*, is used as a string to be translated it may override the whole translation process in validator. If I may suggest, you should not use those in your language resource files but full message strings. See for example [this resource file|http:\/\/framework.zend.com\/svn\/framework\/standard\/trunk\/resources\/languages\/en\/Zend_Validate.php].\r\n\r\n{code}\r\n\/\/ Snippet from Zend_Validate_Abstract\r\n\r\n    protected function _createMessage($messageKey, $value)\r\n    {\r\n        if (!isset($this->_messageTemplates[$messageKey])) {\r\n            return null;\r\n        }\r\n\r\n        $message = $this->_messageTemplates[$messageKey];\r\n\r\n        if (null !== ($translator = $this->getTranslator())) {\r\n-->         if ($translator->isTranslated($messageKey)) {\r\n                $message = $translator->translate($messageKey);\r\n            } else {\r\n                $message = $translator->translate($message);\r\n            }\r\n        }\r\n\r\n        ...\r\n\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-05-15T16:17:20.000+0000",
                    "updated": "2011-05-15T16:17:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47805",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "I can not reproduce this behaviour.\nTherefor closing this issue as not reproduceable.\n\nPlease note that also other validators have a \"invalid input\" message.\n\nFeel free to reopen when you have additional informations. When you have questions on coding problems please ask within the mailing list.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2011-07-30T20:30:14.000+0000",
                    "updated": "2011-07-30T20:30:14.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11374\/transitions"
}