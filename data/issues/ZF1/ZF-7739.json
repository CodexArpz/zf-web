{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7739",
    "key": "ZF-7739",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Incorrect parsing of comment ids in Zend_Gdata_YouTube::replyToCommentEntry"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7739\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-11-20T20:52:33.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wlp1979",
                "name": "wlp1979",
                "displayName": "Lee Parker",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-08-31T10:47:42.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T20:52:33.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "comment",
                "gdata",
                "reply",
                "youtube"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "The Zend_Gdata_YouTube::replyToCommentEntry method assumes a certain structure to the id field of comment entries from YouTube.  While the way the id field is parsed, corresponds to the documentation for YouTube's api, it doesn't correspond to the id values I'm getting back from YouTube.\n\nExample:\nDocumented ID string: tag:youtube,2008:video:xpI6VNvRTII:comment:F53EAC190E4EA5C9\nID string from YouTube: http:\/\/gdata.youtube.com\/feeds\/api\/videos\/EU-5KRo--kw\/comments\/JngxyOAWVePOeKTKP5dmFdvRXopsZlJE59w7BtotjKc\n\nThe reason the method needs to parse the ID string is to build the proper href for the in-reply-to link.  However, it can get this href directly from the original comment entry by calling $commentEntry->getSelfLink();\n\nOriginal code:\n{code:php}\n    public function replyToCommentEntry($commentEntry, $commentText)\n    {\n        $newComment = $this->newCommentEntry();\n        $newComment->content = $this->newContent()->setText($commentText);\n        $commentId = $commentEntry->getId();\n        $commentIdArray = explode(':', $commentId);\n\n        \/\/ create a new link element\n        $inReplyToLinkHref = self::VIDEO_URI . '\/' . $commentIdArray[3] .\n            '\/comments\/' . $commentIdArray[5];\n        $inReplyToLink = $this->newLink($inReplyToLinkHref,\n            self::IN_REPLY_TO_SCHEME, $type=\"application\/atom+xml\");\n        $links = $newComment->getLink();\n        $links[] = $inReplyToLink;\n        $newComment->setLink($links);\n        $commentFeedPostUrl = self::VIDEO_URI . '\/' . $commentIdArray[3] .\n            '\/comments';\n        return $this->insertEntry($newComment,\n            $commentFeedPostUrl, 'Zend_Gdata_YouTube_CommentEntry');\n    }\n{code}\n\nHere is my proposed fix:\n{code:php}\n    public function replyToCommentEntry($commentEntry, $commentText)\n    {\n        $newComment = $this->newCommentEntry();\n        $newComment->content = $this->newContent()->setText($commentText);\n\n        \/\/ create a new link element\n        $inReplyToLinkHref = $commentEntry->getSelfLink()->href;\n        $inReplyToLink = $this->newLink($inReplyToLinkHref,\n            self::IN_REPLY_TO_SCHEME, $type=\"application\/atom+xml\");\n        $links = $newComment->getLink();\n        $links[] = $inReplyToLink;\n        $newComment->setLink($links);\n        $commentFeedPostUrl = self::VIDEO_URI . '\/' . $commentIdArray[3] .\n            '\/comments';\n        return $this->insertEntry($newComment,\n            $commentFeedPostUrl, 'Zend_Gdata_YouTube_CommentEntry');\n    }\n{code}\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7739\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10320",
                    "id": 10320,
                    "description": "Minor Release",
                    "name": "1.9.0",
                    "userReleaseDate": "31\/Jul\/09",
                    "archived": false,
                    "releaseDate": "2009-07-31",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10088",
                    "id": 10088,
                    "name": "Zend_Gdata",
                    "description": "Class interface to Google Data API's.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34112",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wlp1979",
                        "name": "wlp1979",
                        "displayName": "Lee Parker",
                        "active": true
                    },
                    "body": "I just realized that there is one more place where the data from the parsed id field is used.  We need the video id in order to construct the url to which the new comment is posted.  So, we get the video id from the \"alternate\" link in the comment entry which is the standard link to view a video.  \n\nHere is my fix corrected to get the video id as well:\n{code:php}\n    public function replyToCommentEntry($commentEntry, $commentText)\n    {\n        $newComment = $this->newCommentEntry();\n        $newComment->content = $this->newContent()->setText($commentText);\n\n        \/\/ create a new link element\n        $inReplyToLinkHref = $commentEntry->getSelfLink()->href;\n        $inReplyToLink = $this->newLink($inReplyToLinkHref,\n            self::IN_REPLY_TO_SCHEME, $type=\"application\/atom+xml\");\n        $links = $newComment->getLink();\n        $links[] = $inReplyToLink;\n        $newComment->setLink($links);\n\t\t\n\t\tparse_str(parse_url($commentEntry->getAlternateLink()->href, PHP_URL_QUERY), $query);\n        $commentFeedPostUrl = self::VIDEO_URI . '\/' . $query['v'] .\n            '\/comments';\n        return $this->insertEntry($newComment,\n            $commentFeedPostUrl, 'Zend_Gdata_YouTube_CommentEntry');\n    }\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wlp1979",
                        "name": "wlp1979",
                        "displayName": "Lee Parker",
                        "active": true
                    },
                    "created": "2009-08-31T14:08:02.000+0000",
                    "updated": "2009-08-31T14:08:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34113",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tjohns",
                        "name": "tjohns",
                        "displayName": "Trevor Johns",
                        "active": true
                    },
                    "body": "Lee,\nThanks for reporting this, as well as suggesting a patch.\n\nHowever, before I can apply your patch, for legal reasons you need to send in a signed copy of the Zend Framework CLA:\n\n    http:\/\/framework.zend.com\/wiki\/display\/ZFPROP\/Contributor+License+Agreement\n\nWould you be okay doing this? If so, please let me know once your CLA has been received by Zend and you've been added to the developer group in Jira.\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tjohns",
                        "name": "tjohns",
                        "displayName": "Trevor Johns",
                        "active": true
                    },
                    "created": "2009-08-31T15:17:52.000+0000",
                    "updated": "2009-08-31T15:17:52.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34949",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wlp1979",
                        "name": "wlp1979",
                        "displayName": "Lee Parker",
                        "active": true
                    },
                    "body": "My CLA has finally been received by Zend, and I am in the zf-framework-dev group.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wlp1979",
                        "name": "wlp1979",
                        "displayName": "Lee Parker",
                        "active": true
                    },
                    "created": "2009-09-28T11:17:01.000+0000",
                    "updated": "2009-09-28T11:17:01.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52330",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "body": "Bulk change of all issues last updated before 1st January 2010 as \"Won't Fix\".\r\n\r\nFeel free to re-open and provide a patch if you want to fix this issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "created": "2012-11-20T20:52:33.000+0000",
                    "updated": "2012-11-20T20:52:33.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7739\/transitions"
}