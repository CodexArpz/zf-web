{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1599",
    "key": "ZF-1599",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Output frontend with Sqlite backend bombs on setting automaticCleaningFactor to true"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1599\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-01-22T14:39:25.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                "name": "zendfw",
                "displayName": "Shekar Reddy",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-06-19T19:49:30.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-01-23T00:09:06.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Setting automaticCleaningFactor front-end option to true is bombing for Output frontend with Sqlite backend and only works on setting it to false: \n\nError: 2 \nText : sqlite_query() [function.sqlite-query ]: database schema has changed \nFile  : \\Library\\Zend\\Cache\\Backend\\Sqlite.php\nLine : 355 \n\nHere is a backtrace with class\/method names and line numbers:\n\nsqlite_query(\"Resource id #118\", \"DELETE FROM tag WHERE id IN (SELECT id FROM cache WHERE expire>0 AND expire<=1182199839)\")\n\nZend_Cache_Backend_Sqlite  _clean(\"old\", Array[0])  227\n\nZend_Cache_Backend_Sqlite  clean(\"old\", Array[0])  382 \n\nZend_Cache_Core  clean(\"old\")  320\n\nZend_Cache_Core  save( ... )    80\n\nZend_Cache_Frontend_Output  end()  1258 \n\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1599\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                "name": "fab",
                "displayName": "Fabien MARTY",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10090",
                    "id": 10090,
                    "description": "Release Candidate 2",
                    "name": "1.0.0 RC2",
                    "userReleaseDate": "08\/Jun\/07",
                    "archived": true,
                    "releaseDate": "2007-06-08",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10028",
                    "id": 10028,
                    "name": "Zend_Cache",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15337",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Assigning to Fabien.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-06-20T13:21:51.000+0000",
                    "updated": "2007-06-20T13:21:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15421",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "can you try to drop your database file and retry ?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2007-06-23T10:48:47.000+0000",
                    "updated": "2007-06-23T10:48:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15425",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "body": "I've tried dropping the db file and noticed it recreating the file but it gives the same error for the first page load (cache-miss). Subsequent page-loads (cache-hit) are fine without errors. Here is my setup:\n\n{code}\n$frontendOptions = array\n(\n   'caching' => true,\n   'lifeTime' => 7200,\n   'automaticCleaningFactor' => 1\n);\n\n\n$backendOptions = array\n(\n   'cacheDBCompletePath' => '\/temp\/Cache.db',\n   'automaticVacuumFactor'=> 1\n);\n\n\n$cache = Zend_Cache::factory( 'Output', 'Sqlite', $frontendOptions, $backendOptions );\n{code}\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "created": "2007-06-24T00:22:12.000+0000",
                    "updated": "2007-06-24T00:22:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15562",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "works well on my linux box :(",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2007-06-28T14:50:12.000+0000",
                    "updated": "2007-06-28T14:50:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15644",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "body": "I've traced more info as for this error:\n\n{code}\nText : sqlite_query() [function.sqlite-query]: database schema has changed \nFile : \\Library\\Zend\\Cache\\Backend\\Sqlite.php \nLine : 127 \n\n[sql] => SELECT content FROM cache WHERE id='desc' AND (expire=0 OR expire>1183357534)\n\n\n\n\nError: 2 \nText : sqlite_fetch_array() expects parameter 1 to be resource, {color:red}*strong*boolean*strong*{color} given \nFile : \\Library\\Zend\\Cache\\Backend\\Sqlite.php \nLine : 128 \n{code}\n\n\nThe front-end used is OUTPUT.\n\nHTH",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "created": "2007-07-02T01:45:48.000+0000",
                    "updated": "2007-07-02T01:45:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15645",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "body": "Oops! Wiki markup got messed up. Here it goes again:\n\nI've traced more info as for this error:\n\n{code}\nText : sqlite_query() [function.sqlite-query]: database schema has changed \nFile : \\Library\\Zend\\Cache\\Backend\\Sqlite.php \nLine : 127 \n\n[sql] => SELECT content FROM cache WHERE id='desc' AND (expire=0 OR expire>1183357534)\n\nError: 2 \nText : sqlite_fetch_array() expects parameter 1 to be resource, BOOLEAN given \nFile : \\Library\\Zend\\Cache\\Backend\\Sqlite.php \nLine : 128\n{code}\n\n\nThe front-end used is OUTPUT.\n\nHTH",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "created": "2007-07-02T01:48:16.000+0000",
                    "updated": "2007-07-02T01:48:16.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15659",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "can you try to set  'automaticVacuumFactor'=> 0, then drop your cache db, then retry your test ?\n\nthanks\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2007-07-02T15:51:27.000+0000",
                    "updated": "2007-07-02T15:51:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15930",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "body": "I set automatic_vacuum_factor to 0, dropped the database and ran the test. It gave me an error:\n\n   No such table: tag\n\nThen I refreshed the page - it went well. Then I cleared the cache and reset the automatic_vacuum_factor to 1 and re-ran the test. But the problem remains the same :(\n\nThanks!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "created": "2007-07-21T04:11:43.000+0000",
                    "updated": "2007-07-21T04:11:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15931",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "body": "You said it works well on your *nix box. Have you tried Output frontend? I'm getting the problem on first page-load when the cache is empty. Once the content is cached, it's fine on subsequent page-loads.\n\nTIA",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "created": "2007-07-21T04:14:47.000+0000",
                    "updated": "2007-07-21T04:14:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/16315",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "body": "Hi,\n\nI've re-tested it and found the exact same issue as reported before in Zend_Cache_Backend_Sqlite::_clean():\n\n{code}\n        if ($mode==Zend_Cache::CLEANING_MODE_OLD) {\n            $mktime = time();\n            $res1 = @sqlite_query($this->_db, \"DELETE FROM tag WHERE id IN (SELECT id FROM cache WHERE expire>0 AND expire<=$mktime)\");\n{code}\n\n\nWhile debugging, the script exits on the last line above where it tries to delete from tag table. Running the page in the browser gives the following error:\n\nsqlite_query() [function.sqlite-query]: database schema has changed \nFile: Library\\Zend\\Cache\\Backend\\Sqlite.php \nLine: 317\n\n        $result = @sqlite_query($this->_db, \"SELECT num FROM version\");\n\n\nExecuting  the above SQL statements on the Sqlite file run well without a problem. However, there are no errors on setting \"automatic_cleaning_factor\" to 0.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "created": "2007-08-15T23:27:39.000+0000",
                    "updated": "2007-08-15T23:27:39.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/17340",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "it seems that you have a sort of disconnection (parameter 1 is not a resource), I just commited in SVN something which may help (i don't know because I can't reproduce your problem)\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2007-10-23T14:53:29.000+0000",
                    "updated": "2007-10-23T14:53:29.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/17429",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "body": "After applying the SVN upate, I've noticed that I'm getting these errors randomly\/rarely even on pages that are NOT output-cached!:\n\n\n\"sqlite_query() [<a href='function.sqlite-query'>function.sqlite-query<\/a>]: database schema has changed\", \"\\Library\\Zend\\Cache\\Backend\\Sqlite.php\", \"364\", Array[3]\n\nsqlite_query(\"Resource id #114\", \"DELETE FROM tag WHERE id IN (SELECT id FROM cache WHERE expire>0 AND expire<=1193343468)\") 364  \\Library\\Zend\\Cache\\Backend\\Sqlite.php\n\nZend_Cache_Backend_Sqlite  _clean(\"old\", Array[0])  217 \\Library\\Zend\\Cache\\Backend\\Sqlite.php\n\nZend_Cache_Backend_Sqlite  clean(\"old\", Array[0])   337  \\Library\\Zend\\Cache\\Core.php\n\nZend_Cache_Core  clean(\"old\")                       272  \\Library\\Zend\\Cache\\Core.php\n\nZend_Cache->save(...)\n\n\nI work on XP, PHP 5.2.3, MySQL 5, Apache 2.0.5.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "created": "2007-11-07T00:47:28.000+0000",
                    "updated": "2007-11-07T00:47:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18388",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "This thread seems to say that it's a vacuum problem :\n\nhttp:\/\/www.mail-archive.com\/sqlite-users@sqlite.org\/msg04887.html\n\nCan you try to set (one time more) 'automaticVacuumFactor'=> 0 and try to reproduce the problem ?\n\n\n\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2008-01-17T18:09:35.000+0000",
                    "updated": "2008-01-17T18:09:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18437",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "probably fixed in SVN",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2008-01-22T14:39:25.000+0000",
                    "updated": "2008-01-22T14:39:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18453",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "body": "Hi,\n\nI'm currently traveling and shall try out the above and let you know by the end of this week when I get back to my win-box.\n\nRegards,\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "created": "2008-01-23T00:09:06.000+0000",
                    "updated": "2008-01-23T00:09:06.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1599\/transitions"
}