{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8116",
    "key": "ZF-8116",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Translate usage of the cache is inapropriate."
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8116\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/4",
                "name": "Incomplete"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-10-21T23:19:15.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jdaigle",
                "name": "jdaigle",
                "displayName": "Jonathan Daigle",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-10-21T15:45:33.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-10-21T23:19:19.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Zend_Translate_Adapter usage of the cache is inapropriate.\r\n\r\nThere is 2 distinct problem with it.\r\n\r\nA - The options are cached into the same key no matter what the options contains. So If you have different usage of the Zend_Translate, with different options, you will get a lot \"Zend_Cache_Core::save() \/ write_control : written and read data do not match\" in your logs. Also, their is is absolutely no point, in caching the options passed to the construcor.\r\n\r\nB - The translation files, are cached in the same key no matter what the options where used to open it. causing the same result as in a.\r\n\r\n\r\nHere is the patch we applied locally.\r\n--- Adapter.php\t(revision 10888)\r\n+++ Adapter.php\t(revision 10930)\r\n@@ -100,14 +100,6 @@\r\n      *\/\r\n     public function __construct($data, $locale = null, array $options = array())\r\n     {\r\n-        if (isset(self::$_cache)) {\r\n-            $id = 'Zend_Translate_' . $this->toString() . '_Options';\r\n-            $result = self::$_cache->load($id);\r\n-            if ($result) {\r\n-                $this->_options   = unserialize($result);\r\n-            }\r\n-        }\r\n-\r\n         if (($locale === \"auto\") or ($locale === null)) {\r\n             $this->_automatic = true;\r\n         } else {\r\n@@ -339,11 +331,6 @@\r\n \r\n         if ($this->_options['locale'] != $locale) {\r\n             $this->_options['locale'] = $locale;\r\n-\r\n-            if (isset(self::$_cache)) {\r\n-                $id = 'Zend_Translate_' . $this->toString() . '_Options';\r\n-                self::$_cache->save( serialize($this->_options), $id, array('Zend_Translate'));\r\n-            }\r\n         }\r\n \r\n         return $this;\r\n@@ -457,8 +444,9 @@\r\n \r\n         $read = true;\r\n         if (isset(self::$_cache)) {\r\n-            $id = 'Zend_Translate_' . md5(serialize($data)) . '_' . $this->toString();\r\n-            $result = self::$_cache->load($id);\r\n+            $ident = md5(serialize($data) . $locale . serialize($options));\r\n+            $cacheId = 'Zend_Translate_' . $ident . '_' . $this->toString();\r\n+            $result = self::$_cache->load($cacheId);\r\n             if ($result) {\r\n                 $temp = unserialize($result);\r\n                 $read = false;\r\n@@ -495,8 +483,7 @@\r\n         }\r\n \r\n         if (($read) and (isset(self::$_cache))) {\r\n-            $id = 'Zend_Translate_' . md5(serialize($data)) . '_' . $this->toString();\r\n-            self::$_cache->save( serialize($temp), $id, array('Zend_Translate'));\r\n+            self::$_cache->save( serialize($temp), $cacheId, array('Zend_Translate'));\r\n         }\r\n \r\n         return $this;\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8116\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10340",
                    "id": 10340,
                    "description": "Mini Release",
                    "name": "1.8.4",
                    "userReleaseDate": "23\/Jun\/09",
                    "archived": false,
                    "releaseDate": "2009-06-23",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10320",
                    "id": 10320,
                    "description": "Minor Release",
                    "name": "1.9.0",
                    "userReleaseDate": "31\/Jul\/09",
                    "archived": false,
                    "releaseDate": "2009-07-31",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10350",
                    "id": 10350,
                    "description": "Mini Release",
                    "name": "1.9.1",
                    "userReleaseDate": "11\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-11",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10361",
                    "id": 10361,
                    "description": "Mini Release",
                    "name": "1.9.2",
                    "userReleaseDate": "25\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-25",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10362",
                    "id": 10362,
                    "description": "Mini Release",
                    "name": "1.9.3",
                    "userReleaseDate": "22\/Sep\/09",
                    "archived": false,
                    "releaseDate": "2009-09-22",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10370",
                    "id": 10370,
                    "description": "Mini Release",
                    "name": "1.9.4",
                    "userReleaseDate": "13\/Oct\/09",
                    "archived": false,
                    "releaseDate": "2009-10-13",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10099",
                    "id": 10099,
                    "name": "Zend_Translate",
                    "description": "Provides translation functionality, based on standards such as TMX and Gettext.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35452",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Changing priority.\r\n\r\nA \"inapropiate\" behaviour which does not block the usage is not critical.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-10-21T22:58:51.000+0000",
                    "updated": "2009-10-21T22:58:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35453",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Changing from \"Patch\" to \"Bug\".\r\nThe patch can not be applied as is.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-10-21T23:11:34.000+0000",
                    "updated": "2009-10-21T23:11:34.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35454",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Closing as \"incomplete\".\r\n\r\nThe patch is based on ZF 1.6.\r\nSeveral of the mentioned code lines which are patched do not exist. Since the past 1.5 years several changes and new features have been added which would be broken by this patch.\r\n\r\nWhen you have a problem, then please try your code as first step with the actual release.\r\n\r\nIntegrating BC breaks is not allowed by patches.\r\n\r\nPatches should always be done based on the actual release and not based on 1.5 years old codebase.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-10-21T23:19:17.000+0000",
                    "updated": "2009-10-21T23:19:17.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8116\/transitions"
}