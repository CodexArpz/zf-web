{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2220",
    "key": "ZF-2220",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Db::factory not working with Zend_Config_Xml nor with Zend_Config_Ini"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2220\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10172",
                    "id": 10172,
                    "description": "Minor Release",
                    "name": "1.5.0",
                    "userReleaseDate": "17\/Mar\/08",
                    "archived": true,
                    "releaseDate": "2008-03-17",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-12-12T13:29:36.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alemadlei",
                "name": "alemadlei",
                "displayName": "Alejandro Madrigal Leiva",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-11-20T08:33:21.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-01-06T11:38:51.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I have the following code.\n            \n            \/\/$dbConfiguration = new Zend_Config_Xml(dirname(__FILE__) . '\/dbConfiguration.xml', 'production', true);\n            $dbConfiguration = new Zend_Config_Ini(dirname(__FILE__) . '\/dbConfiguration.ini', 'production', true);\n            \n            \/\/ Decrypts encrpyted configuration values.\n            $dbConfiguration->database->host        = self::decryptData( $dbConfiguration->database->host );\n            $dbConfiguration->database->name        = self::decryptData( $dbConfiguration->database->name );\n            $dbConfiguration->database->username    = self::decryptData( $dbConfiguration->database->username );\n            $dbConfiguration->database->password    = self::decryptData( $dbConfiguration->database->password );\n            \n            \/\/ Gets Adapter.\n            self::$_DataBaseSingleton = Zend_Db::factory($dbConfiguration);\n\nBut it does not seem to work.\nLooking at factory function, i see it has this:\n\n        \/*\n         * Convert Zend_Config argument to plain string\n         * adapter name and separate config object.\n         *\/\n        if ($adapter instanceof Zend_Config) {\n            if (isset($adapter->params)) {\n                $config = $adapter->toArray();\n            }elseif(isset($adapter->adapter)) {\n                $adapter = (string) $adapter->adapter;\n            } else {\n                $adapter = null;\n            }\n        }\n                      \nLooking at Zend Config, both for XML and INI, I didn't found this params object.\nAm I doing something wrong or is this a bug?\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/1",
                "name": "Blocker"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2220\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                "name": "darby",
                "displayName": "Darby Felton",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10130",
                    "id": 10130,
                    "description": "Mini Release",
                    "name": "1.0.2",
                    "userReleaseDate": "25\/Sep\/07",
                    "archived": true,
                    "releaseDate": "2007-09-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10012",
                    "id": 10012,
                    "name": "Zend_Db",
                    "description": "interfaces, APIs, and adapters for various third-party data stores",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/17871",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                        "name": "jordanryanmoore",
                        "displayName": "Jordan Ryan Moore",
                        "active": true
                    },
                    "body": "Zend_Db::factory() allows you to use the following two formats for Zend_Config_*:\n\n{code}\n...->adapter  = 'pdo_mysql';\n...->host     = 'localhost';\n...->dbname   = 'db_name';\n...->username = 'someuser';\n...->password = 'somepass';\n{code}\n\nor\n\n{code}\n...->adapter          = 'pdo_mysql';\n...->params->host     = 'localhost';\n...->params->dbname   = 'db_name';\n...->params->username = 'someuser';\n...->params->password = 'somepass';\n{code}\n\nFor one, it looks like you're not specifying an adapter.\n\nLet me know if this helps...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                        "name": "jordanryanmoore",
                        "displayName": "Jordan Ryan Moore",
                        "active": true
                    },
                    "created": "2007-12-12T12:44:02.000+0000",
                    "updated": "2007-12-12T12:44:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/17873",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Jordan's comment illustrates how to supply configuration data as a Zend_Config object. Resolving as not an issue. Please feel free to reopen with additional information (e.g., the relevant parts of the configuration file, exception messages) if this does not work for you.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-12-12T13:29:36.000+0000",
                    "updated": "2007-12-12T13:29:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18148",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ezameku",
                        "name": "ezameku",
                        "displayName": "Olivier Doucet",
                        "active": false
                    },
                    "body": "Bug confirmed !\nIt can be reproduced very easily : \n{code}\n$configSQL = new Zend_Config_Ini('sql.ini', 'master');\n$db = Zend_Db::factory($configSQL );\n{code}\n{code:title=sql.ini file}\n[master]\nadapter=\"pdo_mysql\"\nhost=\"localhost\"\nusername=\"me\"\npassword=\"myself\"\ndbname=\"mydb\"\n{code}\n\nException raised : \n*Uncaught exception 'Zend_Db_Adapter_Exception' with message 'Configuration array must have a key for 'dbname' that names the database instance'  in D:\\MyProject\\Zend\\Db\\Adapter\\Abstract.php:243*\n\na var_dump($config) in Zend\\Db\\Adapter\\Abstract.php:242 gives us : \n{code}\narray(0) { } \n{code}\n\nSo, we have to find out why $config is empty. Solution is in Zend\/Db.php:192\n\n{code}\nif ($adapter instanceof Zend_Config) {\n            if (isset($adapter->params)) {\n                $config = $adapter->params->toArray();\n            }\n...\n{code}\n$adapter->params is not set for Zend_Config_Ini objects. My advice is to add an else like this : \n{code}\nif ($adapter instanceof Zend_Config) {\n            if (isset($adapter->params)) {\n                $config = $adapter->params->toArray();\n            } else {\n               $config = $adapter->toArray();\n           }\n           [...]\n}\n{code}\n\nThis patch is working for me.\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ezameku",
                        "name": "ezameku",
                        "displayName": "Olivier Doucet",
                        "active": false
                    },
                    "created": "2008-01-02T18:27:04.000+0000",
                    "updated": "2008-01-02T18:27:04.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18152",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Pasting the example from the documentation:\n\n{code}\n<?php\nrequire_once 'Zend\/Config.php';\nrequire_once 'Zend\/Db.php';\n\n$config = new Zend_Config(\n    array(\n        'database' => array(\n            'adapter' => 'Mysqli',\n            'params' => array(\n                'dbname' => 'test',\n                'username' => 'webuser',\n                'password' => 'secret',\n            )\n        )\n    )\n);\n\n$db = Zend_Db::factory($config->database);\n));\n{code}\n\nTranslating this to ini format would result in:\n\n{noformat}\n[someSection]\ndatabase.adapter = \"Mysqli\"\ndatabase.params.dbname = \"test\"\ndatabase.params.username = \"webuser\"\ndatabase.params.password = \"secret\"\n{noformat}\n\nAnd you would pass {{$config->database}} to the {{Zend_Db::factory()}}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2008-01-03T07:05:01.000+0000",
                    "updated": "2008-01-03T07:05:01.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18153",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alemadlei",
                        "name": "alemadlei",
                        "displayName": "Alejandro Madrigal Leiva",
                        "active": true
                    },
                    "body": "Ok, so that would mean that docs for Zend_Config_Ini and Zend_Config_XML have errors.\n\nI created both the XML file and the INI file based on these examples:\n\nhttp:\/\/framework.zend.com\/manual\/en\/zend.config.adapters.xml.htm\n\n\n<?xml version=\"1.0\"?>\n<configdata>\n    <production>\n        <webhost>www.example.com<\/webhost>\n        <database>\n            <type>pdo_mysql<\/type>\n            <host>db.example.com<\/host>\n            <username>dbuser<\/username>\n            <password>secret<\/password>\n            <name>dbname<\/name>\n        <\/database>\n    <\/production>\n    <staging extends=\"production\">\n        <database>\n            <host>dev.example.com<\/host>\n            <username>devuser<\/username>\n            <password>devsecret<\/password>\n        <\/database>\n    <\/staging>\n<\/configdata>\n\n\nhttp:\/\/framework.zend.com\/manual\/en\/zend.config.adapters.ini.html\n\n\n[production]\nwebhost           = www.example.com\ndatabase.type     = pdo_mysql\ndatabase.host     = db.example.com\ndatabase.username = dbuser\ndatabase.password = secret\ndatabase.name     = dbname\n\n; Staging site configuration data inherits from production and\n; overrides values as necessary\n[staging : production]\ndatabase.host     = dev.example.com\ndatabase.username = devuser\ndatabase.password = devsecret\n\nAnd as you can see, they dont have the \"params\" attribute ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alemadlei",
                        "name": "alemadlei",
                        "displayName": "Alejandro Madrigal Leiva",
                        "active": true
                    },
                    "created": "2008-01-03T08:24:18.000+0000",
                    "updated": "2008-01-03T08:24:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18154",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Well, I wouldn't say that these examples are errors, since they do not show interaction with Zend_Db, but I do think they are misleading. I'll update the docs shortly to avoid the confusion. :)\n\nThanks for the report!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2008-01-03T08:43:14.000+0000",
                    "updated": "2008-01-03T08:43:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18155",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alemadlei",
                        "name": "alemadlei",
                        "displayName": "Alejandro Madrigal Leiva",
                        "active": true
                    },
                    "body": "Thanks",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alemadlei",
                        "name": "alemadlei",
                        "displayName": "Alejandro Madrigal Leiva",
                        "active": true
                    },
                    "created": "2008-01-03T09:06:21.000+0000",
                    "updated": "2008-01-03T09:06:21.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37439",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fozzyuw",
                        "name": "fozzyuw",
                        "displayName": "John Bertucci",
                        "active": true
                    },
                    "body": "{quote}Zend_Db::factory() allows you to use the following two formats for Zend_Config_*:\r\n...->adapter  = 'pdo_mysql';\r\n...->host     = 'localhost';\r\n...->dbname   = 'db_name';\r\n...->username = 'someuser';\r\n...->password = 'somepass';{quote}\r\n\r\nThis comment is not true.  Having a similar issue and working through the source code for Zend\/Db.php, it shows the only acceptable format is:\r\n\r\n{quote}adapter = '';\r\nparams.host = '';\r\nparams.dbname = '';\r\nparams.username = '';\r\nparams.password = '';{quote}\r\nNot including \"params\" for the other parameters (other than adapter) will have the entire array replaced by the name of the adapter.\r\n\r\nThis can be seen in the source file:\r\n    Zend\/Db.php line 209",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fozzyuw",
                        "name": "fozzyuw",
                        "displayName": "John Bertucci",
                        "active": true
                    },
                    "created": "2010-01-06T11:38:51.000+0000",
                    "updated": "2010-01-06T11:38:51.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2220\/transitions"
}