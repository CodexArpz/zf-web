{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7519",
    "key": "ZF-7519",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "WARNING gets risen in Zend_Search_Lucene_Document_Html when using $query->highlightMatches() with Highlighter_Default"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7519\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=corvuscorax",
                "name": "corvuscorax",
                "displayName": "Corvus Corax",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-08-07T10:32:34.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-21T08:12:49.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "array",
                "empty",
                "highlight",
                "lucene",
                "warning"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "After searching a big index with a *xxx* search term (xxx standing for any short and common phrase), and calling $query->highlightMatches() on all the strings stored in the result,\n\nI sometimes got WARNINGs caused by\nclass Zend_Search_Lucene_Document_Html\nline 400:\n$wordsToHighlight = call_user_func_array('array_merge', $wordsToHighlightList);\n\nbecause $wordsToHighlightList() was an empty array.\n\nWriting a custom highlighter extending Zend_Search_Lucene_Search_Highlighter_Default I was able towork around this by not calling\n\n$this->_doc->highlight($words, $color);\n\nif $words as an empty array to begin with\n\nI have not found out when and why \nZend_Search_Lucene_Search_Highlighter::highlight() was called with an empty array as parameter. when using the $query->highlightMatches() function.\n\nI do think this indicates a problem deeper down.\n\nHowever Zend_Search_Lucene_Search_Highlighter_Default() should probably catch that case and\/or\nZend_Search_Lucene_Document_Html::highlightMatches() should.\n\nI had this problem with 1.8.2. however the code differences between 1.8.2and 1.9 are superficial and mostly deal with handling binary access to index files on disk, so I do belief all later versions are affected, too.\n\nI also encountered extreme performance issues using $query->highlightMatches() (as in 30 seconds to highlight matches in around 100 words, using a 28k document index and roughly 100k terms in the index, doubling the search time.)\n\nResult highlighting also seems to have issues if there are multi byte characters in the source. (highlighted areas are offset by the amount of multibyte characters prior to that position)\n\nI finally fixed the issue for me by not using $highlightMatches , but writing my own highlighting routine based on $query->rewrite()->optimize()->->getQueryTerms() and comparing them to\ntokens from $analyzer->tokenize(\"to be highlighted result text\") ... ->getTermtext() which i then can trace to source string positions.\n\nIts way more performant than $query->highlightMatches(), produces more accurate results, doesnt cause the above bug, and works with non HTML source.\n\n\n\nImportant info:\n\nI had used an analyzer that stored multiple tokens for the same position in source string (synonyme indexer)\nI assume the original bug was caused by more than one of the indexed tokens for the same word in tobehighlighted \/ originally indexed text matched the search pattern. But that's a wild guess.\n\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7519\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/4",
                "name": "Reopened"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-7736",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7736",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-6574",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6574",
                    "type": {
                        "name": "Duplicate",
                        "direction": "OUTBOUND",
                        "description": "duplicates"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12183",
                    "filename": "HtmlHighlightSavetyCheck.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=corvuscorax",
                        "name": "corvuscorax",
                        "displayName": "Corvus Corax",
                        "active": true
                    },
                    "created": "2009-09-02T07:11:04.000+0000",
                    "size": 533,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12183\/HtmlHighlightSavetyCheck.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10330",
                    "id": 10330,
                    "description": "Mini Release",
                    "name": "1.8.2",
                    "userReleaseDate": "27\/May\/09",
                    "archived": false,
                    "releaseDate": "2009-05-27",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10021",
                    "id": 10021,
                    "name": "Zend_Search_Lucene",
                    "description": "pure PHP robust, general purpose text search engine",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33290",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=corvuscorax",
                        "name": "corvuscorax",
                        "displayName": "Corvus Corax",
                        "active": true
                    },
                    "body": "the *xxx* is supposed to be <star>xxx<star> as  in lucene query languag.\nunfortunately this bug tracker software made that bold\n\"*xxx*\"",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=corvuscorax",
                        "name": "corvuscorax",
                        "displayName": "Corvus Corax",
                        "active": true
                    },
                    "created": "2009-08-07T10:33:56.000+0000",
                    "updated": "2009-08-07T10:33:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34175",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=corvuscorax",
                        "name": "corvuscorax",
                        "displayName": "Corvus Corax",
                        "active": true
                    },
                    "body": "patch ZF-7736 should fix this issue, since the highlighter will always be called with non-empty arguments.\n\nHowever it might still be good practice to catch the case of an empty argument in the highlighter itself.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=corvuscorax",
                        "name": "corvuscorax",
                        "displayName": "Corvus Corax",
                        "active": true
                    },
                    "created": "2009-09-02T06:22:35.000+0000",
                    "updated": "2009-09-02T06:22:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34181",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=corvuscorax",
                        "name": "corvuscorax",
                        "displayName": "Corvus Corax",
                        "active": true
                    },
                    "body": "This patch should make the highlight function safe, it checks for emptyness before giving it to user_func_array('array_merge')...\n\nI wonder - what purpose has this specific construct anyway? Why use call_user-func_array?\n\nCould any code comments shed some light on that?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=corvuscorax",
                        "name": "corvuscorax",
                        "displayName": "Corvus Corax",
                        "active": true
                    },
                    "created": "2009-09-02T07:11:06.000+0000",
                    "updated": "2009-09-02T07:11:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52508",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "body": "Bulk change of all issues last updated before 1st January 2010 as \"Won't Fix\".\r\n\r\nFeel free to re-open and provide a patch if you want to fix this issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "created": "2012-11-20T20:52:56.000+0000",
                    "updated": "2012-11-20T20:52:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52918",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=corvuscorax",
                        "name": "corvuscorax",
                        "displayName": "Corvus Corax",
                        "active": true
                    },
                    "body": "Bug has been closed by default in \"Bulk change\". However patch is already attached to bug, what has been missing is a maintainer",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=corvuscorax",
                        "name": "corvuscorax",
                        "displayName": "Corvus Corax",
                        "active": true
                    },
                    "created": "2012-11-21T08:12:49.000+0000",
                    "updated": "2012-11-21T08:12:49.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7519\/transitions"
}