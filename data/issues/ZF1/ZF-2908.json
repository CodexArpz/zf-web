{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2908",
    "key": "ZF-2908",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "ZF 1.5 no longer auto detecting browser language"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2908\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10174",
                    "id": 10174,
                    "description": "Mini Release",
                    "name": "1.5.1",
                    "userReleaseDate": "25\/Mar\/08",
                    "archived": true,
                    "releaseDate": "2008-03-25",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-03-18T08:44:13.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rcastley",
                "name": "rcastley",
                "displayName": "Robert Castley",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-03-18T07:16:45.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-03-21T17:09:03.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "In ZF 1.0.4 I have the following code, it successfully detects browser language setting and applies the translation and will downgrade through the list of languages the browser sends.  Since upgrading to ZF 1.5 this no longer works and always returns the last language loaded (in my case Spanish!) even though the browser is set to en.\n\n{code}\n    public function preDispatch(Zend_Controller_Request_Abstract $request)\n    {\n        $browserLocale = new Zend_Locale(Zend_Locale::BROWSER);\n        Zend_Registry::set('browserLocale', $browserLocale->__toString());\n        setcookie('lang', $browserLocale->__toString(), null, '\/');\n\n        $config = Zend_Registry::get('config');\n\n        $translate = new Zend_Translate(\"csv\", \"languages\" . DS . \"en\" . DS . \"lang.en\", \"en\");\n\n        if (!empty($config->languages->lang)) {\n            foreach ($config->languages->lang as $lang) {\n                $translate->addTranslation(\"languages\" . DS . $lang . DS . \"lang.\" . $lang, $lang);\n            }\n        }\n\n        if ($translate->isAvailable($browserLocale->__toString())) {\n            \/\/Zend_Registry::get('logger')->info(\"Setting language to \" . $browserLocale);\n            $locale = substr($browserLocale->__toString(), 0, 2);\n        } else {\n            \/\/Zend_Registry::get('logger')->info(\"Language \" . $browserLocale . \" not found downgrading to \" . $translate->getLocale());\n            $locale = substr($translate->getLocale(), 0, 2);\n        }\n\n        Zend_Registry::set('translate', $translate);\n        Zend_Registry::set('locale', $locale);\n    }\n{code}\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2908\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10172",
                    "id": 10172,
                    "description": "Minor Release",
                    "name": "1.5.0",
                    "userReleaseDate": "17\/Mar\/08",
                    "archived": true,
                    "releaseDate": "2008-03-17",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10099",
                    "id": 10099,
                    "name": "Zend_Translate",
                    "description": "Provides translation functionality, based on standards such as TMX and Gettext.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19976",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "With your code you set all languages manually. This is the reason why it does not work for you.\nThe settings of your browser are ignored.\n\nYou have eighter to use \"browser\" or \"auto\" as locale to use the browser settings.\n\nAlso instead of adding each languages manually it is better to have this done automatically.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-03-18T08:40:45.000+0000",
                    "updated": "2008-03-18T08:40:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19977",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "* locale \"browser\" for detecting browser locale\n* use directory or file search to get rid of the multiple adding a single file and setting always a new language within there\n* or use setLocale to set the wished locale\n\nall mentioned points are stated in the manual, just take a look",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-03-18T08:44:13.000+0000",
                    "updated": "2008-03-18T08:44:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19988",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rcastley",
                        "name": "rcastley",
                        "displayName": "Robert Castley",
                        "active": true
                    },
                    "body": "I have made the suggested changes to my code.  I know have:\n\n{code}\npublic function preDispatch(Zend_Controller_Request_Abstract $request)\n    {\n      $locale = new Zend_Locale();\n      $translate = new Zend_Translate('csv', 'languages', 'browser', array('scan'=>Zend_Translate::LOCALE_DIRECTORY));\n      $translate->setLocale('browser');\n     Zend_Registry::set('Zend_Translate', $translate);\n{code}\n\nIf I don't use $translate->setLocale('browser'); it seems to display the values of the last language file loaded.\n\nA couple of things to note:\n\n1) My language files are stored like so:\n{code}\nlanguages\n  -->en\n    -->lang.en\n  -->de\n    -->lang.de\n  -->fr\n    -->lang.fr\netc.\n{code}\n\n2) If I set my browser to e.g. Cambodian(km) I will only see messageIds in my view.  How do I get this to default or downgrade to English.  In 1.0.4 using the addTranslation it use to downgrade through the available languages sent by the browser i.e. if I had km -> es -> en in my list it would display English.\n\nAlso, Zend_Translate is not available Zend_View_Helper_MyHelper via $this->translate, I get an undefined method.  The docs seem to say that you can use $this->translate in helpers as long as you store $translate in the registry key Zend_Translate which I have done.  $this->translate is available in script views i.e. index.phtml.\n\nSorry to be a pain!\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rcastley",
                        "name": "rcastley",
                        "displayName": "Robert Castley",
                        "active": true
                    },
                    "created": "2008-03-18T18:11:38.000+0000",
                    "updated": "2008-03-18T18:11:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19991",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Zend_Locale recognises the locale \"browser\"...\n\nZend_Translate does only recognise the \"auto\" locale which includes the \"browser\" locale.\nIf you use \"auto\" then you do not need to set the locale afterwards... \"auto\" is also described in the manual for Zend_Translate.\n\nAs you can see by your structure you could also use search by filename as you have the locale present in it.\n\nRelated to \"km\"... of course... actually Zend_Translate is not able to do rerouting. There is a own issue for this improvement and this is no bug but an improvement. Actually you can do this manually by existing methods.\nSee getList()... it returns all languages... you could then do an array_key_exists BUT you can not do this per message. And also your code is wrong in this case.\nWhen you have \"fr\" for example but only half of all strings translated also your code would not work !!!\nThis is where the other issue comes in.\n\nRelated to Zend_View_Helper_MyHelper... this is not a failure from Zend_Translate... you should ask in the mailinglist as this is not an issue but a question of proper handling. And no you can not use it in \"helpers\" but in the view... you can use view helper in the view and not view helpers in other view helpers. Please ask in the mailinglist for the exact handling.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-03-19T06:45:19.000+0000",
                    "updated": "2008-03-19T06:45:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19993",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rcastley",
                        "name": "rcastley",
                        "displayName": "Robert Castley",
                        "active": true
                    },
                    "body": "Many thanks for taking the time to respond, I really appreciate it.  Off to the mailing lists I go :-)\n\nAll the best!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rcastley",
                        "name": "rcastley",
                        "displayName": "Robert Castley",
                        "active": true
                    },
                    "created": "2008-03-19T07:17:12.000+0000",
                    "updated": "2008-03-19T07:17:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/20132",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "I'm assuming this fix is merged to the 1.5 release branch for release with 1.5.1. Please update JIRA if this is not the case.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-03-21T17:09:03.000+0000",
                    "updated": "2008-03-21T17:09:03.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2908\/transitions"
}