{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11641",
    "key": "ZF-11641",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Currency converts 1 to 10 EUR if LC_ALL is set to de_DE"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11641\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=breiti",
                "name": "breiti",
                "displayName": "Michael K\u00fchn",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-08-03T16:12:36.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-12-13T18:54:36.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "conversion",
                "currency",
                "locale",
                "locales",
                "setlocale",
                "view_helper",
                "viewhelpers"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Hi,\r\n\r\nI got the following Problem:\r\nIf i call $this->currency(1) in a View-Script, it returns: '10,00 \u20ac' (which is obviously wrong, expected: '1,00 \u20ac').\r\nIf i change the locale-settings (see below for more Information) to en_US, $this->currency(1) returns '1,00 $' (which is good but i dont need USD).\r\n\r\nIf i remove the follwing line:\r\nsetlocale(LC_ALL, $localeString);\r\nfrom my bootstrapping (pasted below), $this->currency(1) returns '1,00 \u20ac' and all is fine.\r\n\r\nThe static function normalize in Zend\/Locale\/Math.php seems to make the wrong conversion.\r\n\r\nMy setup:\r\n---\r\nphp-cgi --version\r\n*PHP 5.3.3*-7+squeeze3 with Suhosin-Patch (cgi-fcgi) (built: Jun 28 2011 08:20:54)\r\nCopyright (c) 1997-2009 The PHP Group\r\nZend Engine v2.3.0, Copyright (c) 1998-2010 Zend Technologies\r\n    with XCache v1.3.0, Copyright (c) 2005-2009, by mOo\r\n    with Xdebug v2.1.0, Copyright (c) 2002-2010, by Derick Rethans\r\n---\r\n\/usr\/sbin\/apache2 -v\r\nServer version: *Apache\/2.2*.16 (Debian)\r\nServer built:   Mar 22 2011 21:14:10\r\n---\r\nBrowser: Google Chrome 12.0.742.124\r\n---\r\nOS: Linux (Debian 6.0.2)\r\n---\r\nEnv-Settings:\r\nexport | grep -i lang\r\ndeclare -x GDM_LANG=\"de_DE.UTF-8\"\r\ndeclare -x LANG=\"de_DE.UTF-8\"\r\ndeclare -x LANGUAGE=\"\"\r\n---\r\nlocale-settings (in the bootstrapping of my application):\r\n$localeString = 'de_DE';\r\n*setlocale(LC_ALL, $localeString);*\r\nZend_Registry::set('Zend_Locale', new Zend_Locale($localeString));\r\nZend_Registry::set('Zend_Currency', new Zend_Currency($localeString));"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11641\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "View_Helper"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10880",
                    "id": 10880,
                    "description": "Mini Release",
                    "name": "1.11.9",
                    "userReleaseDate": "14\/Jul\/11",
                    "archived": false,
                    "releaseDate": "2011-07-14",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10071",
                    "id": 10071,
                    "name": "Zend_Currency",
                    "description": "Zend_Currency is a Class which handles all Currency related functions and is locale aware.",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10073",
                    "id": 10073,
                    "name": "Zend_Locale",
                    "description": "Zend_Locale is a basic wrapper for all I18N and L10N issues for the Zend Framework. It provides the userbasically with access to translation functionality. It can handle different source file types for translation.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50397",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexastro",
                        "name": "alexastro",
                        "displayName": "Aleksey Polishchuk",
                        "active": true
                    },
                    "body": "Hi, Michael K\u00fchn! \r\nI've found the solution how to fix the issue.\r\nsetlocale() must be called with LC_MESSAGES param \r\n\r\nsetlocale(LC_MESSAGES, $localeString);\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexastro",
                        "name": "alexastro",
                        "displayName": "Aleksey Polishchuk",
                        "active": true
                    },
                    "created": "2012-04-28T14:26:16.000+0000",
                    "updated": "2012-04-28T14:26:16.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52953",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=csimolka",
                        "name": "csimolka",
                        "displayName": "Christoph Simolka",
                        "active": true
                    },
                    "body": "Hi,\r\n\r\nthe problem is a combination of Zend_Locale_Math::round() and Zend_Locale_Math::normalize().\r\nZend_Locale_Math::round() adds a \".0\" to full integer values or rounds float values to the given precision.\r\nAfter this Zend_Locale_Math::normalize() gets called. With a locale setting that uses a \".\" as thousands sepecator, normalize() strips \".\"\r\n\r\nI could fix the Problem by checking the value in normalize():\r\n\r\n\tif (is_numeric($value)) {\r\n\t\treturn (int) $value;\r\n\t}\r\n\r\n\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=csimolka",
                        "name": "csimolka",
                        "displayName": "Christoph Simolka",
                        "active": true
                    },
                    "created": "2012-12-13T18:54:36.000+0000",
                    "updated": "2012-12-13T18:54:36.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11641\/transitions"
}