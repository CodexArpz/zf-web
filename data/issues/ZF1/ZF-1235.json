{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1235",
    "key": "ZF-1235",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Filter_StripTags needs support to allow html comments"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1235\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10100",
                    "id": 10100,
                    "description": "Release Candidate 3",
                    "name": "1.0.0 RC3",
                    "userReleaseDate": "23\/Jun\/07",
                    "archived": true,
                    "releaseDate": "2007-06-23",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-06-22T14:25:31.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=till",
                "name": "till",
                "displayName": "Till Klampaeckel",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-04-10T08:22:19.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-05T14:44:04.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Zend_Filter_StripTags needs support to allow html comments. Currently, the whitelist only accepts tags.\n\nInside the following string, the comments should be honoured:\n{code}\n'Hello world <!-- this is a comment -->'\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1235\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                "name": "darby",
                "displayName": "Darby Felton",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10070",
                    "id": 10070,
                    "description": "Beta Release; bug fixes",
                    "name": "0.9.2",
                    "userReleaseDate": "06\/Apr\/07",
                    "archived": true,
                    "releaseDate": "2007-04-06",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10013",
                    "id": 10013,
                    "name": "Zend_Filter",
                    "description": "methods for filtering data",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14089",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=falesh",
                        "name": "falesh",
                        "displayName": "John Baldock",
                        "active": true
                    },
                    "body": "I have an idea about how this could be done. First swap all comments in the value with a unique identifier for each comment. Then process the value as normal. Finally swap the unique identifiers back with the comments stored at the start. Following is the two code blocks needed, the first at the start, the second at the end:\n\n{code:PHP}\nif ($keepComments === true) {\n    \/\/ find comments\n    preg_match_all('\/<\\!--.*?-->\/ms' , (string) $value, $matches);\n    \/\/ remove duplicate comments from the array\n    $comments = array_unique($matches[0]);\n    \/\/ replace each comment with a unique identifier\n    foreach ($comments as $k => $v) {\n        $value = str_replace($v, \"ZFST$k\", $value);\n    }\n}\n\n\nif ($keepComments === true) {\n    \/\/ replace the comment identifiers with their associated comment\n    foreach ($comments as $k => $v) {\n        $dataFiltered = str_replace(\"ZFST$k\", $v, $dataFiltered);\n    }\n}\n{code}\n\nThis is the full methods code:\n\n{code:PHP}\npublic function filter($value, $keepComments = false)\n{\n    if ($keepComments === true) {\n        \/\/ find comments\n        preg_match_all('\/<\\!--.*?-->\/ms' , (string) $value, $matches);\n        \/\/ remove duplicate comments from the array\n        $comments = array_unique($matches[0]);\n        \/\/ replace each comment with a unique identifier\n        foreach ($comments as $k => $v) {\n            $value = str_replace($v, \"ZFST$k\", $value);\n        }\n    }\n    \n    \/\/ Initialize accumulator for filtered data\n    $dataFiltered = '';        \n    \/\/ Parse the input data iteratively as regular pre-tag text followed by a\n    \/\/ tag; either may be empty strings\n    preg_match_all('\/([^<]*)(<?[^>]*>?)\/s', (string) $value, $matches);\n    \/\/ Iterate over each set of matches\n    foreach ($matches[1] as $index => $preTag) {\n        \/\/ If the pre-tag text is non-empty, strip any \">\" characters from it\n        if (strlen($preTag)) {\n            $preTag = str_replace('>', '', $preTag);\n        }\n        \/\/ If a tag exists in this match, then filter the tag\n        $tag = $matches[2][$index];\n        if (strlen($tag)) {\n            $tagFiltered = $this->_filterTag($tag);\n        } else {\n            $tagFiltered = '';\n        }\n        \/\/ Add the filtered pre-tag text and filtered tag to the data buffer\n        $dataFiltered .= $preTag . $tagFiltered;\n    }\n    \n    if ($keepComments === true) {\n        \/\/ replace the comment identifiers with their associated comment\n        foreach ($comments as $k => $v) {\n            $dataFiltered = str_replace(\"ZFST$k\", $v, $dataFiltered);\n        }\n    }\n    \n    \/\/ Return the filtered data\n    return $dataFiltered;\n}\n{code}\n\nI tested the above with the following string:\n\n{code:xml} \n<br> test <p> text <\/p> with <!-- comments --> and <!-- hidd\n\nen <br> -->\n{code}\n\nThe output was:\n\n{code:xml} \n test  text  with <!-- comments --> and <!-- hidd\n\nen <br> -->\n{code}\n\n\nThe one issue I can see with this is if the value includes an identifier equal to that used to associate with the comments (ZFST + array key in the above example).\n\nHope this helps,\nJohn Baldock",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=falesh",
                        "name": "falesh",
                        "displayName": "John Baldock",
                        "active": true
                    },
                    "created": "2007-04-10T15:27:28.000+0000",
                    "updated": "2007-04-10T15:27:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14090",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=till",
                        "name": "till",
                        "displayName": "Till Klampaeckel",
                        "active": true
                    },
                    "body": "Hey John,\n\nI am doing pretty much the same - maybe a bit more straight forward towards my issue, yet I thought this should be added to the filter class (well not my cheap workaround, of course).\n\nThe string in question contains {{<!--more-->}} in my case since this is part of a wordpress-style function to allow people to add a \"teaser\" for their blog's homepage and \"extended blog entry\" when people click, \"read more\" into the same text field.\n\nAnyway...\n\n{code}\n$str = 'jksajsa sajsaj sakjsaksa jsa salksa j<!--more--> saksjakjsa js lkjsalk jsa whatever';\n$str = str_replace('<!--more-->', '__ZF_IGNORE__', $str);\n\/\/ do filter stuff\n$str = str_replace('__ZF_IGNORE__', '<!--more-->', $str);\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=till",
                        "name": "till",
                        "displayName": "Till Klampaeckel",
                        "active": true
                    },
                    "created": "2007-04-10T15:52:57.000+0000",
                    "updated": "2007-04-10T15:52:57.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14116",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Minor updates to summary and description.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-04-11T11:44:33.000+0000",
                    "updated": "2007-04-11T11:44:33.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15409",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Resolved with [SVN r5417|http:\/\/framework.zend.com\/fisheye\/changelog\/Zend_Framework\/?cs=5417]. Documentation update to follow.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-06-22T14:25:31.000+0000",
                    "updated": "2007-06-22T14:25:31.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1235\/transitions"
}