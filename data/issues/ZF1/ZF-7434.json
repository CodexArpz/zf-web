{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7434",
    "key": "ZF-7434",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Too many pages with empty content"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField",
            "value": {
                "timeoriginalestimate": 0,
                "timeestimate": 0
            }
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7434\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10580",
                    "id": 10580,
                    "description": "Mini Release",
                    "name": "1.11.6",
                    "userReleaseDate": "05\/May\/11",
                    "archived": false,
                    "releaseDate": "2011-05-05",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-02-17T19:54:46.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mastersurfer84",
                "name": "mastersurfer84",
                "displayName": "Master Surfer",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-07-31T10:39:29.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-04-10T19:03:53.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I use a Paginator with DBSelect for querying the database. See the following code:\r\n{code}\r\n\t\t$select = $this->db->select();\r\n\t\t$select->from(array(\"v\" => \"table\"), \r\n\t\t\t\t\t  array(\"DateDayFormat\" => new Zend_Db_Expr(\"DATE_FORMAT(v.FirstVisitTime, '%d.%m.%Y')\"),\r\n\t\t\t\t\t\t\t\"PageCalls\" => new Zend_Db_Expr(\"SUM(v.PageCalls)\"),\r\n\t\t\t\t\t\t\t))\r\n\t\t\t   ->group(\"DATE(v.FirstVisitTime)\")\r\n\t\t\t   ->order(\"DATE(v.FirstVisitTime) DESC\");\r\n\t\t$paginator = new Zend_Paginator(new Zend_Paginator_Adapter_DbSelect($select));\r\n\t\t$paginator->setItemCountPerPage(20);\r\n\t\t$paginator->setCurrentPageNumber($this->_getParam(\"page\", 1));\r\n\t\t$this->view->paginator = $paginator;\r\n{code}\r\n\r\nThe select should return 6.5 pages, but there are 42 pages. the 7th to the 42nd page are empty. \r\nthis problem occurs also with other selects, so it seems to be a bug - or did you change something, that would explain this strange behavior?"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7434\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                "name": "ramon",
                "displayName": "Ramon Henrique Ornelas",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10320",
                    "id": 10320,
                    "description": "Minor Release",
                    "name": "1.9.0",
                    "userReleaseDate": "31\/Jul\/09",
                    "archived": false,
                    "releaseDate": "2009-07-31",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10350",
                    "id": 10350,
                    "description": "Mini Release",
                    "name": "1.9.1",
                    "userReleaseDate": "11\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-11",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10361",
                    "id": 10361,
                    "description": "Mini Release",
                    "name": "1.9.2",
                    "userReleaseDate": "25\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-25",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10362",
                    "id": 10362,
                    "description": "Mini Release",
                    "name": "1.9.3",
                    "userReleaseDate": "22\/Sep\/09",
                    "archived": false,
                    "releaseDate": "2009-09-22",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10370",
                    "id": 10370,
                    "description": "Mini Release",
                    "name": "1.9.4",
                    "userReleaseDate": "13\/Oct\/09",
                    "archived": false,
                    "releaseDate": "2009-10-13",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10315",
                    "id": 10315,
                    "name": "Zend_Paginator",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33102",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "body": "Could you paste the result of this snippet?\n\n{code}\necho $paginator->getAdapter()->getCountSelect();\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "created": "2009-07-31T10:48:30.000+0000",
                    "updated": "2009-07-31T10:48:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33103",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mastersurfer84",
                        "name": "mastersurfer84",
                        "displayName": "Master Surfer",
                        "active": true
                    },
                    "body": "The Result is:\nSELECT COUNT(1) AS `zend_paginator_row_count` FROM `mvc_visitors` AS `v` ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mastersurfer84",
                        "name": "mastersurfer84",
                        "displayName": "Master Surfer",
                        "active": true
                    },
                    "created": "2009-07-31T10:51:54.000+0000",
                    "updated": "2009-07-31T10:51:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33106",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "body": "Could you try rewriting your code like the following snippet and see if it gives the expected result? Could you also echo the count select again with the following snippet?\n\n{code}\n$select = $this->db->select();\n$select->from(array(\"v\" => \"table\"), \n              array(\"DateDayFormat\" => new Zend_Db_Expr(\"DATE_FORMAT(v.FirstVisitTime, '%d.%m.%Y')\"),\n                    \"PageCalls\" => new Zend_Db_Expr(\"SUM(v.PageCalls)\"),\n                    ))\n       ->group(new Zend_Db_Expr(\"DATE(v.FirstVisitTime)\"))\n       ->order(new Zend_Db_Expr(\"DATE(v.FirstVisitTime) DESC\"));\n{code}\n\nMy guess is that the lack of Zend_Db_Expr is causing the problems. I'm going to see if this is something Zend_Paginator can do something about.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "created": "2009-07-31T11:17:43.000+0000",
                    "updated": "2009-07-31T11:17:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33108",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mastersurfer84",
                        "name": "mastersurfer84",
                        "displayName": "Master Surfer",
                        "active": true
                    },
                    "body": "so, i changes the group and order clauses as you wrote.\nunfortunately the result is the same.\nhere the count infos:\n\nthe count-select-string:\nstring(72) \"SELECT COUNT(1) AS `zend_paginator_row_count` FROM `mvc_visitors` AS `v`\"\n\nand the result of this query\narray(1) {\n  [0] => array(1) {\n    [\"zend_paginator_row_count\"] => string(3) \"839\"\n  }\n}\n\nthat is the same as the direct query in phpmyadmin. so the sql works correct (why shouldn't it ;-) )\n\nthis problem occoured first with 1.9 release. i think the aggregation in the sql is the problem, but in 1.8.x it worked all fine.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mastersurfer84",
                        "name": "mastersurfer84",
                        "displayName": "Master Surfer",
                        "active": true
                    },
                    "created": "2009-07-31T12:37:32.000+0000",
                    "updated": "2009-07-31T12:37:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36234",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "body": "Problem object Zend_Db_Expr in class Zend_Paginator_Adapter_DbSelect::getCountSelect()\r\nline 231\r\n{code}\r\n !($groupParts[0] instanceof Zend_Db_Expr)\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "created": "2009-11-19T21:34:40.000+0000",
                    "updated": "2009-11-19T21:34:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44449",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "body": "This problem only occur with one column in the group and when the same column is envolved by a Zend_Db_Expr().\r\n\r\nReproduced with:\r\n{code}\r\n$select->from('test', 'group')\r\n       ->group(new Zend_Db_Expr('group'));\r\n{code} \r\n\r\nFix in Zend_Paginator_Adapter_DbSelect in the line 232 condition current code\r\n{code}\r\n} else if (!empty($groupParts) && $groupParts[0] !== Zend_Db_Select::SQL_WILDCARD &&\r\n           !($groupParts[0] instanceof Zend_Db_Expr)) {\r\n               $groupPart = $db->quoteIdentifier($groupParts[0], true);\r\n}\r\n{code}\r\n\r\nChange to\r\n{code}\r\n} else if (!empty($groupParts)) {\r\n    $groupPart = $db->quoteIdentifier($groupParts[0], true);\r\n}\r\n{code}\r\n\r\nAlso was deleted the condition *$groupParts[0] !== Zend_Db_Select::SQL_WILDCARD* no makes sense group by * until because this already is a error of SQL.\r\n\r\nGrettings\r\nRamon",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "created": "2011-02-17T19:41:23.000+0000",
                    "updated": "2011-02-17T19:41:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44450",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "body": "I've added a fix for this issue in r23717 in trunk.\r\nPlease test your applications against this.\r\n\r\nIf this works for everyone, I will merge to 1.11.\r\n\r\nThanks since already\r\nRamon",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "created": "2011-02-17T19:53:43.000+0000",
                    "updated": "2011-02-17T19:53:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/45844",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "body": "Merged r23855 to release branch 1.11.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "created": "2011-04-10T19:03:53.000+0000",
                    "updated": "2011-04-10T19:03:53.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7434\/transitions"
}