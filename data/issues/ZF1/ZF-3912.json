{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3912",
    "key": "ZF-3912",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Incorrect encoding of 'subject' in Chinese e-mail, sent with Zend_Mail"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3912\/votes",
                "votes": 5,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/3",
                "name": "Duplicate"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-10-06T08:44:24.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jonathan_maron",
                "name": "jonathan_maron",
                "displayName": "Jonathan Maron",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-08-09T05:28:02.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-10-06T08:44:24.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "With the following code, I wish to send an e-mail with Chinese in the subject:\n\n{code}\/\/ ZendFramework-1.5.2\n\n$mail = new Zend_Mail('UTF-8');\n\n$mail->setFrom('info@example.org');\n$mail->addTo('sam@example.org');\n$mail->setSubject('\u673a\u5668\u89c6\u89c9\u7ec4\u4ef6\u751f\u4ea7\u5546');\n$mail->setBodyText('\u673a\u5668\u89c6\u89c9\u7ec4\u4ef6\u751f\u4ea7\u5546 \u673a\u5668\u89c6\u89c9\u7ec4\u4ef6\u751f\u4ea7\u5546');\n$mail->send();{code}\n\nHowever, the subject of the sent e-mail is garbled and displayed incorrectly in e-mail client (Thunderbird).\n\n{code}\"Subject: =?UTF-8?Q?=E6=9C=BA=E5=99=A8=E8=A7=86=E8=A7=89=E7=BB=84=E4=BB=B6=E7=94=9F=E4=BA=A7= =E5=95=86?=\"{code}\n\nSee full e-mail, which is sent, is below:\n\n{code}From - Sat Aug  9 14:17:45 2008\nX-Account-Key: account2\nX-UIDL: BNb\"!%58\"!UQ]!!J>'\"!\nX-Mozilla-Status: 0001\nX-Mozilla-Status2: 00000000\nReturn-Path: <xxx@xxx.org>\nX-Original-To: yyy@xxx.org\nDelivered-To: yyy@xxx.org\nReceived: from xxx.xxx.org (localhost [127.0.0.1])\n    by localhost (Postfix) with ESMTP id B6B67501847\n    for <yyy@xxx.org>; Sat,  9 Aug 2008 14:14:08 +0200 (CEST)\nTo: <yyy@xxx.org>\nSubject: =?UTF-8?Q?=E6=9C=BA=E5=99=A8=E8=A7=86=E8=A7=89=E7=BB=84=E4=BB=B6=E7=94=9F=E4=BA=A7= =E5=95=86?=\nFrom: \"\" <info@example.org>\nDate: Sat, 09 Aug 2008 14:27:55 +0200\nContent-Type: text\/plain; charset=\"UTF-8\"\nContent-Transfer-Encoding: quoted-printable\nContent-Disposition: inline\nMessage-Id: <20080809122755.C0CAB8C056@xxx.xxx.org>\n\n\n=E6=9C=BA=E5=99=A8=E8=A7=86=E8=A7=89=E7=BB=84=E4=BB=B6=E7=94=9F=E4=BA=A7=E5=\n=95=86 =E6=9C=BA=E5=99=A8=E8=A7=86=E8=A7=89=E7=BB=84=E4=BB=B6=E7=94=9F=E4=\n=BA=A7=E5=95=86{code}\n\nIt seems that the method Zend_Mail::_encodeHeader() is causing the problem. \n\nE-Mail with a Chinese subject is sent correctly, when the following code is used for the method:\n\n{code}protected function _encodeHeader($value)\n{\n    if (Zend_Mime::isPrintable($value)) {\n        return $value;\n    } else {\n        return '=?' . $this->_charset . '?B?' . base64_encode($value) . '?=';\n    }\n} {code}   \n\nJacky Chen posted this solution on Fri, 28 Dec 2007 17:21:26 -0800 at:\n\nhttp:\/\/www.mail-archive.com\/fw-general@lists.zend.com\/msg09005.html\n\nCan his version of Zend_Mail::_encodeHeader() be used to update the official version?\n\nIn the meantime, I am subclassing Zend_Mail, overloading Zend_Mail::_encodeHeader() with his version, as I need to send e-mail with Chinese subjects and *also* From and To addresses - Zend_Mail::_encodeHeader() is used in multiple methods.\n\nThank you for your kind consideration of this change.\n\nJonathan Maron\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/2",
                "name": "Critical"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3912\/watchers",
                "isWatching": false,
                "watchCount": 5
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nico",
                "name": "nico",
                "displayName": "Nico Edtinger",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-1950",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1950",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-2532",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2532",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-3641",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3641",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-3588",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3588",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-1945",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1945",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-1688",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1688",
                    "type": {
                        "name": "Duplicate",
                        "direction": "OUTBOUND",
                        "description": "duplicates"
                    }
                },
                {
                    "issueKey": "ZF-3865",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3865",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-2043",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2043",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11475",
                    "filename": "r10901.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tamole",
                        "name": "tamole",
                        "displayName": "Tomas Markauskas",
                        "active": true
                    },
                    "created": "2008-08-13T13:42:07.000+0000",
                    "size": 4438,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11475\/r10901.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10181",
                    "id": 10181,
                    "description": "Mini Release",
                    "name": " 1.5.2",
                    "userReleaseDate": "15\/May\/08",
                    "archived": true,
                    "releaseDate": "2008-05-15",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10018",
                    "id": 10018,
                    "name": "Zend_Mail",
                    "description": "high-level utility to build MIME-compliant messages and send using a mail transport adapter",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23417",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tamole",
                        "name": "tamole",
                        "displayName": "Tomas Markauskas",
                        "active": true
                    },
                    "body": "This solution would work only for short headers, because the RFC does not allow the encoded words in the headers to be longer than 75 characters. The string has to be split to avoid problems with multibyte characters and therefore has to be split between those characters. I had the same problem and now I have a solution which fixes it for utf-8 string (other charsets later).\n\nI will post a patch in the next few days. It should also close a few other tickets related to Zend_Mail\/Zend_Mime.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tamole",
                        "name": "tamole",
                        "displayName": "Tomas Markauskas",
                        "active": true
                    },
                    "created": "2008-08-09T15:05:34.000+0000",
                    "updated": "2008-08-09T15:05:34.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23418",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jonathan_maron",
                        "name": "jonathan_maron",
                        "displayName": "Jonathan Maron",
                        "active": true
                    },
                    "body": "Hello Thomas\n\nThank you very much for your prompt answer.\n\nI very much look forward to seeing your patch.\n\nWould it be possible for you to send me a copy already?\n\nTIA\n\nJonathan Maron",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jonathan_maron",
                        "name": "jonathan_maron",
                        "displayName": "Jonathan Maron",
                        "active": true
                    },
                    "created": "2008-08-09T21:58:05.000+0000",
                    "updated": "2008-08-09T21:58:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23483",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tamole",
                        "name": "tamole",
                        "displayName": "Tomas Markauskas",
                        "active": true
                    },
                    "body": "Patch for Zend_Mail\/Zend_Mime (@10901)\n\nThis fixes the described problem (and a few more).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tamole",
                        "name": "tamole",
                        "displayName": "Tomas Markauskas",
                        "active": true
                    },
                    "created": "2008-08-13T13:42:08.000+0000",
                    "updated": "2008-08-13T13:42:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23484",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tamole",
                        "name": "tamole",
                        "displayName": "Tomas Markauskas",
                        "active": true
                    },
                    "body": "What was the problem:\n\nFrom http:\/\/tools.ietf.org\/html\/rfc2047#section-2\n\n   An encoded-word may not be more than 75 characters long, including\n   charset, encoding, encoded-text, and delimiters.  If it is desirable\n   to encode more text than will fit in an encoded-word of 75\n   characters, multiple encoded-words (separated by CRLF SPACE) may be\n   used.\n\n   While there is no limit to the length of a multiple-line header\n   field, each line of a header field that contains one or more\n   encoded-words is limited to 76 characters.\n\n\nFrom http:\/\/tools.ietf.org\/html\/rfc2047#section-5\n\n   The 'encoded-text' in an 'encoded-word' must be self-contained;\n   'encoded-text' MUST NOT be continued from one 'encoded-word' to\n   another.  This implies that the 'encoded-text' portion of a \"B\"\n   'encoded-word' will be a multiple of 4 characters long; for a \"Q\"\n   'encoded-word', any \"=\" character that appears in the 'encoded-text'\n   portion will be followed by two hexadecimal characters.\n\n   Each 'encoded-word' MUST encode an integral number of octets.  The\n   'encoded-text' in each 'encoded-word' must be well-formed according\n   to the encoding specified; the 'encoded-text' may not be continued in\n   the next 'encoded-word'.  (For example, \"=?charset?Q?=?=\n   =?charset?Q?AB?=\" would be illegal, because the two hex digits \"AB\"\n   must follow the \"=\" in the same 'encoded-word'.)\n\n   Each 'encoded-word' MUST represent an integral number of characters.\n   A multi-octet character may not be split across adjacent 'encoded-\n   word's.\n\nThere is still one problem with my patch: the first line of the header will probably exceed the length of 76 characters because we don't count the length of the header name. Zend_Mime::encodeQuotedPrintableHeader should get the length of the header name, so it could reduce the length of the first \"encoded-word\". I haven't seen any cases where this would cause big problems, so I haven't resolved it.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tamole",
                        "name": "tamole",
                        "displayName": "Tomas Markauskas",
                        "active": true
                    },
                    "created": "2008-08-13T13:51:24.000+0000",
                    "updated": "2008-08-13T13:51:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23509",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tamole",
                        "name": "tamole",
                        "displayName": "Tomas Markauskas",
                        "active": true
                    },
                    "body": "It would probably fix these two issues too.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tamole",
                        "name": "tamole",
                        "displayName": "Tomas Markauskas",
                        "active": true
                    },
                    "created": "2008-08-16T04:57:15.000+0000",
                    "updated": "2008-08-16T04:57:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23903",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "Patch worked out fine for me. Thanks.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2008-09-02T01:47:12.000+0000",
                    "updated": "2008-09-02T01:47:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23909",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tamole",
                        "name": "tamole",
                        "displayName": "Tomas Markauskas",
                        "active": true
                    },
                    "body": "All these issues seem to be related.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tamole",
                        "name": "tamole",
                        "displayName": "Tomas Markauskas",
                        "active": true
                    },
                    "created": "2008-09-02T10:07:33.000+0000",
                    "updated": "2008-09-02T10:07:33.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24452",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tomas.fejfar@gmail.com",
                        "name": "tomas.fejfar@gmail.com",
                        "displayName": "Tom\u00e1\u0161 Fejfar",
                        "active": true
                    },
                    "body": "Someone should fix this, it's critical bug for everyone usin non-ascii charset...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tomas.fejfar@gmail.com",
                        "name": "tomas.fejfar@gmail.com",
                        "displayName": "Tom\u00e1\u0161 Fejfar",
                        "active": true
                    },
                    "created": "2008-09-11T10:24:54.000+0000",
                    "updated": "2008-09-11T10:24:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24560",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tamole",
                        "name": "tamole",
                        "displayName": "Tomas Markauskas",
                        "active": true
                    },
                    "body": "I would like to know if there's any need for other character sets than UTF-8.\nAnother option to deal with multibyte characters would be to convert all multibyte character sets to UTF-8 in encodeQuotedPrintableHeader (see attached patch).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tamole",
                        "name": "tamole",
                        "displayName": "Tomas Markauskas",
                        "active": true
                    },
                    "created": "2008-09-17T05:53:11.000+0000",
                    "updated": "2008-09-17T05:53:11.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3912\/transitions"
}