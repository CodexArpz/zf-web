{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10502",
    "key": "ZF-10502",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Unable to delete messages from the queue"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10502\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/5",
                "name": "Cannot Reproduce"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-10-20T06:27:28.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic",
                "name": "kinetic",
                "displayName": "Lucian Daia",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-09-29T08:18:32.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-10-20T06:27:28.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I'm trying to remove a message from a Windows Azure Queue. The message was retrieved using the getMessages method.\r\n\r\nWhen calling deleteMessage on the queue, with the queue name as the first parameter and the message instance as the second parameter, I get the following error:\r\n\r\nServer failed to authenticate the request. Make sure the value of Authorization\r\nheader is formed correctly including the signature.\r\nRequestId:47ca4b33-49d3-48a6-8dd8-c864fe96b6c7\r\nTime:2010-09-29T15:15:42.0857455Z\r\n\r\nEven if I try to delete the messsage right after retrieveing it, I still get the same error."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10502\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maartenba",
                "name": "maartenba",
                "displayName": "Maarten Balliauw",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10490",
                    "id": 10490,
                    "description": "Mini Release",
                    "name": "1.10.8",
                    "userReleaseDate": "25\/Aug\/10",
                    "archived": false,
                    "releaseDate": "2010-08-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10476",
                    "id": 10476,
                    "name": "Zend_Service_WindowsAzure",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42390",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic",
                        "name": "kinetic",
                        "displayName": "Lucian Daia",
                        "active": true
                    },
                    "body": "Important notice: the script works perfectly on the Development Storage and the data I provide is correct since I can put messages in the queue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic",
                        "name": "kinetic",
                        "displayName": "Lucian Daia",
                        "active": true
                    },
                    "created": "2010-09-29T08:59:15.000+0000",
                    "updated": "2010-09-29T08:59:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42397",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic",
                        "name": "kinetic",
                        "displayName": "Lucian Daia",
                        "active": true
                    },
                    "body": "Ok, I figured out the problem: the PopReceipt field is not url-encoded. You should apply the urlencode function to the PopReceipt function when calling the deleteMessage method. \r\n\r\nI have no way to contribute the patch, but it's trivial to fix. Please remember to fix this in the Windows Azure SDK library from Codeplex too.\r\n\r\nCheers!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic",
                        "name": "kinetic",
                        "displayName": "Lucian Daia",
                        "active": true
                    },
                    "created": "2010-09-29T15:03:31.000+0000",
                    "updated": "2010-09-29T15:03:31.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42398",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maartenba",
                        "name": "maartenba",
                        "displayName": "Maarten Balliauw",
                        "active": true
                    },
                    "body": "Thank you for the comment, I will fix this ASAP.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maartenba",
                        "name": "maartenba",
                        "displayName": "Maarten Balliauw",
                        "active": true
                    },
                    "created": "2010-09-30T01:11:26.000+0000",
                    "updated": "2010-09-30T01:11:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42399",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maartenba",
                        "name": "maartenba",
                        "displayName": "Maarten Balliauw",
                        "active": true
                    },
                    "body": "Strangeness here! I applied the fix and now I get the error message you posted. If I undo the fix, the error is not there... Investigating.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maartenba",
                        "name": "maartenba",
                        "displayName": "Maarten Balliauw",
                        "active": true
                    },
                    "created": "2010-09-30T01:22:34.000+0000",
                    "updated": "2010-09-30T01:22:34.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42400",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maartenba",
                        "name": "maartenba",
                        "displayName": "Maarten Balliauw",
                        "active": true
                    },
                    "body": "Can you reproduce the issue and print out the values of PopReceipt when the error occurs? I can not reproduce this on my storage account nor dev storage...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maartenba",
                        "name": "maartenba",
                        "displayName": "Maarten Balliauw",
                        "active": true
                    },
                    "created": "2010-09-30T01:27:12.000+0000",
                    "updated": "2010-09-30T01:27:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42401",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic",
                        "name": "kinetic",
                        "displayName": "Lucian Daia",
                        "active": true
                    },
                    "body": "I'll look into it myself. It seems to work now, but I can't really explain why. It also looks like those errors are being generated on the production environment from time to time, not always. Must investigate what PopReceipt the failed messages have and will get back with more details.\r\n\r\nThank you for replying so quickly!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic",
                        "name": "kinetic",
                        "displayName": "Lucian Daia",
                        "active": true
                    },
                    "created": "2010-09-30T03:13:08.000+0000",
                    "updated": "2010-09-30T03:13:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42403",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic",
                        "name": "kinetic",
                        "displayName": "Lucian Daia",
                        "active": true
                    },
                    "body": "Ok, here is what I found:\r\n\r\nIf there is one element in the queue, deleting it works perfectly (and the PopReceipt generated contains only letters and the = sign).\r\n\r\nIf I push two elements in the queue and then try to remove the first one (while still being invisible), I get an error that there is an error with the Authorization header. The PopReceipt generated looks like this: AgAAAAEAAAC+GAAAjULfSZtgywE= . \r\n\r\nAnd here is a fragment of the error returned by the REST service:  \r\n\"Server used following string to sign ... popreceipt:AgAAAAEAAAC GAAA\/eAwWJtgywE=\". Notice that the server returned the urldecoded version of the PopReceipt I sent. \r\n\r\nSo it looks like it all comes down to PopReceipts and characters inside them. I will also investigate this issue, but a little help is always welcome :)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic",
                        "name": "kinetic",
                        "displayName": "Lucian Daia",
                        "active": true
                    },
                    "created": "2010-09-30T05:44:57.000+0000",
                    "updated": "2010-09-30T05:44:57.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42423",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maartenba",
                        "name": "maartenba",
                        "displayName": "Maarten Balliauw",
                        "active": true
                    },
                    "body": "Did you manage to reproduce this consistently?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maartenba",
                        "name": "maartenba",
                        "displayName": "Maarten Balliauw",
                        "active": true
                    },
                    "created": "2010-10-04T09:39:38.000+0000",
                    "updated": "2010-10-04T09:39:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42424",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic",
                        "name": "kinetic",
                        "displayName": "Lucian Daia",
                        "active": true
                    },
                    "body": "Well I am not able to reproduce this consistently, but situations like that do pop up from time to time (Under 5%). Try adding hunderds of messages in the queue, one every 10 seconds and, at the other end, read a message every 15 seconds.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic",
                        "name": "kinetic",
                        "displayName": "Lucian Daia",
                        "active": true
                    },
                    "created": "2010-10-04T10:22:40.000+0000",
                    "updated": "2010-10-04T10:22:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42430",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maartenba",
                        "name": "maartenba",
                        "displayName": "Maarten Balliauw",
                        "active": true
                    },
                    "body": "Just a thought... Does the error occur if you do not do urlencode() on the popreceipt, but instead a character replace of \"+\" by \" \"? (just looking at the details you found)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maartenba",
                        "name": "maartenba",
                        "displayName": "Maarten Balliauw",
                        "active": true
                    },
                    "created": "2010-10-05T08:56:13.000+0000",
                    "updated": "2010-10-05T08:56:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42436",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic",
                        "name": "kinetic",
                        "displayName": "Lucian Daia",
                        "active": true
                    },
                    "body": "I might have a clue on what generated the problem. Can't really research now, but will get with details before the weekend.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic",
                        "name": "kinetic",
                        "displayName": "Lucian Daia",
                        "active": true
                    },
                    "created": "2010-10-06T11:04:45.000+0000",
                    "updated": "2010-10-06T11:04:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42528",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic1988",
                        "name": "kinetic1988",
                        "displayName": "Lucian Daia",
                        "active": true
                    },
                    "body": "I managed to get the error two more times, but in like several hundred calls. Here's a dump from my application's log:\r\n\r\n2010-10-12T12:47:42+03:00 ALERT (1): Error when deleting queue task with MessageId f2aa33dc-c0fa-4ca9-ae02-de7c9915b3a4 and PopReceipt AgAAAAEAAAApAAAAMR+GIPRpywE=: Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.\r\nRequestId:e646944f-d7ee-4799-a25d-a51765daea71\r\nTime:2010-10-12T09:47:52.9112435Z\r\n\r\nIt's no big deal for me, since the second attempt to delete this message apparently succeded (otherwise it would still be in the queue). \r\n\r\nAnd here's some other strange thing that probably helped trigger the chain of errors when I reported the bug:\r\n\r\n\/\/ $nextTask is actually just an instance of a Zend_Service_WindowsAzure_Storage_QueueMessage\r\n$nextTask = $queue->getNextTask();\r\nmessage   = $nextTask->MessageText; \/\/ message is an array, obtained by json unserializing the intial message text. Consider the initial message a serialization of something like messageText = array('numeric_value' => 2013);\r\n\r\nfor ($i = 0; $i < 1000; $i++) {\r\n \/\/ this will print something like <correct_value>,0,0,0.....\r\n echo sprintf('%d', $message['numeric_value']);\r\n}\r\n\r\nHOWEVER, if I just put this line of code:\r\n\r\n$numericValue = $message['numeric_value'];\r\n\r\nfor ($i = 0; $i < 1000; $i++) {\r\n \/\/ this will print the same value all over again, as it should\r\n echo sprintf('%d', $numericValue);\r\n}\r\n\r\nThis oddity seems to appear just for the Windows Azure component.\r\n\r\nAnd to answer your question: I tried replacing \"+\" by \" \" when the errors kept appearing and didn't change the situation too much.\r\n\r\nAs a conclusion: everthing seems to work fine now and I just encountered that error twice in a few thousand queue operations. The code I posted above might be the one that saved me OR maybe it's because I started using another queue.\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kinetic1988",
                        "name": "kinetic1988",
                        "displayName": "Lucian Daia",
                        "active": true
                    },
                    "created": "2010-10-15T17:26:29.000+0000",
                    "updated": "2010-10-15T17:26:29.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42600",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maartenba",
                        "name": "maartenba",
                        "displayName": "Maarten Balliauw",
                        "active": true
                    },
                    "body": "Going to close this issue then. Seems neither one of us can reproduce this consistently...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maartenba",
                        "name": "maartenba",
                        "displayName": "Maarten Balliauw",
                        "active": true
                    },
                    "created": "2010-10-20T06:27:07.000+0000",
                    "updated": "2010-10-20T06:27:07.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10502\/transitions"
}