{
    "expand": "html",
    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-833",
    "key": "ZF-833",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Request_Http does not work correctly if setBaseUrl is set"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-833\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/resolution\/5",
                "name": "Cannot Reproduce"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-04-02T13:51:07.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=sekundek",
                "name": "sekundek",
                "displayName": "Uros",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-01-31T09:05:06.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-05T14:43:43.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "If setBaseUrl is used with HTTP request and when you try to get page without baseUrl there is no match checking and stripping requested url.\n\nProblem is with if ($baseUrl === null)  and when baseUrl is set there is only trim executed insted of  also checking if baseUrl matches requestUrl\nIf setBaseUrl is not set, function automaticaly find correct baseUrl and check for any matches.\n\nIn documentation I found\n\n{quote}\nFor example, if you keep your index.php in a webserver subdirectory named \/projects\/myapp\/index.php, base URL (rewrite base) should be set to \/projects\/myapp. This string will then be stripped from the beginning of the path before calculating any route matches. This frees one from the necessity of prepending it to any of your routes. A route of 'user\/:username' will match URIs like http:\/\/localhost\/projects\/myapp\/user\/martel and http:\/\/example.com\/user\/martel.\"\n{quote}\n\nHere is patch for this to solve:\n\n{{\nIndex: Http.php\n\n===================================================================\n\n--- Http.php\t(revision 3109)\n\n+++ Http.php\t(working copy)\n\n@@ -416,38 +416,37 @@\n\n                     ++$index;\n                 } while (($last > $index) && (false !== ($pos = strpos($path, $baseUrl))) && (0 != $pos));\n             } \n+        }\n+        \/\/ Does the baseUrl have anything in common with the request_uri?\n+        $requestUri = $this->getRequestUri();\n \n-            \/\/ Does the baseUrl have anything in common with the request_uri?\n-            $requestUri = $this->getRequestUri();\n+        if (0 === strpos($requestUri, $baseUrl)) {\n+            \/\/ full $baseUrl matches\n+            $this->_baseUrl = $baseUrl;\n+            return $this;\n+        }\n \n-            if (0 === strpos($requestUri, $baseUrl)) {\n-                \/\/ full $baseUrl matches\n-                $this->_baseUrl = $baseUrl;\n-                return $this;\n-            }\n+        if (0 === strpos($requestUri, dirname($baseUrl))) {\n+            \/\/ directory portion of $baseUrl matches\n+            $this->_baseUrl = rtrim(dirname($baseUrl), '\/');\n+            return $this;\n+        }\n \n-            if (0 === strpos($requestUri, dirname($baseUrl))) {\n-                \/\/ directory portion of $baseUrl matches\n-                $this->_baseUrl = rtrim(dirname($baseUrl), '\/');\n-                return $this;\n-            }\n-\n-            if (!strpos($requestUri, basename($baseUrl))) {\n-                \/\/ no match whatsoever; set it blank\n-                $this->_baseUrl = '';\n-                return $this;\n-            }\n-             \n-            \/\/ If using mod_rewrite or ISAPI_Rewrite strip the script filename \n-            \/\/ out of baseUrl. $pos !== 0 makes sure it is not matching a value \n-            \/\/ from PATH_INFO or QUERY_STRING \n-            if ((strlen($requestUri) >= strlen($baseUrl))\n-                && ((false !== ($pos = strpos($requestUri, $baseUrl))) && ($pos !== 0))) \n-            { \n-                $baseUrl = substr($requestUri, 0, $pos + strlen($baseUrl));\n-            } \n-        } \n+        if (!strpos($requestUri, basename($baseUrl))) {\n+            \/\/ no match whatsoever; set it blank\n+            $this->_baseUrl = '';\n+            return $this;\n+        }\n          \n+        \/\/ If using mod_rewrite or ISAPI_Rewrite strip the script filename \n+        \/\/ out of baseUrl. $pos !== 0 makes sure it is not matching a value \n+        \/\/ from PATH_INFO or QUERY_STRING \n+        if ((strlen($requestUri) >= strlen($baseUrl))\n+            && ((false !== ($pos = strpos($requestUri, $baseUrl))) && ($pos !== 0))) \n+        { \n+            $baseUrl = substr($requestUri, 0, $pos + strlen($baseUrl));\n+        }  \n+         \n         $this->_baseUrl = rtrim($baseUrl, '\/'); \n         return $this;\n     } \n\n}}\n\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-833\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/version\/10020",
                    "id": 10020,
                    "description": "Preview Release; I18N, Acl, Auth, Session",
                    "name": "0.7.0",
                    "userReleaseDate": "18\/Jan\/07",
                    "archived": true,
                    "releaseDate": "2007-01-18",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/component\/10011",
                    "id": 10011,
                    "name": "Zend_Controller",
                    "description": "front controller, including router and dispatcher",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12705",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Please provide the following:\n1. A base URL that should be matched\n2. A sample URL that fails when that base URL is set\n\nThis will better enable me to:\n1. Write tests to ensure the issue is resolved\n2. Determine what exactly is being fixed \n\nThanks!",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2007-02-13T10:24:28.000+0000",
                    "updated": "2007-02-13T10:24:28.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/13878",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Cannot reproduce, and no response from OP for many months.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2007-04-02T13:51:07.000+0000",
                    "updated": "2007-04-02T13:51:07.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-833\/transitions"
}