{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8816",
    "key": "ZF-8816",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Plural translation returns only one letter"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8816\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10160",
                    "id": 10160,
                    "description": "Major Release",
                    "name": "Next Major Release",
                    "archived": false,
                    "released": false
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-09-03T07:46:48.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=joho",
                "name": "joho",
                "displayName": "Jone Hop",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-01-14T06:15:34.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-09-03T07:47:23.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "It returns only the letter at position {$rule} in the $plural[0] string.\r\nWe want it to return the string at index {$rule} in the $plural array.\r\n\r\nWe have to change [$plural[0]][$rule] to [$plural[$rule]] on line 566,567,580 and 581\r\n\r\n{code:title=Zend\/Translate\/Adapter.php (line 558-584)|borderStyle=solid}\r\n        $locale = (string) $locale;\r\n        if (isset($this->_translate[$locale][$messageId])) {\r\n            \/\/ return original translation\r\n            if ($plural === null) {\r\n                return $this->_translate[$locale][$messageId];\r\n            }\r\n\r\n            $rule = Zend_Translate_Plural::getPlural($number, $locale);\r\n            if (isset($this->_translate[$locale][$plural[$rule]])) { \/\/ was [$plural[0]][$rule]\r\n                return $this->_translate[$locale][$plural[$rule]]; \/\/ was [$plural[0]][$rule]\r\n            }\r\n        } else if (strlen($locale) != 2) {\r\n            \/\/ faster than creating a new locale and separate the leading part\r\n            $locale = substr($locale, 0, -strlen(strrchr($locale, '_')));\r\n\r\n            if (isset($this->_translate[$locale][$messageId])) {\r\n                \/\/ return regionless translation (en_US -> en)\r\n                if ($plural === null) {\r\n                    return $this->_translate[$locale][$messageId];\r\n                }\r\n\r\n                $rule = Zend_Translate_Plural::getPlural($number, $locale);\r\n                if (isset($this->_translate[$locale][$plural[$rule]])) { \/\/ was [$plural[0]][$rule]\r\n                    return $this->_translate[$locale][$plural[$rule]]; \/\/ was [$plural[0]][$rule]\r\n                }\r\n            }\r\n        }\r\n{code}\r\n\r\n{code:title=Example.php|borderStyle=solid}\r\n<?php \r\n\t$no = new Zend_Translate(\r\n\t\t'gettext',\r\n\t\tAPPLICATION_PATH.'\/configs\/no.mo',\r\n\t\t'no'\r\n\t);\r\n\t\r\n\t$en = new Zend_Translate(\r\n\t\t'gettext',\r\n\t\tAPPLICATION_PATH.'\/configs\/en.mo',\r\n\t\t'en'\r\n\t);\r\n\t\r\n\tfor ( $number=0; $number<=2; $number++ ){\r\n\t\techo 'no: ' . $number . ' ' . $no->translate(array(_('car'),_('cars'),$number)) .'<br \/>';\r\n\t\techo 'en: ' . $number . ' ' . $en->translate(array(_('car'),_('cars'),$number)) .'<br \/>';\r\n\t}\r\n?>\r\n{code}\r\n\r\n{code:title=result|borderStyle=solid}\r\nno: 0 i\r\nen: 0 a\r\nno: 1 b\r\nen: 1 c\r\nno: 2 i\r\nen: 2 a\r\n{code}\r\n\r\nThe gettext mo\/po files were generated with Poedit:\r\n\r\nthe \"no\" gettext file contains:\r\ncar => bil\r\ncars => biler\r\n\r\n\r\nthe \"en\" gettext file contains:\r\ncar => car\r\ncars => cars"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8816\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10320",
                    "id": 10320,
                    "description": "Minor Release",
                    "name": "1.9.0",
                    "userReleaseDate": "31\/Jul\/09",
                    "archived": false,
                    "releaseDate": "2009-07-31",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10350",
                    "id": 10350,
                    "description": "Mini Release",
                    "name": "1.9.1",
                    "userReleaseDate": "11\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-11",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10361",
                    "id": 10361,
                    "description": "Mini Release",
                    "name": "1.9.2",
                    "userReleaseDate": "25\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-25",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10362",
                    "id": 10362,
                    "description": "Mini Release",
                    "name": "1.9.3",
                    "userReleaseDate": "22\/Sep\/09",
                    "archived": false,
                    "releaseDate": "2009-09-22",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10370",
                    "id": 10370,
                    "description": "Mini Release",
                    "name": "1.9.4",
                    "userReleaseDate": "13\/Oct\/09",
                    "archived": false,
                    "releaseDate": "2009-10-13",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10380",
                    "id": 10380,
                    "description": "Mini Release",
                    "name": "1.9.5",
                    "userReleaseDate": "27\/Oct\/09",
                    "archived": false,
                    "releaseDate": "2009-10-27",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10390",
                    "id": 10390,
                    "description": "Mini Release",
                    "name": "1.9.6",
                    "userReleaseDate": "24\/Nov\/09",
                    "archived": false,
                    "releaseDate": "2009-11-24",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10400",
                    "id": 10400,
                    "description": "Mini Release",
                    "name": "1.9.7",
                    "userReleaseDate": "11\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-11",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10099",
                    "id": 10099,
                    "name": "Zend_Translate",
                    "description": "Provides translation functionality, based on standards such as TMX and Gettext.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37693",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Please give a reproducable example.\r\nWe will not change the core without knowing why.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-14T07:44:01.000+0000",
                    "updated": "2010-01-14T07:44:01.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37696",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=joho",
                        "name": "joho",
                        "displayName": "Jone Hop",
                        "active": true
                    },
                    "body": "Example appended to the description.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=joho",
                        "name": "joho",
                        "displayName": "Jone Hop",
                        "active": true
                    },
                    "created": "2010-01-14T09:06:13.000+0000",
                    "updated": "2010-01-14T09:06:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37701",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "I can not verify this behaviour\r\nSeems like your mo file is broken.\r\n\r\nYour change eliminates plural notation for gettext and makes singular working like plurals. But plurals are noted differently within the gettext standard than plurals. So your change breaks this feature for others.\r\n\r\nMaybe the po file you compiled the mo from is broken.\r\nSee the file \"\/Translate\/Adapter\/_files\/translation_en.mo\" which adds plurals for the message5.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-14T11:07:58.000+0000",
                    "updated": "2010-01-14T11:07:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37702",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "I just verified that you get this issue when the po\/mo file does not use plurals, but when you make multiple singulars and what them to be used as plural.\r\n\r\nThis does not work and there is no way to make it work.\r\nPlurals have to be defined within poEdit (or whatever program you use) explicitely. Otherwise the translations are simply added as singular.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-14T11:14:22.000+0000",
                    "updated": "2010-01-14T11:14:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37705",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Closing as non-issue\r\nFalse mo files can not be corrected. See description above.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-14T12:21:56.000+0000",
                    "updated": "2010-01-14T12:21:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48040",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=menno.dekker@erasmusmc.nl",
                        "name": "menno.dekker@erasmusmc.nl",
                        "displayName": "Menno Dekker",
                        "active": true
                    },
                    "body": "I encountered this issue. I will explain what happens:\r\nI have used regular translate on 'week' and 'weeks' so both are in my po\/mo file. Now I switched to plural, but poedit didn't pickup the plural (others that were not translated before are picked up!!). I know my PO file is missing the correct plural, but Zend doesn't see this and falsely returns just one letter (index) from the word it finds. The problem is in the isset check on line 764. When used on an array, it checks if the key exists, when used on a string (in my case) it will return the n'th char from the string. When my patch is applied, it will correctly be reported as missing.\r\n\r\nI don't know how to attach a diff here so I will just paste it for Zend\/Translate\/Adapter.php :\r\n{code:title=patch.diff}\r\nIndex: Adapter.php\r\n===================================================================\r\n--- Adapter.php\t(revision 24397)\r\n+++ Adapter.php\t(working copy)\r\n@@ -758,8 +758,9 @@\r\n             }\r\n \r\n             $rule = Zend_Translate_Plural::getPlural($number, $locale);\r\n-            if (isset($this->_translate[$locale][$plural[0]][$rule])) {\r\n+            if (is_array($this->_translate[$locale][$plural[0]]) && isset($this->_translate[$locale][$plural[0]][$rule])) {\r\n                 $this->_routed = array();\r\n+\r\n                 return $this->_translate[$locale][$plural[0]][$rule];\r\n             }\r\n         } else if (strlen($locale) != 2) {\r\n{code}\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=menno.dekker@erasmusmc.nl",
                        "name": "menno.dekker@erasmusmc.nl",
                        "displayName": "Menno Dekker",
                        "active": true
                    },
                    "created": "2011-08-22T08:44:44.000+0000",
                    "updated": "2011-08-22T08:44:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48314",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Fixed in ZF2 with [GH-368|https:\/\/github.com\/zendframework\/zf2\/pull\/368]",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2011-09-03T07:46:49.000+0000",
                    "updated": "2011-09-03T07:46:49.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8816\/transitions"
}