{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9624",
    "key": "ZF-9624",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Mail_Protocol_Imap::_decodeLine incorrectly parses some kind of strings"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9624\/votes",
                "votes": 2,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dominikgehl",
                "name": "dominikgehl",
                "displayName": "Dominik Gehl",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-04-06T10:55:08.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-06-11T19:13:06.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "{code}\r\n$imap->_decodeLine(\"1 FETCH (BODYSTRUCTURE ((\"TEXT\" \"PLAIN\" (\"CHARSET\" \"ISO-8859-1\") NIL NIL \"7BIT\" 1753 34 NIL NIL NIL)(\"TEXT\" \"HTML\" (\"CHARSET\" \"ISO-8859-1\") NIL NIL \"7BIT\" 2161 56 NIL NIL NIL) \"ALTERNATIVE\" (\"BOUNDARY\" \"00032557554a10c659047e4f6eb7\") NIL NIL))\") {code}\r\n\r\nreturns \r\n\r\n{code}\r\nArray\r\n(\r\n    [0] => Array\r\n        (\r\n            [0] => 1\r\n            [1] => FETCH\r\n            [2] => Array\r\n                (\r\n                    [0] => BODYSTRUCTURE\r\n                    [1] => Array\r\n                        (\r\n                            [0] => Array\r\n                                (\r\n                                    [0] => TEXT\r\n                                    [1] => PLAIN\r\n                                    [2] => Array\r\n                                        (\r\n                                            [0] => CHARSET\r\n                                            [1] => ISO-8859-1\r\n                                        )\r\n\r\n                                    [3] => NIL\r\n                                    [4] => NIL\r\n                                    [5] => 7BIT\r\n                                    [6] => 1753\r\n                                    [7] => 34\r\n                                    [8] => NIL\r\n                                    [9] => NIL\r\n                                    [10] => NIL)(\"TEXT\"\r\n                                    [11] => HTML\r\n                                    [12] => Array\r\n                                        (\r\n                                            [0] => CHARSET\r\n                                            [1] => ISO-8859-1\r\n                                        )\r\n\r\n                                    [13] => NIL\r\n                                    [14] => NIL\r\n                                    [15] => 7BIT\r\n                                    [16] => 2161\r\n                                    [17] => 56\r\n                                    [18] => NIL\r\n                                    [19] => NIL\r\n                                    [20] => NIL\r\n                                )\r\n\r\n                            [1] => ALTERNATIVE\r\n                            [2] => Array\r\n                                (\r\n                                    [0] => BOUNDARY\r\n                                    [1] => 00032557554a10c659047e4f6eb7\r\n                                )\r\n\r\n                            [3] => NIL\r\n                            [4] => NIL\r\n                        )\r\n\r\n                )\r\n\r\n        )\r\n\r\n)\r\n{code}\r\n\r\nThe issue is the NIL)(\"TEXT\" in the return array, i.e. a closing parenthesis immediately followed by an opening parenthesis doesn't seem to be correctly parsed."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9624\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nico",
                "name": "nico",
                "displayName": "Nico Edtinger",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10440",
                    "id": 10440,
                    "description": "Mini Release",
                    "name": "1.10.3",
                    "userReleaseDate": "01\/Apr\/10",
                    "archived": false,
                    "releaseDate": "2010-04-01",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10451",
                    "id": 10451,
                    "description": "Mini Release",
                    "name": "1.10.4",
                    "userReleaseDate": "28\/Apr\/10",
                    "archived": false,
                    "releaseDate": "2010-04-28",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10460",
                    "id": 10460,
                    "description": "Mini Release",
                    "name": "1.10.5",
                    "userReleaseDate": "26\/May\/10",
                    "archived": false,
                    "releaseDate": "2010-05-26",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10470",
                    "id": 10470,
                    "description": "Mini Release",
                    "name": "1.10.6",
                    "userReleaseDate": "22\/Jun\/10",
                    "archived": false,
                    "releaseDate": "2010-06-22",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10480",
                    "id": 10480,
                    "description": "Mini Release",
                    "name": "1.10.7",
                    "userReleaseDate": "28\/Jul\/10",
                    "archived": false,
                    "releaseDate": "2010-07-28",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10490",
                    "id": 10490,
                    "description": "Mini Release",
                    "name": "1.10.8",
                    "userReleaseDate": "25\/Aug\/10",
                    "archived": false,
                    "releaseDate": "2010-08-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10074",
                    "id": 10074,
                    "name": "Zend_Mail_Storage",
                    "description": "Facilitates reading mail from any of several common mail storage formats.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39855",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dominikgehl",
                        "name": "dominikgehl",
                        "displayName": "Dominik Gehl",
                        "active": true
                    },
                    "body": "The following quick patch fixes the problem:\r\n\r\n--- library\/Zend\/Mail\/Protocol\/Imap.php\t2010-01-05 21:05:09.000000000 -0500\r\n+++ Imap.php\t2010-04-06 14:55:07.000000000 -0400\r\n@@ -203,6 +203,11 @@\r\n         $line = rtrim($line) . ' ';\r\n         while (($pos = strpos($line, ' ')) !== false) {\r\n             $token = substr($line, 0, $pos);\r\n+            $closingPos = strpos($token,')(');\r\n+            if (($closingPos !== false) && ($token[0] != '\"')) {\r\n+                $pos = $pos - strlen($token) + $closingPos;\r\n+                $token = substr($line, 0, $pos+1);\r\n+            }\r\n             while ($token[0] == '(') {\r\n                 array_push($stack, $tokens);\r\n                 $tokens = array();\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dominikgehl",
                        "name": "dominikgehl",
                        "displayName": "Dominik Gehl",
                        "active": true
                    },
                    "created": "2010-04-06T11:59:04.000+0000",
                    "updated": "2010-04-06T11:59:04.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42394",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dominikgehl",
                        "name": "dominikgehl",
                        "displayName": "Dominik Gehl",
                        "active": true
                    },
                    "body": "patch against SVN checkout:\r\n\r\n\r\n--- library\/Zend\/Mail\/Protocol\/Imap.php\t(revision 23006)\r\n+++ library\/Zend\/Mail\/Protocol\/Imap.php\t(working copy)\r\n@@ -203,6 +203,11 @@\r\n         $line = rtrim($line) . ' ';\r\n         while (($pos = strpos($line, ' ')) !== false) {\r\n             $token = substr($line, 0, $pos);\r\n+            $closingPos = strpos($token,')(');\r\n+            if (($closingPos !== false) && ($token[0] != '\"')) {\r\n+                $pos = $pos - strlen($token) + $closingPos;\r\n+                $token = substr($line, 0, $pos+1);\r\n+            }\r\n             while ($token[0] == '(') {\r\n                 array_push($stack, $tokens);\r\n                 $tokens = array();\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dominikgehl",
                        "name": "dominikgehl",
                        "displayName": "Dominik Gehl",
                        "active": true
                    },
                    "created": "2010-09-29T12:00:23.000+0000",
                    "updated": "2010-09-29T12:00:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42396",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dominikgehl",
                        "name": "dominikgehl",
                        "displayName": "Dominik Gehl",
                        "active": true
                    },
                    "body": "With patch in place, the code in the ticket description returns\r\n{code}\r\nArray\r\n(\r\n    [0] => 1\r\n    [1] => FETCH\r\n    [2] => Array\r\n        (\r\n            [0] => BODYSTRUCTURE\r\n            [1] => Array\r\n                (\r\n                    [0] => Array\r\n                        (\r\n                            [0] => TEXT\r\n                            [1] => PLAIN\r\n                            [2] => Array\r\n                                (\r\n                                    [0] => CHARSET\r\n                                    [1] => ISO-8859-1\r\n                                )\r\n                            [3] => NIL\r\n                            [4] => NIL\r\n                            [5] => 7BIT\r\n                            [6] => 1753\r\n                            [7] => 34\r\n                            [8] => NIL\r\n                            [9] => NIL\r\n                            [10] => NIL\r\n                        )\r\n                    [1] => Array\r\n                        (\r\n                            [0] => TEXT\r\n                            [1] => HTML\r\n                            [2] => Array\r\n                                (\r\n                                    [0] => CHARSET\r\n                                    [1] => ISO-8859-1\r\n                                )\r\n                            [3] => NIL\r\n                            [4] => NIL\r\n                            [5] => 7BIT\r\n                            [6] => 2161\r\n                            [7] => 56\r\n                            [8] => NIL\r\n                            [9] => NIL\r\n                            [10] => NIL\r\n                        )\r\n                    [2] => ALTERNATIVE\r\n                    [3] => Array\r\n                        (\r\n                            [0] => BOUNDARY\r\n                            [1] => 00032557554a10c659047e4f6eb7\r\n                        )\r\n                    [4] => NIL\r\n                    [5] => NIL\r\n                )\r\n        )\r\n)\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dominikgehl",
                        "name": "dominikgehl",
                        "displayName": "Dominik Gehl",
                        "active": true
                    },
                    "created": "2010-09-29T12:03:17.000+0000",
                    "updated": "2010-09-29T12:03:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47379",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dominikgehl",
                        "name": "dominikgehl",
                        "displayName": "Dominik Gehl",
                        "active": true
                    },
                    "body": "{code:title=Zend_Mail_Protocol_TestAsset_Imap.php|borderStyle=solid}\r\n\r\n<?php\r\n\r\nrequire_once('Zend\/Mail\/Protocol\/Imap.php');\r\n\r\nclass Zend_Mail_Protocol_TestAsset_Imap extends Zend_Mail_Protocol_Imap \r\n{ \r\n\tprotected $proxy; \r\n\r\n\tpublic function __construct(Zend_Mail_Protocol_Imap $imap) \r\n\t{ \r\n\t\t$this->proxy = $imap; \r\n\t} \r\n\r\n\tpublic function _decodeLineOld($line) \r\n\t{ \r\n\t\treturn $this->proxy->_decodeLine($line);\r\n\t} \r\n\r\n\tpublic function _decodeLine($line) \r\n\t{ \r\n\t\t$tokens = array();\r\n\t\t$stack = array();\r\n\r\n\t\/*\r\n\t    We start to decode the response here. The unterstood tokens are:\r\n\t\tliteral\r\n\t\t\"literal\" or also \"lit\\\\er\\\"al\"\r\n\t\t{bytes}<NL>literal\r\n\t\t(literals*)\r\n\t    All tokens are returned in an array. Literals in braces (the last unterstood\r\n\t    token in the list) are returned as an array of tokens. I.e. the following response:\r\n\t\t\"foo\" baz {3}<NL>bar (\"f\\\\\\\"oo\" bar)\r\n\t    would be returned as:\r\n\t\tarray('foo', 'baz', 'bar', array('f\\\\\\\"oo', 'bar'));\r\n\r\n\t    \/\/ TODO: add handling of '[' and ']' to parser for easier handling of response text\r\n\t *\/\r\n\t\t\/\/  replace any trailling <NL> including spaces with a single space\r\n\t\t$line = rtrim($line) . ' ';\r\n\t\twhile (($pos = strpos($line, ' ')) !== false) {\r\n\t\t\t$token = substr($line, 0, $pos);\r\n\t\t\t$closingPos = strpos($token,')(');\r\n\t\t\tif (($closingPos !== false) && ($token[0] != '\"')) {\r\n\t\t\t\t$pos = $pos - strlen($token) + $closingPos;\r\n\t\t\t\t$token = substr($line, 0, $pos+1);\r\n\t\t\t}\r\n\t\t\twhile ((strlen($token) > 0) && ($token[0] == '(')) {\r\n\t\t\t\tarray_push($stack, $tokens);\r\n\t\t\t\t$tokens = array();\r\n\t\t\t\t$token = substr($token, 1);\r\n\t\t\t}\r\n\t\t\tif ((strlen($token) > 0) && ($token[0] == '\"')) {\r\n\t\t\t\t#Friedl's unrolled loop\r\n\t\t\t\tif (preg_match('%^\\(*\"([^\"\\\\\\\\]*(?:\\\\\\\\.[^\"\\\\\\\\]*)*)\" *%', $line, $matches)) {\r\n\t\t\t\t\t$tokens[] = $matches[1];\r\n\t\t\t\t\t$line = substr($line, strlen($matches[0]));\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ((strlen($token) > 0) && ($token[0] == '{')) {\r\n\t\t\t\t$endPos = strpos($token, '}');\r\n\t\t\t\t$chars = substr($token, 1, $endPos - 1);\r\n\t\t\t\tif (is_numeric($chars)) {\r\n\t\t\t\t\t$token = '';\r\n\t\t\t\t\twhile (strlen($token) < $chars) {\r\n\t\t\t\t\t\t$token .= $this->_nextLine();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$line = '';\r\n\t\t\t\t\tif (strlen($token) > $chars) {\r\n\t\t\t\t\t\t$line = substr($token, $chars);\r\n\t\t\t\t\t\t$token = substr($token, 0, $chars);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$line .= $this->_nextLine();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$tokens[] = $token;\r\n\t\t\t\t\t$line = trim($line) . ' ';\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ((strlen($token)>0) && $stack && $token[strlen($token) - 1] == ')') {\r\n\t\t\t\t\/\/ closing braces are not seperated by spaces, so we need to count them\r\n\t\t\t\t$braces = strlen($token);\r\n\t\t\t\t$token = rtrim($token, ')');\r\n\t\t\t\t\/\/ only count braces if more than one\r\n\t\t\t\t$braces -= strlen($token) + 1;\r\n\t\t\t\t\/\/ only add if token had more than just closing braces\r\n\t\t\t\tif (rtrim($token) != '') {\r\n\t\t\t\t\t$tokens[] = rtrim($token);\r\n\t\t\t\t}\r\n\t\t\t\t$token = $tokens;\r\n\t\t\t\t$tokens = array_pop($stack);\r\n\t\t\t\t\/\/ special handline if more than one closing brace\r\n\t\t\t\twhile ($braces-- > 0) {\r\n\t\t\t\t\t$tokens[] = $token;\r\n\t\t\t\t\t$token = $tokens;\r\n\t\t\t\t\t$tokens = array_pop($stack);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t$tokens[] = $token;\r\n\t\t\t$line = substr($line, $pos + 1);\r\n\t\t}\r\n\r\n\t\t\/\/ maybe the server forgot to send some closing braces\r\n\t\twhile ($stack) {\r\n\t\t\t$child = $tokens;\r\n\t\t\t$tokens = array_pop($stack);\r\n\t\t\t$tokens[] = $child;\r\n\t\t}\r\n\r\n\t\treturn $tokens;\r\n\t} \r\n} \r\n?>\r\n{code}\r\n\r\n\r\n{code:title=Zend_Mail_Protocol_Imap_Test.php|borderStyle=solid}\r\n<?php\r\nrequire_once(dirname(__FILE__) . '\/Zend_Mail_Protocol_TestAsset_Imap.php');\r\n\r\nclass Zend_Mail_Protocol_Imap_Test extends PHPUnit_Framework_TestCase {\r\n\r\n\tpublic function testDecodeLineOldParenthesis() {\r\n\t\t$imap  = new Zend_Mail_Protocol_Imap(); \r\n\t\t$proxy = new Zend_Mail_Protocol_TestAsset_Imap($imap); \r\n\r\n\t\t$line   = '1 FETCH (BODYSTRUCTURE ((\"TEXT\" \"PLAIN\" (\"CHARSET\" \"ISO-8859-1\") NIL NIL \"7BIT\" 1753 34 NIL NIL NIL)(\"TEXT\" \"HTML\" (\"CHARSET\" \"ISO-8859-1\") NIL NIL \"7BIT\" 2161 56 NIL NIL NIL) \"ALTERNATIVE\" (\"BOUNDARY\" \"00032557554a10c659047e4f6eb7\") NIL NIL))'; \r\n\t\t$result = $proxy->_decodeLineOld($line); \r\n\t\t$expectedResult = array(\r\n\t\t\t1,\r\n\t\t\t'FETCH',\r\n\t\t\tarray(\r\n\t\t\t\t'BODYSTRUCTURE',\r\n\t\t\t\tarray(\r\n\t\t\t\t\tarray(\r\n\t\t\t\t\t\t'TEXT',\r\n\t\t\t\t\t\t'PLAIN',\r\n\t\t\t\t\t\tarray('CHARSET', 'ISO-8859-1'),\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'7BIT',\r\n\t\t\t\t\t\t1753,\r\n\t\t\t\t\t\t34,\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'NIL)(\"TEXT\"',\r\n\t\t\t\t\t\t'HTML',\r\n\t\t\t\t\t\tarray('CHARSET', 'ISO-8859-1'),\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'7BIT',\r\n\t\t\t\t\t\t2161,\r\n\t\t\t\t\t\t56,\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'NIL'\r\n\t\t\t\t\t),\r\n\t\t\t\t\t'ALTERNATIVE',\r\n\t\t\t\t\tarray(\r\n\t\t\t\t\t\t'BOUNDARY',\r\n\t\t\t\t\t\t'00032557554a10c659047e4f6eb7'\r\n\t\t\t\t\t),\r\n\t\t\t\t\t'NIL',\r\n\t\t\t\t\t'NIL'\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t);\r\n\t\t$this->assertEquals($expectedResult, $result);\r\n\t}\r\n\r\n\tpublic function testDecodeLineParenthesis() {\r\n\t\t$imap  = new Zend_Mail_Protocol_Imap(); \r\n\t\t$proxy = new Zend_Mail_Protocol_TestAsset_Imap($imap); \r\n\r\n\t\t$line   = '1 FETCH (BODYSTRUCTURE ((\"TEXT\" \"PLAIN\" (\"CHARSET\" \"ISO-8859-1\") NIL NIL \"7BIT\" 1753 34 NIL NIL NIL)(\"TEXT\" \"HTML\" (\"CHARSET\" \"ISO-8859-1\") NIL NIL \"7BIT\" 2161 56 NIL NIL NIL) \"ALTERNATIVE\" (\"BOUNDARY\" \"00032557554a10c659047e4f6eb7\") NIL NIL))'; \r\n\t\t$result = $proxy->_decodeLine($line); \r\n\t\t$expectedResult = array(\r\n\t\t\t1,\r\n\t\t\t'FETCH',\r\n\t\t\tarray(\r\n\t\t\t\t'BODYSTRUCTURE',\r\n\t\t\t\tarray(\r\n\t\t\t\t\tarray(\r\n\t\t\t\t\t\t'TEXT',\r\n\t\t\t\t\t\t'PLAIN',\r\n\t\t\t\t\t\tarray('CHARSET', 'ISO-8859-1'),\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'7BIT',\r\n\t\t\t\t\t\t1753,\r\n\t\t\t\t\t\t34,\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'NIL'\r\n\t\t\t\t\t),\r\n\t\t\t\t\tarray(\r\n\t\t\t\t\t\t'TEXT',\r\n\t\t\t\t\t\t'HTML',\r\n\t\t\t\t\t\tarray('CHARSET', 'ISO-8859-1'),\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'7BIT',\r\n\t\t\t\t\t\t2161,\r\n\t\t\t\t\t\t56,\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'NIL',\r\n\t\t\t\t\t\t'NIL'\r\n\t\t\t\t\t),\r\n\t\t\t\t\t'ALTERNATIVE',\r\n\t\t\t\t\tarray(\r\n\t\t\t\t\t\t'BOUNDARY',\r\n\t\t\t\t\t\t'00032557554a10c659047e4f6eb7'\r\n\t\t\t\t\t),\r\n\t\t\t\t\t'NIL',\r\n\t\t\t\t\t'NIL'\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t);\r\n\t\t$this->assertEquals($expectedResult, $result);\r\n\t}\r\n\r\n\tpublic function testDecodeLineOldEscapedQuote() {\r\n\t\t$imap  = new Zend_Mail_Protocol_Imap(); \r\n\t\t$proxy = new Zend_Mail_Protocol_TestAsset_Imap($imap); \r\n\r\n\t\t$line = '* XLIST (\\HasNoChildren) \"\/\" \"test\\\"label1\"';\r\n\t\t$result = $proxy->_decodeLineOld($line); \r\n\t\t$expectedResult = array('*', 'XLIST', array('\\HasNoChildren'), '\/', 'test\\\\', 'label1\"');\r\n\t\t$this->assertEquals($expectedResult, $result);\r\n\t}\r\n\r\n\tpublic function testDecodeLineEscapedQuote() {\r\n\t\t$imap  = new Zend_Mail_Protocol_Imap(); \r\n\t\t$proxy = new Zend_Mail_Protocol_TestAsset_Imap($imap); \r\n\r\n\t\t$line = '* XLIST (\\HasNoChildren) \"\/\" \"test\\\"label1\"';\r\n\t\t$result = $proxy->_decodeLine($line); \r\n\t\t$expectedResult = array('*', 'XLIST', array('\\HasNoChildren'), '\/', 'test\\\"label1');\r\n\t\t$this->assertEquals($expectedResult, $result);\r\n\t}\r\n}\r\n?>\r\n\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dominikgehl",
                        "name": "dominikgehl",
                        "displayName": "Dominik Gehl",
                        "active": true
                    },
                    "created": "2011-07-06T15:52:42.000+0000",
                    "updated": "2011-07-06T15:52:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51060",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rkenny3264",
                        "name": "rkenny3264",
                        "displayName": "Russell Kenny",
                        "active": true
                    },
                    "body": "Thank you Dominik!  This was still broken in ZF 1.11.11, I applied your patch and was then able to parse BODYSTRUCTURE tags correctly.  Much hair pulling was avoided.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rkenny3264",
                        "name": "rkenny3264",
                        "displayName": "Russell Kenny",
                        "active": true
                    },
                    "created": "2012-06-11T19:13:06.000+0000",
                    "updated": "2012-06-11T19:13:06.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9624\/transitions"
}