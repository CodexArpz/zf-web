{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4841",
    "key": "ZF-4841",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Form_Decorator_Label->setTag() produces invalid XHMTL"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4841\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10390",
                    "id": 10390,
                    "description": "Mini Release",
                    "name": "1.9.6",
                    "userReleaseDate": "24\/Nov\/09",
                    "archived": false,
                    "releaseDate": "2009-11-24",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-11-19T10:22:45.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=archwisp",
                "name": "archwisp",
                "displayName": "Bryan C. Geraghty",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-11-06T14:07:56.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-11-19T10:22:45.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Description:\n\nThe tag \"option\" does not appear to be cleared properly when setTag is used and is rendered as an html property.\n\n{code:title=PHP|borderStyle=solid}\n$start_date = new Zend_Form_Element_Text('start_date', array('label' => 'Start Date'));\n$start_date->getDecorator('label')->setTag('div');\n$form->addElement($start_date);\n{code}\n\nProduces: \n\n{code:title=HTML|borderStyle=solid}\n<div><label for=\"start_date\" tag=\"dt\" class=\"optional\">Start Date<\/label><\/div>\n{code}\n\n{code:title=Diff of quick fix|borderStyle=solid}\nIndex: Form\/Decorator\/Label.php\n===================================================================\n--- Form\/Decorator\/Label.php    (revision 12325)\n+++ Form\/Decorator\/Label.php    (working copy)\n@@ -289,6 +289,10 @@\n         }   \n \n         if (!empty($label)) {\n+           if (!empty($tag) && isset($options['tag'])) {\n+               unset($options['tag']);\n+           }\n+\n             $options['class'] = $class;\n             $label = $view->formLabel($element->getFullyQualifiedName(), trim($label), $options); \n         } else {\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4841\/watchers",
                "isWatching": false,
                "watchCount": 4
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12383",
                    "filename": "Label.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stevehollis",
                        "name": "stevehollis",
                        "displayName": "Steve Hollis",
                        "active": true
                    },
                    "created": "2009-11-19T10:02:40.000+0000",
                    "size": 312,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12383\/Label.patch"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12384",
                    "filename": "LabelTest.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stevehollis",
                        "name": "stevehollis",
                        "displayName": "Steve Hollis",
                        "active": true
                    },
                    "created": "2009-11-19T10:02:40.000+0000",
                    "size": 837,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12384\/LabelTest.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10251",
                    "id": 10251,
                    "description": "Mini Release",
                    "name": "1.6.2",
                    "userReleaseDate": "13\/Oct\/08",
                    "archived": false,
                    "releaseDate": "2008-10-13",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32620",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sweedymick",
                        "name": "sweedymick",
                        "displayName": "Micha\u00ebl Perrin",
                        "active": true
                    },
                    "body": "I encounter this problem as well, and not only with the Label decorator. Setting a tag on an HtmlTag decorator instance will render some invalid HTML code, with the tag attribute being rendered.\n\nThis doesn't happen when no tag is defined (the default one is used instead) because the getTag() method of the decorator (called in the render() method) will try to get this attribute from the options, set it in the object property with the setTag() method, and then explicitly remove the \"tag\" attribute from the options using removeOption().\n\nThe patch I made is slightly different to yours, as the setTag() method now sets the provided tag in the options instead of the class property, and then it will be the getTag() option which will do the same job as it did. I did that to ensure that the default \"dt\" tag option is never used between the time the object is instantiated and the time it is rendered.\n\n {code:none}\nIndex: Form\/Decorator\/Label.php\n===================================================================\n--- Form\/Decorator\/Label.php    (revision 13615)\n+++ Form\/Decorator\/Label.php    (working copy)\n@@ -101,7 +101,7 @@\n         if (empty($tag)) {\n             $this->_tag = null;\n         } else {\n-            $this->_tag = (string) $tag;\n+            $this->setOption('tag', (string) $tag);\n         }\n         return $this;\n     }\n@@ -117,7 +117,7 @@\n             $tag = $this->getOption('tag');\n             if (null !== $tag) {\n                 $this->removeOption('tag');\n-                $this->setTag($tag);\n+                $this->_tag = $tag;\n             }\n             return $tag;\n         }\n {code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sweedymick",
                        "name": "sweedymick",
                        "displayName": "Micha\u00ebl Perrin",
                        "active": true
                    },
                    "created": "2009-07-16T09:03:09.000+0000",
                    "updated": "2009-07-16T09:03:09.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36172",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stevehollis",
                        "name": "stevehollis",
                        "displayName": "Steve Hollis",
                        "active": true
                    },
                    "body": "This issue has a root cause that is not addressed by either of the fixes above.\r\n\r\nThe getTag() method checks the options array for a tag option and correctly removes it if found. However, when there is an explicit call to setTag(), the tag option is not removed. \r\n\r\nIf the intention is to clear the tag, this causes a problem as the getTag() method will restore the original tag from the options array if it has been supplied.\r\n\r\nIf the intention is to change the tag, the 'tag' option is still passed to the HtmlTag decorator and rendered as an attribute.\r\n\r\nSince, by default, the decorator is initialised by Zend_Form_Element with a tag option of 'dt', this affects the most common use case.\r\n\r\nThe fix is to remove the 'tag' option (if it exists) whenever setTag() is called. Patch for Label.php and LabelTest.php attached.\r\n\r\nIndex: Label.php\r\n===================================================================\r\n--- Label.php\t(revision 19044)\r\n+++ Label.php\t(working copy)\r\n@@ -103,6 +103,8 @@\r\n         } else {\r\n             $this->_tag = (string) $tag;\r\n         }\r\n+        $this->removeOption('tag');\r\n+\r\n         return $this;\r\n     }\r\n \r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stevehollis",
                        "name": "stevehollis",
                        "displayName": "Steve Hollis",
                        "active": true
                    },
                    "created": "2009-11-19T10:00:20.000+0000",
                    "updated": "2009-11-19T10:00:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36175",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Patch from Steve applied to trunk and 1.9 release branch.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-11-19T10:22:45.000+0000",
                    "updated": "2009-11-19T10:22:45.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4841\/transitions"
}