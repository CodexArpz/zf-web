{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11310",
    "key": "ZF-11310",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Tmp\/cache dir security considerations"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/9",
                "name": "Docs:  Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11310\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                "name": "freak",
                "displayName": "Dolf Schimmel (Freeaqingme)",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-04-20T14:37:02.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-01-09T20:22:29.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "In the proposal for a default directory structure [1] there's a data\/cache dir, this however is not mentioned in the quickstart guide, and I'm not sure zend_tool creates this while creating a new project. \r\n\r\nThe problem arises on sytems where there are multiple websites each running as their own user because the cache files do not have some sort of unique identifier on a per-project basis, which may result in e.g. write errors for zend_locale cache.\r\n\r\nIt also is a problem when multiple websites of several people\/businesses run on the same server with all the same tmp file because one may be able to spoof someone else's caches.\r\n\r\nSolution:\r\nIf you agree this is a potential security issue, my suggestion would be to by default create a data\/cache dir using zend_tool, document its usage in the quickstart guide, as well as perhaps in zend_cache, and to set the default tmp dir to this folder in the .htaccess file zend_tool creates.\r\n\r\nThanks go out to MvdS for noticing.\r\n\r\n[1] http:\/\/framework.zend.com\/wiki\/display\/ZFPROP\/Zend+Framework+Default+Project+Structure+-+Wil+Sinclair"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11310\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "customfield_10000": {
            "name": "Language",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/customFieldOption\/10000",
                "value": "English"
            }
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10028",
                    "id": 10028,
                    "name": "Zend_Cache",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/45947",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                        "name": "padraic",
                        "displayName": "P\u00e1draic Brady",
                        "active": true
                    },
                    "body": "Just adding a clarification that this impacts on host servers due to their insecure configuration (one user should not be able to read\/write another user's files!). As such it is NOT a Zend Framework security issue. Zend_Tool may elect to use a unique cache directory configuration setting for Zend_Tool (which makes sense anyway to avoid cache conflicts) but server operators should note you can manually configure the cache directory as needed.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                        "name": "padraic",
                        "displayName": "P\u00e1draic Brady",
                        "active": true
                    },
                    "created": "2011-04-20T17:28:41.000+0000",
                    "updated": "2011-04-20T17:36:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/45948",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "Agreed. It's not that ZF is doing something wrong, but we could protect the users better by actually setting a default tmp dir ourselves if the specified tmp dir equals sys_get_tmp",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2011-04-20T17:34:07.000+0000",
                    "updated": "2011-04-20T17:34:07.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46180",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=m%C3%B4shevds",
                        "name": "m\u00f4shevds",
                        "displayName": "M\u00f4she van der Sterre",
                        "active": true
                    },
                    "body": "I like to clarify why this is a security issue, I discussed this with Dolf Schimmel, but I don't think the potential impact is clear from the description. Also, P\u00e1draic Brady notes that this is an issue with an insecure host configuration, however, this is not the case.\r\n\r\nIt is correct that this issue is only relevant for the default ZF configuration, but it is not documented as an insecure default.\r\n\r\nI noticed this issue on a test-server, with 2 distinct users both running the same ZF application, the application of one of the users became inaccessible as a result (local denial of service). I do not directly see a way to exploit this beyond the denial of service, but as the contents of many cache files are serialized objects, this might also be possible.\r\n\r\nThe \/tmp directory (and other system-wide tmp directories) have filemode 1777, this means world writable (the 777 part) with the restricted deletion flag (the 1) set. This particular filemode means any user can 'claim' a file, without fear that another user will delete it. Without this behaviour the tmp directory would be obviously insecure. However this also means no application can rely on using any specific filename in the tmp directory, as another user or application may have claimed it already.\r\n\r\nThis is also the point that makes ZF vulnerable to at least the local denial of service. ZF does not gracefully handle a failure to open the cache file, and it has no provisions to randomize the filename or check the owner before using it.\r\n\r\nThe real way to fix this issue is to implement some sort of 'mktemp' behaviour. However, changing the default to not use \/tmp at all (as proposed) will definitely fix the problem.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=m%C3%B4shevds",
                        "name": "m\u00f4shevds",
                        "displayName": "M\u00f4she van der Sterre",
                        "active": true
                    },
                    "created": "2011-04-29T00:38:48.000+0000",
                    "updated": "2011-04-29T00:38:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49466",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mabe",
                        "name": "mabe",
                        "displayName": "Marc Bennewitz (private)",
                        "active": true
                    },
                    "body": "Is that an issue of Zend_Cache or Zend_Tool ?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mabe",
                        "name": "mabe",
                        "displayName": "Marc Bennewitz (private)",
                        "active": true
                    },
                    "created": "2012-01-09T20:22:29.000+0000",
                    "updated": "2012-01-09T20:22:29.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11310\/transitions"
}