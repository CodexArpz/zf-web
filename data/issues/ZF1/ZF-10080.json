{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10080",
    "key": "ZF-10080",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Session_Namespace function apply() throws PHP NOTICE because namespace is not completly and correctly initialized"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/11",
                "name": "Patch",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10080\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                "name": "johndoe",
                "displayName": "Ren\u00e9 Kerner",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-06-30T02:09:20.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-05-18T07:06:02.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Hello!\r\n\r\nThe functions apply() and applySet() of the Zend_Session_Namespace class throws a PHP Notice if the currently used namespace was not used \/ filled by the __set magic method, applySet(...) throws Zend_Session_Exception('Result must be an array. Got: ' . gettype($result)).\r\n\r\nexample:\r\n{code}\r\nclass RegistrationController extends Zend_Controller_Action\r\n{\r\n\r\n...\r\n\r\n    protected $_namespace = 'RegistrationController';\r\n\r\n...\r\n\r\n    public function getSessionNamespace()\r\n    {\r\n        if(null === $this->_session)\r\n        {\r\n            $this->_session =\r\n                new Zend_Session_Namespace($this->_namespace);\r\n        }\r\n        return $this->_session;\r\n    }\r\n\r\n...\r\n\r\n    public function subFormIsValid(Zend_Form_SubForm $subForm, array $data)\r\n    {\r\n        $name = $subForm->getName();\r\n        if ($subForm->isValid($data))\r\n        {\r\n            $this->getSessionNamespace()->applySet('array_merge', $subForm->getValues());   \/\/ example corrected here (see comments)\r\n            \/\/ originally here is in Zend Documentation:\r\n            \/\/ $this->getSessionNamespace()->$name = $subForm->getValues();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n...\r\n\r\n}\r\n{code}\r\n\r\nthis example comes from the \"Multi-Page Forms\" paragraph of the Zend Documentation:\r\nhttp:\/\/framework.zend.com\/manual\/en\/zend.form.advanced.html\r\nBut I have to customize it because the whole form validation (validation of all subforms\r\nis incorrect!!! oooops... that's another issue...) was broken.\r\n\r\nOn the first call of subFormIsValid(...) no data were added to the Session_Namespace, or\r\nbetter lets say to $_SESSION[$namespace][$key] ( = $value);\r\nso $_SESSION[$namespace] is not initialized as an (currently empty) array.\r\n\r\nnow function apply()\/applySet() of the Zend_Session_Namespace class is called.\r\n\r\n{code:title=Zend\/Session\/Namespace.php -- line 334}\r\n    \/**\r\n     * apply() - enables applying user-selected function, such as array_merge() to the namespace\r\n     * Parameters following the $callback argument are passed to the callback function.\r\n     * Caveat: ignores members expiring now.\r\n     *\r\n     * Example:\r\n     *   $namespace->apply('array_merge', array('tree' => 'apple', 'fruit' => 'peach'), array('flower' => 'rose'));\r\n     *   $namespace->apply('count');\r\n     *\r\n     * @param string|array $callback - callback function\r\n     *\/\r\n    public function apply($callback)\r\n    {\r\n        $arg_list = func_get_args();\r\n        $arg_list[0] = $_SESSION[$this->_namespace]; \/\/ line 348\r\n        return call_user_func_array($callback, $arg_list);\r\n    }\r\n{code}\r\n\r\nThen the PHP Notice comes from line 348: \"$arg_list[0] = $_SESSION[$this->_namespace];\".\r\n$this->_namespace in my case is \"RegistrationController\". But it is filled by the __set(...) magic method of the Zend_Session_Namespace class, that has not been called before. So $_SESSION[\"RegistrationController\"] is not initialized, leading to that notice. It only harms PHP Strict paradigms.\r\nIt's because the initialization is missing in the constructor.\r\n\r\nSo I added following patch:\r\n{code:title=Zend\/Session\/Namespace.php -- line 102 and following}\r\n    public function __construct($namespace = 'Default', $singleInstance = false)\r\n    {\r\n\r\n        ...  \/\/ omitted till line 145:\r\n\r\n        if (self::$_readable === false) {\r\n            \/**\r\n             * @see Zend_Session_Exception\r\n             *\/\r\n            require_once 'Zend\/Session\/Exception.php';\r\n            throw new Zend_Session_Exception(self::_THROW_NOT_READABLE_MSG);\r\n        }\r\n\r\n        \/\/ after that I added:\r\n        if(!isset($_SESSION[$this->_namespace]))\r\n            $_SESSION[$this->_namespace] = array();\r\n        \/\/ this initializes the current namespace as an empty array and thats PHP Strict compliant \r\n\r\n        if (!isset($_SESSION['__ZF'])) {\r\n            return; \/\/ no further processing needed\r\n        }\r\n\r\n        ...\r\n\r\n    }\r\n{code}\r\n\r\nThis also affects the applySet(...) function, but an exception: \"Zend_Session_Exception('Result must be an array. Got: ' . gettype($result))\"\r\nis thrown.\r\n\r\nBest regards,\r\nRen\u00e9 Kerner\r\n\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10080\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10470",
                    "id": 10470,
                    "description": "Mini Release",
                    "name": "1.10.6",
                    "userReleaseDate": "22\/Jun\/10",
                    "archived": false,
                    "releaseDate": "2010-06-22",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10096",
                    "id": 10096,
                    "name": "Zend_Session",
                    "description": "A standardized interface to common functionality found in or indigenous to site session implementations. ",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41258",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "body": "position of correction changed",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "created": "2010-06-30T03:26:45.000+0000",
                    "updated": "2010-06-30T03:26:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41259",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "body": "example with apply was bad...using applySet(...) would be better for that case...\r\nin case of apply set the Exception:\r\nZend_Session_Exception('Result must be an array. Got: ' . gettype($result))\r\nis thrown...\r\n\r\nsorry for that mistake",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "created": "2010-06-30T03:47:00.000+0000",
                    "updated": "2010-06-30T03:47:00.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41260",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "body": "corrected applySet(...) function in example and issue description",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "created": "2010-06-30T03:50:28.000+0000",
                    "updated": "2010-06-30T03:50:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46672",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dmuir",
                        "name": "dmuir",
                        "displayName": "David Muir",
                        "active": true
                    },
                    "body": "Just bumped into this today. Is there a way to get around it?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dmuir",
                        "name": "dmuir",
                        "displayName": "David Muir",
                        "active": true
                    },
                    "created": "2011-05-18T07:06:02.000+0000",
                    "updated": "2011-05-18T07:06:02.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10080\/transitions"
}