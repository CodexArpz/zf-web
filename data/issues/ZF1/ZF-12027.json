{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12027",
    "key": "ZF-12027",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Form::GetValues() not rendered congruent with post data "
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12027\/votes",
                "votes": 5,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthewmatician",
                "name": "matthewmatician",
                "displayName": "Matthew Larson",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2012-01-27T02:05:50.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-03-21T23:35:36.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "Zend_Form",
                "arraynotation",
                "post"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Adding a subform to a Zend_Form, and setting isArray to false will properly add that subform with expected markup, such that the subform creates appropriate array notation (The $_POST data does not show subform values in a nested array).\r\n\r\nHowever, calling the form's getValues() method renders the data differently, in that the returned result will put the subform's values into a sub-array.\r\n\r\nWouldn't it be expected that a request->getPost() and a form->getValues() would have a congruent structure?"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12027\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "zend_form"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                "name": "alab",
                "displayName": "Christian Albrecht",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10981",
                    "id": 10981,
                    "description": "Mini Release",
                    "name": "1.11.11",
                    "userReleaseDate": "29\/Sep\/11",
                    "archived": false,
                    "releaseDate": "2011-09-29",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49576",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frosch",
                        "name": "frosch",
                        "displayName": "Frank Br\u00fcckner",
                        "active": true
                    },
                    "body": "Hi Matthew,\r\ncan you provide a complete code example to reproduce the problem?\r\nThanks!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frosch",
                        "name": "frosch",
                        "displayName": "Frank Br\u00fcckner",
                        "active": true
                    },
                    "created": "2012-01-27T07:45:57.000+0000",
                    "updated": "2012-01-27T07:45:57.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49578",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthewmatician",
                        "name": "matthewmatician",
                        "displayName": "Matthew Larson",
                        "active": true
                    },
                    "body": "Sure:\r\n\r\n{code:title=Sub.php}\r\n<?php\r\nclass Application_Form_Sub extends Zend_Form\r\n{\r\n    public function init()\r\n    {\r\n        $this->setIsArray(false);\r\n\r\n        $this->addElement(\r\n            'Text',\r\n            'subInput',\r\n            array('label' => 'input in a subform',)\r\n        );\r\n    }\r\n}\r\n{code}\r\n\r\n{code:title=Super.php}\r\n<?php\r\nclass Application_Form_Super extends Zend_Form\r\n{\r\n    public function init()\r\n    {\r\n        $this->addElement(\r\n            'Text',\r\n            'superInput',\r\n            array('label' => 'regular input',)\r\n        );\r\n\r\n        $sub = new Application_Form_Sub();\r\n        $this->addSubForm($sub,'sub');\r\n\r\n        $this->addElement(\r\n            'Submit',\r\n            'submit',\r\n            array('label' => 'submit',)\r\n        );\r\n    }\r\n}\r\n{code}\r\n\r\n{code:title=IndexController.php}\r\n<?php\r\nclass IndexController extends Zend_Controller_Action\r\n{\r\n    public function indexAction\r\n    {\r\n        $form = new Application_Form_Super();\r\n        $this->view->form = $form;\r\n        $request = $this->getRequest();\r\n        if($request->isPost() && $form->isValid($request->getPost())){\r\n\r\n            echo '<h2>Post Data:<\/h2><pre>';\r\n            var_dump ($request->getPost());\r\n            echo '<\/pre>';\r\n\r\n            echo '<h2>Form Values<\/h2><pre>';\r\n            var_dump ($form->getValues());\r\n            echo '<\/pre>';\r\n        }\r\n    }\r\n}\r\n{code}\r\n\r\n{code:title=index.phtml}\r\n<?php echo $this->form; ?>\r\n{code}\r\n\r\nJust run the view, put in some values, and see that the two outputted arrays don't have the same structure.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthewmatician",
                        "name": "matthewmatician",
                        "displayName": "Matthew Larson",
                        "active": true
                    },
                    "created": "2012-01-27T14:34:37.000+0000",
                    "updated": "2012-01-27T14:34:37.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49581",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthewmatician",
                        "name": "matthewmatician",
                        "displayName": "Matthew Larson",
                        "active": true
                    },
                    "body": "Also, the same issue exists for Zend_Form::getValidValues().",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthewmatician",
                        "name": "matthewmatician",
                        "displayName": "Matthew Larson",
                        "active": true
                    },
                    "created": "2012-01-27T16:58:18.000+0000",
                    "updated": "2012-01-27T16:58:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49582",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthewmatician",
                        "name": "matthewmatician",
                        "displayName": "Matthew Larson",
                        "active": true
                    },
                    "body": "I did a review of the code. I believe I have established a fix:\r\n\r\n{code:title:Zend\/Form\/Form.php}\r\nclass Zend_Form ...\r\n{\r\n    ...\r\n\r\n    \/**\r\n     * Retrieve all form element values\r\n     *\r\n     * All changes made have been marked with comments\r\n     *\r\n     * @param  bool $suppressArrayNotation\r\n     * @return array\r\n     *\/\r\n    public function getValues($suppressArrayNotation = false)\r\n    {\r\n        \/\/... no changes until the second foreach loop\r\n        \r\n        foreach ($this->getSubForms() as $key => $subForm) {\r\n            $merge = array();\r\n            if (!$subForm->isArray()) {\r\n                \/\/copied and changed this line:\r\n                \/\/$merge[$key] = $subForm->getValues();\r\n                $merge = $subForm->getValues();\r\n            } else {\r\n                $merge = $this->_attachToArray($subForm->getValues(true),\r\n                                               $subForm->getElementsBelongTo());\r\n            }\r\n            $values = $this->_array_replace_recursive($values, $merge);\r\n        }\r\n\r\n        if (!$suppressArrayNotation &&\r\n            $this->isArray() &&\r\n            !$this->_getIsRendered()) {\r\n            $values = $this->_attachToArray($values, $this->getElementsBelongTo());\r\n        }\r\n\r\n        return $values;\r\n    }\r\n\r\n\/\/Regarding getValidValues, it was a little more involved:\r\n\r\n    \/**\r\n     * Returns only the valid values from the given form input.\r\n     *\r\n     * For models that can be saved in a partially valid state, for example when following the builder,\r\n     * prototype or state patterns it is particularly interessting to retrieve all the current valid\r\n     * values to persist them.\r\n     *\r\n     * All changes have been marked with comments\r\n     *\r\n     * @param  array $data\r\n     * @param  bool $suppressArrayNotation\r\n     * @return array\r\n     *\/\r\n    public function getValidValues($data, $suppressArrayNotation = false)\r\n    {\r\n        \/\/... no changes until the second foreach loop\r\n        \r\n        foreach ($this->getSubForms() as $key => $form) {\r\n            $merge = array();\r\n\r\n            \/\/added a local variable, swapped $data with $subData within this loop\r\n            $subData = isset($data[$key]) ? $data[$key] : $data;\r\n\r\n            \/\/ copied and changed the following line:\r\n            \/\/if (isset($data[$key]) && !$form->isArray()) {\r\n            if (!$form->isArray()) {\r\n                $tmp = $form->getValidValues($subData);\r\n                if (!empty($tmp)) {\r\n                    \/\/copied and changed the following line:\r\n                    \/\/$merge[$key] = $tmp;\r\n                    $merge = $tmp;\r\n                }\r\n            } else {\r\n                $tmp = $form->getValidValues($data, true);\r\n                if (!empty($tmp)) {\r\n                    $merge = $this->_attachToArray($tmp, $form->getElementsBelongTo());\r\n                }\r\n            }\r\n            $values = $this->_array_replace_recursive($values, $merge);\r\n        }\r\n        if (!$suppressArrayNotation &&\r\n            $this->isArray() &&\r\n            !empty($values) &&\r\n            !$this->_getIsRendered()) {\r\n            $values = $this->_attachToArray($values, $this->getElementsBelongTo());\r\n        }\r\n\r\n        return $values;\r\n    }\r\n\r\n\r\n{code}\r\n\r\nHope this helps!\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthewmatician",
                        "name": "matthewmatician",
                        "displayName": "Matthew Larson",
                        "active": true
                    },
                    "created": "2012-01-27T17:14:23.000+0000",
                    "updated": "2012-01-27T17:14:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50097",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stewartlord",
                        "name": "stewartlord",
                        "displayName": "Stewart Lord",
                        "active": true
                    },
                    "body": "Note, this same problem also affects getMessages(). The fix is nearly identical.\r\n\r\n{code}\r\nforeach ($this->getSubForms() as $key => $subForm) {\r\n    $merge = $subForm->getMessages(null, true);\r\n    if (!empty($merge)) {\r\n        if (!$subForm->isArray()) {\r\n\/\/ OFFENDING LINE: $merge = array($key => $merge);\r\n        } else {\r\n            $merge = $this->_attachToArray($merge,\r\n                                           $subForm->getElementsBelongTo());\r\n        }\r\n        $messages = $this->_array_replace_recursive($messages, $merge);\r\n    }\r\n}\r\n{code}\r\n\r\nRemoving the offending line fixes the problem.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stewartlord",
                        "name": "stewartlord",
                        "displayName": "Stewart Lord",
                        "active": true
                    },
                    "created": "2012-03-21T23:32:47.000+0000",
                    "updated": "2012-03-21T23:35:36.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12027\/transitions"
}