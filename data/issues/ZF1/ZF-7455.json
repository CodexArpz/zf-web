{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7455",
    "key": "ZF-7455",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "$this->_redirect() behaves differently in test mode"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/9",
                "name": "Docs:  Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7455\/votes",
                "votes": 3,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10510",
                    "id": 10510,
                    "description": "Minor Release",
                    "name": "1.12.0",
                    "userReleaseDate": "27\/Aug\/12",
                    "archived": false,
                    "releaseDate": "2012-08-27",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-07-05T15:15:46.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjs",
                "name": "mjs",
                "displayName": "Michael Stillwell",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-08-03T07:40:53.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-07-05T15:15:46.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "phpunit",
                "redirect",
                "test"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "In normal operation, $this->_redirect() exits after performing the redirect.  This behaviour is disabled by controller test case via $redirector->setExit(false)--in test mode, the exit is not applied.   The result of this is that actions that use _redirect() like a \"return\" or exit behave differently in test mode.\n\ni.e. actions with the following pattern:\n\nif ($some_condition) {\n  $this->_redirect(\"foo\");\n}\n\nif ($other_condition) {\n  $this->_redirect(\"bar\");\n}\n\n$this->_redirect(\"default\");\n\nwill always be redirected to \"default\" in test mode.\n\nIf this issue cannot be fixed, it would at least be helpful to place a warning in 52.2.3.3 saying that _redirect() must be followed by return in actions, otherwise the redirect assertion may not behave as expected."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7455\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "customfield_10000": {
            "name": "Language",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/customFieldOption\/10000",
                "value": "English"
            }
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                "name": "beberlei",
                "displayName": "Benjamin Eberlei",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-5619",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5619",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-7496",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7496",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-11507",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11507",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10340",
                    "id": 10340,
                    "description": "Mini Release",
                    "name": "1.8.4",
                    "userReleaseDate": "23\/Jun\/09",
                    "archived": false,
                    "releaseDate": "2009-06-23",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10312",
                    "id": 10312,
                    "name": "Zend_Test_PHPUnit",
                    "description": "PHPUnit test scaffolding for ZF MVC applications",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33162",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "It's best with both _redirect() and _forward() (as well as when using the redirector action helper) to call return():\n{code}\nreturn $this->_redirect(...);\nreturn $this->_forward(...);\n{code}\nThis will ensure that if the exit flag is disabled, the application will work in the same way.\n\nI will add this verbiage to the manual.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-08-03T11:18:54.000+0000",
                    "updated": "2009-08-03T11:18:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33175",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjs",
                        "name": "mjs",
                        "displayName": "Michael Stillwell",
                        "active": true
                    },
                    "body": "Thanks.  This seems like the best solution now that exit() has managed to get itself into the library.  Looking at \"dispatch()\" in ControllerTestCase.php it looks like the other point of potentially different behavior is with the JSON helper, which also disables exit.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjs",
                        "name": "mjs",
                        "displayName": "Michael Stillwell",
                        "active": true
                    },
                    "created": "2009-08-04T00:22:33.000+0000",
                    "updated": "2009-08-04T00:22:33.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34594",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "Added a section on testing and the redirect helper to the manual.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2009-09-18T01:38:28.000+0000",
                    "updated": "2009-09-18T01:38:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34834",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=olek",
                        "name": "olek",
                        "displayName": "Olek",
                        "active": true
                    },
                    "body": "This workaround partly solves the issue and fails when action helpers are involved. If I redirect from an action helper in init or preDispatch, I want the action controller not to even call the action. Unfortunately, this is not the case, and the regular action logic like rendering happens as well.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=olek",
                        "name": "olek",
                        "displayName": "Olek",
                        "active": true
                    },
                    "created": "2009-09-23T04:16:53.000+0000",
                    "updated": "2009-09-23T04:16:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35001",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjs",
                        "name": "mjs",
                        "displayName": "Michael Stillwell",
                        "active": true
                    },
                    "body": "The updated documentation is available at\n\nhttp:\/\/framework.zend.com\/manual\/en\/zend.test.phpunit.html#zend.test.phpunit.testing.redirector\n\nfor anyone who's interested.\n\nI think the current text can be improved.  At the moment it doesn't really explain, or distinguish between, the problem and the solution.  There also doesn't appear to be any meaningful difference between the two \"important\" boxes and the non-boxed paragraph.\n\nI would prefer something like the following:\n\nThere is a potential problem with combining controller testing if using the redirect helper.  By default, the redirect helper performs an exit() after issuing the redirect header.  This means that the line\n\n   $this->_redirect(...);\n\nwill typically serve to terminate the script; once $this->_redirect(...) is executed, no statement appearing after the redirect within the action will be executed.\n\nSince exit() also terminates PHPUnit, the testing harness disables this feature of _redirect(...), so that the test harness can continue to run.  However, this means that--contrary to non-test mode--statements appearing after $this->_redirect(...) <em>will be executed<\/em> in test mode.  This may result in unexpected behaviour.\n\nTo prevent this, you must ensure that you exit the action after performing a _redirect(...).  The easiest way to ensure this is to preceded the call to $this->_redirect(...) with \"return\":\n\n    return $this->_redirect(...);\n\nIn summary, we recommend that\n\n    $this->_redirect(...);\n\nnever appears in your action methods.  Instead, you should always write:\n\n    return $this->_redirect(...);",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjs",
                        "name": "mjs",
                        "displayName": "Michael Stillwell",
                        "active": true
                    },
                    "created": "2009-09-30T06:18:46.000+0000",
                    "updated": "2009-09-30T06:18:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35051",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=grunichev",
                        "name": "grunichev",
                        "displayName": "Alexey Grunichev",
                        "active": true
                    },
                    "body": "But what should user do if he has the same rules for every action, e.g.\n    public function preDispatch\/init\/or something like that()\n    {\n        $auth = Zend_Auth::getInstance();\n        $role = ($auth->hasIdentity() && !empty($auth->getIdentity()->role))\n            ? $auth->getIdentity()->role : App_Roles::GUEST;\n        $acl = Zend_Registry::get('acl');\n        if (!$acl->isAllowed($role, App_Resources::REQUIRED_LOGIN_PAGE)) {\n            $this->_redirect('\/error\/denied');\n        }\n        $this->_user = $auth->getIdentity();\n    }\nit works fine in application, but in testing mode action method is invoked and can throw error (due to undefined _user properties, or we should check it in every method). Does that mean it never will work in testable applications?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=grunichev",
                        "name": "grunichev",
                        "displayName": "Alexey Grunichev",
                        "active": true
                    },
                    "created": "2009-10-02T05:23:30.000+0000",
                    "updated": "2009-10-02T05:23:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35053",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "This has obviously not been fixed sufficiently.\n\nI had an idea, we should investigate wheater its possible to replace the redirector helper in the controller testcase with an own implementation that behaves equally.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2009-10-02T05:29:19.000+0000",
                    "updated": "2009-10-02T05:29:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47358",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "\"Fixing\" this really requires overhauls to the way the MVC workflow currently works; there's no way to return early from an action (or helper, or plugin, etc.) due to limitations in how PHP works. In plain and simple language, PHP is not an event-driven language, which makes it impossible to truly short-circuit execution. \n\nThe EventManager in ZF2 will help in solving this issue, but there will always be edge cases when it comes to redirection and getting the response returned early.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2011-07-05T15:15:46.000+0000",
                    "updated": "2011-07-05T15:15:46.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7455\/transitions"
}