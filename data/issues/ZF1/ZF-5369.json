{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5369",
    "key": "ZF-5369",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Acl::allow($role) does not behave as expected"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5369\/votes",
                "votes": 3,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=asche",
                "name": "asche",
                "displayName": "Christian Ascheberg",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-12-29T01:55:48.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-09-08T19:11:00.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "The following code does not behave as I do expect:\n\n{code}\n$acl = new Zend_Acl();\n\n$acl->addRole(new Zend_Acl_Role('user'));\n$acl->addRole(new Zend_Acl_Role('admin'), 'user');\n\n$acl->add(new Zend_Acl_Resource('resource'));\n\n$acl->deny('user', 'resource');\n$acl->allow('admin');\n\necho \"user -> resource = \".(($acl->isAllowed('user', 'resource')) ? 'yes' : 'no').\"\\n\";\necho \"admin -> resource = \".(($acl->isAllowed('admin', 'resource')) ? 'yes' : 'no').\"\\n\";\n{code}\n\noutputs:\n{quote}\nuser -> resource = no\nadmin -> resource = no\n{quote}\nI would expect that 'admin' is allowed to access 'resource'. Is there a bug?\n\nSame thing with a modified code from http:\/\/devzone.zend.com\/article\/1665-Zend_Acl-Zend_Auth-Example-Scenario :\n{code}\n$acl->add(new Zend_Acl_Resource('home'));\n$acl->add(new Zend_Acl_Resource('news'));\n$acl->add(new Zend_Acl_Resource('tutorials'));\n$acl->add(new Zend_Acl_Resource('forum'));\n$acl->add(new Zend_Acl_Resource('support'));\n$acl->add(new Zend_Acl_Resource('admin'));\n\n$acl->addRole(new Zend_Acl_Role('guest'));\n$acl->addRole(new Zend_Acl_Role('member'), 'guest');\n$acl->addRole(new Zend_Acl_Role('admin'), 'member');\n\n\/\/ Guest may only view content\n$acl->allow('guest', 'home');\n$acl->allow('guest', 'news');\n$acl->allow('guest', 'tutorials');\n$acl->allow('member', 'forum');\n$acl->deny('member', 'forum', 'update'); \/\/ Remove specific privilege\n$acl->allow('member', 'support');\n$acl->allow('admin'); \/\/ unrestricted access\n\necho \"member -> forum : read = \".(($acl->isAllowed('member', 'forum', 'read')) ? 'yes' : 'no').\"\\n\";\necho \"admin -> forum : read = \".(($acl->isAllowed('admin', 'forum', 'read')) ? 'yes' : 'no').\"\\n\";\necho \"member -> forum : update = \".(($acl->isAllowed('member', 'forum', 'update')) ? 'yes' : 'no').\"\\n\";\necho \"admin -> forum : update = \".(($acl->isAllowed('admin', 'forum', 'update')) ? 'yes' : 'no').\"\\n\";\n{code}\n\n{quote}\nmember -> forum : read = yes\nadmin -> forum : read = yes\nmember -> forum : update = no\nadmin -> forum : update = no\n{quote}\n\nAfter a closer look, to me it seems as if the 'allResources'-part of the rules is only checked when $resource is explicitly null instead of - for example - checking it whenever there is no explicit rule for the given resource (in Zend_Acl::_getRules)."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/6",
                "name": "N\/A"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5369\/watchers",
                "isWatching": false,
                "watchCount": 4
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/10000",
                "name": "Postponed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-7119",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7119",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12058",
                    "filename": "ZF-5379.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-07-01T21:15:18.000+0000",
                    "size": 1465,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12058\/ZF-5379.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10271",
                    "id": 10271,
                    "description": "Mini Release",
                    "name": "1.7.2",
                    "userReleaseDate": "23\/Dec\/08",
                    "archived": false,
                    "releaseDate": "2008-12-23",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10070",
                    "id": 10070,
                    "name": "Zend_Acl",
                    "description": "Access control list authorization component",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/27757",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=asche",
                        "name": "asche",
                        "displayName": "Christian Ascheberg",
                        "active": true
                    },
                    "body": "further investigations",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=asche",
                        "name": "asche",
                        "displayName": "Christian Ascheberg",
                        "active": true
                    },
                    "created": "2009-01-05T01:37:53.000+0000",
                    "updated": "2009-01-05T01:37:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28044",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "This issue is a blocker, will investigate it, although i am not an expert at Zend_Acl",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2009-01-11T07:03:27.000+0000",
                    "updated": "2009-01-11T07:03:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28045",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "Confirmed the use-case as not working correctly.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2009-01-11T07:16:05.000+0000",
                    "updated": "2009-01-11T07:16:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28203",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Assigning to Ralph to get closure on this issues.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2009-01-14T13:31:40.000+0000",
                    "updated": "2009-01-14T13:31:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32335",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "This issue cannot be changed without either changing the architecture drastically or breaking BC.\n\nGiven the original usecase:\n{php}$acl = new Zend_Acl();\n\n$acl->addRole(new Zend_Acl_Role('user'));\n$acl->addRole(new Zend_Acl_Role('admin'), 'user');\n\n$acl->add(new Zend_Acl_Resource('resource'));\n\n$acl->deny('user', 'resource');\n$acl->allow('admin');{php}\n\nThe point is that though you can allow role 'admin' to have access to everything, role 'user' is still the parent of user and by default this prevails. You can however change this behaviour by applying the attached patch. Point is then that you would break BC... see for that the current unittests, testCMSExample(), line 991:\n$this->assertFalse($this->_acl->isAllowed('administrator', 'announcement', 'archive')); (r16407)\n\nWhat in that test basically is done is exactly the opposite:\n{php}\n$acl->addRole(new Zend_Acl_Role('user'));\n$acl->addRole(new Zend_Acl_Role('admin'), 'user');\n\n$acl->add(new Zend_Acl_Resource('resource'));\n$acl->allow('admin');\n$acl->deny(null, 'resource'); \/\/ Deny all access to 'resource'{php}\n\nA solution would be with a future fix (reorganization of zend_acl, if any) would be to keep track of when which permission was added.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-07-01T21:12:38.000+0000",
                    "updated": "2009-07-01T21:12:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32336",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "If not clear yet; I propose to either postpone this issue until zend_acl is drastically worked on (2.0?), or close it as a wont-fix.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-07-01T21:15:33.000+0000",
                    "updated": "2009-07-01T21:15:33.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32695",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=asche",
                        "name": "asche",
                        "displayName": "Christian Ascheberg",
                        "active": true
                    },
                    "body": "I think it would be better to \"dratically\" work on Zend_ACL (which surely means breaking BC) instead of just closing this issue.\n\nMy idea is (basically) that you should have tree of roles and resources (and maybe also privileges), each with a ROOT element. Furthermore you should have an explizit access matrix for every combination of roles and resources where the possible values are 'allow', 'deny' and 'inherit' while 'inherit' should be default and would not need to be set explizitly.\n\nOne more thing about the current implementation: to me, it is not logical why one role should inherit from multiple other roles. At least the way it is currently implemented is hard to follow \/ confusing to me.\nAn expample is given on http:\/\/framework.zend.com\/manual\/en\/zend.acl.html\nThis is a modification of the given example with an additional level of inheritance:\n\n{code}\n$acl = new Zend_Acl();\n\n$acl->addRole(new Zend_Acl_Role('a1'))\n    ->addRole(new Zend_Acl_Role('a2'));\n\n$acl->addRole(new Zend_Acl_Role('b1'), 'a1')\n    ->addRole(new Zend_Acl_Role('b2'), 'a2');\n\n$parents = array('b1', 'b2');\n$acl->addRole(new Zend_Acl_Role('someUser'), $parents);\n\n$acl->add(new Zend_Acl_Resource('someResource'));\n\n$acl->deny();\n\n$acl->allow('a2', 'someResource');\n\n$acl->deny('b1', 'someResource');\n\necho $acl->isAllowed('someUser', 'someResource') ? 'allowed' : 'denied';\n{code}\n\nThe output is\n{quote}\nallowed\n{quote}\n\nSo you check 'b2' first, then 'b2's parent which is 'a2' (allowed). Given the case that there is no explizit rule for 'a2', then you would check 'b1' and its parent 'a1'... wouldn't it be more consequent then to completely walk up the tree to the _ROOT_ with the result 'deny' (with no multiple inheritance possible) or check 'b1' first and then check the parents of 'b2' and 'b1'? I hope you understand what I mean (as I said, to me its is confusing...).\n\nHowever, I really like Zend Framework and its really nice coding style. I would really like to get involved in this a bit!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=asche",
                        "name": "asche",
                        "displayName": "Christian Ascheberg",
                        "active": true
                    },
                    "created": "2009-07-19T10:26:38.000+0000",
                    "updated": "2009-07-19T10:26:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32786",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "This issue is certainly recognized. If the problem cannot be solved without major BC-breaks, probably a next version of an acl component will be added to ZF. There are already several proposals for this, I propose you keep an eye on those.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-07-21T05:16:23.000+0000",
                    "updated": "2009-07-21T05:16:23.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5369\/transitions"
}