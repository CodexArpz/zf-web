{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8602",
    "key": "ZF-8602",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Setting resources.log.stream.filterParams.priority = 4 in application.ini throws error"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8602\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10360",
                    "id": 10360,
                    "description": "Minor Release",
                    "name": "1.10.0",
                    "userReleaseDate": "27\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-27",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-01-12T13:29:28.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kanundrum",
                "name": "kanundrum",
                "displayName": "Akeem Philbert",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-12-21T18:45:15.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-01-12T13:29:28.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "The error is thrown because the constant doesn't exist in that class found in Zend_Log_Filter_Priority version 1.9.10 alpha. the potential fix is attached:\r\n{code}\r\n@@ -78,12 +78,12 @@\r\n         ), $config);\r\n \r\n         \/\/ Add support for constants\r\n-        if (is_string($config['priority'])) {\r\n-            $config['priority'] = constant($config['priority']);\r\n+        if (!is_numeric($config['priority'])) {\r\n+            $config['priority'] = constant(\"Zend_Log::\".$config['priority']);\r\n         }\r\n \r\n         return new self(\r\n-            $config['priority'], \r\n+            (int) $config['priority'],\r\n             $config['operator']\r\n         );\r\n     }\r\n{code}\r\n\r\nThe actual error\r\n\r\nWarning: constant(): Couldn't find constant 4 in \/var\/www\/wetawa\/library\/Zend\/Log\/Filter\/Priority.php on line 82 Fatal error: Uncaught exception 'Zend_Log_Exception' with message 'Priority must be an integer' in \/var\/www\/wetawa\/library\/Zend\/Log\/Filter\/Priority.php:58 Stack trace: #0 \/var\/www\/wetawa\/library\/Zend\/Log\/Filter\/Priority.php(88): Zend_Log_Filter_Priority->__construct(NULL, NULL) #1 [internal function]: Zend_Log_Filter_Priority::factory(Array) #2 \/var\/www\/wetawa\/library\/Zend\/Log.php(201): call_user_func(Array, Array) #3 \/var\/www\/wetawa\/library\/Zend\/Log.php(154): Zend_Log->_constructFromConfig('filter', Array, 'Zend_Log_Filter') #4 \/var\/www\/wetawa\/library\/Zend\/Log.php(139): Zend_Log->_constructFilterFromConfig(Array) #5 \/var\/www\/wetawa\/library\/Zend\/Log.php(400): Zend_Log->_constructWriterFromConfig(Array) #6 \/var\/www\/wetawa\/library\/Zend\/Log.php(114): Zend_Log->addWriter(Array) #7 \/var\/www\/wetawa\/library\/Zend\/Application\/Resource\/Log.php(67): Zend_Log::factory(Array) #8 \/var\/www\/wetawa\/library\/Zend\/Application\/Resource\/Log.php(48): Zend_Application_Resource_Log->getLog() #9 \/var\/www\/wetawa\/library\/Zend\/Application\/Bootstrap\/B in \/var\/www\/wetawa\/library\/Zend\/Log\/Filter\/Priority.php on line 58 "
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8602\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12531",
                    "filename": "prioritydiff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kanundrum",
                        "name": "kanundrum",
                        "displayName": "Akeem Philbert",
                        "active": true
                    },
                    "created": "2009-12-21T18:49:48.000+0000",
                    "size": 742,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12531\/prioritydiff"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10360",
                    "id": 10360,
                    "description": "Minor Release",
                    "name": "1.10.0",
                    "userReleaseDate": "27\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-27",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10460",
                    "id": 10460,
                    "name": "Zend_Application_Resource",
                    "description": "Plugin resources for Zend_Application",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10017",
                    "id": 10017,
                    "name": "Zend_Log",
                    "description": "classic logging utility functions",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37138",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "Thank you for reporting this issue. I am currently enjoying my holidays, but will fix it on January 1st. (unless I turn out to have (more) wifi available).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-12-22T08:48:16.000+0000",
                    "updated": "2009-12-22T08:48:16.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37262",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=simpliest",
                        "name": "simpliest",
                        "displayName": "Sergey Boroday",
                        "active": true
                    },
                    "body": "I think that\r\n{code}\r\nconstant(\"Zend_Log::\".$config['priority']);\r\n{code}\r\nis debatable.\r\nBecause such solution disallow us to use constants from other classes (e.g. own classes).\r\n\r\nBut both _is_numeric_ and _type_ _casting_ to integer required. Because any atomic data goes from config goes as string and now we can't setup priority via number\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=simpliest",
                        "name": "simpliest",
                        "displayName": "Sergey Boroday",
                        "active": true
                    },
                    "created": "2009-12-31T05:46:27.000+0000",
                    "updated": "2009-12-31T05:46:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37263",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kanundrum",
                        "name": "kanundrum",
                        "displayName": "Akeem Philbert",
                        "active": true
                    },
                    "body": "I added the class to find the constant to address the warning shown in the report as well, because the class Zend_Log_Filter_Priority has no constants defined. So this might require a bit of an architectural fix to accommodate developer defined constants. I should have noted that I'm using php 5.3.\r\n ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kanundrum",
                        "name": "kanundrum",
                        "displayName": "Akeem Philbert",
                        "active": true
                    },
                    "created": "2009-12-31T06:04:27.000+0000",
                    "updated": "2009-12-31T06:04:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37307",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "I tried to reproduce, but was not able. Please do provide (much) more information on how to reproduce. The used reproduction code:\r\n{code}    public function testNumericLogStreamFilterParamsPriorityDoesNotFail() {\r\n        $options = array('stream' =>\r\n                        array('writerName'   => 'Stream',\r\n                              'writerParams' => array('stream' => \"php:\/\/memory\",\r\n                                                      'mode' => 'a'),\r\n                        array('filterName' => 'Priority'),\r\n                        array('filterParams' => array('priority' => 4))));\r\n        $resource = new Zend_Application_Resource_Log($options);\r\n        $resource->setBootstrap($this->bootstrap);\r\n        $resource->init();\r\n    }{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2010-01-02T13:37:49.000+0000",
                    "updated": "2010-01-02T13:37:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37308",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kanundrum",
                        "name": "kanundrum",
                        "displayName": "Akeem Philbert",
                        "active": true
                    },
                    "body": "that should have been  <code>array('filterParams' => array('priority' => '4'))));<\/code> since from the config ini it's a string. also note I'm using php 5.3. I'll try to write the failing testCase\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kanundrum",
                        "name": "kanundrum",
                        "displayName": "Akeem Philbert",
                        "active": true
                    },
                    "created": "2010-01-02T13:46:57.000+0000",
                    "updated": "2010-01-02T13:46:57.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37309",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "Adding quotes around the 4 makes no difference.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2010-01-02T14:45:32.000+0000",
                    "updated": "2010-01-02T14:45:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37313",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kanundrum",
                        "name": "kanundrum",
                        "displayName": "Akeem Philbert",
                        "active": true
                    },
                    "body": "The correct test case is:\r\n{code}\r\npublic function testNumericLogStreamFilterParamsPriorityDoesNotFail() {\r\n        $options = array('stream' =>\r\n                        array('writerName'   => 'Stream',\r\n                              'writerParams' => array('stream' => \"php:\/\/memory\",\r\n                                                      'mode' => 'a'),\r\n                        'filterName' => 'Priority',\r\n                        'filterParams' => array('priority' => '4')));\r\n        $resource = new Zend_Application_Resource_Log($options);\r\n        $resource->setBootstrap($this->bootstrap);\r\n        $resource->init();\r\n    }\r\n{code}\r\n\r\nThe test case you are using never tests filters because your 'filterName' is wrapped in an array and line 138 is never hit in Zend\/Log.php",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kanundrum",
                        "name": "kanundrum",
                        "displayName": "Akeem Philbert",
                        "active": true
                    },
                    "created": "2010-01-02T16:42:05.000+0000",
                    "updated": "2010-01-02T16:42:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37406",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "Reassigning as agreed upon on irc",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2010-01-05T12:02:40.000+0000",
                    "updated": "2010-01-05T12:02:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37638",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Fixed in trunk",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2010-01-12T13:29:28.000+0000",
                    "updated": "2010-01-12T13:29:28.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8602\/transitions"
}