{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10623",
    "key": "ZF-10623",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "BBCode Parser returns wrong value for multibyte strings when mbstring.func_overload is enabled"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10623\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=scaror",
                "name": "scaror",
                "displayName": "Rob van Aarle",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-11-02T06:01:28.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T21:37:23.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "{code:title=Example|borderStyle=solid}\r\n$oBbParser = Zend_Markup::factory('Bbcode');\r\necho $oBbParser->render('a[foo]'); \/\/ prints 'a[foo]'\r\necho $oBbParser->render('\u20ac[foo]'); \/\/ prints '\u20ac', but should have printed '\u20ac[foo]'\r\n{code}\r\n\r\nh5.Description\r\nWhen mbstring.func_overload is enabled for strings, the above issue arises. I tracked it down to the Zend_Markup_Parser_Bbcode class. This class relies on preg_match() and its 'offset' parameter). This parameter indicates the start in +bytes+ (_php.net: The optional parameter offset can be used to specify the alternate place from which to start the search (in bytes)_). However, the value of this 'offset' parameter is calculated using strlen().\r\n\r\nh5.Solution\r\nA function to count the number of bytes should be used instead of counting the number of characters. To verify, I've replaced all 4 occurrences of strlen($str) with mb_strlen($str, 'latin1') in the Zend_Markup_Parser_Bbcode class. The example on top prints the correct rendered value then.\r\n\r\nh5.Explanation\r\nWhen mbstring.func_overload is not enabled for strings, then strlen() returns the number of bytes of a multibyte string, and everything works fine. When mbstring.func_overload is enabled for strings, the strlen() function behaves as mb_strlen() and returns the number of characters of a multibyte string. Things go wrong in this case."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10623\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10490",
                    "id": 10490,
                    "description": "Mini Release",
                    "name": "1.10.8",
                    "userReleaseDate": "25\/Aug\/10",
                    "archived": false,
                    "releaseDate": "2010-08-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10471",
                    "id": 10471,
                    "name": "Zend_Markup",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42803",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=scaror",
                        "name": "scaror",
                        "displayName": "Rob van Aarle",
                        "active": true
                    },
                    "body": "'latin' should be 'latin1'",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=scaror",
                        "name": "scaror",
                        "displayName": "Rob van Aarle",
                        "active": true
                    },
                    "created": "2010-11-02T06:10:36.000+0000",
                    "updated": "2010-11-02T06:10:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42804",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kokx",
                        "name": "kokx",
                        "displayName": "Pieter Kokx",
                        "active": true
                    },
                    "body": "I checked this with my own PHP configuration and since the default (and recommended) value for mbstring.func_overload is 0, this is more a configuration problem rather than a coding bug. From my point of view, a note in the documentation would be better than changing the code for this.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kokx",
                        "name": "kokx",
                        "displayName": "Pieter Kokx",
                        "active": true
                    },
                    "created": "2010-11-02T06:34:20.000+0000",
                    "updated": "2010-11-02T06:34:20.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10623\/transitions"
}