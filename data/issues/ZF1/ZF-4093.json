{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4093",
    "key": "ZF-4093",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Adapter checks all fallback LDAP servers even if Zend_Ldap_Exception::LDAP_INVALID_CREDENTIALS returned"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4093\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-10-08T19:00:08.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mmercier",
                "name": "mmercier",
                "displayName": "Michael Mercier",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-08-27T11:50:33.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-10-08T19:00:08.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I have the following situation:\n\n3+ LDAP servers:\nldap.server1.host = ldap-server1\nldap.server2.host = ldap-server2\nldap.server3.host = ldap-server3\n\nIn my environment, user accounts are locked out after 3 invalid authentication attempts (intruder lockout).\n\nWhen using Zend_Auth_Adapter_Ldap with 3 (or more) configured LDAP servers, the adapter will attempt to use all of the servers even if the first returns Zend_Ldap_Exception::LDAP_INVALID_CREDENTIALS.\n\nIf the number of fallback servers is greater or equal to the number of attempts allowed before intruder lockout, the user will be locked out on first authentication attempt if they have entered the wrong password..\n\nMy resolution for this was the following (near line 239):\n{code}\n} else if ($err == Zend_Ldap_Exception::LDAP_INVALID_CREDENTIALS) {\n   $code = Zend_Auth_Result::FAILURE_CREDENTIAL_INVALID;\n   $message[0] = \"Invalid credentails\";\n   break; \/\/ stop, we don't want the adapter to fallback on other servers if the password was wrong, this can potentially cause an intruder lockout\n}\n{code}\n\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4093\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=miallen",
                "name": "miallen",
                "displayName": "Michael B Allen",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10161",
                    "id": 10161,
                    "description": "Mini Release",
                    "name": "1.5.3",
                    "userReleaseDate": "28\/Jul\/08",
                    "archived": true,
                    "releaseDate": "2008-07-28",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10280",
                    "id": 10280,
                    "name": "Zend_Auth_Adapter_Ldap",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23779",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=miallen",
                        "name": "miallen",
                        "displayName": "Michael B Allen",
                        "active": true
                    },
                    "body": "That is only true when multiple servers are used for redundancy. If you are using multiple servers to support different domains the above logic would not be suitable.\n\nBut clearly this is a problem in the redundancy case. What needs to happen is that the authenticate() loop needs to track which domains have returned LDAP_INVALID_CREDENTIALS and then ignore additional server options with the same accountDomainName.\n\n$invalidCredentials = array();\nforeach ($serverOptions as $options) {\n    $accountDomainName = $options['accountDomainName']\n    if (isset($invalidCredentials[$accountDomainName])) {\n        \/\/ invalid cred returned for this domain already, skip it ...\n        continue;\n    }\n\n    \/\/ try bind\n\n    if ($err === Zend_Ldap_Exception::LDAP_INVALID_CREDENTIALS) {\n        $invalidCredentials[$accountDomainName] = true;\n    }\n}\n\nAlso, note that servers might return different errors given a bad password. This will need to be researched.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=miallen",
                        "name": "miallen",
                        "displayName": "Michael B Allen",
                        "active": true
                    },
                    "created": "2008-08-27T13:25:10.000+0000",
                    "updated": "2008-08-27T13:25:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24910",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=miallen",
                        "name": "miallen",
                        "displayName": "Michael B Allen",
                        "active": true
                    },
                    "body": "Fixed in 11765.\n\nMultiple sets of server options with the same accountDomainName (actually an \"authority name\" determined by querying the domain options - or lack thereof) will be skipped if the username or credentials were already determined to be invalid with a server in the same domain.\n\nFor example, if you have three sets of server options and all of them have accountDomainName = foo.net and the first server returns \"Invalid credentials\", the other servers will be skipped.\n\nWithout this update, each server may be tried with a bad password and may trigger a password policy violation that could result in the account being locked out.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=miallen",
                        "name": "miallen",
                        "displayName": "Michael B Allen",
                        "active": true
                    },
                    "created": "2008-10-08T19:00:07.000+0000",
                    "updated": "2008-10-08T19:00:07.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4093\/transitions"
}