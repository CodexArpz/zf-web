{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4839",
    "key": "ZF-4839",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "ControllerTestCase broken with PHPUnit 3.3.3"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4839\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10360",
                    "id": 10360,
                    "description": "Minor Release",
                    "name": "1.10.0",
                    "userReleaseDate": "27\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-27",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-01-21T10:13:16.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sgehrig",
                "name": "sgehrig",
                "displayName": "Stefan Gehrig",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-11-06T12:30:50.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-01-21T10:13:17.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Zend_Test_PHPUnit_ControllerTestCase is broken with PHPUnit 3.3.3 (most recent version) in revision 12333.\nControllerTestCase uses {{PHPUnit_Framework_TestCase::incrementAssertionCounter()}} in line 1099, but this method is not available any more with PHPUnit 3.3.3 (don't know in which version this was removed). The appropriate method in PHPUnit 3.3.3 is {{PHPUnit_Framework_TestCase::addToAssertionCount($count)}}.\n\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4839\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10260",
                    "id": 10260,
                    "description": "Minor Release",
                    "name": "1.7.0",
                    "userReleaseDate": "17\/Nov\/08",
                    "archived": false,
                    "releaseDate": "2008-11-17",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10340",
                    "id": 10340,
                    "description": "Mini Release",
                    "name": "1.8.4",
                    "userReleaseDate": "23\/Jun\/09",
                    "archived": false,
                    "releaseDate": "2009-06-23",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10312",
                    "id": 10312,
                    "name": "Zend_Test_PHPUnit",
                    "description": "PHPUnit test scaffolding for ZF MVC applications",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25843",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Fixed in r12372; now checks for PHPUnit version and calls appropriate method for that version.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-11-07T08:32:29.000+0000",
                    "updated": "2008-11-07T08:32:29.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25847",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sgehrig",
                        "name": "sgehrig",
                        "displayName": "Stefan Gehrig",
                        "active": true
                    },
                    "body": "Still not solved...\n\nLine 1098 now reads \n{code}\nif (version_compare('3.3.3', PHPUnit_Runner_Version::id(), 'lt')) {\n{code}\nbut must be\n{code}\nif (version_compare('3.3.3', PHPUnit_Runner_Version::id(), '<=')) {\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sgehrig",
                        "name": "sgehrig",
                        "displayName": "Stefan Gehrig",
                        "active": true
                    },
                    "created": "2008-11-07T09:00:23.000+0000",
                    "updated": "2008-11-07T09:00:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25848",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sgehrig",
                        "name": "sgehrig",
                        "displayName": "Stefan Gehrig",
                        "active": true
                    },
                    "body": "Still not solved...\n\nLine 1098 now reads\n\n{code}\nif (version_compare('3.3.3', PHPUnit_Runner_Version::id(), 'lt')) {\n{code}\n\nbut must be\n\n{code}\nif (version_compare('3.3.3', PHPUnit_Runner_Version::id(), 'le')) {\n{code}\n\nor \n\n{code}\nif (version_compare('3.3.3', PHPUnit_Runner_Version::id(), '<=')) {\n{code}\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sgehrig",
                        "name": "sgehrig",
                        "displayName": "Stefan Gehrig",
                        "active": true
                    },
                    "created": "2008-11-07T09:02:02.000+0000",
                    "updated": "2008-11-07T09:02:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25853",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Um... no. We don't want <=, because at version 3.3.3 the change was introduced. Versions _less than_ 3.3.3 require the handling as originally written.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-11-07T09:17:57.000+0000",
                    "updated": "2008-11-07T09:17:57.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25856",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sgehrig",
                        "name": "sgehrig",
                        "displayName": "Stefan Gehrig",
                        "active": true
                    },
                    "body": "Please see my comments in the following code:\n\n{code}\n\/**\n     * Increment assertion count\n     * \n     * @return void\n     *\/\n    protected function _incrementAssertionCount()\n    {\n        $stack = debug_backtrace(); \/\/ why calling debug_backtrace() twice?\n        foreach (debug_backtrace() as $step) {\n            if (isset($step['object']) \n                && $step['object'] instanceof PHPUnit_Framework_TestCase\n            ) {\n                if (version_compare('3.3.3', PHPUnit_Runner_Version::id(), 'lt')) { \/\/ if 3.3.3 < CURRENT_VERSION do\n                    $step['object']->addToAssertionCount(1);\n                } else { \/\/ if 3.3.3 >= CURRENT_VERSION do\n                    $step['object']->incrementAssertionCounter();\n                }\n                break;\n            }\n        }\n    }\n{code}\n\nBut in PHPUnit 3.3.3 {{incrementAssertionCounter()}} is not available any more... ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sgehrig",
                        "name": "sgehrig",
                        "displayName": "Stefan Gehrig",
                        "active": true
                    },
                    "created": "2008-11-07T09:31:25.000+0000",
                    "updated": "2008-11-07T09:31:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25857",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sgehrig",
                        "name": "sgehrig",
                        "displayName": "Stefan Gehrig",
                        "active": true
                    },
                    "body": "Please see my comments in the following code:\n\n{code}\n\/**\n     * Increment assertion count\n     * \n     * @return void\n     *\/\n    protected function _incrementAssertionCount()\n    {\n        $stack = debug_backtrace(); \/\/ why calling debug_backtrace() twice?\n        foreach (debug_backtrace() as $step) {\n            if (isset($step['object']) \n                && $step['object'] instanceof PHPUnit_Framework_TestCase\n            ) {\n                if (version_compare('3.3.3', PHPUnit_Runner_Version::id(), 'lt')) { \/\/ if 3.3.3 < CURRENT_VERSION do\n                    $step['object']->addToAssertionCount(1);\n                } else { \/\/ if 3.3.3 >= CURRENT_VERSION do\n                    $step['object']->incrementAssertionCounter();\n                }\n                break;\n            }\n        }\n    }\n{code}\n\nBut in PHPUnit 3.3.3 {{incrementAssertionCounter()}} is not available any more... \n\nSorry to bother you with this!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sgehrig",
                        "name": "sgehrig",
                        "displayName": "Stefan Gehrig",
                        "active": true
                    },
                    "created": "2008-11-07T09:32:55.000+0000",
                    "updated": "2008-11-07T09:32:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25859",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I've rewritten it to the following:\n{code}\nif (version_compare(PHPUnit_Runner_Version::id(), '3.3.3', 'lt')) {\n    $step['object']->incrementAssertionCounter();\n} else {\n    $step['object']->addToAssertionCount(1);\n}\n{code}\nwhich should make the intention clearer.\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-11-07T10:04:31.000+0000",
                    "updated": "2008-11-07T10:04:31.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/27070",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vladev",
                        "name": "vladev",
                        "displayName": "Emil Ivanov",
                        "active": true
                    },
                    "body": "We are running from an svn:externals of phpunit and it doesn't have a version there. Can this be some sort of other check, for example method_exists or something?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vladev",
                        "name": "vladev",
                        "displayName": "Emil Ivanov",
                        "active": true
                    },
                    "created": "2008-12-05T05:58:23.000+0000",
                    "updated": "2008-12-05T05:58:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/27075",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Sure. I'm reopening the issue so we can track that.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-12-05T08:13:41.000+0000",
                    "updated": "2008-12-05T08:13:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/27076",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Changing to trivial and improvement, as it will work for most users of PHPUnit as-is right now; the improvement is for those tracking svn of PHPUnit.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-12-05T08:14:45.000+0000",
                    "updated": "2008-12-05T08:14:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30362",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bhazzard",
                        "name": "bhazzard",
                        "displayName": "Brian Hazzard",
                        "active": true
                    },
                    "body": "I too have this issue. I tried changing the source code to the method_exists approach and had no luck. I also tried a hack-fix of defining incrementAssertionCounter in my test class and simply calling addToAssertionCount(1) in it's body... again, no luck. Has this been resolved?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bhazzard",
                        "name": "bhazzard",
                        "displayName": "Brian Hazzard",
                        "active": true
                    },
                    "created": "2009-04-24T05:55:12.000+0000",
                    "updated": "2009-04-24T05:55:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30365",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bhazzard",
                        "name": "bhazzard",
                        "displayName": "Brian Hazzard",
                        "active": true
                    },
                    "body": "In the meantime \"upgrading\" to PHPUnit 3.3.16 does indeed fix this problem.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bhazzard",
                        "name": "bhazzard",
                        "displayName": "Brian Hazzard",
                        "active": true
                    },
                    "created": "2009-04-24T06:12:44.000+0000",
                    "updated": "2009-04-24T06:12:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31121",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ibonilla",
                        "name": "ibonilla",
                        "displayName": "Ivan Bonilla Cortes",
                        "active": true
                    },
                    "body": "This actually affects more users than those tracking svn of PHPUnit:\nNeither incrementAssertionCounter nor addtoAssertionCount exist on versions prior to 3.3.0\nincrementAssertionCounter exists on versions 3.3.0 to 3.3.2\naddtoAssertionCount exists on versions 3.3.3 and on\n\nYou may be wondering why someone would want to use an older version of phpunit. Sadly the latest version that ubuntu gnu\/linux packages is 3.2.16:\nhttp:\/\/packages.ubuntu.com\/jaunty\/phpunit\nso this bug affects all ubuntu users that want to use a package manager.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ibonilla",
                        "name": "ibonilla",
                        "displayName": "Ivan Bonilla Cortes",
                        "active": true
                    },
                    "created": "2009-05-18T16:56:42.000+0000",
                    "updated": "2009-05-18T16:56:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32319",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "As mentioned in the previous comment, somewhat older versions of PHPUnit don't have any of these methods for the simple reason that not all distributions are as keen on keeping everything cutting edge as others :'(\n\nIf there's no alternate solution in versions before 3.3.0 of PHPUnit, I suggest a following 'fix':\n{code}\n                if (version_compare(PHPUnit_Runner_Version::id(), '3.3.0', 'lt')) {\n                    break; \/\/ Do nothing\n                } elseif (version_compare(PHPUnit_Runner_Version::id(), '3.3.3', 'lt')) {\n                    $step['object']->incrementAssertionCounter();\n                } else {\n                    $step['object']->addToAssertionCount(1);\n                }\n                break;{code}\n\nI'm setting the priority to major, as for there will certainly be many more people running distros like these...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-07-01T07:35:41.000+0000",
                    "updated": "2009-07-01T07:35:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32609",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lornajane",
                        "name": "lornajane",
                        "displayName": "Lorna Mitchell",
                        "active": true
                    },
                    "body": "I ran into this issue as well - using debian lenny, ZF 1.8 and the standard phpunit from apt-get which is 3.2.167.  The patch from Dolf works perfectly for me (thanks!)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lornajane",
                        "name": "lornajane",
                        "displayName": "Lorna Mitchell",
                        "active": true
                    },
                    "created": "2009-07-16T04:24:05.000+0000",
                    "updated": "2009-07-16T04:24:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37900",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Fixed in trunk and 1.10 release branch.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2010-01-21T10:13:16.000+0000",
                    "updated": "2010-01-21T10:13:16.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4839\/transitions"
}