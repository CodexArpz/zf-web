{
    "expand": "html",
    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-897",
    "key": "ZF-897",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Db_Select generates not working queries"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-897\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/version\/10021",
                    "id": 10021,
                    "description": "Preview release; DB, Filter, Log",
                    "name": "0.8.0",
                    "userReleaseDate": "21\/Feb\/07",
                    "archived": true,
                    "releaseDate": "2007-02-21",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-02-09T19:59:06.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=wojciech",
                "name": "wojciech",
                "displayName": "Wojciech Naruniec",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-02-09T08:29:46.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-05T14:43:49.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "There is a simple query with one join:\n\n{code}\n$select->from('foo', '*'); \n$select->join('bar', 'foo.id = bar.id', '*'); \n{code}\n\nIt should produce sql query like this:\n\n{code}\nSELECT foo.*, bar.* \nFROM foo \nJOIN bar ON foo.id = bar.id \n{code}\n\nBut it produces this sql query:\n\n{code}\nSELECT foo_1.*, bar_1.* \nFROM foo foo_1\nJOIN bar bar_1 ON foo.id = bar.id \n{code}\n\nIt doesn't work, PDO throwns exception: \n\"SQLSTATE[42S02]: Base table or view not found: 1109 Unknown table 'foo' in on clause\"\n\nThis bug affects some other methods eg. Zend_Db_Select::where() and it is connected with correlations feature added on last commit."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-897\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                "name": "bkarwin",
                "displayName": "Bill Karwin",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-896",
                    "issue": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-896",
                    "type": {
                        "name": "Dependency",
                        "direction": "OUTBOUND",
                        "description": "depends on"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/component\/10132",
                    "id": 10132,
                    "name": "Zend_Db_Select",
                    "description": "OO interface to building a SELECT SQL query.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12639",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=arikon",
                        "name": "arikon",
                        "displayName": "Sergey Belov",
                        "active": true
                    },
                    "body": "Dublicate",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=arikon",
                        "name": "arikon",
                        "displayName": "Sergey Belov",
                        "active": true
                    },
                    "created": "2007-02-09T08:56:11.000+0000",
                    "updated": "2007-02-09T08:56:11.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12652",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=arikon",
                        "name": "arikon",
                        "displayName": "Sergey Belov",
                        "active": true
                    },
                    "body": "One more bug with generation of query:\n{code}\n$select = $this->db\n    ->select()\n    ->from(array('nstree' => 't1'), array('left_key', 'right_key', 'id'))\n    ->joinLeft(array('nstree' => 'j1'), \n        '(j1.right_key >= t1.right_key AND j1.left_key <= t1.left_key)', \n        \"GROUP_CONCAT(d.uri_part ORDER BY j1.level ASC SEPARATOR '\/') AS path\")\n    ->joinLeft(array('pages' => 'd'), '(j1.page_id = d.id)', 'uri_part');\n{code}\nshould produce\n{code}\nSELECT\n    t1.*,\n    GROUP_CONCAT(d.uri_part ORDER BY j1.level ASC SEPARATOR '\/') AS path,\n    d.uri_part\nFROM nstree t1\nLEFT JOIN nstree j1 ON (j1.right_key >= t1.right_key AND j1.left_key <= t1.left_key)\nLEFT JOIN pages d ON (j1.page_id = d.id)\n{code}\nbut produces\n{code}\nSELECT\n    t1.*,\n    j1.GROUP_CONCAT(d.uri_part ORDER BY j1.level ASC SEPARATOR '\/') AS path,\n    d.uri_part\nFROM nstree t1\nLEFT JOIN nstree j1 ON (j1.right_key >= t1.right_key AND j1.left_key <= t1.left_key)\nLEFT JOIN pages d ON (j1.page_id = d.id)\n{code}\nproblem is in \"j1.\" before \"GROUP_CONCAT\"",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=arikon",
                        "name": "arikon",
                        "displayName": "Sergey Belov",
                        "active": true
                    },
                    "created": "2007-02-09T12:53:01.000+0000",
                    "updated": "2007-02-09T12:53:01.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12655",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=arikon",
                        "name": "arikon",
                        "displayName": "Sergey Belov",
                        "active": true
                    },
                    "body": "Maybe this could help.\nI'm using this workaround to avoid adding correlation name to \"custom\" fields.\n{code}\nIndex: library\/Zend\/Db\/Select.php\n===================================================================\n--- library\/Zend\/Db\/Select.php\t(revision 3324)\n+++ library\/Zend\/Db\/Select.php\t(working copy)\n@@ -638,6 +638,10 @@\n         settype($cols, 'array');\n \n         foreach ($cols as $col) {\n+            if (preg_match(\"\/[\\(\\)]\/\", $col)) {\n+                $this->_parts[self::COLUMNS][''][] = trim($col);\n+                continue;\n+            }\n             $this->_parts[self::COLUMNS][$correlationName][] = trim($col);\n         }\n     }\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=arikon",
                        "name": "arikon",
                        "displayName": "Sergey Belov",
                        "active": true
                    },
                    "created": "2007-02-09T13:07:21.000+0000",
                    "updated": "2007-02-09T13:07:21.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12660",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "I don't think it would be good to do that kind of pattern-matching on the column name.  Column names that are quoted can contain parentheses as part of the identifier.  \n\nThere are also other cases that should not be prepended with the correlation name that do not contain parens.\n\nI am proposing a different solution for this issue.  See ZF-900.\n\nYou can specify the correlation name.  Correlation names can be identical to the physical table name.  For example:\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-02-09T15:49:20.000+0000",
                    "updated": "2007-02-09T15:49:20.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12661",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Sorry, I hit send too soon.\n\nThe issue at the top of this issue report is that the class generates correlation names, and these do not match the correlation names in your join condition.\n\nYou can specify the correlation name. Correlation names can be identical to the physical table name. For example:\n{code}\n$select->from( array('foo' => 'foo'), '*'); \n$select->join( array('bar' => 'bar'), 'foo.id = bar.id', '*');\n{code}\n\nThe secondary issues reported above are different; they are related to adding expressions to the select-list that should not have correlation names prepended.  Another workaround for this is the following:\n{code}\n$select = $this->db\n    ->select()\n    ->from(array('nstree' => 't1'), array('left_key', 'right_key', 'id'))\n    ->from( '', \"GROUP_CONCAT(d.uri_part ORDER BY j1.level ASC SEPARATOR '\/') AS path\")\n    ->joinLeft(array('nstree' => 'j1'), \n        '(j1.right_key >= t1.right_key AND j1.left_key <= t1.left_key)', array() )\n    ->joinLeft(array('pages' => 'd'), '(j1.page_id = d.id)', 'uri_part');\n{code}\n\nAbove you see that if you pass '' as the table name, it does not generate a correlation name but it does add the named column to the select-list.  Also, you can specify an empty {{array()}} for the column list in the {{joinLeft()}} method, which will add no columns from j1to the select-list.  Otherwise it defaults to {{'*'}}.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-02-09T15:54:10.000+0000",
                    "updated": "2007-02-09T15:54:10.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12665",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "I'm resolving this issue as \"Not an Issue\".\nI intend to enhance Zend_Db_Select more, but it will be recorded under different issues in JIRA.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-02-09T19:59:06.000+0000",
                    "updated": "2007-02-09T19:59:06.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-897\/transitions"
}