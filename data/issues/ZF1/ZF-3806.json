{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3806",
    "key": "ZF-3806",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Problem with stored procedure and MySql"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3806\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10340",
                    "id": 10340,
                    "description": "Mini Release",
                    "name": "1.8.4",
                    "userReleaseDate": "23\/Jun\/09",
                    "archived": false,
                    "releaseDate": "2009-06-23",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-06-17T14:06:16.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shlomov",
                "name": "shlomov",
                "displayName": "Shlomo Vanunu",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-07-30T05:06:14.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-06-17T14:06:16.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I need your help with a stored procedure in MySql using ZendFramework:\n\nThis is the stored:\nDELIMITER $$\nDROP PROCEDURE IF EXISTS `test`.`p1` $$\nCREATE DEFINER=`root`@`%` PROCEDURE `p1`(IN p_in INT, OUT p_out INT)\nBEGIN\n\nSELECT concat(\"VALORE DI p_in: \", p_in) as VALORE;\n# Creo il valore di output\nSET p_out = p_in * 100;\nEND $$\nDELIMITER ;\n\nThis is the result on MySql command prompt:\nmysql> SET @prova = 100;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> CALL p1 (9, @prova);\n+-------------------+\n| VALORE |\n+-------------------+\n| VALORE DI p_in: 9 |\n+-------------------+\n1 row in set (0.00 sec)\n\nQuery OK, 0 rows affected (0.09 sec)\n\nmysql> SELECT @prova;\n+--------+\n| @prova |\n+--------+\n| 900 |\n+--------+\n1 row in set (0.02 sec)\n\nNow the php script:\n<?php\nrequire_once 'Zend\/Db.php';\nrequire_once 'Zend\/Db\/Adapter\/Mysqli.php';\n\n$db = new Zend_Db_Adapter_Mysqli(array(\n'host' => 'localhost',\n'username' => 'mito',\n'password' => 'test',\n'dbname' => 'test'\n));\n$prova = 0;\n$out_in = 100;\n\n$sql = \"SET @prova = 100\";\n$stmt = new Zend_Db_Statement_Mysqli($db, $sql);\n$stmt->execute();\n\n$sql = \"CALL p1 (?, @prova)\";\n$stmt = new Zend_Db_Statement_Mysqli($db, $sql);\n$stmt->execute(array(60));\n$row = $stmt->fetchAll();\n\nprint \"<pre>\";\nprint_r($row);\nprint \"<\/pre>\";\n\n\/\/$nextRowset = $stmt->nextRowset();\n$closeCursor = $stmt->closeCursor();\n$close = $stmt->close();\n\n\/\/ Retrieve variable\n$sql = \"SELECT @prova\";\n$stmt2 = new Zend_Db_Statement_Mysqli($db, $sql);\n$stmt2->execute();\n$prova = $stmt2->fetch();\n\necho \"value: \" . $prova;\n?>\n\nRunning the script I have an error at this istruction: $stmt2 = new Zend_Db_Statement_Mysqli($db, $sql);\nDebug Error: \/cabelweb\/lib\/PHP\/ZendFramework-1.5.1\/library\/Zend\/Db\/Statement\/Mysqli.php line 85 - Uncaught exception 'Zend_Db_Statement_Mysqli_Exception' with message 'Mysqli prepare error: Commands out of sync; you can't run this command now' in \/cabelweb\/lib\/PHP\/ZendFramework-1.5.1\/library\/Zend\/Db\/Statement\/Mysqli.php:85\nStack trace:\n#0 \/cabelweb\/lib\/PHP\/ZendFramework-1.5.1\/library\/Zend\/Db\/Statement.php(109): Zend_Db_Statement_Mysqli->_prepare('SELECT @prova')\n#1 \/cabelweb\/bin\/PHP\/com\/cabel\/apps\/test\/zend_framework\/mysql\/stored_exec_ZF.php(35): Zend_Db_Statement->__construct(Object(Zend_Db_Adapter_Mysqli), 'SELECT @prova')\n#2 {main}\nthrown\n\nWhy this behavior? Where is the problem?\nThanks in advance"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/customFieldOption\/10039",
                "value": "  Should Have"
            }
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3806\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10174",
                    "id": 10174,
                    "description": "Mini Release",
                    "name": "1.5.1",
                    "userReleaseDate": "25\/Mar\/08",
                    "archived": true,
                    "releaseDate": "2008-03-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10131",
                    "id": 10131,
                    "name": "Zend_Db_Adapter_Mysqli",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23778",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Hi Shlomo,\n\nI think we have a fix for this inside ZF 1.6 coming up soon.\n\nIf you are interested in a patch, please check this:\n\nhttp:\/\/framework.zend.com\/code\/changelog\/Standard_Library?cs=9738\n\nmore specfifically, this file and change:\n\nhttp:\/\/framework.zend.com\/code\/browse\/Standard_Library\/trunk\/library\/Zend\/Db\/Statement\/Mysqli.php?r1=9573&r2=9738\n\nAs you can see, the closeCursor() method gets a next_result call to the Mysqli statement object.  The reason this is necessary is b\/c stored procedure calls always return multiple result sets (presumably the last result set is for the exit status code).  Please try this and let me know if it works.\n\nThanks!\nRalph Schindler",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2008-08-27T13:04:25.000+0000",
                    "updated": "2008-08-27T13:04:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31929",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "No response from reporter, this issue appears to have been fixed in 1.6.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2009-06-17T14:06:16.000+0000",
                    "updated": "2009-06-17T14:06:16.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3806\/transitions"
}