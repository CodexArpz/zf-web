{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9148",
    "key": "ZF-9148",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Cache_Backend_Static doesn't  work properly"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9148\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-03-16T05:22:35.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikitug",
                "name": "nikitug",
                "displayName": "Nikita Afanasenko",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-02-11T08:46:04.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-03-16T05:22:35.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I'm trying to use Zend_Cache_Backend_Static like this:\r\n\r\n{code:title=Bootstrap.php}\r\nprotected function _initCache()\r\n{\r\n    $manager = new Zend_Cache_Manager();  \r\n    $manager->setCacheTemplate('page', array(\r\n        'frontend' => array(\r\n            'name'    => 'Capture',\r\n            'options' => array(\r\n                'ignore_user_abort' => true,\r\n                'automatic_serialization' => true\r\n            ),\r\n        ),\r\n        'backend' => array(\r\n            'name'    => 'Static',\r\n            'options' => array(\r\n                'public_dir' => 'cache',\r\n            ),\r\n        ),\r\n    ));\r\n    $manager->getCache('page')->start('nothing', array());\r\n}\r\n{code}\r\n\r\nFirstly, why i have to specify {{$id}} and {{$tag}} in {{start()}}? Why not just {{$manager->getCache('page')->start()}}?\r\n\r\nThen, in Zend_Cache_Backend_Static:\r\n{code}\r\nif (is_null($id) || strlen($id) == 0) {\r\n    $id = $this->_detectId();\r\n} else {\r\n    $id = $this->_decodeId($id);\r\n}\r\n{code}\r\n\r\nBut {{$id}} couldn't ever be {{null}} or {{\"\"}}. It's impossible to call {{start('', array())}}, because {{Zend_Cache_Core::_validateIdOrTag}} will throw exception {{\"Invalid id or tag '$string' : must use only [a-zA-Z0-9_]\"}}. So, {{$id = $this->_detectId();}} will never be executed, and {{$id = $this->_decodeId($id);}} will produce wrong filename.\r\n\r\nThen, in \r\n{code}$pathName = realpath($this->_options['public_dir']) . dirname($id);{code}\r\n{{$pathName}} become {{\"bla-bla\/public\/cache.\"}}, and name of file to be created become {{\"bla-bla\/public\/cache.\/index.html\"}}.\r\n\r\nSo, is it's my mistake or it's really BUG?"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9148\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                "name": "padraic",
                "displayName": "P\u00e1draic Brady",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10412",
                    "id": 10412,
                    "description": "Mini Release",
                    "name": "1.10.1",
                    "userReleaseDate": "10\/Feb\/10",
                    "archived": false,
                    "releaseDate": "2010-02-10",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10028",
                    "id": 10028,
                    "name": "Zend_Cache",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38404",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "body": "Reassigned for Padraic",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "created": "2010-02-11T09:05:03.000+0000",
                    "updated": "2010-02-11T09:05:03.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38408",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                        "name": "padraic",
                        "displayName": "P\u00e1draic Brady",
                        "active": true
                    },
                    "body": "It's important to remember that the static cache doesn't work like the other caches. It's designed to be a transparent backend system triggered from a controller action, and as such, it's entire operation is dictated by the Zend_Controller_Action_Helper_Cache class. About the only thing you should change is the location of the public_dir (you're using a non-path above - use the absolute path).\r\n\r\nTo offer a few points of difference:\r\n\r\nIDs are the request URI, however the ID passed to the backend must first be encoded as hexadecimal characters (i.e. bin2hex()) to bypass the Zend_Cache_Core ID restrictions. The request URI may be empty (root URI) and detectId() simply adds a check to ensure this isn't an error passed along by mistake.\r\n\r\nTags are not stored to the static cache, since the static cache holds files to be served OUTSIDE of PHP. The tags are stored to an \"inner\" cache instead. The inner cache is managed by the backend, and so tags need to be passed at that point.\r\n\r\nData is never serialized unless it also requires a custom extension name outside of the default option. So setting automatic_serialization, as above, should not be done.\r\n\r\nThe cache is intended to be managed via the Cache action manager which allows you to setup which actions in a controller to cache, with what extension, and with which tags. It also offers methods for removing\/purging the cache using the request URI or tags (the tag cleaning is similar to other backends). Use outside of the action helper should use the helper itself as a reference point for manual management. Manually, you would also need to register a helper\/plugin to trigger the Capture frontend.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                        "name": "padraic",
                        "displayName": "P\u00e1draic Brady",
                        "active": true
                    },
                    "created": "2010-02-11T09:31:54.000+0000",
                    "updated": "2010-02-11T09:31:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38409",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                        "name": "padraic",
                        "displayName": "P\u00e1draic Brady",
                        "active": true
                    },
                    "body": "Here's an example from a current project:\r\n\r\n.htaccess (includes extra settings for local XML feeds):\r\n\r\n{code}AddType application\/rss+xml .xml\r\nAddType application\/atom+xml .xml\r\n\r\nRewriteEngine On\r\n\r\nRewriteCond %{REQUEST_URI} feed\/rss$\r\nRewriteCond %{DOCUMENT_ROOT}\/cached\/%{REQUEST_URI}.xml -f\r\nRewriteRule .* cached\/%{REQUEST_URI}.xml [L,T=application\/rss+xml]\r\n\r\nRewriteCond %{REQUEST_URI} feed\/atom$\r\nRewriteCond %{DOCUMENT_ROOT}\/cached\/%{REQUEST_URI}.xml -f\r\nRewriteRule .* cached\/%{REQUEST_URI}.xml [L,T=application\/atom+xml]\r\n\r\nRewriteCond %{DOCUMENT_ROOT}\/cached\/index.html -f\r\nRewriteRule ^\/*$ cached\/index.html [L]\r\nRewriteCond %{DOCUMENT_ROOT}\/cached\/%{REQUEST_URI}.(html|xml|json|opml) -f\r\nRewriteRule .* cached\/%{REQUEST_URI}.%1 [L]\r\n\r\nRewriteCond %{REQUEST_FILENAME} -s [OR]\r\nRewriteCond %{REQUEST_FILENAME} -l [OR]\r\nRewriteCond %{REQUEST_FILENAME} -d\r\nRewriteRule ^.*$ - [NC,L]\r\n\r\nRewriteRule ^.*$ index.php [NC,L]{code}\r\n\r\napplication.ini:\r\n\r\n{code}; Custom Caches (Adjustments To Default CacheManager)\r\nresources.cacheManager.page.backend.options.public_dir = APPLICATION_PATH \"\/..\/public\/cached\"\r\nresources.cacheManager.pagetag.backend.options.cache_dir = APPLICATION_PATH \"\/..\/data\/cache\/tags\"{code}\r\n\r\nIndexController (Cached):\r\n\r\n{code}class Zfplanet_IndexController extends Zend_Controller_Action\r\n{\r\n\r\n    protected $_paginator = null;\r\n\r\n    public function init()\r\n    {\r\n        $this->_paginator = new Zend_Paginator(\r\n            Doctrine_Core::getTable('Zfplanet_Model_Entry')\r\n        );\r\n        $this->view->paginator = $this->_paginator;\r\n        $this->_helper->cache(array('index', 'page'), array('allentries'));\r\n    }\r\n\r\n    public function indexAction()\r\n    {\r\n        $this->_paginator->setCurrentPageNumber(1);\r\n    }\r\n    \r\n    public function pageAction()\r\n    {\r\n        $this->_helper->viewRenderer->setNoRender();\r\n        $this->_paginator->setCurrentPageNumber(\r\n            $this->_getParam('pageNumber')\r\n        );\r\n        $this->render('index');\r\n    }\r\n\r\n}{code}\r\n\r\nCache Purging (Here, after a feed is polled (updates index\/pages with new content)):\r\n\r\n{code}<?php\r\n\r\nclass Zfplanet_CallbackController extends Zend_Controller_Action\r\n{\r\n\r\n    public function processAction()\r\n    {\r\n        \/\/ ...\r\n        $this->_helper->getHelper('Cache')->removePagesTagged(array('allentries'));\r\n        \/\/ ...\r\n    }\r\n\r\n}{code}\r\n\r\nThis works perfectly fine here.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                        "name": "padraic",
                        "displayName": "P\u00e1draic Brady",
                        "active": true
                    },
                    "created": "2010-02-11T09:38:44.000+0000",
                    "updated": "2010-02-11T09:38:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38410",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikitug",
                        "name": "nikitug",
                        "displayName": "Nikita Afanasenko",
                        "active": true
                    },
                    "body": "Padraic, thanks a lot!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikitug",
                        "name": "nikitug",
                        "displayName": "Nikita Afanasenko",
                        "active": true
                    },
                    "created": "2010-02-11T09:46:24.000+0000",
                    "updated": "2010-02-11T09:46:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39276",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                        "name": "padraic",
                        "displayName": "P\u00e1draic Brady",
                        "active": true
                    },
                    "body": "Closing - report was the result of a misundertanding of how the static cache operated. Nothing to fix ;).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                        "name": "padraic",
                        "displayName": "P\u00e1draic Brady",
                        "active": true
                    },
                    "created": "2010-03-16T05:22:35.000+0000",
                    "updated": "2010-03-16T05:22:35.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9148\/transitions"
}