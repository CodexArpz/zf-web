{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2982",
    "key": "ZF-2982",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Keyword field are not searchable using the QueryParser if not lowercase"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2982\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-05-05T03:15:59.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=pallaert",
                "name": "pallaert",
                "displayName": "Patrick ALLAERT",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-03-27T09:08:20.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-05-05T03:15:59.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I have to enter my keyword lowercase to find them with the QueryParser, otherwise I get no results.\n\nHow to reproduce:\n\n<?php\n\nrequire 'Zend\/Search\/Lucene.php';\n\n$index = Zend_Search_Lucene::create('test');\n\n$doc = new Zend_Search_Lucene_Document();\n\n$doc->addField(Zend_Search_Lucene_Field::Keyword('firstname', 'Patrick'));\n$doc->addField(Zend_Search_Lucene_Field::Keyword('lastname', 'Allaert'));\n\n$index->addDocument($doc);\n\n\/\/ ------------> OOPS, expecting \"1\" in both cases\necho count($index->find(Zend_Search_Lucene_Search_QueryParser::parse('Patrick'))) . \"\\n\"; \/\/ print \"0\"\necho count($index->find(Zend_Search_Lucene_Search_QueryParser::parse('patrick'))) . \"\\n\"; \/\/ print \"0\"\n\n$index = Zend_Search_Lucene::create('test2');\n\n$doc = new Zend_Search_Lucene_Document();\n\n$doc->addField(Zend_Search_Lucene_Field::Keyword('firstname', 'patrick'));\n$doc->addField(Zend_Search_Lucene_Field::Keyword('lastname', 'allaert'));\n\n$index->addDocument($doc);\n\n\/\/ OK, here i correctly have \"1\" in both cases\necho count($index->find(Zend_Search_Lucene_Search_QueryParser::parse('Patrick'))) . \"\\n\";  \/\/ print \"1\"\necho count($index->find(Zend_Search_Lucene_Search_QueryParser::parse('patrick'))) . \"\\n\";  \/\/ print \"1\"\n\n?>"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/customFieldOption\/10040",
                "value": " Nice to Have"
            }
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2982\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "state:need-feedback",
                "zf-caretaker-adamlundrigan",
                "zf-crteam-padraic",
                "zf-crteam-priority",
                "zf-crteam-review"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                "name": "adamlundrigan",
                "displayName": "Adam Lundrigan",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-623",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-623",
                    "type": {
                        "name": "Duplicate",
                        "direction": "OUTBOUND",
                        "description": "duplicates"
                    }
                },
                {
                    "issueKey": "ZF-623",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-623",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-6636",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6636",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11632",
                    "filename": "ZF-2982.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=pallaert",
                        "name": "pallaert",
                        "displayName": "Patrick ALLAERT",
                        "active": true
                    },
                    "created": "2008-11-08T07:28:50.000+0000",
                    "size": 1219,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11632\/ZF-2982.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10172",
                    "id": 10172,
                    "description": "Minor Release",
                    "name": "1.5.0",
                    "userReleaseDate": "17\/Mar\/08",
                    "archived": true,
                    "releaseDate": "2008-03-17",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10021",
                    "id": 10021,
                    "name": "Zend_Search_Lucene",
                    "description": "pure PHP robust, general purpose text search engine",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/20505",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Can you please assess and categorize as necessary?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-03-27T16:04:42.000+0000",
                    "updated": "2008-03-27T16:04:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25970",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=pallaert",
                        "name": "pallaert",
                        "displayName": "Patrick ALLAERT",
                        "active": true
                    },
                    "body": "Test reproducing this bug",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=pallaert",
                        "name": "pallaert",
                        "displayName": "Patrick ALLAERT",
                        "active": true
                    },
                    "created": "2008-11-08T07:28:51.000+0000",
                    "updated": "2008-11-08T07:28:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48504",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "I could not reproduce this bug exactly as the OP shows; I get a slightly different result:\r\n\r\nThese unit tests pass against trunk:\r\n{code}\r\nIndex: tests\/Zend\/Search\/Lucene\/SearchTest.php\r\n===================================================================\r\n--- tests\/Zend\/Search\/Lucene\/SearchTest.php     (revision 24462)\r\n+++ tests\/Zend\/Search\/Lucene\/SearchTest.php     (working copy)\r\n@@ -486,4 +486,36 @@\r\n\r\n         Zend_Search_Lucene::setResultSetLimit($storedResultSetLimit);\r\n     }\r\n+\r\n+    \/**\r\n+     * @group ZF-2982\r\n+     *\/\r\n+    public function testKeywordFieldSearchableUsingQueryParserWhenTermNotLowercase()\r\n+    {\r\n+        $index = Zend_Search_Lucene::create('test');\r\n+\r\n+        $doc = new Zend_Search_Lucene_Document();\r\n+        $doc->addField(Zend_Search_Lucene_Field::Keyword('firstname', 'Patrick'));\r\n+\r\n+        $index->addDocument($doc);\r\n+\r\n+        $this->assertTrue(count($index->find(Zend_Search_Lucene_Search_QueryParser::parse('Patrick'))) == 1);\r\n+        $this->assertTrue(count($index->find(Zend_Search_Lucene_Search_QueryParser::parse('patrick'))) == 0);\r\n+    }\r\n+\r\n+    \/**\r\n+     * @group ZF-2982\r\n+     *\/\r\n+    public function testKeywordFieldSearchableUsingQueryParserWhenTermIsLowercase()\r\n+    {\r\n+        $index = Zend_Search_Lucene::create('test');\r\n+\r\n+        $doc = new Zend_Search_Lucene_Document();\r\n+        $doc->addField(Zend_Search_Lucene_Field::Keyword('firstname', 'patrick'));\r\n+\r\n+        $index->addDocument($doc);\r\n+\r\n+        $this->assertTrue(count($index->find(Zend_Search_Lucene_Search_QueryParser::parse('Patrick'))) == 1);\r\n+        $this->assertTrue(count($index->find(Zend_Search_Lucene_Search_QueryParser::parse('patrick'))) == 1);\r\n+    }\r\n }\r\n{code}\r\n\r\nSo, when the keyword contains a capital letter ('Patrick') the search is exact ('Patrick' matches, 'patrick' doesn't match).  However, when the keyword is all lowercase ('patrick') the search is not exact (both 'Patrick' and 'patrick' match)\r\n\r\nie: I added this unit test to prove the capital-letter point, and it passes:\r\n{code}\r\n\/**\r\n * @group ZF-2982\r\n *\/\r\npublic function testKeywordFieldSearchableUsingQueryParserWhenTermNotLowercase2()\r\n{\r\n    $index = Zend_Search_Lucene::create('test');\r\n\r\n    $doc = new Zend_Search_Lucene_Document();\r\n    $doc->addField(Zend_Search_Lucene_Field::Keyword('firstname', 'paTrIcK'));        \r\n    $index->addDocument($doc);\r\n\r\n    $this->assertTrue(count($index->find(Zend_Search_Lucene_Search_QueryParser::parse('Patrick'))) == 0);\r\n    $this->assertTrue(count($index->find(Zend_Search_Lucene_Search_QueryParser::parse('patrick'))) == 0);\r\n}\r\n{code}\r\n\r\n'paTrIcK' matches neither 'Patrick' nor 'patrick'.\r\n\r\nI believe the issue stems from the way case-insensitive searches are performed:\r\n{quote}\r\nThe standard analyzer may transform the query string to lower case for case-insensitivity, remove stop-words, and stem among other transformations.\r\n\r\nThe API method doesn't transform or filter input terms in any way. It's therefore more suitable for computer generated or untokenized fields. \r\n{quote}\r\n(source: http:\/\/framework.zend.com\/manual\/en\/zend.search.lucene.searching.html#zend.search.lucene.searching.query_building)\r\n\r\nThe simplest workaround is to make sure that all your keyword field values are lowercased (strtolower). \r\n\r\nThe current setup appears to be that if the index keyword value is all lowercase, the match is treated as case-insensitive, and if it contains any upper-case characters it's treated as case-sensitive.  Seems counter-intuitive, but is this a bug?  If so, is it something that should be fixed in ZFv1 so late in it's lifecycle?  Or should we push the issue up to ZF2 for resolution?  It's been around since at least 1.5, so chances are anyone encountering it have workarounds for it already in place. \r\n\r\nThoughts?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-09-23T14:11:40.000+0000",
                    "updated": "2011-09-23T14:11:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48505",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=pallaert",
                        "name": "pallaert",
                        "displayName": "Patrick ALLAERT",
                        "active": true
                    },
                    "body": "I indeed have a work around named \"Solr\".\r\nZend Search Lucene is definetely not an option for anyone serious about using search engine technology.\r\nA workaround is difficult as you may not know whether your user, when entering a term, is about to search case sensitively or not. So yes, I consider this is a bug.\r\nBut honestly, I don't care anymore about Zend_Search :)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=pallaert",
                        "name": "pallaert",
                        "displayName": "Patrick ALLAERT",
                        "active": true
                    },
                    "created": "2011-09-23T14:36:52.000+0000",
                    "updated": "2011-09-23T14:36:52.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2982\/transitions"
}