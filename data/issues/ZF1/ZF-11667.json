{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11667",
    "key": "ZF-11667",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "error message via addError() un-neccessarily gets duplicated multiple times"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11667\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=iandeth",
                "name": "iandeth",
                "displayName": "Toshimasa Ishibashi",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-08-14T15:35:49.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-06T18:58:03.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "Zend_Form_Element_Multi",
                "Zend_Form_Element_MultiCheckbox"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "h1. ISSUE\r\nwith Zend_Form_Element_Multi and it's subclasses...\r\n{code}\r\n## create element with 4 checkboxes\r\n$elem = new Zend_Form_Element_MultiCheckbox('age', array(\r\n    'multiOptions' => array(\r\n        array('key'=>'a', 'value'=>'A'),\r\n        array('key'=>'b', 'value'=>'B'),\r\n        array('key'=>'c', 'value'=>'C'),\r\n        array('key'=>'d', 'value'=>'D'),\r\n    )\r\n));\r\n\r\n## check 3 of them\r\n$elem->setValue(array('A','B','D'));\r\n\r\n## later on, fails some validation on submit\r\n$elem->addError('some error!');\r\n\r\nprint_r( $elem->getMessages() );\r\n# =>Array\r\n# (\r\n#   [0] => some error!; some error!; some error!\r\n# )\r\n{code}\r\n\r\nh2. SUSPICION:\r\n\r\n- why need to duplicate error messages based on number of values checked?\r\n- => some error!; some error!; some error!\r\n\r\nh2. SUPPOSITION:\r\n\r\n- message should appear only once, \r\n- and %value% replacement should be affected by value array count.\r\n\r\n{code}\r\nwith:\r\n\r\n  $elem->addError('some error!');\r\n\r\nresult:\r\n\r\n  Array (\r\n     [0] => some error!\r\n  )\r\n\r\nwith:\r\n\r\n  $elem->addError('some error! %value%');\r\n  \r\nresult:\r\n\r\n  Array (\r\n     [0] => some error! a; b; c\r\n  )\r\n\r\n{code}\r\n\r\nh1. THE FIX\r\n{code}\r\ndiff -Naru ZendFramework\/library\/Zend\/Form\/Element.php lib-zend-patch\/Zend\/Form\/Element.php \r\n--- ZendFramework\/library\/Zend\/Form\/Element.php 2011-07-06 01:04:15.000000000 +0900\r\n+++ lib-zend-patch\/Zend\/Form\/Element.php        2011-08-15 00:34:32.000000000 +0900\r\n@@ -226,6 +226,8 @@\r\n      *\/\r\n     protected $_isPartialRendering = false;\r\n \r\n+    public $concatJustValuesInErrorMessage = true;\r\n+\r\n     \/**\r\n      * Constructor\r\n      *\r\n@@ -2234,11 +2236,16 @@\r\n             if (($this->isArray() || is_array($value))\r\n                 && !empty($value)\r\n             ) {\r\n-                $aggregateMessages = array();\r\n-                foreach ($value as $val) {\r\n-                    $aggregateMessages[] = str_replace('%value%', $val, $message);\r\n+                if( $this->concatJustValuesInErrorMessage ){\r\n+                    $concatVals = implode($this->getErrorMessageSeparator(), $value);\r\n+                    $messages[$key] = str_replace('%value%', $concatVals, $message);\r\n+                }else{\r\n+                    $aggregateMessages = array();\r\n+                    foreach ($value as $val) {\r\n+                        $aggregateMessages[] = str_replace('%value%', $val, $message);\r\n+                    }\r\n+                    $messages[$key] = implode($this->getErrorMessageSeparator(), $aggregateMessages);\r\n                 }\r\n-                $messages[$key] = implode($this->getErrorMessageSeparator(), $aggregateMessages);\r\n             } else {\r\n                 $messages[$key] = str_replace('%value%', $value, $message);\r\n             }\r\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11667\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "zf-crteam-padraic",
                "zf-crteam-priority"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                "name": "alab",
                "displayName": "Christian Albrecht",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10980",
                    "id": 10980,
                    "description": "Mini Release",
                    "name": "1.11.10",
                    "userReleaseDate": "04\/Aug\/11",
                    "archived": false,
                    "releaseDate": "2011-08-04",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48234",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "You will need to sign and submit a CLA before we can apply your suggested improvement.\r\nSee here: http:\/\/framework.zend.com\/wiki\/display\/ZFPROP\/Contributor+License+Agreement",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-08-27T20:03:53.000+0000",
                    "updated": "2011-08-27T20:03:53.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11667\/transitions"
}