{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8069",
    "key": "ZF-8069",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Filter_StripTags setAllowedAttributes when magic_quotes_gpc is on"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8069\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-11-27T06:27:20.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bartsokol",
                "name": "bartsokol",
                "displayName": "Bart Sokol",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-10-13T23:31:20.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-11-27T06:27:20.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "Zend_Filter_StripTags",
                "allowedAttributes",
                "magic_quotes_gpc",
                "setAllowedAttributes"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I'm using Zend_Filter_StripTags setAllowedAttributes to allow some of HTML tags attributes to be available in Zend_Form's Textarea element. Everything works fine when magic_quotes_gpc is off (on my development machine). But when I send the scripts to the production server (where magic_quotes_gpc if on and I don't have privileges to change it with .htaccess or php.ini - shared hosting), filter strips all attributes (tags are OK, checked for both global attributes and tag-specific).\n\nI think this should be handled within the filter by checking state of magic_quotes_gpc variable and changing the filtering function to react properly (maybe removing unnecessary backslashes as I'm quite sure this is the problem).\n\nGreetings,\nBart"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8069\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                "name": "ramon",
                "displayName": "Ramon Henrique Ornelas",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10370",
                    "id": 10370,
                    "description": "Mini Release",
                    "name": "1.9.4",
                    "userReleaseDate": "13\/Oct\/09",
                    "archived": false,
                    "releaseDate": "2009-10-13",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35200",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Please give something reproducable.\n\n* Your php release\n* The unfiltered content\n* The filtered content when it works\n* The filtered content when it does not work",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-10-14T01:29:29.000+0000",
                    "updated": "2009-10-14T01:29:29.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35201",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bartsokol",
                        "name": "bartsokol",
                        "displayName": "Bart Sokol",
                        "active": true
                    },
                    "body": "On development machine I have PHP 5.2.6 running as Apache module, on production server PHP 5.2.8 running as FastCGI on Apache.\n\nUnfiltered content can be this:\n\n<table class=\"sometable\">\n<tr><td colspan=\"2\">Header<\/td><\/tr>\n<tr><td>Column 1<\/td><td>Column 2<\/td><\/tr>\n<\/table>\n\nWhen it works, it returns the same code as above, when it doesn't work:\n\n<table>\n<tr><td>Header<\/td><\/tr>\n<tr><td>Column 1<\/td><td>Column 2<\/td><\/tr>\n<\/table>\n\n(same but without attributes).\n\nSample code - adding form element with filter:\n\n$pageContent = new Zend_Form_Element_Textarea('pageContent');\n$pageContent->setLabel('Content')\n                    ->setRequired(false)\n                    ->addValidator('StringLength',false,array(0,16384))\n                    ->addFilter(new Zend_Filter_StripTags(array('b','i','u','h3' => array('class','id'),'h4' => array('class','id'),'h5' => array('class','id'),'p' => array('class','id'),'br','ul' => array('class','id'),'ol' => array('class','id'),'li' => array('class','id'),'strong','em','big','small','script' => array('type','src'),'table' => array('class','id'),'tr' => array('class','id'),'td' => array('class','id','colspan','rowspan'),'th' => array('class','id','colspan','rowspan'),'div' => array('class','id'))));\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bartsokol",
                        "name": "bartsokol",
                        "displayName": "Bart Sokol",
                        "active": true
                    },
                    "created": "2009-10-14T01:49:20.000+0000",
                    "updated": "2009-10-14T01:49:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35202",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Not reproducable:\nI did the following...\n\n{code}\nvar_dump(get_magic_quotes_gpc());\n\n$filter = new Zend_Filter_StripTags(\n    array('allowTags' => array(\n        'b',\n        'i',\n        'u',\n        'h3' => array('class','id'),\n        'h4' => array('class','id'),\n        'h5' => array('class','id'),\n        'p' => array('class','id'),\n        'br',\n        'ul' => array('class','id'),\n        'ol' => array('class','id'),\n        'li' => array('class','id'),\n        'strong',\n        'em',\n        'big',\n        'small',\n        'script' => array('type','src'),\n        'table' => array('class','id'),\n        'tr' => array('class','id'),\n        'td' => array('class','id','colspan','rowspan'),\n        'th' => array('class','id','colspan','rowspan'),\n        'div' => array('class','id'))));\n\nvar_dump($filter->filter(\"<table class=\\\"sometable\\\">\n<tr><td colspan=\\\"2\\\">Header<\/td><\/tr>\n<tr><td>Column 1<\/td><td>Column 2<\/td><\/tr>\n<\/table>\"));\n{code}\n\nThe result was:\n{code}\nint 0\nstring '<table class=\"sometable\">\n<tr><td colspan=\"2\">Header<\/td><\/tr>\n<tr><td>Column 1<\/td><td>Column 2<\/td><\/tr>\n<\/table>' (length=115)\n{code}\n\nand with magic quotes on it was:\n{code}\nint 1\nstring '<table class=\"sometable\">\n<tr><td colspan=\"2\">Header<\/td><\/tr>\n<tr><td>Column 1<\/td><td>Column 2<\/td><\/tr>\n<\/table>' (length=115)\n{code}\n\nSo this failure is not reproducable for the filter with the given example.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-10-14T04:11:54.000+0000",
                    "updated": "2009-10-14T04:11:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35203",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bartsokol",
                        "name": "bartsokol",
                        "displayName": "Bart Sokol",
                        "active": true
                    },
                    "body": "I've asked my ISP to change magic_quotes_gpc to Off and now it works correctly so it has to be this variable.\nI've tested it with with this code:\n\n<table id=\"cennik\">\n<tr><td class=\"cennikDzial\" colspan=\"2\">Standard\/td><\/tr> \n<tr><td class=\"cennikOpcja\">Option<\/td> \n<td class=\"cennikCena\">1400-3000<\/td><\/tr>\n<tr><td class=\"cennikDzial\" colspan=\"2\">Additional<\/td><\/tr>\n<tr><td class=\"cennikOpcja\">Second option<\/td>\n<td class=\"cennikCena\">800<\/td><\/tr>\n<tr><td class=\"cennikOpcja\">Third option<\/td> \n<td class=\"cennikCena\">400<\/td><\/tr>\n<\/table>\n\nPlease remember that I'm using it with Zend_Form_Element_Textarea with Zend_Form (generated code: <textarea name=\"pageContent\" id=\"pageContent\" rows=\"24\" cols=\"80\"> within <form id=\"pageForm\" enctype=\"multipart\/form-data\" method=\"post\">).\nmagic_quotes_gpc acts when you're sending data through form, so it won't be a problem when using filter the way you've tested it. You have to test it with a posted form data to get this error.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bartsokol",
                        "name": "bartsokol",
                        "displayName": "Bart Sokol",
                        "active": true
                    },
                    "created": "2009-10-14T04:30:38.000+0000",
                    "updated": "2009-10-14T04:30:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35204",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bartsokol",
                        "name": "bartsokol",
                        "displayName": "Bart Sokol",
                        "active": true
                    },
                    "body": "Ups, there correct code was:\n\n<table id=\"cennik\">\n<tr><td class=\"cennikDzial\" colspan=\"2\">Standard<\/td><\/tr>\n<tr><td class=\"cennikOpcja\">Option<\/td>\n<td class=\"cennikCena\">1400-3000<\/td><\/tr>\n<tr><td class=\"cennikDzial\" colspan=\"2\">Additional<\/td><\/tr>\n<tr><td class=\"cennikOpcja\">Second option<\/td>\n<td class=\"cennikCena\">800<\/td><\/tr>\n<tr><td class=\"cennikOpcja\">Third option<\/td>\n<td class=\"cennikCena\">400<\/td><\/tr>\n<\/table>\n\nI've accidentally deleted one < char.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bartsokol",
                        "name": "bartsokol",
                        "displayName": "Bart Sokol",
                        "active": true
                    },
                    "created": "2009-10-14T04:33:46.000+0000",
                    "updated": "2009-10-14T04:33:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35213",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "In this case the problem is not related to Zend_Filter as it filters the content as expected regardless of magic_quotes.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-10-14T10:00:06.000+0000",
                    "updated": "2009-10-14T10:00:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35214",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Changed assigned component as this problem is related to Zend_Form_Element_Textbox and not to Zend_Filter.\r\n\r\nChanged assigned maintainer.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-10-14T10:02:13.000+0000",
                    "updated": "2010-06-10T22:23:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43360",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "body": "It is not the responsibility of the ZF fixed this.\r\nUntil because is recommend that is this disabled to avoid major transtornor.\r\n\r\nSee how disable \r\nhttp:\/\/www.php.net\/manual\/en\/security.magicquotes.disabling.php\r\n\r\nSolution much more elegant\r\nhttp:\/\/blog.philipbrown.id.au\/2008\/10\/zend-framework-forms-and-magic_quotes_gpc\/",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "created": "2010-11-27T06:26:57.000+0000",
                    "updated": "2010-11-27T06:26:57.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8069\/transitions"
}