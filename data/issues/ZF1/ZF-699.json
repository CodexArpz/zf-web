{
    "expand": "html",
    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-699",
    "key": "ZF-699",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "empty() and isset() on view properties are broken when the property is false or null"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-699\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/version\/10020",
                    "id": 10020,
                    "description": "Preview Release; I18N, Acl, Auth, Session",
                    "name": "0.7.0",
                    "userReleaseDate": "18\/Jan\/07",
                    "archived": true,
                    "releaseDate": "2007-01-18",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-01-06T16:40:53.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=mkrkac",
                "name": "mkrkac",
                "displayName": "Marin Krkac",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2006-12-29T16:42:36.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-12-19T13:07:49.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I have a lot of \"if (empty($this->foo)):\" in my views and after upgrading from 0.2 to 0.6 some of them didn't work anymore.\n\n{code}\n$view = new Zend_View();\n\n$view->foo = false;\nvar_dump(isset($view->foo)); \/\/ returns true\nvar_dump(empty($view->foo)); \/\/ returns false, should return true\n\n$view->bar = null;\nvar_dump(isset($view->bar)); \/\/ returns true, should return false\nvar_dump(empty(($view->bar)); \/\/ returns false, should return true\n{code}\n\nI've been able to fix it by changing the flag (the second parameter) in the call to the parent constructor in Zend_View_Abstract from 2 (ArrayObject::ARRAY_AS_PROPS) to 0, and reimplementing some of the methods to retain the same functionality of the Zend_View object when using the assign() method, var_dump and foreach.\n\n{code}\npublic function __construct($config = array())\n{\n    \/\/ ...\n\n    \/\/ parent::__construct(array(), 0);\n    \/\/ which can then just be\n    parent::__construct();\n}\n\npublic function __set($key, $val)\n{\n    $this->offsetSet($key, $val);\n}\n\npublic function __get($key)\n{\n    return $this->offsetGet($key);\n}\n\npublic function __isset($key)\n{\n    return $this->offsetExists($key) and $this->offsetGet($key) !== null;\n}\n{code}\n\nHere are some potential tests:\n{code}\n$view = new Zend_View();\n\t\t\n$this->assertFalse(isset($view->notSet));\n$this->assertTrue(empty($view->notSet));\n\n$view->foo = null;\n$this->assertFalse(isset($view->foo));\n$this->assertTrue(empty($view->foo));\n\n$view->bar = false;\n$this->assertTrue(isset($view->bar));\n$this->assertTrue(empty($view->bar));\n\n$view->assign('assigned', 'val');\n$this->assertEquals($view->assigned, 'val');\n\n$view->assign('falseVal', false);\n$this->assertTrue(isset($view->falseVal));\n$this->assertTrue(empty($view->falseVal));\n\n$view->assign('nullVal', null);\n$this->assertFalse(isset($view->nullVal));\n$this->assertTrue(empty($view->nullVal));\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-699\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/version\/10040",
                    "id": 10040,
                    "description": "Preview Release; MVC maturation, HTTP client, Gdata",
                    "name": "0.6.0",
                    "userReleaseDate": "16\/Dec\/06",
                    "archived": true,
                    "releaseDate": "2006-12-16",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/component\/10026",
                    "id": 10026,
                    "name": "Zend_View",
                    "description": "View portion of the ZF MVC",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12025",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=mkrkac",
                        "name": "mkrkac",
                        "displayName": "Marin Krkac",
                        "active": true
                    },
                    "body": "I forgot to mention that I'm using PHP 5.2.0.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=mkrkac",
                        "name": "mkrkac",
                        "displayName": "Marin Krkac",
                        "active": true
                    },
                    "created": "2006-12-30T04:52:56.000+0000",
                    "updated": "2006-12-30T04:52:56.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12111",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I actually already have __set\/__get\/__isset defined as you describe. However, if I remove the ARRAY_AS_PROPS flag, I break the functionality that I was originally fixing with this solution -- basically, the ability to do the following:\n{code}\n$view->foo = array();\n$view->foo[] = 42;\n{code}\n\nWhat's interesting is that if I define a class like this:\n{code}\nclass View\n{\n    public $foo = false;\n    public $bar = null;\n    public $baz = '';\n}\n{code}\nempty() works fine with each property, but using ArrayObject, it does not; I'm actually thinking this is a bug in ArrayObject, but I'll need to find a workaround.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2007-01-05T12:13:08.000+0000",
                    "updated": "2007-01-05T12:13:08.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12168",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=mkrkac",
                        "name": "mkrkac",
                        "displayName": "Marin Krkac",
                        "active": true
                    },
                    "body": "I've never used ArrayObject before, so I don't know if this is a bug or a feature.\n\nDoes Zend_View need to support array access?\n{code}\n$view = new Zend_View();\n$view['foo'] = 'bar';\n{code}\n\nIf not, here is an idea for a workaround:\n{code}\nclass Zend_View_Abstract extends ArrayObject\n{  \n    public function __construct()\n    {\n        parent::__construct(array(), ArrayObject::STD_PROP_LIST);\n    }\n    \n    public function assign($key, $val)\n    {\n        $this->$key = $val;\n    }\n    \n    public function count()\n    {\n        return $this->getIterator()->count();\n    }\n    \n    public function getIterator()\n    {\n        $r = new ReflectionObject($this);\n        return new Zend_View_Iterator($this, new ArrayIterator($r->getProperties()));\n    }\n\n    public function getVars()\n    {\n        $result = array();\n       \t$r = new ReflectionObject($this);\n        foreach ($r->getProperties() as $p) {\n            if ($p->class == 'ArrayObject') {\n                $result[$p->name] = $this->{$p->name};\n            }\n        }\n\n        return $result;\n    }\n\n    public function clearVars()\n    {\n    \t$r = new ReflectionObject($this);\n        foreach ($r->getProperties() as $p) {\n            if ($p->class == 'ArrayObject') {\n                unset($this->{$p->name});\n            }\n        }\n    }\n}\n\nclass Zend_View_Iterator extends FilterIterator\n{\n    protected $_view;\n    \n    public function __construct(Zend_View $view, Iterator $iterator)\n    {\n        $this->_view = $view;\n        parent::__construct($iterator);\n    }\n    \n    public function accept()\n    {\n        return $this->current(true)->class == 'ArrayObject';\n    }\n    \n    public function current($real = false)\n    {\n        if ($real) {\n            return parent::current();\n        }\n        $current = parent::current();\n        return $this->_view->{$current->name};\n    }\n}\n{code}\n\nThis passes all the tests, but the overloaded methods (__get(), __set(), __isset(), __unset()) need to be removed.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=mkrkac",
                        "name": "mkrkac",
                        "displayName": "Marin Krkac",
                        "active": true
                    },
                    "created": "2007-01-06T14:12:01.000+0000",
                    "updated": "2007-01-06T14:12:01.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12169",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Resolved in revision 2644. Instead of extending ArrayObject, __set() now checks for array values and recasts them to ArrayObject. This allows both behaviours -- empty() and $view->foo[] to work correctly.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2007-01-06T16:40:53.000+0000",
                    "updated": "2007-01-06T16:40:53.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12172",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=mkrkac",
                        "name": "mkrkac",
                        "displayName": "Marin Krkac",
                        "active": true
                    },
                    "body": "I've tried that when I was looking for a workaround. I've seen it in a comment by Gunar Scholz in ZF-298. But, unfortunately, this creates a regression (just like fixing {{$this->foo[] = 42}} broke isset() and empty()).\n{code:title=Regression}\n$view = new Zend_View();\n$view->foo = array();\n$this->assertTrue(is_array($view->foo)); \/\/ fails\n{code}\nWhich, [apparently|http:\/\/bugs.php.net\/bug.php?id=36930], is not a bug. But people don't care how Zend_View is implemented. If they put an array in a view, I think they would expect is_array() to work.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=mkrkac",
                        "name": "mkrkac",
                        "displayName": "Marin Krkac",
                        "active": true
                    },
                    "created": "2007-01-07T08:21:54.000+0000",
                    "updated": "2007-01-07T08:21:54.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/27517",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Bookkeeping. Closing old issues and assigning them to the person who ultimately resolved the issue.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-12-19T13:07:48.000+0000",
                    "updated": "2008-12-19T13:07:48.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-699\/transitions"
}