{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11609",
    "key": "ZF-11609",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "ZF 1.11.9: No Captcha img rendered"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11609\/votes",
                "votes": 2,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10980",
                    "id": 10980,
                    "description": "Mini Release",
                    "name": "1.11.10",
                    "userReleaseDate": "04\/Aug\/11",
                    "archived": false,
                    "releaseDate": "2011-08-04",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-07-28T21:39:09.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=segnior_rossi",
                "name": "segnior_rossi",
                "displayName": "rossi",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-07-25T21:13:29.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-05-11T15:56:20.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "captcha"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Hi,\r\n\r\ni've upgraded from ZF 1.11.8 to 1.11.9. After the upgrade no captcha image is displayed any more, because the captcha img tag is not rendered. I could solve it by explicitely adding the captcha decorator to Zend_Form_Element_Captcha.\r\n\r\nIssue is explained here as well: http:\/\/stackoverflow.com\/questions\/6726987\/zend-1-11-9-form-decorators-captcha\r\n\r\nninsky"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11609\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                "name": "kaiuwe",
                "displayName": "Kai Uwe",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-8094",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8094",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/14539",
                    "filename": "Captcha.php.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-07-27T12:47:01.000+0000",
                    "size": 1551,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/14539\/Captcha.php.patch"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/14540",
                    "filename": "CaptchaTest.php.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-07-27T12:47:01.000+0000",
                    "size": 7457,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/14540\/CaptchaTest.php.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10880",
                    "id": 10880,
                    "description": "Mini Release",
                    "name": "1.11.9",
                    "userReleaseDate": "14\/Jul\/11",
                    "archived": false,
                    "releaseDate": "2011-07-14",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47651",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "body": "Component changed to Zend_Form.\r\nPriority changed because a simple workaround is available.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-07-25T21:53:49.000+0000",
                    "updated": "2011-07-25T21:53:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47652",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "body": "Please have a look at: ZF-8094 - Captcha element always set captcha decorator",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-07-25T21:56:00.000+0000",
                    "updated": "2011-07-25T21:56:00.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47655",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "body": "Example to reproduce the problem.\r\n{code:title=Example}\r\n$form = new Zend_Form(); \r\n\r\n$form->addElement( \r\n    'captcha', \r\n    'foo', \r\n    array( \r\n        'label' => 'Foo', \r\n            'captcha' => array( \r\n            'captcha' => 'Figlet', \r\n            'wordLen' => 6, \r\n            'timeout' => 300, \r\n        ), \r\n    ) \r\n); \r\n\r\necho '<h3>Before rendering<\/h3>'; \r\necho '<ul>'; \r\nforeach ($form->getElement('foo')->getDecorators() as $decorator) { \r\n    echo '<li>' . get_class($decorator) . '<\/li>'; \r\n} \r\necho '<\/ul>'; \r\n\r\necho '<h3>Output<\/h3>'; \r\necho $form->render($view); \r\n\r\necho '<h3>After rendering<\/h3>'; \r\necho '<ul>'; \r\nforeach ($form->getElement('foo')->getDecorators() as $decorator) { \r\n    echo '<li>' . get_class($decorator) . '<\/li>'; \r\n} \r\necho '<\/ul>';\r\n{code}\r\n{code:title=Output|borderStyle=solid}\r\n<h3>Before rendering<\/h3>\r\n<ul>\r\n    <li>Zend_Form_Decorator_Errors<\/li>\r\n    <li>Zend_Form_Decorator_Description<\/li>\r\n    <li>Zend_Form_Decorator_HtmlTag<\/li>\r\n    <li>Zend_Form_Decorator_Label<\/li>\r\n<\/ul>\r\n<h3>Output<\/h3>\r\n<form enctype=\"application\/x-www-form-urlencoded\" action=\"\" method=\"post\">\r\n    <dl class=\"zend_form\">\r\n        <dt id=\"foo-input-label\">\r\n            <label for=\"foo-input\" class=\"required\">Foo<\/label>\r\n        <\/dt>\r\n        <dd id=\"foo-element\">\r\n            <input type=\"hidden\" name=\"foo[id]\" value=\"f93f678c0154a9429eb3c9b6c824abb3\" id=\"foo-id\" \/>\r\n            <input type=\"text\" name=\"foo[input]\" id=\"foo-input\" value=\"\" \/>\r\n        <\/dd>\r\n    <\/dl>\r\n<\/form>\r\n<h3>After rendering<\/h3>\r\n<ul>\r\n    <li>Zend_Form_Decorator_Captcha_Word<\/li>\r\n    <li>Zend_Form_Decorator_Errors<\/li>\r\n    <li>Zend_Form_Decorator_Description<\/li>\r\n    <li>Zend_Form_Decorator_HtmlTag<\/li>\r\n    <li>Zend_Form_Decorator_Label<\/li>\r\n<\/ul>\r\n{code}\r\n*Before rendering*\r\n\r\n* Zend_Form_Decorator_Errors\r\n* Zend_Form_Decorator_Description\r\n* Zend_Form_Decorator_HtmlTag\r\n* Zend_Form_Decorator_Label\r\n\r\n*After rendering*\r\n\r\n* Zend_Form_Decorator_Captcha_Word\r\n* Zend_Form_Decorator_Errors\r\n* Zend_Form_Decorator_Description\r\n* Zend_Form_Decorator_HtmlTag\r\n* Zend_Form_Decorator_Label\r\n\r\nThe decorator \"Zend_Form_Decorator_Captcha\" is missing.\r\n\r\nBUT:\r\n{code:title=Example}\r\n$form->getElement('foo')->clearDecorators(); \r\n{code}\r\n{code:title=Output|borderStyle=solid}\r\n<h3>Before rendering<\/h3>\r\n<ul>\r\n<\/ul>\r\n<h3>Output<\/h3>\r\n<form enctype=\"application\/x-www-form-urlencoded\" action=\"\" method=\"post\">\r\n    <dl class=\"zend_form\">\r\n        <input type=\"hidden\" name=\"foo[id]\" value=\"6c7c11aebd47e23c0d773f99b562bef2\" id=\"foo-id\" \/>\r\n        <input type=\"text\" name=\"foo[input]\" id=\"foo-input\" value=\"\" \/>\r\n    <\/dl>\r\n<\/form>\r\n<h3>After rendering<\/h3>\r\n<ul>\r\n    <li>Zend_Form_Decorator_Captcha_Word<\/li>\r\n<\/ul>\r\n{code}\r\n\r\n*Before rendering*\r\n\r\n(empty)\r\n\r\n*After rendering*\r\n\r\n* Zend_Form_Decorator_Captcha_Word",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-07-26T08:34:52.000+0000",
                    "updated": "2011-07-26T08:34:52.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47657",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=djart",
                        "name": "djart",
                        "displayName": "Thanos Kyritsis",
                        "active": true
                    },
                    "body": "Thanks for opening this bug. It is affected by Subversion revision #24223 for library\/Zend\/Form\/Element\/Captcha.php which fixed ReCaptcha, but broke the other captchas (Figlet, Image and Dumb which are all Word Captchas). Specifically, the following block of code doesn't work well for Word Captchas (it only does for ReCaptcha):\r\n\r\n{code:title=Zend\/Form\/Element\/Captcha.php line 183|borderStyle=solid}\r\n$decorator  = $captcha->getDecorator();\r\nif (!empty($decorator)) {\r\n    array_unshift($decorators, $decorator);\r\n} else {\r\n     $decorator = array('Captcha', array('captcha' => $captcha));\r\n     array_unshift($decorators, $decorator);\r\n}\r\n\r\n$this->setDecorators($decorators);\r\n{code}\r\n\r\nRecaptcha needs just his own decorator, so the if\/else block is correct for it's case. All the other (word) captchas need both their own decorator (which is actually \"Captcha_Word\") AND additionally the generic Captcha Decorator, so that if\/else block ruins it for them.\r\n\r\nI can think of two different solutions, I don't know which one Zend Framework developers think as better:\r\n\r\n* Change the above if\/else block to a bit more complicated (and \"uglier\") one\r\n* Refactor the Captcha_Word decorator (making it as \"good\" and \"rich\" as the Captcha_ReCaptcha decorator is) and (probably) drop the generic Captcha decorator completely. (I would say this is the cleaner approach but ZF devs should decide)\r\n\r\nFor the first case, the if\/else could be something like the following pseudo-code:\r\n\r\n{code:title=pseudo-code|borderStyle=solid}\r\n$decorator  = $captcha->getDecorator();\r\nif (!empty($decorator)) {\r\n    array_unshift($decorators, $decorator);\r\n}\r\n\r\nif (the current captcha object is not ReCaptcha) {\r\n     \/\/ push an additional decorator to the stack\r\n     $decorator = array('Captcha', array('captcha' => $captcha));\r\n     array_unshift($decorators, $decorator);\r\n}\r\n\r\n$this->setDecorators($decorators);\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=djart",
                        "name": "djart",
                        "displayName": "Thanos Kyritsis",
                        "active": true
                    },
                    "created": "2011-07-26T10:14:58.000+0000",
                    "updated": "2011-07-26T10:14:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47658",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "body": "{quote}\r\nRefactor the Captcha_Word decorator (making it as \"good\" and \"rich\" as the Captcha_ReCaptcha decorator is) and (probably) drop the generic Captcha decorator completely. (I would say this is the cleaner approach but ZF devs should decide)\r\n{quote}\r\nI think it is a bad idea, because we need a separation between image\/figlet and the text input.\r\n\r\n(The example does not use the current implementation, because the current implementation adds additional decorators in the method to render!)\r\n{code:title=Example}\r\n\/\/ Form\r\n$form = new Zend_Form();\r\n$form->removeDecorator('HtmlTag');\r\n\r\n\/\/ Element\r\n$form->addElement(\r\n    'captcha',\r\n    'foo',\r\n    array(\r\n        'label' => 'Foo',\r\n        'captcha' => array(\r\n            'captcha' => 'Figlet',\r\n            'wordLen' => 6,\r\n            'timeout' => 300,\r\n        ),\r\n    )\r\n);\r\n\r\n\/\/ Element decorators\r\n$form->getElement('foo')->setDecorators(array(\r\n    \/\/ Zend_Form_Decorator_HtmlTag\r\n    array(\r\n        \/\/ Decorator name\r\n        array(\r\n            'spanOpen' => 'HtmlTag',\r\n        ),\r\n        \/\/ Decorator options\r\n        array(\r\n            'tag'      => 'span',\r\n            'openOnly' => true,\r\n        ),\r\n    ),\r\n    \/\/ Zend_Form_Decorator_Captcha\r\n    'Captcha',\r\n    \/\/ Zend_Form_Decorator_HtmlTag\r\n    array(\r\n        \/\/ Decorator name\r\n        array(\r\n            'spanClose' => 'HtmlTag',\r\n        ),\r\n        \/\/ Decorator options\r\n        array(\r\n            'tag'       => 'span',\r\n            'closeOnly' => true,\r\n            'placement' => 'append',\r\n        ),\r\n    ),\r\n    \/\/ Zend_Form_Decorator_Captcha_Word\r\n    'Captcha_Word',\r\n    \/\/ Zend_Form_Decorator_Errors\r\n    'Errors',\r\n    \/\/ Zend_Form_Decorator_Description\r\n    'Description',\r\n    \/\/ Zend_Form_Decorator_Label\r\n    'Label',\r\n    \/\/ Zend_Form_Decorator_HtmlTag\r\n    array(\r\n        \/\/ Decorator name\r\n        array(\r\n            'div' => 'HtmlTag',\r\n        ),\r\n        \/\/ Decorator options\r\n        array(\r\n            'tag' => 'div',\r\n        ),\r\n    ),\r\n));\r\n\r\necho $form->render($view);\r\n{code}\r\n{code:title=Output|borderStyle=solid}\r\n<form enctype=\"application\/x-www-form-urlencoded\" action=\"\" method=\"post\">\r\n    <div>\r\n        <label for=\"foo-input\" class=\"required\">Foo<\/label>\r\n        <span>\r\n        <pre>__    __   __   __   __   _    __   __    ______    _____   \r\n\\ \\\\ \/ \/\/  \\ \\\\\/ \/\/ | || | ||  \\ \\\\\/ \/\/  \/_   _\/\/  |  ___|| \r\n \\ \\\/ \/\/    \\ ` \/\/  | '--' ||   \\ ` \/\/     | ||    | ||__   \r\n  \\  \/\/      | ||   | .--. ||    | ||     _| ||    | ||__   \r\n   \\\/\/       |_||   |_|| |_||    |_||    \/__\/\/     |_____|| \r\n    `        `-`'   `-`  `-`     `-`'    `--`      `-----`  \r\n                                                            \r\n<\/pre>\r\n        <\/span>\r\n        <input type=\"hidden\" name=\"foo[id]\" value=\"27fa6f97eec08a70dc1f2951f972aaae\" id=\"foo-id\" \/>\r\n        <input type=\"text\" name=\"foo[input]\" id=\"foo-input\" value=\"\" \/>\r\n    <\/div>\r\n<\/form>\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-07-26T10:55:42.000+0000",
                    "updated": "2011-07-26T11:00:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47659",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "body": "*@Thanos*\r\nThe new implementation must respect \"loadDefaultDecoratorsIsDisabled()\".\r\nSee my example above with \u201cclearDecorators()\" and ZF-8094.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-07-26T11:08:54.000+0000",
                    "updated": "2011-07-26T11:08:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47660",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=djart",
                        "name": "djart",
                        "displayName": "Thanos Kyritsis",
                        "active": true
                    },
                    "body": "{quote}\r\nThe new implementation must respect \"loadDefaultDecoratorsIsDisabled()\".\r\nSee my example above with \u201cclearDecorators()\" and ZF-8094.\r\n{quote}\r\n\r\n@Kai\r\nI agree, it's a chance to solve both problems\/issues with one patch. I think that the Zend_Form_Element_Captcha render function currently doesn't show much respect neither for ReCaptcha nor for the others, am I correct ? It is the only render function (among other zend form elements) that actually pushes additional decorators in the stack. \r\n\r\nAre the Zend_Form_Decorator_Captcha_Word, Zend_Form_Decorator_Captcha and Zend_Form_Decorator_Captcha_ReCaptcha regarded as default decorators or not ? Which of them should or shouldn't be in the default decorators group ?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=djart",
                        "name": "djart",
                        "displayName": "Thanos Kyritsis",
                        "active": true
                    },
                    "created": "2011-07-26T12:21:25.000+0000",
                    "updated": "2011-07-26T12:21:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47668",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "body": "{quote}I think that the Zend_Form_Element_Captcha render function currently doesn't show much respect neither for ReCaptcha nor for the others, am I correct ?{quote}\r\nRight.\r\n{quote}It is the only render function (among other zend form elements) that actually pushes additional decorators in the stack.{quote}\r\nZend_Form_Element_File needs also a special decorator, but [takes a different approach|http:\/\/framework.zend.com\/code\/filedetails.php?repname=Zend+Framework&path=%2Ftags%2Frelease-1.11.9%2Flibrary%2FZend%2FForm%2FElement%2FFile.php].\r\n{quote}Are the Zend_Form_Decorator_Captcha_Word, Zend_Form_Decorator_Captcha and Zend_Form_Decorator_Captcha_ReCaptcha regarded as default decorators or not ? Which of them should or shouldn't be in the default decorators group ?{quote}\r\nThis is the problem:\r\n||Captcha adapters||Required decorators||\r\n|Dumb, Figlet, Image|Zend_Form_Decorator_Captcha + Zend_Form_Decorator_Captcha_Word|\r\n|ReCaptcha|Zend_Form_Decorator_Captcha_ReCaptcha|",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-07-26T14:59:43.000+0000",
                    "updated": "2011-07-26T14:59:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47674",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=djart",
                        "name": "djart",
                        "displayName": "Thanos Kyritsis",
                        "active": true
                    },
                    "body": "All right, how about this patch:\r\n\r\n{code:title=proposed patch|borderStyle=solid}\r\n--- library\/Zend\/Form\/Element\/Captcha.php.orig\t2011-07-26 19:02:59.473494443 +0300\r\n+++ library\/Zend\/Form\/Element\/Captcha.php\t2011-07-26 19:21:08.795165709 +0300\r\n@@ -178,17 +178,21 @@\r\n         $captcha    = $this->getCaptcha();\r\n         $captcha->setName($this->getFullyQualifiedName());\r\n \r\n-        $decorators = $this->getDecorators();\r\n+        if (!$this->loadDefaultDecoratorsIsDisabled()) {\r\n+            $decorators = $this->getDecorators();\r\n \r\n-        $decorator  = $captcha->getDecorator();\r\n-        if (!empty($decorator)) {\r\n-            array_unshift($decorators, $decorator);\r\n-        } else {\r\n-            $decorator = array('Captcha', array('captcha' => $captcha));\r\n-            array_unshift($decorators, $decorator);\r\n-        }\r\n+            $decorator  = $captcha->getDecorator();\r\n+            if (!empty($decorator)) {\r\n+                array_unshift($decorators, $decorator);\r\n+            }\r\n+\r\n+            if ($captcha instanceof Zend_Captcha_Word) {\r\n+                $decorator = array('Captcha', array('captcha' => $captcha));\r\n+                array_unshift($decorators, $decorator);\r\n+            }\r\n \r\n-        $this->setDecorators($decorators);\r\n+            $this->setDecorators($decorators);\r\n+        }\r\n \r\n         $this->setValue($this->getCaptcha()->generate());\r\n \r\n{code}\r\n\r\nIt makes the render function look like this:\r\n\r\n{code:title=render()|borderStyle=solid}\r\npublic function render(Zend_View_Interface $view = null)\r\n    {\r\n        $captcha    = $this->getCaptcha();\r\n        $captcha->setName($this->getFullyQualifiedName());\r\n\r\n        if (!$this->loadDefaultDecoratorsIsDisabled()) {\r\n            $decorators = $this->getDecorators();\r\n\r\n            $decorator  = $captcha->getDecorator();\r\n            if (!empty($decorator)) {\r\n                array_unshift($decorators, $decorator);\r\n            }\r\n\r\n            if ($captcha instanceof Zend_Captcha_Word) {\r\n                $decorator = array('Captcha', array('captcha' => $captcha));\r\n                array_unshift($decorators, $decorator);\r\n            }\r\n\r\n            $this->setDecorators($decorators);\r\n        }\r\n\r\n        $this->setValue($this->getCaptcha()->generate());\r\n\r\n        return parent::render($view);\r\n    }\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=djart",
                        "name": "djart",
                        "displayName": "Thanos Kyritsis",
                        "active": true
                    },
                    "created": "2011-07-26T16:45:22.000+0000",
                    "updated": "2011-07-26T16:45:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47687",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "body": "Should we check for existing captcha decorators?\r\n{code:title=Unit test}\r\n\/**\r\n * @group ZF-11609\r\n *\/\r\npublic function testDecoratorsBeforeAndAfterRendering()\r\n{\r\n    \/\/ Disable default decorators is true\r\n    $element = new Zend_Form_Element_Captcha(\r\n        'foo',\r\n        array(\r\n            'captcha'        => 'Dumb',\r\n            'captchaOptions' => array(\r\n                'sessionClass' => 'Zend_Form_Element_CaptchaTest_SessionContainer',\r\n            ),\r\n            'disableLoadDefaultDecorators' => true,\r\n            'decorators'                   => array(\r\n                'Description',\r\n                'Errors',\r\n                'Captcha_Word',\r\n                'Captcha',\r\n                'Label',\r\n            ),\r\n        )\r\n    );\r\n\r\n    \/\/ Before rendering\r\n    $decorators = array_keys($element->getDecorators());\r\n    $this->assertSame(\r\n        array(\r\n            'Zend_Form_Decorator_Description',\r\n            'Zend_Form_Decorator_Errors',\r\n            'Zend_Form_Decorator_Captcha_Word',\r\n            'Zend_Form_Decorator_Captcha',\r\n            'Zend_Form_Decorator_Label',\r\n        ),\r\n        $decorators,\r\n        var_export($decorators, true)\r\n    );\r\n\r\n    $element->render();\r\n\r\n    \/\/ After rendering\r\n    $decorators = array_keys($element->getDecorators());\r\n    $this->assertSame(\r\n        array(\r\n            'Zend_Form_Decorator_Description',\r\n            'Zend_Form_Decorator_Errors',\r\n            'Zend_Form_Decorator_Captcha_Word',\r\n            'Zend_Form_Decorator_Captcha',\r\n            'Zend_Form_Decorator_Label',\r\n        ),\r\n        $decorators,\r\n        var_export($decorators, true)\r\n    );\r\n\r\n    \/\/ Disable default decorators is false\r\n    $element = new Zend_Form_Element_Captcha(\r\n        'foo',\r\n        array(\r\n            'captcha'        => 'Dumb',\r\n            'captchaOptions' => array(\r\n                'sessionClass' => 'Zend_Form_Element_CaptchaTest_SessionContainer',\r\n            ),\r\n            'decorators' => array(\r\n                'Description',\r\n                'Errors',\r\n                'Captcha_Word',\r\n                'Captcha',\r\n                'Label',\r\n            ),\r\n        )\r\n    );\r\n\r\n    \/\/ Before rendering\r\n    $decorators = array_keys($element->getDecorators());\r\n    $this->assertSame(\r\n        array(\r\n            'Zend_Form_Decorator_Description',\r\n            'Zend_Form_Decorator_Errors',\r\n            'Zend_Form_Decorator_Captcha_Word',\r\n            'Zend_Form_Decorator_Captcha',\r\n            'Zend_Form_Decorator_Label',\r\n        ),\r\n        $decorators,\r\n        var_export($decorators, true)\r\n    );\r\n\r\n    $element->render();\r\n    \r\n    \/\/ After rendering\r\n    $decorators = array_keys($element->getDecorators());\r\n    $this->assertSame(\r\n        array(\r\n            'Zend_Form_Decorator_Description',\r\n            'Zend_Form_Decorator_Errors',\r\n            'Zend_Form_Decorator_Captcha_Word',\r\n            'Zend_Form_Decorator_Captcha',\r\n            'Zend_Form_Decorator_Label',\r\n        ),\r\n        $decorators,\r\n        var_export($decorators, true)\r\n    );\r\n}\r\n{code}\r\n\r\n{code:title=Result|borderStyle=solid}\r\nThere was 1 failure:\r\n\r\n1) Zend_Form_Element_CaptchaTest::testDecoratorsBeforeAndAfterRendering\r\narray (\r\n  0 => 'Zend_Form_Decorator_Captcha',\r\n  1 => 'Zend_Form_Decorator_Captcha_Word',\r\n  2 => 'Zend_Form_Decorator_Description',\r\n  3 => 'Zend_Form_Decorator_Errors',\r\n  4 => 'Zend_Form_Decorator_Label',\r\n)\r\n--- Expected\r\n+++ Actual\r\n@@ @@\r\n Array\r\n (\r\n-    [0] => Zend_Form_Decorator_Description\r\n-    [1] => Zend_Form_Decorator_Errors\r\n-    [2] => Zend_Form_Decorator_Captcha_Word\r\n-    [3] => Zend_Form_Decorator_Captcha\r\n+    [0] => Zend_Form_Decorator_Captcha\r\n+    [1] => Zend_Form_Decorator_Captcha_Word\r\n+    [2] => Zend_Form_Decorator_Description\r\n+    [3] => Zend_Form_Decorator_Errors\r\n     [4] => Zend_Form_Decorator_Label\r\n )\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-07-27T09:00:19.000+0000",
                    "updated": "2011-07-27T09:00:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47691",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=djart",
                        "name": "djart",
                        "displayName": "Thanos Kyritsis",
                        "active": true
                    },
                    "body": "(I would upload the patch as an attachment, but perhaps I don't have the permissions to do so).\r\nRight, here is an improved version that should not fail the above Unit test (it checks for existing captcha decorators):\r\n\r\n{code:title=proposed patch 2}\r\n--- library\/Zend\/Form\/Element\/Captcha.php.orig\t2011-07-26 19:02:59.473494443 +0300\r\n+++ library\/Zend\/Form\/Element\/Captcha.php\t2011-07-27 13:17:00.216725827 +0300\r\n@@ -178,17 +178,24 @@\r\n         $captcha    = $this->getCaptcha();\r\n         $captcha->setName($this->getFullyQualifiedName());\r\n \r\n-        $decorators = $this->getDecorators();\r\n+        if (!$this->loadDefaultDecoratorsIsDisabled()) {\r\n+            $decorators = $this->getDecorators();\r\n+            $decorator  = $captcha->getDecorator();\r\n+            $key        = get_class($this->_getDecorator($decorator, null));\r\n+\r\n+            if (!empty($decorator) && !array_key_exists($key, $decorators)) {\r\n+                array_unshift($decorators, $decorator);\r\n+            }\r\n \r\n-        $decorator  = $captcha->getDecorator();\r\n-        if (!empty($decorator)) {\r\n-            array_unshift($decorators, $decorator);\r\n-        } else {\r\n             $decorator = array('Captcha', array('captcha' => $captcha));\r\n-            array_unshift($decorators, $decorator);\r\n-        }\r\n+            $key       = get_class($this->_getDecorator($decorator[0], $decorator[1]));\r\n \r\n-        $this->setDecorators($decorators);\r\n+            if ($captcha instanceof Zend_Captcha_Word && !array_key_exists($key, $decorators)) {\r\n+                array_unshift($decorators, $decorator);\r\n+            }\r\n+\r\n+            $this->setDecorators($decorators);\r\n+        }\r\n \r\n         $this->setValue($this->getCaptcha()->generate());\r\n \r\n{code}\r\n\r\nIt makes the render function look like this:\r\n\r\n{code:title=render()|borderStyle=solid}\r\n    public function render(Zend_View_Interface $view = null)\r\n    {\r\n        $captcha    = $this->getCaptcha();\r\n        $captcha->setName($this->getFullyQualifiedName());\r\n\r\n        if (!$this->loadDefaultDecoratorsIsDisabled()) {\r\n            $decorators = $this->getDecorators();\r\n            $decorator  = $captcha->getDecorator();\r\n            $key        = get_class($this->_getDecorator($decorator, null));\r\n\r\n            if (!empty($decorator) && !array_key_exists($key, $decorators)) {\r\n                array_unshift($decorators, $decorator);\r\n            }\r\n\r\n            $decorator = array('Captcha', array('captcha' => $captcha));\r\n            $key       = get_class($this->_getDecorator($decorator[0], $decorator[1]));\r\n\r\n            if ($captcha instanceof Zend_Captcha_Word && !array_key_exists($key, $decorators)) {\r\n                array_unshift($decorators, $decorator);\r\n            }\r\n\r\n            $this->setDecorators($decorators);\r\n        }\r\n\r\n        $this->setValue($this->getCaptcha()->generate());\r\n\r\n        return parent::render($view);\r\n    }\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=djart",
                        "name": "djart",
                        "displayName": "Thanos Kyritsis",
                        "active": true
                    },
                    "created": "2011-07-27T10:31:56.000+0000",
                    "updated": "2011-07-27T10:31:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47693",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "body": "Fix and unit tests",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-07-27T12:47:01.000+0000",
                    "updated": "2011-07-27T12:47:01.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47694",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "@Thanos Kyritsis\r\nYou will need to sign and submit a CLA before you can attach your patch to this issue\r\nSee here: http:\/\/framework.zend.com\/wiki\/display\/ZFPROP\/Contributor+License+Agreement",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-07-27T13:23:09.000+0000",
                    "updated": "2011-07-27T13:23:09.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47696",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "body": "Hi Adam,\r\nThanos wrote the patch. I've tested the patch, write the unit tests and added both files.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-07-27T13:37:10.000+0000",
                    "updated": "2011-07-27T13:37:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47760",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Patches reviewed and applied to both trunk and 1.11 release branch.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2011-07-28T21:39:09.000+0000",
                    "updated": "2011-07-28T21:39:09.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11609\/transitions"
}