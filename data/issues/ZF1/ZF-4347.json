{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4347",
    "key": "ZF-4347",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Problem with breakChainOnFailure in Zend_File_Transfer_Adapter_Abstract"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4347\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10251",
                    "id": 10251,
                    "description": "Mini Release",
                    "name": "1.6.2",
                    "userReleaseDate": "13\/Oct\/08",
                    "archived": false,
                    "releaseDate": "2008-10-13",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-09-24T10:40:59.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=malt",
                "name": "malt",
                "displayName": "malt",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-09-22T01:43:54.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-10-10T14:41:46.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When using the breakChainOnFailure feature for file validators, the chain will break even if the validator does not return an error.\n\nIn the isValid() function in Zend_File_Transfer_Adapter_Abstract all validators will be run in a foreach loop. The check if breakChainOnFailure in\n\n{code:title=Zend_File_Transfer_Adapter_Abstract}\nif ($this->_break[$class]) {\n                        $break = true;\n                        break;\n}\n{code} \n\nwill break the loop without a check if there were errors in the validator, then the remaining validators in the chain are skipped.\n\nI fixed it with the following replacement code ( does not mean it is the right solution ):\n\n{code:title=Zend_File_Transfer_Adapter_Abstract}\nif ($this->_break[$class] && count($validator->getMessages()) > 0) {\n                        $break = true;\n                        break;\n}\n{code} \n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4347\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10201",
                    "id": 10201,
                    "description": "Mini Release",
                    "name": "1.6.1",
                    "userReleaseDate": "15\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-15",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10320",
                    "id": 10320,
                    "name": "Zend_File_Transfer",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24608",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=malt",
                        "name": "malt",
                        "displayName": "malt",
                        "active": true
                    },
                    "body": "This fix only works well if you have just 1 file element in the form.\n\nThe general problem with multiple file elements and breakChainOnFailure is that they all share the validators trough the adapter. Basically this is a good idea but leads to a problem.\n\nWhen the first element in the form gets validated and an error was found, for example the file has a wrong extension, all following form elements having the same validator will skip all validators coming after this validator in the chain. This happens because the extension validator carries already a message from the first element. \n\nSo if you have an ImageSize validator later in the chain for all elements, it wont be checked because the foreach loop will be left because of the previous Extension validator. \n\nNote: This wont be happen if each file element in the form has different validators.\n\nThere should be some reset function for the messages in the validators, so that the validation of each file element starts fresh and without any leftovers from previous file elements.\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=malt",
                        "name": "malt",
                        "displayName": "malt",
                        "active": true
                    },
                    "created": "2008-09-22T07:04:32.000+0000",
                    "updated": "2008-09-22T07:04:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24609",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=malt",
                        "name": "malt",
                        "displayName": "malt",
                        "active": true
                    },
                    "body": "I forgot to mention that i am using latest trunk version.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=malt",
                        "name": "malt",
                        "displayName": "malt",
                        "active": true
                    },
                    "created": "2008-09-22T07:34:06.000+0000",
                    "updated": "2008-09-22T07:34:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24617",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "You misunderstood the nature of breakChainOnFailure.\n\nThis work the same way like in Zend_Form.\nA element which breaks validation stops all further validations.\n\nThis is also true for file elements. As soon as a file element breaks validations the complete chain is stopped. Of course also for all further elements, because the whole validation stopped.\n\nThere is no way to have single elements be stopped and others after it be validated.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-09-22T11:58:35.000+0000",
                    "updated": "2008-09-22T11:58:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24624",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=malt",
                        "name": "malt",
                        "displayName": "malt",
                        "active": true
                    },
                    "body": "I experienced a different behavior of validation in Zend_Form. One invalid form element does not stop the whole validation process of the form. My impression is it that breakChainOnFailure just works locally for each form element, if they have multiple validators attached.\n\nThats why i was confused that file elements dont work the same way ( if there are multiple file elements in the form ).\n\nI also noticed that the error messages for the file elements will just be returned from the Adapter. Thats ok if you have only one file element. With multiple file elements, the error messages from the adapter should be transfered to each file element to avoid mixups. \n\nTo fix this i added the following code to the isValid() function of Zend_Form_Element_File:\n\n{code:title=Zend_Form_Element_File}\nif($adapter->hasErrors()) {\n\t$this->addErrors($adapter->getMessages());\n}\n{\/code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=malt",
                        "name": "malt",
                        "displayName": "malt",
                        "active": true
                    },
                    "created": "2008-09-23T01:28:36.000+0000",
                    "updated": "2008-09-23T01:28:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24625",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=malt",
                        "name": "malt",
                        "displayName": "malt",
                        "active": true
                    },
                    "body": "{code:title=Zend_Form_Element_File}\nif($adapter->hasErrors()) { \n      $this->addErrors($adapter->getMessages());\n }\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=malt",
                        "name": "malt",
                        "displayName": "malt",
                        "active": true
                    },
                    "created": "2008-09-23T01:31:29.000+0000",
                    "updated": "2008-09-23T01:31:29.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24626",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=malt",
                        "name": "malt",
                        "displayName": "malt",
                        "active": true
                    },
                    "body": "This also means the getMessages() function can be removed from Zend_Form_Element_File.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=malt",
                        "name": "malt",
                        "displayName": "malt",
                        "active": true
                    },
                    "created": "2008-09-23T02:00:17.000+0000",
                    "updated": "2008-09-23T02:00:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24646",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "The actual implementation does not have this problem.\nValidation is always done for single elements.\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-09-24T10:40:56.000+0000",
                    "updated": "2008-09-24T10:40:56.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4347\/transitions"
}