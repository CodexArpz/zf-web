{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6568",
    "key": "ZF-6568",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Defer initialization methods in module bootstrap until routeShutdown"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6568\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-05-07T06:05:14.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=monzee",
                "name": "monzee",
                "displayName": "Mon Zafra",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-05-07T05:22:57.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-05-08T04:02:51.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "bootstrap",
                "modules"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "At the moment, all module bootstrap methods are executed in every request. This makes it impossible to define behavior that are specific to a module. For example, I have two modules and I want to have different layouts for each. If I define _initLayout() in the two module bootstraps which pulls the layout MVC instance and sets the layout path and template, one of them will be overridden by the other, or both of them overridden by the application bootstrap itself. \n\nThere should be a way to specify module bootstrap methods that will be invoked only if the current request maps to that specific module. A possible way to do this is to register a controller plugin in the Modules resource plugin which pulls the active module from the request object and calls a bootstrap() analog that calls all module bootstrap methods that are named in a certain way:\n{code:title=module bootstrap}\n    class Foo_Bootstrap extends Zend_Application_Module_Bootstrap\n    {\n        protected function _initRoutes() { \/* this is always called *\/ }\n        protected function _setupLayout() { \/* this is only called if the request maps to the foo module *\/ }\n        public function setup() { \/* this should be defined in the parent class; it calls all _setup* methods *\/ }\n    }\n{code}\n{code:controller plugin}\n    class Module_Setup_Plugin extends Zend_Controller_Plugin_Abstract\n    {\n        public function __construct(array $executedBootstraps)\n        {\n            $this->_bootstraps = $executedBootstraps;\n        }\n\n        public function routeShutdown($request)\n        {\n            $module = $request->getModuleName();\n            $bootstrap = $this->_bootstraps[$module];\n            $bootstrap->setup();\n        }\n    }\n{code}\n{code:title=resource plugin}\n    \/\/ Zend\/Application\/Resource\/Modules.php\n    ...\n    public function init()\n    {\n        ...\n        $plugin = new Module_Setup_Plugin($this->_bootstraps);\n        $this->getBootstrap()->getResource('frontcontroller')->registerPlugin($plugin);\n        return $this->_bootstraps;\n    }\n    ...\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6568\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10241",
                    "id": 10241,
                    "description": "Minor Release",
                    "name": "1.8.0",
                    "userReleaseDate": "30\/Apr\/09",
                    "archived": false,
                    "releaseDate": "2009-04-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10390",
                    "id": 10390,
                    "name": "Zend_Application",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30741",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "The point of module bootstrapping is to provide the ability to bootstrap features that should be available on every request. Such actions include setting up module-specific autoloading (e.g., so that module-specific models may be resolved for use in sitewide layout), setting up plugin paths (e.g., so that module-specific view helpers and action helpers will be present), and providing common plugins.\n\nThis latter directly addresses some of your concerns. If you have bootstrapping actions that you only need to load if the request maps to your module, you should be moving this logic to a routeShutdown() or dispatchLoopStartup() plugin _that your module bootstrap registers_.\n\nAs an example, your bootstrap could do the following:\n\n{code}\nclass Foo_Bootstrap extends Zend_Application_Module_Bootstrap\n{\n    protected function _initPlugins()\n    {\n        $bootstrap = $this->getApplication();\n        if ($bootstrap instanceof Zend_Application) {\n            $bootstrap = $this;\n        }\n        $bootstrap->bootstrap('FrontController');\n        $front = $bootstrap->getResource('FrontController');\n\n        $plugin = new Foo_Plugin_Layout();\n        $plugin->setBootstrap($this);\n        $front->registerPlugin($plugin);\n    }\n}\n{code}\n\nFoo_Plugin_Layout would then have a routeShutdown() or dispatchLoopStartup() method that checks to see if the current module is selected, and if so, does some initialization:\n\n{code}\nclass Foo_Plugin_Layout extends Zend_Controller_Plugin_Abstract\n{\n    public function routeShutdown(Zend_Controller_Request_Abstract $request)\n    {\n        if ('foo' != $request->getModuleName()) {\n            return;\n        }\n\n        \/\/ do some work...\n    }\n}\n{code}\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-05-07T06:02:49.000+0000",
                    "updated": "2009-05-07T06:02:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30742",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Moving module bootstrapping until after routing directly contradicts one of the purposes of module bootstraps: the ability to affect the application lifecycle, _including_ routing. If initialization needs to be deferred until after routing, the module bootstrap should register plugins for doing so.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-05-07T06:05:14.000+0000",
                    "updated": "2009-05-07T06:05:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30757",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=monzee",
                        "name": "monzee",
                        "displayName": "Mon Zafra",
                        "active": true
                    },
                    "body": "To be clear, I wasn't requesting that all bootstrap methods be deferred until routeShutdown. I was requesting that we have, in addition to _init* methods, another set of methods that will be invoked later by a controller plugin.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=monzee",
                        "name": "monzee",
                        "displayName": "Mon Zafra",
                        "active": true
                    },
                    "created": "2009-05-07T19:25:21.000+0000",
                    "updated": "2009-05-07T19:25:21.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30766",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "You can write any methods you want in a resource plugin, and invoke them selectively from your controller plugins. While I can see your need, it conflicts with the design. Bootstrapping is for initialization that needs to occur on every request; plugins are the appropriate place to put initialization that may be conditional based on the request environment.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-05-08T04:02:50.000+0000",
                    "updated": "2009-05-08T04:02:50.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6568\/transitions"
}