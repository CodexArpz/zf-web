{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1118",
    "key": "ZF-1118",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Problems with Offers and OfferSummary"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/11",
                "name": "Patch",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1118\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10070",
                    "id": 10070,
                    "description": "Beta Release; bug fixes",
                    "name": "0.9.2",
                    "userReleaseDate": "06\/Apr\/07",
                    "archived": true,
                    "releaseDate": "2007-04-06",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-04-06T09:17:04.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                "name": "nikosams",
                "displayName": "Niko Sams",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-03-23T01:12:34.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-05T14:43:58.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I wanted to use Service_Amazon and came up with various problems:\n- OfferSummary not included in result if Offers is empty\n- OfferSummary is incomplete\n- for some items i get warnings\n\npatches are against latest trunk.\n\nThis is my client-code:\n{code}\n$amazon = new Zend_Service_Amazon('AMAZON_KEY');\n$item = $amazon->itemLookup('B0000A432X', array('ResponseGroup' => 'Large'));\nZend_Debug::dump($item);\n\n$amazon = new Zend_Service_Amazon('AMAZON_KEY', 'DE');\n$item = $amazon->itemLookup('3853262724', array('ResponseGroup' => 'Large'));\nZend_Debug::dump($item);\n{code}\n\nbugfix: replaced $offer with $dom\nbugfix: added namespace\n{code}\nIndex: library\/Zend\/Service\/Amazon\/OfferSet.php\n===================================================================\n--- library\/Zend\/Service\/Amazon\/OfferSet.php    (Revision 4171)\n+++ library\/Zend\/Service\/Amazon\/OfferSet.php    (Arbeitskopie)\n@@ -41,12 +41,12 @@\n\n        $offer = $xpath->query('.\/az:OfferSummary', $dom);\n         if ($offer->length == 1) {\n-               $lowestNewPrice = $xpath->query('.\/az:OfferSummary\/az:LowestNewPrice', $offer);\n+               $lowestNewPrice = $xpath->query('.\/az:OfferSummary\/az:LowestNewPrice', $dom);\n             if ($lowestNewPrice->length == 1) {\n                 $this->LowestNewPrice = (int) $xpath->query('.\/az:OfferSummary\/az:LowestNewPrice\/az:Amount\/text()', $dom)->item(0)->data;\n                 $this->LowestNewPriceCurrency = (string) $xpath->query('.\/az:OfferSummary\/az:LowestNewPrice\/az:CurrencyCode\/text()', $dom)->item(0)->data;\n             }\n-            $lowestOldPrice = $xpath->query('.\/az:OfferSummary\/az:LowestNewPrice', $offer);\n+            $lowestOldPrice = $xpath->query('.\/az:OfferSummary\/az:LowestOldPrice', $dom);\n             if ($lowestOldPrice->length == 1) {\n                 $this->LowestOldPrice = (int) $xpath->query('.\/az:OfferSummary\/az:LowestOldPrice\/az:Amount\/text()', $dom)->item(0)->data;\n                 $this->LowestOldPriceCurrency = (string) $xpath->query('.\/az:OfferSummary\/az:LowestOldPrice\/az:CurrencyCode\/text()', $dom)->item(0)->data;\n@@ -56,7 +56,7 @@\n             $this->TotalCollectible = (int) $xpath->query('.\/az:OfferSummary\/az:TotalCollectible\/text()', $dom)->item(0)->data;\n             $this->TotalRefurbished = (int) $xpath->query('.\/az:OfferSummary\/az:TotalRefurbished\/text()', $dom)->item(0)->data;\n         }\n-        $offers = $xpath->query('.\/az:Offers\/Offer', $dom);\n+        $offers = $xpath->query('.\/az:Offers\/az:Offer', $dom);\n         if ($offers->length >= 1) {\n             foreach($offers as $offer) {\n                 $this->Offers[] = new Zend_Service_Amazon_Offer($offer);\n{code}\n\nRemove OfferSummary variable - as it is nowhere used.\nCreate Offers-Object if OffersSummary or Offers is included in the result.\n(OfferSet actually reads the OfferSummary-Data)\n{code}\nIndex: library\/Zend\/Service\/Amazon\/Item.php\n===================================================================\n--- library\/Zend\/Service\/Amazon\/Item.php        (Revision 4171)\n+++ library\/Zend\/Service\/Amazon\/Item.php        (Arbeitskopie)\n@@ -36,7 +36,6 @@\n     public $MediumImage;\n     public $LargeImage;\n     public $Subjects;\n-    public $OfferSummary;\n     public $Offers;\n     public $CustomerReviews;\n     public $SimilarProducts;\n@@ -140,7 +139,8 @@\n         }\n\n         $result = $xpath->query('.\/az:Offers', $dom);\n-        if ($result->length > 1) {\n+        $resultSummary = $xpath->query('.\/az:OfferSummary', $dom);\n+        if ($result->length > 1 || $resultSummary->length == 1) {\n             $this->Offers = new Zend_Service_Amazon_OfferSet($dom);\n         }\n{code}\n\nAvoid Warning if field is not set:\n{code}\nIndex: library\/Zend\/Service\/Amazon\/Offer.php\n===================================================================\n--- library\/Zend\/Service\/Amazon\/Offer.php       (Revision 4171)\n+++ library\/Zend\/Service\/Amazon\/Offer.php       (Arbeitskopie)\n@@ -45,6 +45,9 @@\n         $this->Price = (int) $xpath->query('.\/az:OfferListing\/az:Price\/az:Amount\/text()', $dom)->item(0)->data;\n         $this->CurrencyCode = (string) $xpath->query('.\/az:OfferListing\/az:Price\/az:CurrencyCode\/text()', $dom)->item(0)->data;\n         $this->Availability = (string) $xpath->query('.\/az:OfferListing\/az:Availability\/text()', $dom)->item(0)->data;\n-        $this->IsEligibleForSuperSaverShipping = (bool) $xpath->query('.\/az:OfferListing\/az:isEligibleForSuperSaverShipping\/text()', $dom)->item(0)->data;\n+        $result = $xpath->query('.\/az:OfferListing\/az:isEligibleForSuperSaverShipping\/text()', $dom);\n+        if ($result->length == 1) {\n+            $this->IsEligibleForSuperSaverShipping = (bool) $result->item(0)->data;\n+        }\n     }\n }\n{code}\n\nAvoid Warning if field is not set:\n{code}\nIndex: library\/Zend\/Service\/Amazon\/CustomerReview.php\n===================================================================\n--- library\/Zend\/Service\/Amazon\/CustomerReview.php      (Revision 4171)\n+++ library\/Zend\/Service\/Amazon\/CustomerReview.php      (Arbeitskopie)\n@@ -39,7 +39,10 @@\n        $xpath = new DOMXPath($dom->ownerDocument);\n        $xpath->registerNamespace('az', 'http:\/\/webservices.amazon.com\/AWSECommerceService\/2005-10-05');\n         foreach(array('Rating', 'HelpfulVotes', 'CustomerId', 'TotalVotes', 'Date', 'Summary', 'Content') as $el) {\n-            $this->$el = (string) $xpath->query(\".\/az:$el\/text()\", $dom)->item(0)->data;\n+            $result = $xpath->query(\".\/az:$el\/text()\", $dom);\n+            if ($result->length == 1) {\n+                $this->$el = (string) $result->item(0)->data;\n+            }\n         }\n     }\n }\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1118\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                "name": "darby",
                "displayName": "Darby Felton",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10060",
                    "id": 10060,
                    "description": "Beta Release; bug fixes",
                    "name": "0.9.1",
                    "userReleaseDate": "23\/Mar\/07",
                    "archived": true,
                    "releaseDate": "2007-03-23",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10022",
                    "id": 10022,
                    "name": "Zend_Service_Amazon",
                    "description": "utility functions for using Amazon web services",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/13660",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "edit description: corrected code-tags",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2007-03-23T01:18:25.000+0000",
                    "updated": "2007-03-23T01:18:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/13767",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Updated summary",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-03-28T12:12:19.000+0000",
                    "updated": "2007-03-28T12:12:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14004",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "I believe this issue to have been resolved with [SVN r4357|http:\/\/framework.zend.com\/fisheye\/changelog\/Zend_Framework\/?cs=4357]. If this is not the case, please feel free to reopen with additional comment.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-04-04T17:40:24.000+0000",
                    "updated": "2007-04-04T17:40:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14031",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "everything was fixed and works fine, except the last patch:\n{code}\nIndex: library\/Zend\/Service\/Amazon\/CustomerReview.php\n===================================================================\n--- library\/Zend\/Service\/Amazon\/CustomerReview.php      (Revision 4171)\n+++ library\/Zend\/Service\/Amazon\/CustomerReview.php      (Arbeitskopie)\n@@ -39,7 +39,10 @@\n        $xpath = new DOMXPath($dom->ownerDocument);\n        $xpath->registerNamespace('az', 'http:\/\/webservices.amazon.com\/AWSECommerceService\/2005-10-05');\n         foreach(array('Rating', 'HelpfulVotes', 'CustomerId', 'TotalVotes', 'Date', 'Summary', 'Content') as $el) {\n-            $this->$el = (string) $xpath->query(\".\/az:$el\/text()\", $dom)->item(0)->data;\n+            $result = $xpath->query(\".\/az:$el\/text()\", $dom);\n+            if ($result->length == 1) {\n+                $this->$el = (string) $result->item(0)->data;\n+            }\n         }\n     }\n }\n{code}\n\nI still get warnings if a field does not exist (and the field actually does not exist in the response from amazon)\n\nhow do i reopen this issue?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2007-04-06T01:03:26.000+0000",
                    "updated": "2007-04-06T01:03:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14035",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Reopening issue on Niko's behalf.\n\nNiko, I see a \"Reopen Issue\" link under \"Available Workflow Actions\" on the left side of the page, in the navigation column. Maybe your view is different?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-04-06T08:34:43.000+0000",
                    "updated": "2007-04-06T08:34:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14036",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "I don't have this :(\nLooks like I have different permissions here...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2007-04-06T09:13:44.000+0000",
                    "updated": "2007-04-06T09:13:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14037",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Added patch with [SVN r4388|http:\/\/framework.zend.com\/fisheye\/changelog\/Zend_Framework\/?cs=4388].\n\nThanks, Niko! :)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-04-06T09:17:04.000+0000",
                    "updated": "2007-04-06T09:17:04.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1118\/transitions"
}