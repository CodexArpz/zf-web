{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10497",
    "key": "ZF-10497",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Can not add more than one database validator to a form"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10497\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-09-28T02:35:16.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kryten",
                "name": "kryten",
                "displayName": "Garry Childs",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-09-26T16:15:52.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-09-28T02:35:23.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "This is not a major issue but I have had the need to check an email address against two different database tables.  I added both to a form element, see below, but only one was checked.  I had a quick look at the source code and discovered that the validator's name is used as the key in the validator list, hence why only the last database validator worked.\r\n\r\nThe work around for this was simple as I just added a second check after the initial form validation.\r\n\r\nThe form element:\r\n\r\n$email_address = new Zend_Form_Element_Text('email_address');\r\n$email_address->setLabel('Email address:')\r\n        ->setRequired(true)\r\n        ->setAttrib('size', 50)\r\n        ->addErrorMessage('You must specify a valid email address')\r\n        ->addFilter('StringTrim')\r\n        ->addFilter('StripNewlines')\r\n        ->addFilter('StripTags')\r\n        ->addValidator('NotEmpty', true)\r\n        ->addValidator('EmailAddress', true, array(\r\n            'deep' => true,\r\n            'allow' => Zend_Validate_Hostname::ALLOW_DNS,\r\n            'mx' => true))\r\n        ->addValidator('Db_NoRecordExists', true, array(\r\n            'adapter' => Zend_Registry::get('mydb'),\r\n            'field' => 'email_address',\r\n            'table' => 'site_users',\r\n            'setMessage' => array('recordFound' => \r\n                'This email address is already registered!')))\r\n        ->addValidator('Db_NoRecordExists', true, array(\r\n            'adapter' => Zend_Registry::get('mydb'),\r\n            'field' => 'email_address',\r\n            'table' => 'site_agencies',\r\n            'setMessage' => array('recordFound' => \r\n                'This email address is already registered!')));\r\n\r\nThe workaround:\r\nI removed the last validator from the code above and added into my controller script\r\n\r\n$request = $this->getRequest();\r\n$form = new Form_MyForm(null);\r\n\r\nif($request->isPost()){\r\n    if($form->isValid($this->_request->getPost())){\r\n        $email_address = $this->_request->getParam('email_address');\r\n        $validator = new Zend_Validate_Db_NoRecordExists(array(\r\n                'adaptor'\t=> Zend_Registry::get('seevee'),\r\n                'table'\t\t=> 'site_agencies',\r\n                'field'\t\t=> 'agency_email_address'));\r\n        if ($validator->isValid($email_address)) {\r\n                \/\/ valid\r\n        } else {\r\n                \/\/ invalid\r\n                $this->view->errorMessage = '\r\n                    There has been a problem with the form you submitted<br \/>\r\n                    Please correct the errors below to continue';\r\n        }\r\n    }  \r\n}\t\r\n\r\nI know this is only trivial but you may wish to look into this sometime.\t\t\t\t\r\n\r\nKind regards\r\nGarry"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/5",
                "name": "Trivial"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10497\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bittarman",
                "name": "bittarman",
                "displayName": "Ryan Mauger",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-4811",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4811",
                    "type": {
                        "name": "Duplicate",
                        "direction": "OUTBOUND",
                        "description": "duplicates"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10490",
                    "id": 10490,
                    "description": "Mini Release",
                    "name": "1.10.8",
                    "userReleaseDate": "25\/Aug\/10",
                    "archived": false,
                    "releaseDate": "2010-08-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10140",
                    "id": 10140,
                    "name": "Zend_Validate",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42385",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bittarman",
                        "name": "bittarman",
                        "displayName": "Ryan Mauger",
                        "active": true
                    },
                    "body": "Closing duplicate issue.\r\n\r\nPlease see linked issue for reasons.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bittarman",
                        "name": "bittarman",
                        "displayName": "Ryan Mauger",
                        "active": true
                    },
                    "created": "2010-09-28T02:35:18.000+0000",
                    "updated": "2010-09-28T02:35:18.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10497\/transitions"
}