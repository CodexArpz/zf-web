{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7137",
    "key": "ZF-7137",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "zf.sh fallback code to build path to zf.php is situationaly broken"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7137\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/5",
                "name": "Cannot Reproduce"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-05-28T21:05:21.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                "name": "gnanderson",
                "displayName": "Graham Anderson",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-06-26T13:59:27.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-05-28T21:05:21.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "zend_tool"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "If the two scripts (zf.sh & zf.php) from the (ZF) distribution bin dir are placed in \/usr\/bin and \/usr\/bin\/zf.sh is symlinked to \/usr\/bin\/zf calling \"zf\" from a shell location outside of \/usr\/bin fails to execute zf.php\n\nThe problem appears to be the code to build the path ends up using the \".\" or \"..\" relative directory artifacts instead of building an absolute path to the current zf.sh location.\n\nThe following diff fixes this so that \"zf\" can be run from a shell in any location by always using the absolute path to zf.sh and prepending this to the call to zf.php. Assuming of course zf.sh and zf.php are placed in the same location, as the code expects.\n\n{noformat}\n35,41c35,36\n<     SELF_LINK=\"$0\"\n<     SELF_LINK_TMP=\"$(readlink \"$SELF_LINK\")\"\n<     while test -n \"$SELF_LINK_TMP\"; do\n<         SELF_LINK=\"$SELF_LINK_TMP\"\n<         SELF_LINK_TMP=\"$(readlink \"$SELF_LINK\")\"\n<     done\n<     PHP_DIR=\"$(dirname \"$SELF_LINK\")\"\n---\n>     SELF_LOCATION=\"$(which \"$0\")\"\n>     PHP_DIR=\"$(dirname \"$SELF_LOCATION\")\"\n42a38\n>\n{noformat}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/6",
                "name": "N\/A"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7137\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12114",
                    "filename": "zf.sh.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                        "name": "gnanderson",
                        "displayName": "Graham Anderson",
                        "active": true
                    },
                    "created": "2009-07-30T05:06:09.000+0000",
                    "size": 568,
                    "mimeType": "application\/octet-stream; charset=ISO-8859-1",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12114\/zf.sh.patch"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12113",
                    "filename": "zf.sh.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                        "name": "gnanderson",
                        "displayName": "Graham Anderson",
                        "active": true
                    },
                    "created": "2009-07-30T05:05:33.000+0000",
                    "size": 568,
                    "mimeType": "application\/octet-stream; charset=ISO-8859-1",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12113\/zf.sh.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10241",
                    "id": 10241,
                    "description": "Minor Release",
                    "name": "1.8.0",
                    "userReleaseDate": "30\/Apr\/09",
                    "archived": false,
                    "releaseDate": "2009-04-30",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10310",
                    "id": 10310,
                    "description": "Mini Release",
                    "name": "1.8.1",
                    "userReleaseDate": "12\/May\/09",
                    "archived": false,
                    "releaseDate": "2009-05-12",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10330",
                    "id": 10330,
                    "description": "Mini Release",
                    "name": "1.8.2",
                    "userReleaseDate": "27\/May\/09",
                    "archived": false,
                    "releaseDate": "2009-05-27",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10331",
                    "id": 10331,
                    "description": "Mini Release",
                    "name": "1.8.3",
                    "userReleaseDate": "09\/Jun\/09",
                    "archived": false,
                    "releaseDate": "2009-06-09",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10340",
                    "id": 10340,
                    "description": "Mini Release",
                    "name": "1.8.4",
                    "userReleaseDate": "23\/Jun\/09",
                    "archived": false,
                    "releaseDate": "2009-06-23",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10380",
                    "id": 10380,
                    "name": "Zend_Tool",
                    "description": "Zend_Tool component",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33056",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                        "name": "gnanderson",
                        "displayName": "Graham Anderson",
                        "active": true
                    },
                    "body": "unified format in case the diff in my comment is awkward for people",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                        "name": "gnanderson",
                        "displayName": "Graham Anderson",
                        "active": true
                    },
                    "created": "2009-07-30T05:05:35.000+0000",
                    "updated": "2009-07-30T05:05:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33057",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                        "name": "gnanderson",
                        "displayName": "Graham Anderson",
                        "active": true
                    },
                    "body": "unified format in case the diff in my comment is awkward for people",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                        "name": "gnanderson",
                        "displayName": "Graham Anderson",
                        "active": true
                    },
                    "created": "2009-07-30T05:06:09.000+0000",
                    "updated": "2009-07-30T05:06:09.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37186",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stefan.stubbe",
                        "name": "stefan.stubbe",
                        "displayName": "Stefan Stubbe",
                        "active": true
                    },
                    "body": "Although the problem I am having is not the exactly the same as Graham's, it is very similar and the fix I propose should solve his problem too.\r\n\r\nI keep different ZendFramework version around and have created symbolic links to the different zf.sh version like this:\r\n\r\n{noformat}\r\n~\/bin $ ls -1 zf*\r\nlrwxrwxrwx 1 yahiko yahiko  8 Dec 27 15:01 zf -> zf-1.9.6\r\nlrwxrwxrwx 1 yahiko yahiko 72 Aug 16 12:01 zf-1.9.1 -> ..\/library\/ZendFramework-1.9.1-minimal\/bin\/zf.sh\r\nlrwxrwxrwx 1 yahiko yahiko 75 Sep 27 21:21 zf-1.9.3 -> ..\/library\/ZendFramework-1.9.3PL1-minimal\/bin\/zf.sh\r\nlrwxrwxrwx 1 yahiko yahiko 72 Oct 21 23:36 zf-1.9.4 -> ..\/library\/ZendFramework-1.9.4-minimal\/bin\/zf.sh\r\nlrwxrwxrwx 1 yahiko yahiko 72 Dec 27 15:01 zf-1.9.6 -> ..\/library\/ZendFramework-1.9.6-minimal\/bin\/zf.sh\r\n{noformat}\r\n\r\nAll the zf-* symbolic links work like expected. But the 'zf' symbolic link doesn't.\r\nThis symbolic link always points to the symbolic link that points to the lastest zf.zh.\r\n\r\nThe reason why it does not work is that {{readlink zf}} gives {{zf-1.9.6}}, which becomes the result for SELF_LINK ({{readlink zf-1.9.6}} is empty).\r\n{{dirname zf-1.9.6}} gives '.', so that the final command that is executed and fails is:\r\n\r\n{noformat}php -d safe_mode=Off -f \".\/zf.php\" -- $@{noformat}\r\n\r\n\r\nIf I link directly to the latest zf.sh, it works like expected.\r\nMaybe my usage is rare enough to ignore this problem, but the fix is easy enough.\r\n\r\n{noformat}\r\ndiff --git a\/zf.sh b\/zf.sh\r\nindex d35273a..5020dc3 100755\r\n--- a\/zf.sh\r\n+++ b\/zf.sh\r\n@@ -32,12 +32,7 @@ fi\r\n if test \"@php_dir@\" != '@'php_dir'@'; then\r\n     PHP_DIR=\"@php_dir@\"\r\n else\r\n-    SELF_LINK=\"$0\"\r\n-    SELF_LINK_TMP=\"$(readlink \"$SELF_LINK\")\"\r\n-    while test -n \"$SELF_LINK_TMP\"; do\r\n-        SELF_LINK=\"$SELF_LINK_TMP\"\r\n-        SELF_LINK_TMP=\"$(readlink \"$SELF_LINK\")\"\r\n-    done\r\n+    SELF_LINK=\"$(readlink -f \"$0\")\"\r\n     PHP_DIR=\"$(dirname \"$SELF_LINK\")\"\r\n fi\r\n{noformat}\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stefan.stubbe",
                        "name": "stefan.stubbe",
                        "displayName": "Stefan Stubbe",
                        "active": true
                    },
                    "created": "2009-12-27T07:42:58.000+0000",
                    "updated": "2009-12-27T07:42:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46891",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "I cannot reproduce your issue.\n\nWhich shell is this in? Can you give me exact steps to reproduce. I use custom links in my environment as well and they seems to link and work fine.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2011-05-28T21:05:21.000+0000",
                    "updated": "2011-05-28T21:05:21.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7137\/transitions"
}