{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2052",
    "key": "ZF-2052",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "base url not detected when it has urlencoded characters"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField",
            "value": {
                "timeoriginalestimate": 30,
                "timeestimate": 30
            }
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2052\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10170",
                    "id": 10170,
                    "description": "Mini Release",
                    "name": "1.0.4",
                    "userReleaseDate": "26\/Feb\/08",
                    "archived": true,
                    "releaseDate": "2008-02-26",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-03-06T10:57:27.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gbachelet",
                "name": "gbachelet",
                "displayName": "Geoffrey",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-10-08T08:11:40.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-01-26T06:48:00.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When the base url has a space in it (or whatever urlencoded character I guess) the Zend_Controller_Request_Http object does not detect it properly.\n\nA simple urldecode() inside Zend_Controller_Request_Http::setRequestUri() will fix that"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2052\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-2782",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2782",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10130",
                    "id": 10130,
                    "description": "Mini Release",
                    "name": "1.0.2",
                    "userReleaseDate": "25\/Sep\/07",
                    "archived": true,
                    "releaseDate": "2007-09-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10011",
                    "id": 10011,
                    "name": "Zend_Controller",
                    "description": "front controller, including router and dispatcher",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/17593",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Scheduling for 1.0.3",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2007-11-16T14:37:11.000+0000",
                    "updated": "2007-11-16T14:37:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19244",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Patched in trunk and release-1.0 branch.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-02-19T09:33:43.000+0000",
                    "updated": "2008-02-19T09:33:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19683",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Changing this behaviour actually breaks many applications, particularly those that pull from getPathInfo(). I am reverting this change.\n\nIf you need this functionality, subclass the request object as follows:\n{code}\nclass My_Request_Http extends Zend_Controller_Request_Http\n{\n    public function setRequestUri($requestUri = null)\n    {\n        parent::setRequestUri($requestUri);\n        $this->_requestUri = urldecode($this->_requestUri);\n        return $this;\n    }\n}\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-03-06T10:57:05.000+0000",
                    "updated": "2008-03-06T10:57:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19684",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Will not fix, as it breaks other behaviours.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-03-06T10:57:27.000+0000",
                    "updated": "2008-03-06T10:57:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44190",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cduv",
                        "name": "cduv",
                        "displayName": "Claude Duvergier",
                        "active": true
                    },
                    "body": "I'm suggesting another fix that won't change {{Zend_Controller_Request_Http::$_requestUri}}.\r\n\r\n*Context:*\r\nI access my development Apache server via the following URL (a VirtualHost): http:\/\/devprojects.myself.local\r\nMy multiple Zend-powered application are accessible from there. For example: http:\/\/devprojects.myself.local\/myGreatZfApp\/public\/\r\nBut, for some, there are spaces in the name of the folder that contains the application. Hence they appears the URL as \"%20\" (eg. [http:\/\/devprojects.myself.local\/another%20Zf App\/public\/]).\r\n\r\n*Problem:*\r\nMy problem is that, on theses projects, baseUrl is not correctly set: it stays empty (an empty string).\r\nBy analysing the code of {{Zend_Controller_Request_Http::setBaseUrl()}} I found out that base URL is somehow firstly correctly detected (either via {{$_SERVER['SCRIPT_NAME']}} or {{$_SERVER['PHP_SELF']}}), stored in local variable {{$baseUrl}} but gets compared to {{Zend_Controller_Request_Http::_requestUri}}:\r\n{code}\r\n\/\/ Does the baseUrl have anything in common with the request_uri?\r\n$requestUri = $this->getRequestUri();\r\n\r\nif (0 === strpos($requestUri, $baseUrl)) {\r\n    \/\/ full $baseUrl matches\r\n    $this->_baseUrl = $baseUrl;\r\n    return $this;\r\n}\r\n\r\nif (0 === strpos($requestUri, dirname($baseUrl))) {\r\n    \/\/ directory portion of $baseUrl matches\r\n    $this->_baseUrl = rtrim(dirname($baseUrl), '\/');\r\n    return $this;\r\n}\r\n\r\n$truncatedRequestUri = $requestUri;\r\nif (($pos = strpos($requestUri, '?')) !== false) {\r\n    $truncatedRequestUri = substr($requestUri, 0, $pos);\r\n}\r\n\r\n$basename = basename($baseUrl);\r\nif (empty($basename) || !strpos($truncatedRequestUri, $basename)) {\r\n    \/\/ no match whatsoever; set it blank\r\n    $this->_baseUrl = '';\r\n    return $this;\r\n}\r\n\r\n\/\/ If using mod_rewrite or ISAPI_Rewrite strip the script filename\r\n\/\/ out of baseUrl. $pos !== 0 makes sure it is not matching a value\r\n\/\/ from PATH_INFO or QUERY_STRING\r\nif ((strlen($requestUri) >= strlen($baseUrl))\r\n    && ((false !== ($pos = strpos($requestUri, $baseUrl))) && ($pos !== 0)))\r\n{\r\n    $baseUrl = substr($requestUri, 0, $pos + strlen($baseUrl));\r\n}\r\n{code}\r\n\r\nMy opinion is the code doesn't make the difference between a file path on the server and an URL (that have it's own set of constraints): the two may be similar then have some small differences.\r\n\r\n*Steps to reproduce:*\r\n- Create a blank new Zend application\r\n- Make it accessible via an URL that contains one or more spaces (eg. [http:\/\/127.0.0.1\/my projects rep\/The Application\/])\r\n- Print the base URL via {{Zend_Controller_Front::getInstance()->getBaseUrl()}} or {{Zend_View_Helper_BaseUrl::getBaseUrl()}}\r\n- Notice it's empty (should be \"\/my projects rep\/The Application\/\")\r\n\r\n*Fix proposal:*\r\nThe simple following fix seems to do the trick (making the {{Zend_Controller_Request_Http::_requestUri}} going through {{urldecode()}}):\r\n{code}\r\n\/\/ Does the baseUrl have anything in common with the request_uri?\r\n$requestUri = urldecode($this->getRequestUri());\r\n{code}\r\nBut, as I said, file paths and URLs shouldn't be considered as equals: thus I suggest to make {{$baseUrl}} (which is actually constructed from file paths) go through {{urlencode()}} instead:{code}\r\n\/\/ Convert the paths found into an URL (handling specials characters such as spaces)\r\n$baseUrl = urlencode($baseUrl);\r\n\r\n\/\/ Does the baseUrl have anything in common with the request_uri?\r\n$requestUri = $this->getRequestUri();\r\n\r\n[...]\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cduv",
                        "name": "cduv",
                        "displayName": "Claude Duvergier",
                        "active": true
                    },
                    "created": "2011-01-26T03:33:46.000+0000",
                    "updated": "2011-01-26T03:33:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44192",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cduv",
                        "name": "cduv",
                        "displayName": "Claude Duvergier",
                        "active": true
                    },
                    "body": "Please ignore my second proposal (applying {{urlencode()}} on {{$baseUrl}}) as ({{urlencode()}} hasn't the proper effect on base URL (spaces are changed to \"+\").\r\n\r\nAdditionally, I've noticed that with my first fix proposal (applying {{urldecode()}} to the request URI) when accessing to [http:\/\/127.0.0.1\/my%20projects%20rep\/The%20Application\/public\/index.php] (note the tailing \"*index.php*\"), base URL takes the _wrong_ value \"\/my%20projects%20rep\/The%20Application\/public\/index.php\" (because, in that case, {{$baseUrl}} directly fully matches the request URI).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cduv",
                        "name": "cduv",
                        "displayName": "Claude Duvergier",
                        "active": true
                    },
                    "created": "2011-01-26T06:47:56.000+0000",
                    "updated": "2011-01-26T06:47:56.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2052\/transitions"
}