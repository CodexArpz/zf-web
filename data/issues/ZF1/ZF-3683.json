{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3683",
    "key": "ZF-3683",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Performance improvement: reuse token object in lowercase filter"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3683\/votes",
                "votes": 2,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10510",
                    "id": 10510,
                    "description": "Minor Release",
                    "name": "1.12.0",
                    "userReleaseDate": "27\/Aug\/12",
                    "archived": false,
                    "releaseDate": "2012-08-27",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-05-30T13:15:07.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zoe",
                "name": "zoe",
                "displayName": "zoe slattery",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-07-18T09:39:12.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-05-30T13:15:19.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "There is a small performance improvement that could be made to the part of the code that creates indexes.\r\nIn class Zend_Search_Lucene_Analysis_Analyzer_Common_Text in the nextToken() method the following line of code is executed:\r\n\r\n$token = $this->normalize(new Zend_Search_Lucene_Analysis_Token($str, $pos, $endpos));\r\n\r\nThis calls the normalize() method of Zend_Search_Lucene_Analysis_TokenFilter_LowerCase. A Token object is created as part of the call to normalize(), inside normalize() a second Token object is created which is an exact copy of the first apart from the fact that the text is converted to lower case.\r\n\r\nThis means that two Token objects are created for every token - this has some impact on performance (about 7% on the examples that I've looked at). One very simple fix would be to change normalize() so that it doesn't create a second object but just updates the text in the object that is passed to it. This would also require a change to Token.php to allow the text field to be set. I expect that there are more architecturally pleasing ways to fix."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3683\/watchers",
                "isWatching": false,
                "watchCount": 4
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "FixForZF1.12",
                "state:need-feedback",
                "zf-caretaker-adamlundrigan",
                "zf-crteam-padraic",
                "zf-crteam-priority",
                "zf-crteam-review"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                "name": "adamlundrigan",
                "displayName": "Adam Lundrigan",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/14953",
                    "filename": "ZF-3683.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2012-03-09T17:44:26.000+0000",
                    "size": 2544,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/14953\/ZF-3683.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10181",
                    "id": 10181,
                    "description": "Mini Release",
                    "name": " 1.5.2",
                    "userReleaseDate": "15\/May\/08",
                    "archived": true,
                    "releaseDate": "2008-05-15",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10021",
                    "id": 10021,
                    "name": "Zend_Search_Lucene",
                    "description": "pure PHP robust, general purpose text search engine",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25935",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "Re-evaluated to major since Lucene already is very memory hungry 7% is quite a bit, and this can probably be fixed very easily (as reporter suggested).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2008-11-08T00:31:46.000+0000",
                    "updated": "2008-11-08T00:31:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48774",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Here is a patch implementing the issue submitter's suggestion:\r\n{code}\r\nIndex: library\/Zend\/Search\/Lucene\/Analysis\/TokenFilter\/LowerCase.php\r\n===================================================================\r\n--- library\/Zend\/Search\/Lucene\/Analysis\/TokenFilter\/LowerCase.php\t(revision 24527)\r\n+++ library\/Zend\/Search\/Lucene\/Analysis\/TokenFilter\/LowerCase.php\t(working copy)\r\n@@ -45,14 +45,8 @@\r\n      *\/\r\n     public function normalize(Zend_Search_Lucene_Analysis_Token $srcToken)\r\n     {\r\n-        $newToken = new Zend_Search_Lucene_Analysis_Token(\r\n-                                     strtolower( $srcToken->getTermText() ),\r\n-                                     $srcToken->getStartOffset(),\r\n-                                     $srcToken->getEndOffset());\r\n-\r\n-        $newToken->setPositionIncrement($srcToken->getPositionIncrement());\r\n-\r\n-        return $newToken;\r\n+        $srcToken->setTermText(strtolower($srcToken->getTermText()));\r\n+        return $srcToken;\r\n     }\r\n }\r\n \r\nIndex: library\/Zend\/Search\/Lucene\/Analysis\/TokenFilter\/LowerCaseUtf8.php\r\n===================================================================\r\n--- library\/Zend\/Search\/Lucene\/Analysis\/TokenFilter\/LowerCaseUtf8.php\t(revision 24527)\r\n+++ library\/Zend\/Search\/Lucene\/Analysis\/TokenFilter\/LowerCaseUtf8.php\t(working copy)\r\n@@ -57,14 +57,8 @@\r\n      *\/\r\n     public function normalize(Zend_Search_Lucene_Analysis_Token $srcToken)\r\n     {\r\n-        $newToken = new Zend_Search_Lucene_Analysis_Token(\r\n-                                     mb_strtolower($srcToken->getTermText(), 'UTF-8'),\r\n-                                     $srcToken->getStartOffset(),\r\n-                                     $srcToken->getEndOffset());\r\n-\r\n-        $newToken->setPositionIncrement($srcToken->getPositionIncrement());\r\n-\r\n-        return $newToken;\r\n+        $srcToken->setTermText(mb_strtolower($srcToken->getTermText(), 'UTF-8'));\r\n+        return $srcToken;\r\n     }\r\n }\r\n \r\nIndex: library\/Zend\/Search\/Lucene\/Analysis\/Token.php\r\n===================================================================\r\n--- library\/Zend\/Search\/Lucene\/Analysis\/Token.php\t(revision 24527)\r\n+++ library\/Zend\/Search\/Lucene\/Analysis\/Token.php\t(working copy)\r\n@@ -123,6 +123,18 @@\r\n     {\r\n         return $this->_termText;\r\n     }\r\n+    \r\n+    \/**\r\n+     * Sets the Token's term text.\r\n+     * \r\n+     * @param string $text\r\n+     * @return this\r\n+     *\/\r\n+    public function setTermText($text)\r\n+    {\r\n+        $this->_termText = $text;\r\n+        return $this;\r\n+    }\r\n \r\n     \/**\r\n      * Returns this Token's starting offset, the position of the first character\r\n{code}\r\n\r\nThe Zend_Search_Lucene test suite still passes after the above modifications are made, however the area of Zend_Search_Lucene in question is not unit tested.  \r\n\r\nAre there any backwards-compatibility issues with changing this behavior now?  Previously, an entirely new token would come out of {{normalize()}}, but with the above modifications the provided token is modified in-place and returned.  Are there any situations where this would be inappropriate?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-10-24T17:40:40.000+0000",
                    "updated": "2011-10-24T17:45:04.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50873",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Fixed in trunk r24832",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2012-05-30T13:15:07.000+0000",
                    "updated": "2012-05-30T13:15:07.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3683\/transitions"
}