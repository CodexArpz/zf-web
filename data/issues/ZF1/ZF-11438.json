{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11438",
    "key": "ZF-11438",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend Date 2038"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11438\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zensys",
                "name": "zensys",
                "displayName": "Timmo Henseler",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-06-03T16:17:50.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-03-02T19:16:07.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "date",
                "zend"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Though Zend_Date claims to solve the 2038 issue, when I do:\r\n\r\n$date = new Zend_Date();\r\n$date->addMonth(350);\r\n\r\nI get a date in 1970.\r\n\r\nWith my limited knowledge of the ZF internals I tracked this down to Zend_Date_DateObject in the (internal) function mktime() where a check is made on $year being between 1901 and 2038. But with months > 12 this would not be the right check resulting in the native mktime() function receiving a date > 2038."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11438\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "zend_date"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10530",
                    "id": 10530,
                    "description": "Mini Release",
                    "name": "1.11.3",
                    "userReleaseDate": "01\/Feb\/11",
                    "archived": false,
                    "releaseDate": "2011-02-01",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10580",
                    "id": 10580,
                    "description": "Mini Release",
                    "name": "1.11.6",
                    "userReleaseDate": "05\/May\/11",
                    "archived": false,
                    "releaseDate": "2011-05-05",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10072",
                    "id": 10072,
                    "name": "Zend_Date",
                    "description": "Zend_Date is the basic library for the handling of all date, time and calendar-related issues.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46966",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Could you provide an example?\r\n\r\nI attempted to reproduce your issue:\r\n{code}\r\n\/**\r\n * @group ZF-11438\r\n *\/\r\npublic function testAddMonthsDoesNotCauseDateToFallVictimTo2038Bug()\r\n{\r\n    $date = new Zend_Date();\r\n    $date->addMonth(350);\r\n    $this->assertEquals('2040',date(\"Y\", $date->getTimestamp()));\r\n}\r\n{code}\r\nHowever, this test passes when run against SVN trunk. ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-06-03T16:31:31.000+0000",
                    "updated": "2011-06-03T16:31:31.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48015",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zensys",
                        "name": "zensys",
                        "displayName": "Timmo Henseler",
                        "active": true
                    },
                    "body": "Sorry to have left this so long, on my system (Ubuntu 11.04, PHP Version 5.3.5-1ubuntu7.2, ZF 1.11.10) this test does not pass. There I was stuck, but looking at the below snippet of the internal mktime function of Zend_Date_DateObject I understand my negative result:\r\n\r\n{code}protected function mktime($hour, $minute, $second, $month, $day, $year, $gmt = false)\r\n    {\r\n        \/\/ complete date but in 32bit timestamp - use PHP internal\r\n        if ((1901 < $year) and ($year < 2038)) {\r\n\r\n            $oldzone = @date_default_timezone_get();\r\n            \/\/ Timezone also includes DST settings, therefor substracting the GMT offset is not enough\r\n            \/\/ We have to set the correct timezone to get the right value\r\n            if (($this->_timezone != $oldzone) and ($gmt === false)) {\r\n                date_default_timezone_set($this->_timezone);\r\n            }\r\n            $result = ($gmt) ? @gmmktime($hour, $minute, $second, $month, $day, $year)\r\n                             :   @mktime($hour, $minute, $second, $month, $day, $year);\r\n            date_default_timezone_set($oldzone);\r\n\r\n            return $result;\r\n        }\r\n{code}\r\n\r\nThis checks for the $year argument but not for the total result of adding months, $years and the other arguments. Unless I miss some subtilities in other parts of the code, this is clearly a bug imho.\r\n\r\nE.g. php mktime(0,0,0,350,0,2011) returns false on my system - as does mktime(0,0,0,11,0,2038) but not mktime(0,0,0,1,0,2038) - but  these arguments pass the test to qualify for the internal php mktime in the function above. This would not be noticed in most cases because either the year needs to be close to 2038 or the number of months needs to be equivalent to a large number of years, as in my case (I use Zend_Date for actuarial calculations where these extreme cases are not unusual).\r\n\r\nStill this does explain why your assertEquals passes ...\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zensys",
                        "name": "zensys",
                        "displayName": "Timmo Henseler",
                        "active": true
                    },
                    "created": "2011-08-19T18:11:45.000+0000",
                    "updated": "2011-08-19T18:11:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48016",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zensys",
                        "name": "zensys",
                        "displayName": "Timmo Henseler",
                        "active": true
                    },
                    "body": "Last line of my previous comment should of course be:\r\n\r\nStill this does NOT explain why your assertEquals passes ...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zensys",
                        "name": "zensys",
                        "displayName": "Timmo Henseler",
                        "active": true
                    },
                    "created": "2011-08-19T18:15:34.000+0000",
                    "updated": "2011-08-19T18:15:34.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48325",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vincentbluff",
                        "name": "vincentbluff",
                        "displayName": "Shaun Freeman",
                        "active": true
                    },
                    "body": "Are you using a 32bit OS or 64bit OS as I checked this on Ubuntu 64bit and got:\r\n\r\n$date = new Zend_Date();\r\n$date->addMonth(350);\r\n\r\n= 3 Nov 2040 22:35:45",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vincentbluff",
                        "name": "vincentbluff",
                        "displayName": "Shaun Freeman",
                        "active": true
                    },
                    "created": "2011-09-03T21:39:33.000+0000",
                    "updated": "2011-09-03T21:39:33.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48326",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vincentbluff",
                        "name": "vincentbluff",
                        "displayName": "Shaun Freeman",
                        "active": true
                    },
                    "body": "Sorry I forgot year 2038+ dates do not work on 32bit machines",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vincentbluff",
                        "name": "vincentbluff",
                        "displayName": "Shaun Freeman",
                        "active": true
                    },
                    "created": "2011-09-03T21:44:53.000+0000",
                    "updated": "2011-09-03T21:44:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48332",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zensys",
                        "name": "zensys",
                        "displayName": "Timmo Henseler",
                        "active": true
                    },
                    "body": "32 bit Ubuntu\r\n\r\nI now use the following workaround:\r\n\r\n\/\/ convert months to years to avoid 2038 bug in addMonth()\r\n$years = 0;    \t\r\nif (11 < $months) {\r\n\t$years = floor ($months \/ 12);\r\n\t$months -= 12 * $years;\r\n}\r\n\r\nwith the expected result (date somewhere in 2040)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zensys",
                        "name": "zensys",
                        "displayName": "Timmo Henseler",
                        "active": true
                    },
                    "created": "2011-09-04T07:14:07.000+0000",
                    "updated": "2011-09-04T07:14:07.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49890",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vasylp",
                        "name": "vasylp",
                        "displayName": "Vasyl",
                        "active": true
                    },
                    "body": "I reported absolutely the same issue few months earlier, but no response:\r\nhttp:\/\/framework.zend.com\/issues\/browse\/ZF-11289?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#issue-tabs\r\n\r\nIn description I suggested the solution of this issue. Hope it will help to somebody.\r\nFor me it works like a charm after mine modifications within internal mktime.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vasylp",
                        "name": "vasylp",
                        "displayName": "Vasyl",
                        "active": true
                    },
                    "created": "2012-03-02T19:16:07.000+0000",
                    "updated": "2012-03-02T19:16:07.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11438\/transitions"
}