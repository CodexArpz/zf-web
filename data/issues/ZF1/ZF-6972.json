{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6972",
    "key": "ZF-6972",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Writer_Firebug calculates wrong occurence of \"log\" in stack trace"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6972\/votes",
                "votes": 2,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kingcrunch",
                "name": "kingcrunch",
                "displayName": "Sebastian Krebs",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-06-10T00:16:04.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T21:37:49.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "In Writer_Firebug::_write() the traceOffset is hardcoded at line 185. The leads to the problem, that in some cases it calculated the wrong file and line, in which the log should occur.\n\nSomewhere in a function or class-method\n{code}\/\/ Simple file\n$log = new Zend_Log(new Zend_Log_Writer_Firebug();\nfunction test($log) {\n  $log->info('test');\n  $log->log('test', 6);\n}\ntest ($log);{code}The first one works correctly, it gives the correct file and line. The second one (in this case) sends no file and line, in this and all other cases it goes one step \"too far\".\n\nThe hardcoded value expects, that the log is called via __call() in every case, but if I call log() directly there is one stack-entry to less, or if I  overwrite Zend_Log::log() or Zend_Log::__call() (or both), the stack trace is \"too big\" and will return some file\/line from some of the log-classes.\n\nI hope, you understand ...\n\nVersion is 15892"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6972\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12640",
                    "filename": "ZF-6972.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cwt137",
                        "name": "cwt137",
                        "displayName": "Christopher Thomas",
                        "active": true
                    },
                    "created": "2010-01-18T08:30:01.000+0000",
                    "size": 824,
                    "mimeType": "text\/x-patch",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12640\/ZF-6972.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10017",
                    "id": 10017,
                    "name": "Zend_Log",
                    "description": "classic logging utility functions",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37801",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cwt137",
                        "name": "cwt137",
                        "displayName": "Christopher Thomas",
                        "active": true
                    },
                    "body": "Attached is a patch",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cwt137",
                        "name": "cwt137",
                        "displayName": "Christopher Thomas",
                        "active": true
                    },
                    "created": "2010-01-18T08:30:04.000+0000",
                    "updated": "2010-01-18T08:30:04.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41200",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frankyz",
                        "name": "frankyz",
                        "displayName": "Francois",
                        "active": true
                    },
                    "body": "The Problem ist the hardcoded traceOffset in Zend_Log_Writer_Firebug.\r\nBut this Patch is not the right solution.\r\n\r\nMy function:\r\n{code}\r\nfunction debug()\r\n{\r\n\tif (func_num_args() == 1)\r\n\t   Zend_Registry::get('log')->debug(func_get_arg(0));\r\n\telse if (func_num_args() > 1)\r\n\t   Zend_Registry::get('log')->debug(func_get_args());\r\n}\r\n{code}\r\n\r\nIn this case, the traceOffset is 7, not the hardcoded 6 or the \r\ncount of debug_backtrace() - in my special example 18).\r\n\r\nThe best solution, is to set the TraceOffset by defult of 6:\r\n{code:title=add this to the end of: Zend_Log_Writer_Firebug __construct}\r\nZend_Wildfire_Plugin_FirePhp::getInstance()->setOption('traceOffset' , 6);\r\n{code}\r\n\r\nDon't set hardcoded the traceOffset:\r\n{code:title=replace this in: Zend_Log_Writer_Firebug _write}\r\nZend_Wildfire_Plugin_FirePhp::getInstance()->send($message,\r\n                                                          $label,\r\n                                                          $type);\r\n{code}\r\n\r\nNow, i can change the Offset outside from the Writer, with\r\n{code}Zend_Wildfire_Plugin_FirePhp::getInstance()->setOption('traceOffset' , 7);{code}\r\n\r\n\r\nNote: this solution is not the right one,\r\nif concurrent usage on Zend_Wildfire_Plugin_FirePhp.\r\nIf this a risk, so the Writer must implemend set\/get FirebugOption Methods...\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frankyz",
                        "name": "frankyz",
                        "displayName": "Francois",
                        "active": true
                    },
                    "created": "2010-06-26T01:10:44.000+0000",
                    "updated": "2010-06-26T01:10:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41201",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frankyz",
                        "name": "frankyz",
                        "displayName": "Francois",
                        "active": true
                    },
                    "body": ";) The better solution is to use the $event array.\r\n\r\n{code:title=_write}\r\n$traceOffset = isset($event['traceOffset'])?$event['traceOffset']:6;\r\n        \r\nZend_Wildfire_Plugin_FirePhp::getInstance()->send($message,\r\n                                                          $label,\r\n                                                          $type,\r\n                                                          array('traceOffset'=>$traceOffset));\r\n{code}\r\n\r\nExample on my function:\r\n{code}\r\nfunction debug()\r\n{\r\n\tif (func_num_args() == 1)\r\n\t   Zend_Registry::get('log')->debug(func_get_arg(0), array('traceOffset' => 7));\r\n\telse\r\n\t   Zend_Registry::get('log')->debug(func_get_args(), array('traceOffset' => 7));\r\n}\r\n{code}\r\n\r\nSo everyone can set the right traceOffset...\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frankyz",
                        "name": "frankyz",
                        "displayName": "Francois",
                        "active": true
                    },
                    "created": "2010-06-26T01:22:59.000+0000",
                    "updated": "2010-06-26T01:22:59.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6972\/transitions"
}