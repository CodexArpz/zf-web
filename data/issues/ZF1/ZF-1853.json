{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1853",
    "key": "ZF-1853",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Rest_Client doesn't clean params before create the Zend_Http_Client request"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1853\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10170",
                    "id": 10170,
                    "description": "Mini Release",
                    "name": "1.0.4",
                    "userReleaseDate": "26\/Feb\/08",
                    "archived": true,
                    "releaseDate": "2008-02-26",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-01-10T21:54:11.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mben",
                "name": "mben",
                "displayName": "Marc Bennewitz (GIATA mbH)",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-08-15T09:36:06.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-10-11T21:33:36.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "{code}\n$rest1 = new Zend_Rest_Client('http:\/\/rest.server.com');\n$rest1->test('test');\n$rest->get();    \/\/ -> http:\/\/rest.server.com?arg1=test&test=test&rest=1\n\n$rest2 = clone $rest1;\n$rest2->test2('test2');\n$rest2->get();    \/\/ -> http:\/\/rest.server.com?arg1=test2&test=test&test2=test2&rest=1\n\n$rest3 = new Zend_Rest_Client('http:\/\/rest.server.com');\n$rest3->test3('test3');\n$rest3->get();    \/\/ -> http:\/\/rest.server.com?arg1=test3&test=test&test2=test2&text3=test3&rest=1\n{code}\n\nZend_Rest_Client use a static Zend_Http_Client object but this only add all given params\n\n{code}\n    \/\/ Zend_Rest_Client (Line 130 - 136)\n    final public function restGet($path, array $query = null)\n    {\n        $this->_prepareRest($path);\n        $client = self::getHttpClient();\n        $client->setParameterGet($query);\n        return $client->request('GET');\n    }\n\n    \/\/ Zend_Rest_Client (Line 100 - 120)\n    final private function _prepareRest($path)\n    {\n        \/\/ Get the URI object and configure it\n        if (!$this->_uri instanceof Zend_Uri_Http) {\n            require_once 'Zend\/Rest\/Client\/Exception.php';\n            throw new Zend_Rest_Client_Exception('URI object must be set before performing call');\n        }\n\n        $uri = $this->_uri->getUri();\n\n        if ($path[0] != '\/' && $uri[strlen($uri)-1] != '\/') {\n            $path = '\/' . $path;\n        }\n\n        $this->_uri->setPath($path);\n\n        \/**\n         * Get the HTTP client and configure it for the endpoint URI.  Do this each time\n         * because the Zend_Http_Client instance is shared among all Zend_Service_Abstract subclasses.\n         *\/\n        self::getHttpClient()->resetParameters();    \/\/ <- This line is missing\n        self::getHttpClient()->setUri($this->_uri);\n    }\n\n\n    \/\/ Zend_Http_Client  (Line 377 - 387)\n    public function setParameterGet($name, $value = null)\n    {\n        if (is_array($name)) {\n            foreach ($name as $k => $v)\n                $this->_setParameter('GET', $k, $v);\n        } else {\n            $this->_setParameter('GET', $name, $value);\n        }\n\n        return $this;\n    }\n\n    \/\/ Zend_Http_Client  (Line 415 - 433)\n    protected function _setParameter($type, $name, $value)\n    {\n        $parray = array();\n        $type = strtolower($type);\n        switch ($type) {\n            case 'get':\n                $parray = &$this->paramsGet;\n                break;\n            case 'post':\n                $parray = &$this->paramsPost;\n                break;\n        }\n\n        if ($value === null) {\n            if (isset($parray[$name])) unset($parray[$name]);\n        } else {\n            $parray[$name] = $value;\n        }\n    }\n{code}\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1853\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=davey",
                "name": "davey",
                "displayName": "Davey Shafik",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-10664",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10664",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-2467",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2467",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11076",
                    "filename": "Client.php.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=elazar",
                        "name": "elazar",
                        "displayName": "Matthew Turland",
                        "active": true
                    },
                    "created": "2008-01-10T20:50:55.000+0000",
                    "size": 550,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11076\/Client.php.diff"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10110",
                    "id": 10110,
                    "description": "Mini Release",
                    "name": "1.0.1",
                    "userReleaseDate": "30\/Jul\/07",
                    "archived": true,
                    "releaseDate": "2007-07-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10094",
                    "id": 10094,
                    "name": "Zend_Rest_Client",
                    "description": "Client for executing Rest requests.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/16324",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Assigned to Davey",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2007-08-16T13:26:00.000+0000",
                    "updated": "2007-08-16T13:26:00.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18271",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=elazar",
                        "name": "elazar",
                        "displayName": "Matthew Turland",
                        "active": true
                    },
                    "body": "I agree with the original report. Each request made by Zend_Rest_Client is \"inheriting\" parameters from previous requests made with that Zend_Rest_Client instance. I don't believe this is intuitive given that Zend_Rest_Client doesn't provide methods for parameter handling as Zend_Http_Client does, which implies that parameters will be specific to the request being executed and will not be retained in subsequent requests made with that Zend_Rest_Client instance. This needs to be fixed. I'll attach a patch shortly that makes use of the fluent API to apply the fix suggested in the bug report.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=elazar",
                        "name": "elazar",
                        "displayName": "Matthew Turland",
                        "active": true
                    },
                    "created": "2008-01-10T20:49:49.000+0000",
                    "updated": "2008-01-10T20:49:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18272",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=elazar",
                        "name": "elazar",
                        "displayName": "Matthew Turland",
                        "active": true
                    },
                    "body": "Proposed patch.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=elazar",
                        "name": "elazar",
                        "displayName": "Matthew Turland",
                        "active": true
                    },
                    "created": "2008-01-10T20:50:55.000+0000",
                    "updated": "2008-01-10T20:50:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18273",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=davey",
                        "name": "davey",
                        "displayName": "Davey Shafik",
                        "active": true
                    },
                    "body": "Fixed in 1.0.x and trunk\n\n- Davey",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=davey",
                        "name": "davey",
                        "displayName": "Davey Shafik",
                        "active": true
                    },
                    "created": "2008-01-10T21:54:11.000+0000",
                    "updated": "2008-01-10T21:54:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18454",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tomsommer",
                        "name": "tomsommer",
                        "displayName": "Tom Sommer",
                        "active": true
                    },
                    "body": "This bug is not entirely fixed.\n\nSending more requests after each other produces wrong requests on the server.\n\n$client = new Zend_Rest_Client('http:\/\/127.0.0.1\/rest.php');\n$res = $client->add(0,0,0,0,0,0)->get();\nvar_dump($res);\n\t\n\t\n$client = new Zend_Rest_Client('http:\/\/127.0.0.1\/rest.php');\n$res = $client->find(16)->get();\nvar_dump($res);\n\n\nGET \/rest.php?method=add&arg0=0&arg1=0&arg2=0&arg3=0&arg4=0&arg5=0&rest=1 HTTP\/1.1\" 200 175 \"-\" \"Zend_Http_Client\"\nGET \/rest.php?find=16&arg1=16&rest=1 HTTP\/1.1\" 404 202 \"-\" \"Zend_Http_Client\"\n\nAs you can see, the 2nd request is incorrect, and contains no \"method\" argument, resulting in an error from the server.\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tomsommer",
                        "name": "tomsommer",
                        "displayName": "Tom Sommer",
                        "active": true
                    },
                    "created": "2008-01-23T01:11:05.000+0000",
                    "updated": "2008-01-23T01:11:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48674",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mcleod@spaceweb.nl",
                        "name": "mcleod@spaceweb.nl",
                        "displayName": "Bart McLeod",
                        "active": true
                    },
                    "body": "I tried to reproduce the bug described in the last comment, but I can't. The opposite is true, it is working allright now.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mcleod@spaceweb.nl",
                        "name": "mcleod@spaceweb.nl",
                        "displayName": "Bart McLeod",
                        "active": true
                    },
                    "created": "2011-10-11T21:33:36.000+0000",
                    "updated": "2011-10-11T21:33:36.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1853\/transitions"
}