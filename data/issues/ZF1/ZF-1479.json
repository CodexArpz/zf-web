{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1479",
    "key": "ZF-1479",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "::toNumber() returns wrong value"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1479\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10100",
                    "id": 10100,
                    "description": "Release Candidate 3",
                    "name": "1.0.0 RC3",
                    "userReleaseDate": "23\/Jun\/07",
                    "archived": true,
                    "releaseDate": "2007-06-23",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-06-10T11:26:41.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coogle",
                "name": "coogle",
                "displayName": "John Coggeshall",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-06-01T18:59:51.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-05T14:44:15.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "{code}\nprint Zend_Locale_Format::toNumber(3.57, array('precision' => 2, 'locale' => $locale));\n{code}\n\nThe output should be something like 3.57... but it returns 3.43 for me :)"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1479\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10023",
                    "id": 10023,
                    "description": "Release Candidate 1",
                    "name": "1.0.0 RC1",
                    "userReleaseDate": "28\/May\/07",
                    "archived": true,
                    "releaseDate": "2007-05-28",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10073",
                    "id": 10073,
                    "name": "Zend_Locale",
                    "description": "Zend_Locale is a basic wrapper for all I18N and L10N issues for the Zend Framework. It provides the userbasically with access to translation functionality. It can handle different source file types for translation.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14921",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coogle",
                        "name": "coogle",
                        "displayName": "John Coggeshall",
                        "active": true
                    },
                    "body": "{code}\nIndex: PhpMath.php\n===================================================================\n--- PhpMath.php (revision 5073)\n+++ PhpMath.php (working copy)\n@@ -73,7 +73,7 @@\n     if ((string)($result + $op2) != (string)$op1) {\n         throw new Zend_Locale_Math_Exception(\"subtraction overflow: $op1 - $op2 != $result\", $op1, $op2, $result);\n     }\n-    if ($op3 !== null) {\n+    if (($op3 !== null) && ($op3 !== 0)) {\n         $result = round($result, $op3);\n     }\n     if ($op3 > 0) {\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coogle",
                        "name": "coogle",
                        "displayName": "John Coggeshall",
                        "active": true
                    },
                    "created": "2007-06-01T19:22:07.000+0000",
                    "updated": "2007-06-01T19:22:07.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14922",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Assigning to Thomas.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-06-01T19:34:38.000+0000",
                    "updated": "2007-06-01T19:34:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14944",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Please give details on \n\n*) SVN Version\n*) OS System\n*) BCMath useage\n*) The used locale option\n*) The used number format option\n\nfor reproduction\n\nThnx",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2007-06-04T14:21:32.000+0000",
                    "updated": "2007-06-04T14:21:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15037",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "*) PHP Version",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2007-06-09T05:03:12.000+0000",
                    "updated": "2007-06-09T05:03:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15041",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tibor",
                        "name": "tibor",
                        "displayName": "Tibor Antal\u00f3czy",
                        "active": true
                    },
                    "body": "- svn version: 1.0.0 RC2 (downloaded from http:\/\/framework.zend.com\/download)\n- system: Linux Debian 2.6.16.45\n- php version: PHP Version 5.1.4-Debian-0.1~sarge1 (Debian GNU\/Linux)\n- apache version: Apache\/2.0.54 (Debian GNU\/Linux)\n- apache loaded modules: core mod_access mod_auth mod_log_config mod_logio mod_env mod_setenvif prefork http_core mod_mime mod_status mod_autoindex mod_negotiation mod_dir mod_alias mod_so mod_actions mod_cgi mod_php5 mod_rewrite mod_ssl mod_userdir\n- php features enabled: calendar, curl, date, dom, eAceelerator (I tried eAccelerator enabled and disabled, but the result was the same), exif, gd, gettext, hash, iconv, imap, libxml, mbstring, mysql, pcre, pdo, pdo_mysql, pdo_pgsql, pgsql, Reflection, session, shmop, SimpleXML, SPL, SQLite, standard, tidy, xml, xmlreader, xmlrpc, xmlwriter, zlib\n- BCMath: I don't seem to have that installed (tried to use the bcadd and bcmul functions, but they resulted in PHP fatal errors) *I guess this is the cruicial difference between your and my system*\n- I was testing with 'en', 'de' and 'hu' locales, they all produced the same output\n- I didn't use any extra options for toNumber(), just the number and the locale\n\nHere is the code I run as an example:\n{code}\n   for($i=1.7; $i<3.8; $i=$i+0.1) {\n       $number = Zend_Locale_Format::toNumber($i, array('locale' => $this->view->locale));\n       echo $i.': '.$number.'<br>';\n   }\n{code}\n\nif locale set to 'hu', the output is as follows:\n   1.7: 1,3\n   1.8: 2,2\n   1.9: 2,1\n   2: 2\n   2.1: 2,1\n   2.2: 2,2\n   2.3: 2,3\n   2.4: 2,4\n   2.5: 2,5\n   2.6: 2,4\n   2.7: 2,3\n   2.8: 3,2\n   2.9: 3,1\n   3: 3\n   3.1: 3,1\n   3.2: 3,2\n   3.3: 3,3\n   3.4: 3,4\n   3.5: 3,5\n   3.6: 3,4\n   3.7: 3,3 \n\nIn this example, 1.7, 1.8, 1.9, 2.6, 2.7, 2.8, 2.9, 3.5, 3.6 and 3.7 was incorrectly printed.\n\n*My suggestion (skip this if you don't care or find it totally wrong, I am just trying to help here):*\nIf the developers use BCMath, than probably it would worth trying this function BCMath disabled. \nI tried to trace the error, and I found that the Zend_Locale_Math_Sub() function is not handling the requests as the Zend_Local_Format_toNumber() function would expect (Zend\/Locale\/Format.php line 392).\nWhile John Coggeshall in his first comment has spotted the error correctly, his quick fix didn't really cure the problem (at least not in my case).\nThe toNumber() function is calling Zend_Locale_Math::$sub with three parameters: the two numbers that should be substracted and the precision it should be rounded to. The called function is doing its job nicely, but as far as I can see, the toNumber() function is expecting the number before the decimal sign (floor()).\nTo correct this I have made two changes:\nZend\/Locale\/Format.php line 392\n{code}\n-         $preg = call_user_func(Zend_Locale_Math::$sub, $value, '0', 0);\n+        $preg = call_user_func(Zend_Locale_Math::$sub, $value, '0');\n{code}\n\nZend\/Locale\/Math\/PhpMath.php from line 76\n{code}\n    if ($op3 !== null) {\n        $result = round($result, $op3);\n+    } else {\n+        $result = floor($result);\n    }\n{code}\n\nSince I don't have BCMath, I couldn't try how that reacts to this change, but according to the php manual, the bcsub should return the correct result if only the two numbers are given.\n\nI hope this helps a bit.\n\nTibor",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tibor",
                        "name": "tibor",
                        "displayName": "Tibor Antal\u00f3czy",
                        "active": true
                    },
                    "created": "2007-06-09T07:55:39.000+0000",
                    "updated": "2007-06-09T07:55:39.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15065",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Yes... seems to work with and without...\n\nFixed with SVN 5208",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2007-06-10T11:26:41.000+0000",
                    "updated": "2007-06-10T11:26:41.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1479\/transitions"
}