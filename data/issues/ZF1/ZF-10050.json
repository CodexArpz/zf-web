{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10050",
    "key": "ZF-10050",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Translation is executed twice on form labels"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10050\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/3",
                "name": "Duplicate"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-10-26T00:48:50.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=christianriesen",
                "name": "christianriesen",
                "displayName": "Christian Riesen",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-06-24T23:51:50.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-10-26T00:48:56.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I classified it as unknown component since I'm not sure exactly where it's at, just see the resulting 'mayhem'.\r\n\r\nInitializing translate this way:\r\n{code}\r\n    public function _initTranslate()\r\n    {\r\n    \t$this->bootstrap('logging');\r\n    \t$log = Zend_Registry::get('Zend_Log');\r\n\t\t\r\n    \t$translate = new Zend_Translate('array', APPLICATION_PATH . '\/..\/language\/en.php', 'en');\r\n\t\t$translate->setOptions(array(\r\n            'log' => $log,\r\n            'logUntranslated' => true\r\n\t\t));\r\n\r\n    \tZend_Registry::set('Zend_Translate', $translate);\r\n    \treturn $translate;\r\n    }\r\n{code}\r\n\r\nThen initializing and setting the form in controller, and echoing it in view. Here is the form class:\r\n{code}\r\n<?php\r\n\r\nclass User_Form_Login extends Zend_Form\r\n{\r\n    public function init()\r\n    {\r\n        $this->setMethod('post');\r\n\r\n        $this->addElement('text', 'username', array(\r\n            'label'      => 'Username',\r\n            'required'   => true,\r\n            'filters'    => array(\r\n                array('StringTrim'),\r\n            ),\r\n            'validators' => array(\r\n                array(\r\n                    'StringLength',\r\n                    false,\r\n                    array(\r\n                        3,\r\n                        60\r\n                    )\r\n                ),\r\n            ),\r\n        ));\r\n\r\n        $this->addElement('password', 'userpassword', array(\r\n            'label'      => 'Password',\r\n            'required'   => true,\r\n            'filters'    => array('StringTrim'),\r\n            'validators' => array(\r\n                array(\r\n                    'StringLength',\r\n                    false,\r\n                    array(\r\n                        6,\r\n                        100\r\n                    )\r\n                ),\r\n            )\r\n        ));\r\n\t\t\r\n        $this->addElement('submit', 'submit', array(\r\n            'ignore'   => true,\r\n            'label'    => 'Login',\r\n        ));\r\n    }\r\n}\r\n{code}\r\n\r\nAs you can see nothing really interesting or overly dramatic. Now using the firebug logger, it displayed to me that Username was not translated, twice. I added it and the message went away. Then I added a translation in german, \"Benutzername\". Now I received a message that \"Benutzername\" was not translated, although I did not change the form. So it tried to retranslate the already translated string IMHO.\r\n\r\nI cloned the array adapter for translate and overwrote the following function below:\r\n{code}\r\n    protected function _log($message, $locale) {\r\n        if ($this->_options['logUntranslated']) {\r\n            $message = str_replace('%message%', $message, $this->_options['logMessage']);\r\n            $message = str_replace('%locale%', $locale, $message);\r\n\r\n            $message .= PHP_EOL;\r\n\r\n            $trace = debug_backtrace();\r\n            foreach ($trace as $line) {\r\n            \t$message .= $line['file'] . ':' . $line['line'];\r\n            \t$message .= \"\\n\";\r\n            }\r\n\r\n            if ($this->_options['log']) {\r\n                $this->_options['log']->notice($message);\r\n            } else {\r\n                trigger_error($message, E_USER_NOTICE);\r\n            }\r\n        }\r\n    }\r\n{code}\r\n\r\nThis gave me the following output on just the English translation showing, with no Username translation added.\r\n\r\nUntranslated message within 'en': Username\r\n\/www\/ZendFramework-1.10.6\/Zend\/Translate\/Adapter.php:748\r\n\/www\/ZendFramework-1.10.6\/Zend\/Form\/Element.php:625\r\n\/www\/ZendFramework-1.10.6\/Zend\/Form\/Decorator\/Label.php:253\r\n\/www\/ZendFramework-1.10.6\/Zend\/Form\/Decorator\/Label.php:296\r\n\/www\/ZendFramework-1.10.6\/Zend\/Form\/Element.php:2020\r\n\/www\/ZendFramework-1.10.6\/Zend\/Form\/Decorator\/FormElements.php:101\r\n\/www\/ZendFramework-1.10.6\/Zend\/Form.php:2887\r\n\/www\/ZendFramework-1.10.6\/Zend\/Form.php:2903\r\n\/www\/base\/application\/modules\/user\/views\/scripts\/login\/index.phtml:9\r\n\/www\/ZendFramework-1.10.6\/Zend\/View.php:108\r\n\/www\/ZendFramework-1.10.6\/Zend\/View\/Abstract.php:880\r\n\/www\/ZendFramework-1.10.6\/Zend\/Controller\/Action\/Helper\/ViewRenderer.php:897\r\n\/www\/ZendFramework-1.10.6\/Zend\/Controller\/Action\/Helper\/ViewRenderer.php:918\r\n\/www\/ZendFramework-1.10.6\/Zend\/Controller\/Action\/Helper\/ViewRenderer.php:957\r\n\/www\/ZendFramework-1.10.6\/Zend\/Controller\/Action\/HelperBroker.php:277\r\n\/www\/ZendFramework-1.10.6\/Zend\/Controller\/Action.php:523\r\n\/www\/ZendFramework-1.10.6\/Zend\/Controller\/Dispatcher\/Standard.php:295\r\n\/www\/ZendFramework-1.10.6\/Zend\/Controller\/Front.php:954\r\n\/www\/ZendFramework-1.10.6\/Zend\/Application\/Bootstrap\/Bootstrap.php:97\r\n\/www\/ZendFramework-1.10.6\/Zend\/Application.php:366\r\n\/www\/base\/public\/index.php:27\r\n\r\nUntranslated message within 'en': Username\r\n\/www\/ZendFramework-1.10.6\/Zend\/Translate\/Adapter.php:748\r\n\/www\/ZendFramework-1.10.6\/Zend\/Form\/Decorator\/Label.php:261\r\n\/www\/ZendFramework-1.10.6\/Zend\/Form\/Decorator\/Label.php:296\r\n\/www\/ZendFramework-1.10.6\/Zend\/Form\/Element.php:2020\r\n\/www\/ZendFramework-1.10.6\/Zend\/Form\/Decorator\/FormElements.php:101\r\n\/www\/ZendFramework-1.10.6\/Zend\/Form.php:2887\r\n\/www\/ZendFramework-1.10.6\/Zend\/Form.php:2903\r\n\/www\/base\/application\/modules\/user\/views\/scripts\/login\/index.phtml:9\r\n\/www\/ZendFramework-1.10.6\/Zend\/View.php:108\r\n\/www\/ZendFramework-1.10.6\/Zend\/View\/Abstract.php:880\r\n\/www\/ZendFramework-1.10.6\/Zend\/Controller\/Action\/Helper\/ViewRenderer.php:897\r\n\/www\/ZendFramework-1.10.6\/Zend\/Controller\/Action\/Helper\/ViewRenderer.php:918\r\n\/www\/ZendFramework-1.10.6\/Zend\/Controller\/Action\/Helper\/ViewRenderer.php:957\r\n\/www\/ZendFramework-1.10.6\/Zend\/Controller\/Action\/HelperBroker.php:277\r\n\/www\/ZendFramework-1.10.6\/Zend\/Controller\/Action.php:523\r\n\/www\/ZendFramework-1.10.6\/Zend\/Controller\/Dispatcher\/Standard.php:295\r\n\/www\/ZendFramework-1.10.6\/Zend\/Controller\/Front.php:954\r\n\/www\/ZendFramework-1.10.6\/Zend\/Application\/Bootstrap\/Bootstrap.php:97\r\n\/www\/ZendFramework-1.10.6\/Zend\/Application.php:366\r\n\/www\/base\/public\/index.php:27\r\n\r\n\r\nIt looks like in the first round, it goes from Decorator Label to Form Element and then translates there. In the second round it just seems to call the translator from Decorator Label.\r\n\r\nThis output is from a single call to a page, not two or more.\r\n\r\nIt's not exactly a show stopper, but annoying as it fills up the log over time with unnecessary messages.\r\n\r\nI know about filtering and so on for logs, but think this still is a bug that should not happen."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10050\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                "name": "alab",
                "displayName": "Christian Albrecht",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-8694",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8694",
                    "type": {
                        "name": "Duplicate",
                        "direction": "OUTBOUND",
                        "description": "duplicates"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10470",
                    "id": 10470,
                    "description": "Mini Release",
                    "name": "1.10.6",
                    "userReleaseDate": "22\/Jun\/10",
                    "archived": false,
                    "releaseDate": "2010-06-22",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41196",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=christianriesen",
                        "name": "christianriesen",
                        "displayName": "Christian Riesen",
                        "active": true
                    },
                    "body": "1.9.6 Issue still active in 1.10.6",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=christianriesen",
                        "name": "christianriesen",
                        "displayName": "Christian Riesen",
                        "active": true
                    },
                    "created": "2010-06-25T04:51:20.000+0000",
                    "updated": "2010-06-25T04:51:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42710",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjh_ca",
                        "name": "mjh_ca",
                        "displayName": "Marc Hodgins",
                        "active": true
                    },
                    "body": "Closing as this is a duplicate of ZF-8694.  Better to direct all efforts to a single ticket as this same issue is open many times in the tracker.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjh_ca",
                        "name": "mjh_ca",
                        "displayName": "Marc Hodgins",
                        "active": true
                    },
                    "created": "2010-10-26T00:48:50.000+0000",
                    "updated": "2010-10-26T00:48:50.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10050\/transitions"
}