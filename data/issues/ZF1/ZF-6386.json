{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6386",
    "key": "ZF-6386",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Filter_Encrypt_Mcrypt encodes key before encryption and decryption"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6386\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10241",
                    "id": 10241,
                    "description": "Minor Release",
                    "name": "1.8.0",
                    "userReleaseDate": "30\/Apr\/09",
                    "archived": false,
                    "releaseDate": "2009-04-30",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-04-23T14:34:31.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jstuart",
                "name": "jstuart",
                "displayName": "James Stuart",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-04-22T13:28:40.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-11-02T14:57:36.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "Zend_Filter_Encrypt_Mcrypt"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Zend_Filter_Encrypt_Mcrypt currently encodes the user provided key before using it to encrypt or decrypt data.  This breaks the ability to use the encryption and decryption filters, using the Mcrypt adapter, with any data not encrypted using Zend_Filter_Encrypt_Mcrypt.\n\nThe code in question is: \n\n        srand();\n        $keysize = mcrypt_enc_get_key_size($cipher);\n        $key     = substr(md5($this->_encryption['key']), 0, $keysize);\n\nIf you want to see the different results you can use these two pieces of code:\n\nKey: 1234567890ABCDEFGHIJKLMNOPQRSTUV\n(32 byte, 256 bit)\nIV: 1234567890ABCDEF\n(16 byte, 128 bit)\nAlgorithm: MCRYPT_RIJNDAEL_128\nMode: MCRYPT_MODE_CBC\n\nPHP Mcrypt:\n$module = mcrypt_module_open(MCRYPT_RIJNDAEL_128, '', MCRYPT_MODE_CBC, '');\nmcrypt_generic_init($module, '1234567890ABCDEFGHIJKLMNOPQRSTUV',\n'1234567890ABCDEF');\n$encrypted = mcrypt_generic($module, 'test_string');\n$encoded = base64_encode($encrypted);\n----\nencoded value is gFHQANviiEyF2LEy24Ws+w==\n\nZend_Filter_Encrypt:\n$encrypt = new Zend_Filter_Encrypt(\n   array(\n       'adapter'=>'mcrypt',\n       'algorithm'=>MCRYPT_RIJNDAEL_128,\n       'mode'=>MCRYPT_MODE_CBC,\n       'key'=>'1234567890ABCDEFGHIJKLMNOPQRSTUV',\n       'vector'=>'1234567890ABCDEF'\n   )\n);\n$encrypted = $encrypt->filter('test_string');\n$encoded = base64_encode($encrypted);\n-----\nencoded value is mkN6BBnQWHnwiPjnKe6zGg==\n\nIn this case, even though the keys are the same, Zend_Filter_Encrypt_Mcrypt uses md5 to encode the key before encryption.  The resulting key (09c87b51e8bfad618e7bb82c538ac525) is actually used to perform the encryption.\n\nAt a minimum, it should be possible to disable the encoding of the key.  If this is done, functionality needs to be added to ensure that the key length is valid for the cipher being used.\n\nThe documentation, both in the code and in the reference guide needs to be updated to explain that the key is encoded before being used to perform the encryption.\n\nI will provide a patch in the next day or two.  At this point I assume that we need to maintain the current functionality, adding the ability to turn it off, instead of just removing encoding entirely.  Is that an accurate assumption?"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6386\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11887",
                    "filename": "mcrypt.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jstuart",
                        "name": "jstuart",
                        "displayName": "James Stuart",
                        "active": true
                    },
                    "created": "2009-04-23T14:49:15.000+0000",
                    "size": 10387,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11887\/mcrypt.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10241",
                    "id": 10241,
                    "description": "Minor Release",
                    "name": "1.8.0",
                    "userReleaseDate": "30\/Apr\/09",
                    "archived": false,
                    "releaseDate": "2009-04-30",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10160",
                    "id": 10160,
                    "description": "Major Release",
                    "name": "Next Major Release",
                    "archived": false,
                    "released": false
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10013",
                    "id": 10013,
                    "name": "Zend_Filter",
                    "description": "methods for filtering data",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30347",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "New feature 'salt option' added with r15120.\nAllows the usage of salted or unsalted keys.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-04-23T14:34:28.000+0000",
                    "updated": "2009-04-23T14:34:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30348",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jstuart",
                        "name": "jstuart",
                        "displayName": "James Stuart",
                        "active": true
                    },
                    "body": "Attached would be my recommended changes.  I went a step further and modified the code to allow\/disallow padding of both the vector and the key.  Also added helper methods and such.  It's pretty self explanatory.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jstuart",
                        "name": "jstuart",
                        "displayName": "James Stuart",
                        "active": true
                    },
                    "created": "2009-04-23T14:49:19.000+0000",
                    "updated": "2009-04-23T14:49:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42793",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=arekanderu",
                        "name": "arekanderu",
                        "displayName": "arekanderu",
                        "active": true
                    },
                    "body": "Why is this marked as fixed? I got the latest 1.10.8 and the patch is not appended to it.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=arekanderu",
                        "name": "arekanderu",
                        "displayName": "arekanderu",
                        "active": true
                    },
                    "created": "2010-10-31T18:45:03.000+0000",
                    "updated": "2010-10-31T18:45:03.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42805",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "The failure was about not turning off default salting.\r\nThis has been fixed by r15120 which also included tests which showed the correct behaviour and that the mentioned failure was really fixed.\r\n\r\nTherefor this issue was closed more than a year ago with the comment what has been done.\r\nNormally a patch is not used for an already fixed issue as long as there is no note of an failure or problem with the fix itself.\r\nJames would have mentioned this.\r\n\r\nNote that padding of key\/vector would also be seen problematic because encoding\/decoding would again only work with Zend_Filter_Encode instead of (as mentioned) other possible components beside ZF.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-11-02T14:28:10.000+0000",
                    "updated": "2010-11-02T14:28:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42808",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=arekanderu",
                        "name": "arekanderu",
                        "displayName": "arekanderu",
                        "active": true
                    },
                    "body": "Sorry, I got the line numbers wrong. \r\n\r\nLine 277: mcrypt_enc_get_supported_key_sizes($cipher)\r\nLine 278: if (empty($keysizes) || ($this->_encryption['salt'] == true))\r\n\r\nBoth in MCrypt.php",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=arekanderu",
                        "name": "arekanderu",
                        "displayName": "arekanderu",
                        "active": true
                    },
                    "created": "2010-11-02T14:57:35.000+0000",
                    "updated": "2010-11-02T14:57:35.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6386\/transitions"
}