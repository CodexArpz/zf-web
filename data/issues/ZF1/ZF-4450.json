{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4450",
    "key": "ZF-4450",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Problem with wrong splitted\/encoded mail-subjects"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4450\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gruberro",
                "name": "gruberro",
                "displayName": "Robert Gruber",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-10-02T03:59:53.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-08-07T12:24:39.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "We had two problems with the {{Zend_Mime_Decode::splitMessage()}}-method:\r\n\r\nA lot of mail-headers (maybe they are not really rfc-conform) couldn't be splitted correctly by the native php-function {{iconv_mime_decode_headers()}} used by the framework. e.g. \r\n{code}\r\niconv_mime_decode_headers() => array( ..., [subject] => '=?iso-8859-1?q?=AB=CD?=\\nX-Priority: 3', ...)\r\n{code}\r\n\r\nSome subject-strings encoded in the following way \r\n{code}\r\n=?(utf-8|iso-8859-1|...)?(q|b)?......?=\r\n{code}\r\ncouldn't be decoded by the iconv-function. Therefore we used the {{mb_decode_mimeheader()}}-function for those messages.\r\n\r\nIndex: Decode.php\r\n===================================================================\r\n--- Decode.php\t(revision 277)\r\n+++ Decode.php\t(revision 278)\r\n@@ -139,10 +139,17 @@\r\n{code}\r\n             @list($headers, $body) = @preg_split(\"%([\\r\\n]+)\\\\1%U\", $message, 2);\r\n         }\r\n \r\n+        $headers = preg_replace(\"\/=\\n([^ ]+)\/\", \"= \\n\\\\1\", $headers);\r\n         $headers = iconv_mime_decode_headers($headers, ICONV_MIME_DECODE_CONTINUE_ON_ERROR);\r\n+        \r\n+        \/\/ normalize header names\r\n+        foreach ($headers as $name => &$header) {\r\n \r\n-        \/\/ normalize header names\r\n-        foreach ($headers as $name => $header) {\r\n+            if (! is_array($header) && preg_match('\/((=\\?|\\?))\/', $header)) {\r\n+                $header = preg_replace_callback('\/(=\\?([^\\?]+)\\?(q|b)\\?([^\\?]+)\\?=)\/i',\r\n+                    create_function('$a', 'return mb_decode_mimeheader($a[0]);'), $header);\r\n+            }\r\n+\r\n             $lower = strtolower($name);\r\n             if ($lower == $name) {\r\n                 continue;\r\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4450\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                "name": "beberlei",
                "displayName": "Benjamin Eberlei",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-9470",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9470",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12637",
                    "filename": "ZF-4450.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                        "name": "gnanderson",
                        "displayName": "Graham Anderson",
                        "active": true
                    },
                    "created": "2010-01-17T06:25:19.000+0000",
                    "size": 2438,
                    "mimeType": "text\/x-patch",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12637\/ZF-4450.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10201",
                    "id": 10201,
                    "description": "Mini Release",
                    "name": "1.6.1",
                    "userReleaseDate": "15\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-15",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10019",
                    "id": 10019,
                    "name": "Zend_Mime",
                    "description": "support class for handling multi-part MIME messages",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25910",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nico",
                        "name": "nico",
                        "displayName": "Nico Edtinger",
                        "active": true
                    },
                    "body": "For the headers that couldn't be decoded: did you check your setting for iconv.internal_encoding? Don't have multibyte here to test.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nico",
                        "name": "nico",
                        "displayName": "Nico Edtinger",
                        "active": true
                    },
                    "created": "2008-11-07T17:41:14.000+0000",
                    "updated": "2008-11-07T17:41:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25989",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gruberro",
                        "name": "gruberro",
                        "displayName": "Robert Gruber",
                        "active": true
                    },
                    "body": "Our iconv.internal_encoding is always UTF-8!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gruberro",
                        "name": "gruberro",
                        "displayName": "Robert Gruber",
                        "active": true
                    },
                    "created": "2008-11-10T01:20:10.000+0000",
                    "updated": "2008-11-10T01:20:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36721",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "body": "Hi, Robert.\r\n\r\nIs this issue still active?\r\nWe have fixed many issues between 1.7.2 and 1.7.4 .",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "created": "2009-12-04T23:49:54.000+0000",
                    "updated": "2009-12-04T23:49:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36784",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gruberro",
                        "name": "gruberro",
                        "displayName": "Robert Gruber",
                        "active": true
                    },
                    "body": "Hi!\r\n\r\nUnfortunately the project using the patch posted some months ago is currently running under the zf-version 1.6.1 - never touch a running system ;) It isn't also possible to upgrade for a short test, because there is a lot of bootstapping-changes and so on.\r\nWhenever the project will be upgraded to a newer version of zf I will look at all this features and patches again and give you entire feedback.\r\n\r\nFor me it would make sense to have the possibility to inject Zend_Mime into Zend_Mail, so everyone would be able to extend some functionality inside there.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gruberro",
                        "name": "gruberro",
                        "displayName": "Robert Gruber",
                        "active": true
                    },
                    "created": "2009-12-07T10:07:49.000+0000",
                    "updated": "2009-12-07T10:07:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37766",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                        "name": "gnanderson",
                        "displayName": "Graham Anderson",
                        "active": true
                    },
                    "body": "I can confirm the header splitting issue still exists in 1.10beta1 \r\n\r\nIt actually happend quite often because a common scenario is to have a domain key header immediately followed by the message-id header. Often a domain key signature will have the offending string end; and so the message-id header gets swallowed into the domain key header.\r\n\r\nI sampled about 20k emails from a local maildir store and the failure to split the headers correctly happened roughly 5% of the time.\r\n\r\nI cannot confirm the inconv\/mbstring decoding issue exists, I did not notice it specifically nor did I test for it.\r\n\r\nAnyway, the regex replace for the splitting issue is good, attaching patch with unit test that replicates the splitting issue.\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                        "name": "gnanderson",
                        "displayName": "Graham Anderson",
                        "active": true
                    },
                    "created": "2010-01-17T06:23:07.000+0000",
                    "updated": "2010-01-17T06:23:07.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37767",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                        "name": "gnanderson",
                        "displayName": "Graham Anderson",
                        "active": true
                    },
                    "body": "Test case reproduces issue + trivial fix.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gnanderson",
                        "name": "gnanderson",
                        "displayName": "Graham Anderson",
                        "active": true
                    },
                    "created": "2010-01-17T06:25:24.000+0000",
                    "updated": "2010-01-17T06:25:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37788",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "body": "Thank you for Your collaboration, Graham Anderson .\r\nI will look at Your suggestion deeply.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "created": "2010-01-17T22:17:22.000+0000",
                    "updated": "2010-01-17T22:17:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40970",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "body": "Sorry, I have been inactive since last April.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "created": "2010-06-12T06:40:06.000+0000",
                    "updated": "2010-06-12T06:40:06.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4450\/transitions"
}