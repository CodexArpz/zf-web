{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4495",
    "key": "ZF-4495",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "LDAP connection bug with special characters"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4495\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10320",
                    "id": 10320,
                    "description": "Minor Release",
                    "name": "1.9.0",
                    "userReleaseDate": "31\/Jul\/09",
                    "archived": false,
                    "releaseDate": "2009-07-31",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-07-20T12:31:53.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hschaefer123",
                "name": "hschaefer123",
                "displayName": "Holger Sch\u00e4fer",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-10-06T04:48:23.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-07-20T12:31:53.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "authentication against Microsoft ADS (LDAP) does not work with special characters inside username!\n\nThe problem is inside:\npublic function getCanonicalAccountName($acctname, $form = 0)\n  ...\n  $uname = strtolower($uname);\n ..\n\nIf using a DN Form of authentication ex. \"sch\u00e4fer@abc.de\"\nthe authentication needs DN: sch\\303\\244fer@abc.de\n\nThe stringtolower conversion corrupts the uname data and the whole authentication\ndoes not work for usernames with special characters!\n\nAlso strtolower can be critical in situations with different charsets!\n\nMaybe this transformation can be optional or must not be used at this place.\n\nHope, that this fix will find his way in one of the next releases, because as a workaround\ni manually have to comment out this line of code.\n\nBest wishes,\nHolger Sch\u00e4fer"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4495\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sgehrig",
                "name": "sgehrig",
                "displayName": "Stefan Gehrig",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10201",
                    "id": 10201,
                    "description": "Mini Release",
                    "name": "1.6.1",
                    "userReleaseDate": "15\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-15",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10281",
                    "id": 10281,
                    "name": "Zend_Ldap",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24820",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=miallen",
                        "name": "miallen",
                        "displayName": "Michael B Allen",
                        "active": true
                    },
                    "body": "Yeah, it looks like we need to use $username = mb_strtolower($username, 'UTF-8'). We might need to call it conditionally if it's not a core PHP function though.\n\nCommenting out that strtolower is an ok solution too.\n\nThe reason the username is lower-cased is because, as the name of the method implies, getCanonicalAccountName should always return the same string for the same account such that an equality comparison with == should return true. If we don't normalize the case, that may result in subtle bugs in higher level logic where people assume a logical comparison will be sufficient (as opposed to a strcasecmp). But since database string comparisons are almost always case insensitive, it's probably ok to not normalize the username to lowercase. So perhaps we should make this optional.\n\nI'm about to do another pass at Zend_Ldap. I'll create an account with non-ASCII characters in the username and make sure that all the tests work correctly.\n\nThanks for the feedback,\nMike",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=miallen",
                        "name": "miallen",
                        "displayName": "Michael B Allen",
                        "active": true
                    },
                    "created": "2008-10-06T08:54:56.000+0000",
                    "updated": "2008-10-06T08:54:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24912",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=miallen",
                        "name": "miallen",
                        "displayName": "Michael B Allen",
                        "active": true
                    },
                    "body": "Holger,\n\nI was not able to reproduce this issue.\n\nAdding a user sch\u00e4fer to AD worked perfectly with my standard Zend_Auth_Adapter_Ldap demo app. The user is correctly authenticated and the umlaut is represented correctly throughout.\n\nPerhaps your PHP multi-byte settings are causing an issue?\n\nOr perhaps the web server locale is not suitable?\n\nMy interpretation of the strtolower documentation indicates that a UTF-8 locale or C local should work fine. UTF-8 characters should be converted correctly in a UTF-8 locale and characters are not converted at all in the C local.\n\nNote that if you are using a locale other than UTF-8, the LDAP client in general may not behave as expected as LDAP data is always UTF-8 regardless of what locale you run in.\n\nI will leave this issue open if you wish to pursue the issue futher however I have downgraded the issue to \"minor\".\n\nMike",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=miallen",
                        "name": "miallen",
                        "displayName": "Michael B Allen",
                        "active": true
                    },
                    "created": "2008-10-08T19:09:56.000+0000",
                    "updated": "2008-10-08T19:09:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24921",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hschaefer123",
                        "name": "hschaefer123",
                        "displayName": "Holger Sch\u00e4fer",
                        "active": true
                    },
                    "body": "Hi Allan,\nthanks for the quick answer.\n\nWe are using Windows as a Devsystem and Linux as the prodsystem,\nto make sure that the code is running on both systems.\n\nWindows has it's own kind of implementation of the locale functionality.\nIn the manual i found an entry:\n>Note about using UTF-8 locale charset on Windows systems:\n>According to MSDN, Windows setlocale()'s implementation does not support UTF-8 encoding. \n>Citation from \"MSDN setlocale, _wsetlocale\" page (http:\/\/msdn.microsoft.com\/en-us\/library\/x99tb11d.aspx):\n>The set of available languages, country\/region codes, and code pages includes all those supported by the >Win32 >NLS API except code pages that require more than two bytes per character, such as UTF-7 and UTF-8. If >you provide >a code page like UTF-7 or UTF-8, setlocale will fail, returning NULL. \n\nThat was the reason why we have to use different locales for Windows and Linux.\n\nI just tested it by myself, and all combinations of setlocale (only windows) like \nsetlocale(LC_ALL, 'deu_deu', 'germany_germany'); \ndoes not work the expected way (things like \"deu_deu.UTF8\" does not work on windows).\nThe locale is always \"German_Germany.1252 \"\n\nConcerning strtolower:\nIn the manual, there is also an example function \"strtolower_utf8($inputString)\", that uses\nutf8_decoding -> strtolower -> utf_encode to make sure, that strtolower works well in utf8 case.\n\nSo i think, i'm not able to use Zend_Ldap (on windows) without the strtolower line, cause the problems is in combination of codepage 1252 and using strtolower while the whole communikation is code in utf-8.\n\nIf Zend_Framework supports the windows plattform, any solution inside the framework would be great, cause it is a little bit problematic on every update of the ZendFramework manually to comment the codeline. \n\nAny Ideas?\n\nBest wishes\nHolger",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hschaefer123",
                        "name": "hschaefer123",
                        "displayName": "Holger Sch\u00e4fer",
                        "active": true
                    },
                    "created": "2008-10-09T00:23:56.000+0000",
                    "updated": "2008-10-09T00:23:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32749",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sgehrig",
                        "name": "sgehrig",
                        "displayName": "Stefan Gehrig",
                        "active": true
                    },
                    "body": "fixed in trunk rev. 16890",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sgehrig",
                        "name": "sgehrig",
                        "displayName": "Stefan Gehrig",
                        "active": true
                    },
                    "created": "2009-07-20T12:31:52.000+0000",
                    "updated": "2009-07-20T12:31:52.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4495\/transitions"
}