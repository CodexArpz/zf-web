{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9976",
    "key": "ZF-9976",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Translate_Adapter rerouting problem"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9976\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10470",
                    "id": 10470,
                    "description": "Mini Release",
                    "name": "1.10.6",
                    "userReleaseDate": "22\/Jun\/10",
                    "archived": false,
                    "releaseDate": "2010-06-22",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-06-12T13:49:04.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                "name": "johndoe",
                "displayName": "Ren\u00e9 Kerner",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-06-10T09:59:04.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-06-12T13:49:10.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Hello!\r\n\r\nWhen there are 2 (or more) untranslated MessageIDs (one directly after the other), I got only the first one translated in the \"routed\" \"fallback\" language.\r\n\r\n\r\nit's about these lines of code:\r\n\"if (array_key_exists($locale, $this->_options['route']) &&\r\n                !array_key_exists($locale, $this->_routed)\"\r\nand:\r\n\"$this->_routed[$locale] = true;\"\r\nin line 738 - 740 (and also 683 - 685) of Zend\/Translate\/Adapter.php\r\n\r\nExample:\r\nto translate:\r\nID1 (available in user-language)\r\nID2 (not available in user-language, routing to standard-language)\r\nID3 (not available in user-language, routing to standard-language)\r\n\r\nID1 is found in user-language-source and successfully returned - OK!\r\n\r\nID2 is NOT found in user-language-source;\r\nsetting \"$this->_routed[USER_LANGUAGE] = true\" and successfully return text from standard language - OK\r\n\r\nID3 is NOT found in user-language-source;\r\n\"$this->_routed[USER_LANGUAGE]\" already is true\r\nin lines 738\/739 we have:\r\n\"if (array_key_exists($locale, $this->_options['route']) &&\r\n                !array_key_exists($locale, $this->_routed)\"\r\nan because of \"!array_key_exists($locale, $this->_routed)\"\r\nwe won't route, because we thougth, we already did...\r\nwe don't return the translation from the standard language, so\r\nonly the MessageID (ID3) will be returned...\r\n-ERROR!!!\r\n\r\nit's eroneous, that \"$this->_routed\" will be resetted AFTER:\r\n\"return $this->translate($messageId, $this->_options['route'][$locale]);\r\n            }\"\r\nby\r\n\"$this->_routed = array();\" in line 744\r\nbut because of that \"return $this->translate(...\" we don't reach that point.\r\n\r\nBest regards,\r\nRen\u00e9 Kerner.\r\n\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9976\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13127",
                    "filename": "TRANSLATE_DE.png",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "created": "2010-06-11T00:48:33.000+0000",
                    "size": 11876,
                    "mimeType": "image\/png",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13127\/TRANSLATE_DE.png",
                    "thumbnail": "http:\/\/fw02.zend.com\/issues\/secure\/thumbnail\/13127\/_thumb_13127.png"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13128",
                    "filename": "TRANSLATE_EN_no-translations.png",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "created": "2010-06-11T00:48:36.000+0000",
                    "size": 13205,
                    "mimeType": "image\/png",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13128\/TRANSLATE_EN_no-translations.png",
                    "thumbnail": "http:\/\/fw02.zend.com\/issues\/secure\/thumbnail\/13128\/_thumb_13128.png"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13130",
                    "filename": "TRANSLATE_EN_translated-ID-4-5-6-7.png",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "created": "2010-06-11T01:38:24.000+0000",
                    "size": 13146,
                    "mimeType": "image\/png",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13130\/TRANSLATE_EN_translated-ID-4-5-6-7.png",
                    "thumbnail": "http:\/\/fw02.zend.com\/issues\/secure\/thumbnail\/13130\/_thumb_13130.png"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13129",
                    "filename": "TRANSLATE_EN_translated-ID-4-5-6-7.png",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "created": "2010-06-11T00:48:36.000+0000",
                    "size": 13134,
                    "mimeType": "image\/png",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13129\/TRANSLATE_EN_translated-ID-4-5-6-7.png",
                    "thumbnail": "http:\/\/fw02.zend.com\/issues\/secure\/thumbnail\/13129\/_thumb_13129.png"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10460",
                    "id": 10460,
                    "description": "Mini Release",
                    "name": "1.10.5",
                    "userReleaseDate": "26\/May\/10",
                    "archived": false,
                    "releaseDate": "2010-05-26",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10099",
                    "id": 10099,
                    "name": "Zend_Translate",
                    "description": "Provides translation functionality, based on standards such as TMX and Gettext.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40939",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "The code works as expected. It would be nice if you give a real example instead of framework code.\r\n\r\nThis is a simple recursive methodcall as used in many other components and projects. When you follow the workflow you would see that _route is resetted before the rerouted translation is returned.\r\n\r\nI can't see a failure wether in code nor within the testbed which tests the code.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-06-10T12:15:43.000+0000",
                    "updated": "2010-06-10T12:15:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40940",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "body": "Ok, I'll explain a bit precisely.\r\n\r\nIn my application german (de) is the standard-locale and the german language-file would always be the complete one. for test-reasons, i changed my firefox-language-option to \"en\", so Zend_Locale retrieves english as the actual locale. but it's not completly translated.\r\nso i wanted to reroute \"en\" to \"de\" if the identifiers aren't found in the \"en\"-languagefile.\r\n\r\n{code:title=application.ini}\r\n\r\n...\r\n\r\n;----------------------------\r\n; Zend_Locale\r\n;----------------------------\r\nresources.locale.default = \"de\"\r\n\r\n;----------------------------\r\n; Zend_Translate\r\n;----------------------------\r\nresources.translate.adapter = \"Tacticx_Translate_Adapter_Gettext\"\r\nresources.translate.data = APPLICATION_PATH \"\/languages\"\r\nresources.translate.default = \"de\"\r\nresources.translate.locale = \"auto\"\r\nresources.translate.route.en = \"de\"\r\nresources.translate.options.disableNotices = false\r\nresources.translate.options.logUntranslated = true\r\nresources.translate.options.scan = \"directory\"\r\nresources.translate.options.ignore[] = \".\"\r\nresources.translate.options.ignore.regex = \"\/\\.po$\/i\"\r\n\r\n...\r\n\r\n{code}\r\n\r\n{code:title=Bootstrap.php}\r\n    protected function _initTranslation()\r\n    {\r\n        $this->bootstrap('locale');\r\n        $this->bootstrap('translate');\r\n        $translate = Zend_Registry::get('Zend_Translate');\r\n        $writer = new Zend_Log_Writer_Stream(APPLICATION_ROOT_PATH\r\n                . '\/data\/logs\/translation.log');\r\n        $log = new Zend_Log($writer);\r\n        \/\/ Diese der \u00dcbersetzungs-Instanz hinzuf\u00fcgen\r\n        $translate->setOptions(array('log' => $log));\r\n    }\r\n\r\n    protected function _initNavigationMenu()\r\n    {\r\n        $this->bootstrap('locale');\r\n        $this->bootstrap('translate');\r\n        $this->bootstrap('translation');\r\n        require_once(APPLICATION_ROOT_PATH . DIRECTORY_SEPARATOR . 'data'\r\n                    . DIRECTORY_SEPARATOR . 'menu' . DIRECTORY_SEPARATOR\r\n                    . 'menu.inc.php');\r\n        \/\/ only stores an navigation-menu array in variable $menu\r\n        Zend_Registry::set('Zend_Navigation', $menu);\r\n{code}\r\n\r\n{code:title=data\/menu\/menu.php}\r\n$menu = new Zend_Navigation(\r\narray(\r\n    array(\r\n        'label' => 'navigation::home',\r\n        'uri' => '\/',\r\n        'pages' => array(\r\n                       array(\r\n                           'label' => 'navigation::login',\r\n                           'controller' => 'access',\r\n                       ),\r\n                       array(\r\n                           'label' => 'navigation::logout',\r\n                           'action' => 'logout',\r\n                           'controller' => 'access',\r\n                       )\r\n        ),\r\n    ),\r\n    array(\r\n        'label' => 'navigation::organization_editor',\r\n        'module' => 'mgr',\r\n        'action' => 'index',\r\n        'controller' => 'organization',\r\n    ),\r\n\r\n...\r\n\r\n{code}\r\n\r\nas you can see, the navigation labels are \"identifiers\", which should be translated by Zend_Translate.\r\n\r\nThe Zend_View_Helper_SOMETHING (?) is used to create the menu-structure and there the labels got translated.\r\n\r\nIn that example the View_Helper_???... (i'm @home at the moment and can't say, which is used. tomorrow i'll again debug that and add that information) gets the Translator (I expect Zend_Translate from Zend_Registry) and calls ->translate(\"navigation::login\");\r\nlocale is null and gets the currently user-locale (line 656, Zend\/Translate\/Adapter.php).\r\n\r\nthe next lines until line 707 are skipped, because the conditions don't match.\r\nafter that, because of missing languagefile-entries in the english-language-file, the next lines are skipped (conditions don't match) until line 735\/736:\r\n{code}\r\n        $this->_log($messageId, $locale);\r\n        \/\/ use rerouting when enabled\r\n{code}\r\n\r\nthen we come to the routing-part (lines 737 - 745):\r\n{code}\r\n        if (!empty($this->_options['route'])) \/\/ isn't empty --> true\r\n        {  \/\/ --> go in that if\r\n            if (array_key_exists($locale, $this->_options['route']) &&  \/\/ exists --> true \r\n                !array_key_exists($locale, $this->_routed))         \/\/ doesn't exists --> true\r\n            {   \/\/ --> go in that if\r\n                $this->_routed[$locale] = true; \/\/ for that translator-object (let's call it: TO1) we set routed[\"en\"] to true\r\n                return $this->translate($messageId, $this->_options['route'][$locale]); \/\/ we call ->translate(\"...\", \"de\") and it will return the right german languagefile-entry for that identifier\r\n            }\r\n\r\n            $this->_routed = array();  \/\/ is not called, because of \"return $this->translate(...)\" before\r\n        }\r\n{code}\r\n\r\nin that navigation-menu, the next identifier also isn't translated in the english-language-file.\r\n\r\nso we are in the same helper and have the same translator-object (TO1), which \"$this->_routed[$locale]\" value is still not resetted (I debugged that!!!). so: $this->_routed[\"en\"] is true.\r\n\r\nthe view helper now calls with that translator (TO1) ->translate(\"the_next_identifier\");\r\nas before no line matches one of the if-conditions and we come to lines 737 - 745:\r\n{code}\r\n        if (!empty($this->_options['route'])) \/\/ isn't empty --> true\r\n        {  \/\/ --> go in that if\r\n            if (array_key_exists($locale, $this->_options['route']) &&  \/\/ exists --> true \r\n                !array_key_exists($locale, $this->_routed))         \/\/ already EXISTS --> false\r\n            {   \/\/ --> NOT go in that if\r\n                $this->_routed[$locale] = true;\r\n                return $this->translate($messageId, $this->_options['route'][$locale]);\r\n            }\r\n\r\n            $this->_routed = array();  \/\/ now it's resetted, but we didn't translate that identifier. for that translator-object only the next identifier will be translated...\r\n        }\r\n{code}\r\n\r\nthe reason is, that the reset:\r\n{code}\r\n$this->_routed = array();\r\n{code}\r\n\r\nis only resetted on three positions:\r\nline 53, on initialization: private $_routed = array();\r\nline 689, $this->_routed = array(); after Zend_Locale::isLocale-checks\r\nline 744, $this->_routed = array(); after rerouting\r\n\r\nmore specific code-examples I can only support from work tomorrow.\r\n\r\nwhat code examples do you need?\r\n\r\nbest regards,\r\nren\u00e9\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "created": "2010-06-10T13:56:09.000+0000",
                    "updated": "2010-06-10T13:56:09.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40941",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "body": "wrong translation example (application code follows!)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "created": "2010-06-11T00:48:36.000+0000",
                    "updated": "2010-06-11T00:48:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40942",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "body": "now some explanation for my screenshots:\r\n\r\nI hava a StartController with an index-action.\r\n{code:title=application\/views\/scripts\/start\/index.phtml}\r\nSTARTSEITE<br \/>\r\n<?php\r\necho $this->translate('test1') . '<br \/>' . PHP_EOL;\r\necho $this->translate('test2') . '<br \/>' . PHP_EOL;\r\necho $this->translate('test3') . '<br \/>' . PHP_EOL;\r\necho $this->translate('test4') . '<br \/>' . PHP_EOL;\r\necho $this->translate('test5') . '<br \/>' . PHP_EOL;\r\necho $this->translate('test6') . '<br \/>' . PHP_EOL;\r\necho $this->translate('test7') . '<br \/>' . PHP_EOL;\r\necho $this->translate('test8') . '<br \/>' . PHP_EOL;\r\necho $this->translate('test9') . '<br \/>' . PHP_EOL;\r\necho $this->translate('test10') . '<br \/>' . PHP_EOL;\r\necho $this->translate('test11') . '<br \/>' . PHP_EOL;\r\necho $this->translate('test12') . '<br \/>' . PHP_EOL;\r\necho $this->translate('test13') . '<br \/>' . PHP_EOL;\r\necho $this->translate('test14') . '<br \/>' . PHP_EOL;\r\n{code}\r\n\r\nIn german PO\/MO-files I translated identifiers test1 - test4 and test7 - test12. test5, test6, test13 and test14 aren't translated.\r\nThis is correctly shown in picture one: \"TRANSLATE_DE.png\"\r\n!TRANSLATE_DE.png|thumbnail!\r\n\r\n\r\nThen I switched my browser LANGUAGE_ACCEPT to \"English [en]\" and Zend_Locale will give this to Zend_Translate.\r\nIn the english languagefile nothing is translated at this time.\r\n!TRANSLATE_EN_no-translations.png|thumbnail!\r\nThis should look like picture one and there should always be the german translation:\r\n\u00fc1 - \u00fc4\r\ntest5, test6\r\n\u00fc7 - \u00fc12\r\ntest13, test14\r\nBUT I got:\r\n\u00fc1 - OK\r\ntest2 - ERROR\r\n\u00fc3 - OK\r\ntest4 - ERROR\r\ntest5 - OK\r\ntest6 - OK\r\n\u00fc7 - OK\r\ntest8 - ERROR\r\n\u00fc9 - OK\r\ntest10 - ERROR\r\n\u00fc11 - OK\r\ntest12 - ERROR\r\ntest13 - OK\r\ntest14 - OK\r\nAs you can see, only every second untranslated translation is correctly routed!\r\n\r\n\r\nThen I translated some identifiers in the english languagefile, but only identifiers test4 - test7.\r\nAs you can see,\r\n!TRANSLATE_EN_translated-ID-4-5-6-7.png|thumbnail!\r\nI should get:\r\n\u00fc1 - \u00fc3\r\nen4 - en7\r\n\u00fc8 - \u00fc12\r\ntest13, test14\r\n\r\nBUT I got:\r\n\u00fc1 - OK\r\ntest2 - ERROR\r\n\u00fc3 - OK\r\nen4 - OK\r\nen5 - OK\r\nen6 - OK\r\nen7 - OK\r\ntest8 - ERROR\r\n\u00fc9 - OK\r\ntest10 - ERROR\r\n\u00fc11 - OK\r\ntest12 - ERROR\r\ntest13 - OK\r\ntest14 - OK\r\n\r\nSo you can see only every second translation in case of language-rerouting is correct.\r\n\r\nThe reason is in the recursion.\r\nBecause of the RETURN command in \"return $this->translate($messageId, $route_language)\" the reset of $this->_routed[$routed_language] will only be reseted in a later call of $this->translate() for the next identifier. The right solution would be to save the returned value of the $this->translate($messageId, $route_language) to a variable. Then after the recursion reset or in code \"unset($this->_routed[$currently_routed_language])\". So you can prevent endless recursion in cyclic routing definitions (like EN => DE => FR => EN) when the identifier is not found.\r\n\r\n\r\nAnd more precisly in german \/ Und auf Deutsch:\r\nEs liegt daran, wie ich bereits beschrieben habe, dass im beim re-routen der rekursive Abstieg direkt mit einem RETURN gemacht wird.\r\nRichtig w\u00e4re doch, das Ergebnis des rekursiven Abstiegs von $this->translate($messageId, $route_language) in eine variable zu speichern.\r\nNach erfolgreichem rekursivem Aufstieg \"unset($this->_routed[$geroutete_sprache])\" zu machen. und dann erst das RETURN.\r\nSo kann man verhindern, dass es eine endlose Rekursionschleife gibt, wenn der Bezeichner\/Identifier bei einer zyklischen Routen-Definition (z.B. EN => DE => FR => EN) nicht gefunden wird.\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "created": "2010-06-11T01:37:39.000+0000",
                    "updated": "2010-06-11T01:37:39.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40943",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "body": "wrong screenshot replaced",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "created": "2010-06-11T01:38:25.000+0000",
                    "updated": "2010-06-11T01:38:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40944",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "body": "In my project I'm using a self extended Zend_Translate_Adaper_Gettext. It's called Tacticx_Translate_Adaper_Gettext.\r\nIt's not the right place because it should be in a Tacticx_Translate_Adaper class, but for me it's acceptable there atm.\r\nHere is an example for a corrected Zend\/Translate\/Adapter.php\r\nI only show the added function and the corrected translate(...)-function.\r\n\r\n\r\n{code:title=Zend\/Translate\/Adapter.php - only with the correction! }\r\n    private function _routeTranslate($_messageId, $_locale)\r\n    {\r\n        $this->_routed[$_locale] = true;\r\n        $foreign_lang = $this->translate($_messageId, $this->_options['route'][$_locale]);\r\n        unset($this->_routed[$_locale]);\r\n        if(!isset($this->_routed))\r\n            $this->_routed = array();\r\n        return $foreign_lang;\r\n    }\r\n\r\n    \/**\r\n     * Translates the given string\r\n     * returns the translation\r\n     *\r\n     * @see Zend_Locale\r\n     * @param  string|array       $messageId Translation string, or Array for plural translations\r\n     * @param  string|Zend_Locale $locale    (optional) Locale\/Language to use, identical with\r\n     *                                       locale identifier, @see Zend_Locale for more information\r\n     * @return string\r\n     *\/\r\n    public function translate($messageId, $locale = null)\r\n    {\r\n        if($locale === null)\r\n            $locale = $this->_options['locale'];\r\n        $plural = null;\r\n        if(is_array($messageId))\r\n        {\r\n            if(count($messageId) > 2)\r\n            {\r\n                $number = array_pop($messageId);\r\n                if(!is_numeric($number))\r\n                {\r\n                    $plocale = $number;\r\n                    $number  = array_pop($messageId);\r\n                }\r\n                else\r\n                    $plocale = 'en';\r\n\r\n                $plural    = $messageId;\r\n                $messageId = $messageId[0];\r\n            }\r\n            else\r\n                $messageId = $messageId[0];\r\n        }\r\n\r\n        \/\/ check if chosen locale is a valid locale\r\n        if(!Zend_Locale::isLocale($locale, true, false))\r\n        {\r\n            if (!Zend_Locale::isLocale($locale, false, false))\r\n            {\r\n                \/\/ language does not exist, return original string\r\n                $this->_log($messageId, $locale);\r\n                \/\/ use rerouting when enabled\r\n                if(!empty($this->_options['route']))\r\n                {\r\n                    if(array_key_exists($locale, $this->_options['route']) &&\r\n                        !array_key_exists($locale, $this->_routed))\r\n                    {\r\n                        return $this->_routeTranslate($messageId, $locale);\r\n                    }\r\n                    $this->_routed = array();\r\n                }\r\n\r\n                if($plural === null)\r\n                    return $messageId;\r\n\r\n                $rule = Zend_Translate_Plural::getPlural($number, $plocale);\r\n                if(!isset($plural[$rule]))\r\n                    $rule = 0;\r\n                return $plural[$rule];\r\n            }\r\n            $locale = new Zend_Locale($locale);\r\n        }\r\n\r\n        $locale = (string) $locale;\r\n        if((is_string($messageId) || is_int($messageId)) && isset($this->_translate[$locale][$messageId]))\r\n        {\r\n            \/\/ return original translation\r\n            if($plural === null)\r\n                return $this->_translate[$locale][$messageId];\r\n            $rule = Zend_Translate_Plural::getPlural($number, $locale);\r\n            if(isset($this->_translate[$locale][$plural[0]][$rule]))\r\n                return $this->_translate[$locale][$plural[0]][$rule];\r\n        }\r\n        else if(strlen($locale) != 2)\r\n        { \/\/ faster than creating a new locale and separate the leading part\r\n            $locale = substr($locale, 0, -strlen(strrchr($locale, '_')));\r\n\r\n            if((is_string($messageId) || is_int($messageId))\r\n                && isset($this->_translate[$locale][$messageId]))\r\n            { \/\/ return regionless translation (en_US -> en)\r\n                if($plural === null)\r\n                    return $this->_translate[$locale][$messageId];\r\n                $rule = Zend_Translate_Plural::getPlural($number, $locale);\r\n                if (isset($this->_translate[$locale][$plural[0]][$rule]))\r\n                    return $this->_translate[$locale][$plural[0]][$rule];\r\n            }\r\n        }\r\n\r\n        $this->_log($messageId, $locale);\r\n        \/\/ use rerouting when enabled\r\n        if (!empty($this->_options['route']))\r\n        {\r\n            if (array_key_exists($locale, $this->_options['route']) &&\r\n                !array_key_exists($locale, $this->_routed))\r\n            {\r\n                return $this->_routeTranslate($messageId, $locale);\r\n            }\r\n            $this->_routed = array();\r\n        }\r\n        if ($plural === null)\r\n            return $messageId;\r\n\r\n        $rule = Zend_Translate_Plural::getPlural($number, $plocale);\r\n        if (!isset($plural[$rule]))\r\n            $rule = 0;\r\n        return $plural[$rule];\r\n    }\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=johndoe",
                        "name": "johndoe",
                        "displayName": "Ren\u00e9 Kerner",
                        "active": true
                    },
                    "created": "2010-06-11T02:25:18.000+0000",
                    "updated": "2010-06-11T02:25:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40978",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Please write your issues in english and not in other languages which people don't understand. Thnx.\r\n\r\nFixed with r22425.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-06-12T13:49:05.000+0000",
                    "updated": "2010-06-12T13:49:05.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9976\/transitions"
}