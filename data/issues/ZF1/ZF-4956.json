{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4956",
    "key": "ZF-4956",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Double query encoding conversion"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4956\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-10-16T01:11:31.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=boris",
                "name": "boris",
                "displayName": "Boris",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-11-15T13:45:31.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-10-16T01:11:38.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Hi, I write a simple class that helps to collect keywords from russian search engine \"Yandex\",\nthey offer special service to check most popular queries sent by users.\n\nMy IDE uses utf8 encoding, and file encoded with utf8 as well.\nI searched for keyword \"\u0442\u0435\u0441\u0442\" (\"test\" in English), here is the url I copied from my browser:\n\nhttp:\/\/wordstat.yandex.ru\/advq?rpt=ppc&key=&shw=1&tm=&checkboxes=&text=%F2%E5%F1%F2&regions_text=%C2%F1%E5&regions=\n\nHere is a php class that I wrote to collect keywords from this service:\n\n----------------------------------\n{code}\n<?php\n\nsetlocale(LC_ALL, 'ru_RU.UTF-8');\ndate_default_timezone_set('Europe\/Moscow');\nerror_reporting(E_ALL|E_STRICT);\nini_set('display_erros', 'on');\n\nclass YandexWordstat {\n    \n    private $client;\n    \n    private $url = 'http:\/\/wordstat.yandex.ru\/advq';\n    \n    public function __construct()\n    {\n        $this->client = new Zend_Http_Client();\n        $this->client->setConfig(array('maxredirects'   => 0,\n                                       'timeout'       => 30,\n                                       'adapter'    => 'Zend_Http_Client_Adapter_Proxy',\n                                       'proxy_host' => 'srv01.lan',\n                                       'proxy_port' => 3128,\n                                       \n        ));\n    }\n\n    private function getPage()\n    {\n        $this->client->setUri($this->url);\n        $responce = $this->client->request();\n        if ($responce->getStatus() != 200)\n        {\n            return false;\n        }\n\n        $page = $responce->getBody();\n        return $page;\n    }\n    \n    private function createSearchString($options = array())\n    {\n        $params = array('rpt' => 'ppc', 'key' => '', 'shw' => 1, 'tm' => '',\n                        'checkboxes' => '', 'regions_text' => '%C2%F1%E5', 'regions' => '', );\n        foreach($options as $key => $value) {\n            $params[$key] = $value;\n        }\n\n        foreach ($params as $p_key => $p_value) {\n            $this->client->setParameterGet($p_key, $p_value);\n        }\n        var_dump($this->client);\n    }\n    \n    public function collectKeywords($keyword)\n    {\n\/\/      $keyword = iconv('utf-8', 'windows-1251', $keyword);\n        $this->createSearchString(array('text' => $keyword));\n        $first_page = $this->getPage();\n        $this->getKeywords($first_page);\n    }\n{code}\n----------------------------------\n\nThere is a call to var_dump in code, I did this specially because I wanted to check if url correct or not,\nhere is the output:\n\n-------------------------------------------\n\n{noformat}\nobject(Zend_Http_Client)[49]\n  protected 'config' => \n    array\n      'maxredirects' => int 0\n      'strictredirects' => boolean false\n      'useragent' => string 'Zend_Http_Client' (length=16)\n      'timeout' => int 30\n      'adapter' => string 'Zend_Http_Client_Adapter_Proxy' (length=30)\n      'httpversion' => string '1.1' (length=3)\n      'keepalive' => boolean false\n      'storeresponse' => boolean true\n      'strict' => boolean true\n      'proxy_host' => string 'srv01.lan' (length=9)\n      'proxy_port' => int 3128\n  protected 'adapter' => null\n  protected 'uri' => null\n  protected 'headers' => \n    array\n      empty\n  protected 'method' => string 'GET' (length=3)\n  protected 'paramsGet' => \n    array\n      'rpt' => string 'ppc' (length=3)\n      'key' => string '' (length=0)\n      'shw' => int 1\n      'tm' => string '' (length=0)\n      'checkboxes' => string '' (length=0)\n      'regions_text' => string '%C2%F1%E5' (length=9)\n      'regions' => string '' (length=0)\n      'text' => string '%F2%E5%F1%F2' (length=12)\n{noformat}      \n-------------------\n\nPlease note the following\n{code} 'text' => string '%F2%E5%F1%F2' (length=12){code}\n this is a correct url parameter, but when I checked HTTP Proxy logs I saw the following:\n\nhttp:\/\/wordstat.yandex.ru\/advq?rpt=ppc&key=&shw=1&tm=&checkboxes=&regions_text=%25C2%25F1%25E5&regions=&text=%25F2%25E5%25F1%25F2\n\nlook at the url part\n&text=%25F2%25E5%25F1%25F2\nit was changed. You may also visit the provided url and check that is is not correct.\n\nThere is no any additional code in my class that makes any conversions or something like that.\n\nI looked at Zend\/library\/Zend\/Uri\/Http.php and reviewed the setQuery method, it uses the http_build_query\nphp function, so I thought that this function caused a problem, and I wrote a test script:\n\n--------------------\n{code}\n<?php\n\n$str = '\u0442\u0435\u0441\u0442';\n$str = iconv('utf-8', 'windows-1251', $str);\n\nvar_dump(http_build_query(array('test' => $str)));\n\n?>\n\nOUTPUT:\n\nboris@sba:~\/Desktop\/zend$ php test.php\nstring(17) \"test=%F2%E5%F1%F2\"\n{code}\n--------------------\n\nSo here is my question: is this some kind of a bug in Zend Framework, or do I need to set some additional\nparameters\/variables etc, to prevent Zend Framework from doing this double conversions?"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4956\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mabe",
                "name": "mabe",
                "displayName": "Marc Bennewitz (private)",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10252",
                    "id": 10252,
                    "description": "Minor Preview Release",
                    "name": "1.7 Preview Release",
                    "userReleaseDate": "13\/Oct\/08",
                    "archived": true,
                    "releaseDate": "2008-10-13",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10015",
                    "id": 10015,
                    "name": "Zend_Http_Client",
                    "description": "performs HTTP requests",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37799",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mabe",
                        "name": "mabe",
                        "displayName": "Marc Bennewitz (private)",
                        "active": true
                    },
                    "body": "Hi Boris,\r\n\r\nI see you set the get parameter already url encoded:\r\n{code}\r\n        $params = array('rpt' => 'ppc', 'key' => '', 'shw' => 1, 'tm' => '',\r\n                        'checkboxes' => '', 'regions_text' => '%C2%F1%E5', 'regions' => '', );\r\n        foreach($options as $key => $value) {\r\n            $params[$key] = $value;\r\n        }\r\n\r\n        foreach ($params as $p_key => $p_value) {\r\n            $this->client->setParameterGet($p_key, $p_value);\r\n        }\r\n{code}\r\n\r\nBut Zend_Http_Client is doing this for you.\r\nThis means if you set \"setParameterGet('regions_text', '%C2%F1%E5')\" Zend_Http_Client generates \"&regions_text=%25C2%25F1%25E5\".\r\nPlease set your parameter not pre-urlencoded like: \"setParameterGet('regions_text', \"\\xC2\\xF1\\xE5\")\"",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mabe",
                        "name": "mabe",
                        "displayName": "Marc Bennewitz (private)",
                        "active": true
                    },
                    "created": "2010-01-18T07:01:01.000+0000",
                    "updated": "2010-01-18T07:01:01.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42529",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mabe",
                        "name": "mabe",
                        "displayName": "Marc Bennewitz (private)",
                        "active": true
                    },
                    "body": "not an issue (see my comment above)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mabe",
                        "name": "mabe",
                        "displayName": "Marc Bennewitz (private)",
                        "active": true
                    },
                    "created": "2010-10-16T01:11:33.000+0000",
                    "updated": "2010-10-16T01:11:33.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4956\/transitions"
}