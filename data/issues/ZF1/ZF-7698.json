{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7698",
    "key": "ZF-7698",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Cannot 'describeTables' with SQLServer 2000, using Zend_Db_Adapter_Sqlsrv"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7698\/votes",
                "votes": 4,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-04-16T07:57:17.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=paulkissick",
                "name": "paulkissick",
                "displayName": "Paul Kissick",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-08-27T04:23:25.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-08-09T01:05:38.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "describeTable",
                "sqlsrv"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Connecting to SQLServer 2000 using the latest Sqlsrv driver (1.1 CTP Aug 09 release), with the Microsoft SQL Server Native Client 2008, on a windows IIS server (6.0) using FastCGI and PHP v5.2.10\n\nThe describeTable function fails with the exception: \n'The connection cannot process this operation because there is a statement with pending results. To make the connection available for other queries, either fetch all results or cancel or free the statement. For more information, see the product documentation about the MultipleActiveResultSets connection option'\n\nLine 436 in Zend\\Db\\Adapter\\SqlSrv.php executes a stored procedure, but the script cannot run the next stored procedure on line 455 without first clearing the statement.\n\nI propose unsetting the first statement after the result set is returned: \n\nLine 439: unset($stmt);\n\nThis will resolve the describeTable issue with SQLServer 2000.\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7698\/watchers",
                "isWatching": false,
                "watchCount": 5
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=juokaz",
                "name": "juokaz",
                "displayName": "Juozas Kaziukenas",
                "active": false
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10361",
                    "id": 10361,
                    "description": "Mini Release",
                    "name": "1.9.2",
                    "userReleaseDate": "25\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10012",
                    "id": 10012,
                    "name": "Zend_Db",
                    "description": "interfaces, APIs, and adapters for various third-party data stores",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38293",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=victorsmirnov",
                        "name": "victorsmirnov",
                        "displayName": "Victor Smirnov",
                        "active": true
                    },
                    "body": "Hi!\r\n\r\nI face the same error as described here with Zend Framework 1.10.0.\r\nAnd suggested solution works for me too.\r\n\r\nIt's just one line - why not fix this? :)\r\n\r\nThanks!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=victorsmirnov",
                        "name": "victorsmirnov",
                        "displayName": "Victor Smirnov",
                        "active": true
                    },
                    "created": "2010-02-06T05:17:31.000+0000",
                    "updated": "2010-02-06T05:17:31.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38733",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=qr123de",
                        "name": "qr123de",
                        "displayName": "Bob Marley",
                        "active": true
                    },
                    "body": "Same on 1.10.1 and also with MSSQL2008.\r\n\r\nZend_Db_Statement_Sqlsrv_Exception: The connection cannot process this operation because there is a statement with pending results.  To make\r\n the connection available for other queries, either fetch all results or cancel or free the statement.  For more information, see the produc\r\nt documentation about the MultipleActiveResultSets connection option. in [...]\\ZendFramework-1.10.1\\library\\Zend\\Db\\Statement\\Sqlsrv.php o\r\nn line 206\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=qr123de",
                        "name": "qr123de",
                        "displayName": "Bob Marley",
                        "active": true
                    },
                    "created": "2010-02-25T03:32:41.000+0000",
                    "updated": "2010-02-25T03:32:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40037",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=juokaz",
                        "name": "juokaz",
                        "displayName": "Juozas Kaziukenas",
                        "active": false
                    },
                    "body": "This adapter is not supposed to be used in Sql server 2000 (http:\/\/msdn.microsoft.com\/en-US\/library\/cc296172(v=SQL.90).aspx). I have added code to fix this though.\r\n\r\nFixed in r21882",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=juokaz",
                        "name": "juokaz",
                        "displayName": "Juozas Kaziukenas",
                        "active": false
                    },
                    "created": "2010-04-16T07:57:17.000+0000",
                    "updated": "2010-04-16T07:57:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40117",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=qr123de",
                        "name": "qr123de",
                        "displayName": "Bob Marley",
                        "active": true
                    },
                    "body": "Which adapter do you mean?\r\nzend, php_sqlsvr or native sql driver \r\n\r\nHere \r\nhttp:\/\/msdn.microsoft.com\/en-US\/library\/cc296170%28v=SQL.90%29.aspx\r\nis a response from Ashay Chaudhary and he writes:\r\nMSFT RESPONSE: Yes, it should work. SQL Server 2000 is the oldest version supported by this driver.\r\n\r\nIf you look into the driver documentation, you will also find that the sql2k server is supported.\r\n\r\nbut thats all for the native driver.\r\ni didnt found informations about php_sqlsvr,\r\nbut it uses the native driver.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=qr123de",
                        "name": "qr123de",
                        "displayName": "Bob Marley",
                        "active": true
                    },
                    "created": "2010-04-19T06:28:39.000+0000",
                    "updated": "2010-04-19T06:28:39.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40118",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=qr123de",
                        "name": "qr123de",
                        "displayName": "Bob Marley",
                        "active": true
                    },
                    "body": "I just to a look on your fixed code.\r\n\r\nMaybe, you also should free the second statment on\/after line 467.\r\n\r\n\r\n{{\/\/ Discover primary key column(s) for this table.}}\r\n{{$primaryKeysResult = $stmt->fetchAll(Zend_Db::FETCH_NUM);}}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=qr123de",
                        "name": "qr123de",
                        "displayName": "Bob Marley",
                        "active": true
                    },
                    "created": "2010-04-19T06:35:15.000+0000",
                    "updated": "2010-04-19T06:35:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40119",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=juokaz",
                        "name": "juokaz",
                        "displayName": "Juozas Kaziukenas",
                        "active": false
                    },
                    "body": "Sqlsrv adapter uses sqlsrv driver, which requirements are here http:\/\/msdn.microsoft.com\/en-US\/library\/cc296170(v=SQL.90).aspx But that comment now confused me as in all texts 2005 is referenced as lowest version supported. \r\n\r\nLet me get back to you after I speak with Ashay.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=juokaz",
                        "name": "juokaz",
                        "displayName": "Juozas Kaziukenas",
                        "active": false
                    },
                    "created": "2010-04-19T06:41:51.000+0000",
                    "updated": "2010-04-19T06:41:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41918",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=qr123de",
                        "name": "qr123de",
                        "displayName": "Bob Marley",
                        "active": true
                    },
                    "body": "isnt fixed in 1.10.7\r\n\r\nmy patch\r\n\r\npublic function describeTable($tableName, $schemaName = null)\r\n    {\r\n        \/**\r\n         * Discover metadata information about this table.\r\n         *\/\r\n        $sql    = \"exec sp_columns @table_name = \" . $this->quoteIdentifier($tableName, true);\r\n        $stmt   = $this->query($sql);\r\n        $result = $stmt->fetchAll(Zend_Db::FETCH_NUM);\r\nunset($stmt);\r\n\t\t\r\n        $owner           = 1;\r\n        $table_name      = 2;\r\n        $column_name     = 3;\r\n        $type_name       = 5;\r\n        $precision       = 6;\r\n        $length          = 7;\r\n        $scale           = 8;\r\n        $nullable        = 10;\r\n        $column_def      = 12;\r\n        $column_position = 16;\r\n\r\n        \/**\r\n         * Discover primary key column(s) for this table.\r\n         *\/\r\n        $tableOwner = $result[0][$owner];\r\n        $sql        = \"exec sp_pkeys @table_owner = \" . $tableOwner\r\n                    . \", @table_name = \" . $this->quoteIdentifier($tableName, true);\r\n        $stmt       = $this->query($sql);\r\nunset($stmt);\r\n\t\t\r\n        $primaryKeysResult = $stmt->fetchAll(Zend_Db::FETCH_NUM);\r\n        $primaryKeyColumn  = array();\r\n\r\n        \/\/ Per http:\/\/msdn.microsoft.com\/en-us\/library\/ms189813.aspx,\r\n        \/\/ results from sp_keys stored procedure are:\r\n        \/\/ 0=TABLE_QUALIFIER 1=TABLE_OWNER 2=TABLE_NAME 3=COLUMN_NAME 4=KEY_SEQ 5=PK_NAME\r\n\r\n        $pkey_column_name = 3;\r\n        $pkey_key_seq     = 4;\r\n        foreach ($primaryKeysResult as $pkeysRow) {\r\n            $primaryKeyColumn[$pkeysRow[$pkey_column_name]] = $pkeysRow[$pkey_key_seq];\r\n        }\r\n\r\n        $desc = array();\r\n        $p    = 1;\r\n        foreach ($result as $key => $row) {\r\n            $identity = false;\r\n            $words    = explode(' ', $row[$type_name], 2);\r\n            if (isset($words[0])) {\r\n                $type = $words[0];\r\n                if (isset($words[1])) {\r\n                    $identity = (bool) preg_match('\/identity\/', $words[1]);\r\n                }\r\n            }\r\n\r\n            $isPrimary = array_key_exists($row[$column_name], $primaryKeyColumn);\r\n            if ($isPrimary) {\r\n                $primaryPosition = $primaryKeyColumn[$row[$column_name]];\r\n            } else {\r\n                $primaryPosition = null;\r\n            }\r\n\r\n            $desc[$this->foldCase($row[$column_name])] = array(\r\n                'SCHEMA_NAME'      => null, \/\/ @todo\r\n                'TABLE_NAME'       => $this->foldCase($row[$table_name]),\r\n                'COLUMN_NAME'      => $this->foldCase($row[$column_name]),\r\n                'COLUMN_POSITION'  => (int) $row[$column_position],\r\n                'DATA_TYPE'        => $type,\r\n                'DEFAULT'          => $row[$column_def],\r\n                'NULLABLE'         => (bool) $row[$nullable],\r\n                'LENGTH'           => $row[$length],\r\n                'SCALE'            => $row[$scale],\r\n                'PRECISION'        => $row[$precision],\r\n                'UNSIGNED'         => null, \/\/ @todo\r\n                'PRIMARY'          => $isPrimary,\r\n                'PRIMARY_POSITION' => $primaryPosition,\r\n                'IDENTITY'         => $identity,\r\n            );\r\n        }\r\n\r\n        return $desc;\r\n    }\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=qr123de",
                        "name": "qr123de",
                        "displayName": "Bob Marley",
                        "active": true
                    },
                    "created": "2010-08-09T01:05:35.000+0000",
                    "updated": "2010-08-09T01:05:35.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7698\/transitions"
}