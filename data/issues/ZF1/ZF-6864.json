{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6864",
    "key": "ZF-6864",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Plugin Broker increases memory usage when Zend_Layout is enabled"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6864\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-11-13T03:15:33.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=federico.cargnelutti",
                "name": "federico.cargnelutti",
                "displayName": "fc",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-05-30T03:54:20.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-11-13T04:05:28.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When Zend_Layout is enabled, the response gets copied in different places. This causes the memory usage to increase depending on the size of the page, controllers dispatched and, maybe, plugins registered. \r\n\r\nIt only happens after an action controller is dispatched. You can debug it by adding print_r($this->_plugins) to the Zend_Controller_Plugin_Broker::postDispatch() method, or, after the front controller dispatches the request:\r\n\r\n{php}\r\n$dispatcher->dispatch($this->_request, $this->_response);\r\nprint_r($this->_plugins);\r\n{php}\r\n\r\nI would suggest not storing an instance of the front controller in Zend_Layout_Controller_Action_Helper and Zend_Controller_Action. And once that's done, focusing on the Zend_Controller_Plugin_Broker::setResponse() method, who's responsible for looping through all the plugins and setting the response.\r\n\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6864\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10270",
                    "id": 10270,
                    "description": "Mini Release",
                    "name": "1.7.1",
                    "userReleaseDate": "01\/Dec\/08",
                    "archived": false,
                    "releaseDate": "2008-12-01",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10320",
                    "id": 10320,
                    "description": "Minor Release",
                    "name": "1.9.0",
                    "userReleaseDate": "31\/Jul\/09",
                    "archived": false,
                    "releaseDate": "2009-07-31",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10011",
                    "id": 10011,
                    "name": "Zend_Controller",
                    "description": "front controller, including router and dispatcher",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10270",
                    "id": 10270,
                    "name": "Zend_Layout",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33289",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "Can you maybe point out where the response object is copied (and thus cloned? I don't see it.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-08-07T09:48:12.000+0000",
                    "updated": "2009-08-07T09:48:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33382",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "I'm closing this issue as incomplete. Please note that assigning an object two other object does NOT copy it, but merely assigns (as the verb 'assigning' suggests). An object gets only copied when using the CLONE statement.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-08-11T08:12:49.000+0000",
                    "updated": "2009-08-11T08:12:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35952",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=federico.cargnelutti",
                        "name": "federico.cargnelutti",
                        "displayName": "fc",
                        "active": true
                    },
                    "body": "Hi, \r\n\r\nWhy did you close this issue? You did the same thing with another issue I reported (http:\/\/framework.zend.com\/issues\/browse\/ZF-7105) without understanding what the problem was.\r\n\r\nWhat I'm reporting here has nothing to do with cloning objects. You can reproduce this by enabling the layout and adding  \r\n\r\nprint_r($this->_plugins); die;\r\n\r\nto the Front Controller after it dispatches the request (ZF 1.7.1, Line 934 \/ ZF 1.9.0 Line 946).\r\n\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=federico.cargnelutti",
                        "name": "federico.cargnelutti",
                        "displayName": "fc",
                        "active": true
                    },
                    "created": "2009-11-12T02:54:11.000+0000",
                    "updated": "2009-11-12T02:54:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35959",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "I closed the issue because I did ask you a relevant question, and until now there's still not been given any answer, while that answer is critical for identifying the issue. What the closing of issues is concerned; whenever I close an issue without writing a fix and committing that to trunk, I always discuss on IRC with other ZF contributors to make sure I'm not the only one who thinks it's worth closing. That goes for this issue as well as #ZF-7105.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-11-12T06:46:18.000+0000",
                    "updated": "2009-11-12T06:46:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35961",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "After having discussed this once again on IRC (sigh), we decided you should really point out where any (response) object is copied (file\/methodnames\/etc). If there's no response given within 24 hours, I will close this issue (indefinitely, I hope).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-11-12T07:12:49.000+0000",
                    "updated": "2009-11-12T07:12:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35964",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "Reassigning as discussed.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-11-12T08:34:55.000+0000",
                    "updated": "2009-11-12T08:34:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35968",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Federico, you're missing something important.\r\n\r\nObjects are passed by reference. Storing the reference takes essentially no new memory.\r\n\r\nHowever, when you perform operations such as print_r, var_dump, or var_export, or analyse object structures in xdebug\/zend debugger... you're now reproducing the entire object tree and dumping it. This leads to things like circular references -- which is what is consuming memory.\r\n\r\nThe better way to test this is to determine the amount of memory usage after a request is complete using memory_get_peak_usage() (and *not* utilizing print_r, var_dump, or var_export during the request). If you can verify that memory consumption is substantially different in that case, we can examine it more closely.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-11-12T10:20:15.000+0000",
                    "updated": "2009-11-12T10:20:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35985",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=federico.cargnelutti",
                        "name": "federico.cargnelutti",
                        "displayName": "fc",
                        "active": true
                    },
                    "body": "> If there's no response given within 24 hours, I will close this issue (indefinitely, I hope).\r\n\r\nDolf, can you stop talking about closing issues please. You are obsessed with closing issues. Not reading them, closing them. This is an issue tracker! We are here to analyze problems, discuss solutions, contribute ideas and share findings. If you don't care about a specific problem or you don't understand it, move to the next one. But don't close it mate.\r\n\r\n\r\n\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=federico.cargnelutti",
                        "name": "federico.cargnelutti",
                        "displayName": "fc",
                        "active": true
                    },
                    "created": "2009-11-13T02:17:22.000+0000",
                    "updated": "2009-11-13T02:17:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35992",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Federico, can you reply to my comment, please?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-11-13T04:05:28.000+0000",
                    "updated": "2009-11-13T04:05:28.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6864\/transitions"
}