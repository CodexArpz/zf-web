{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2224",
    "key": "ZF-2224",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Behavior of Zend_Validate_Abstract::setMessage() and Zend_Validate_EmailAddress doesn't work as expected"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2224\/votes",
                "votes": 3,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/5",
                "name": "Cannot Reproduce"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10310",
                    "id": 10310,
                    "description": "Mini Release",
                    "name": "1.8.1",
                    "userReleaseDate": "12\/May\/09",
                    "archived": false,
                    "releaseDate": "2009-05-12",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-04-25T09:51:07.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thetiger2k",
                "name": "thetiger2k",
                "displayName": "Ulrich Berkm\u00fcller",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-11-21T10:08:20.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-11-16T14:05:58.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "In the following scenario, i want to check an email address for validity and show the user only a single message that the email address which was entered is invalid.\n(this validator was used in combination with Zend_Filter_Input where the 'messages' => '...' key in the array is ignored in that case)\n\n{noformat}\n        $emailToCheck = 'foo@bar.com)'; \/\/ note the ')'\n\n        $emailValidator = new Zend_Validate_EmailAddress();\n        $emailValidator->setMessage('Please enter a valid email address.');\n\n        $valid = $emailValidator->isValid($emailToCheck);\n        var_dump($valid);\n        if (!$valid) {\n            var_dump($emailValidator->getMessages());\n        }\n{noformat}\n\nI didn't set any key for the messages so I expected that all error messages are set to my specific error message but when I looked at the implementation of Zend_Validate_Abstract::setMessage(), only the first message key gets that message:\n\n{noformat}\npublic function setMessage($messageString, $messageKey = null)\n{\n        if ($messageKey === null) {\n            $keys = array_keys($this->_messageTemplates);\n            $messageKey = current($keys);\n        }\n        [...]\n}\n{noformat}\n\nSo I would expect that I can set all messages to my defined error message but neither setMessage() nor setMessages() has this implemented.\n\nThe next problem is located in the Zend_Validate_EmailAddress validator, where the hostname validator passes all messages and errors to the  to Zend_Validate_EmailAddress validator:\n{noformat}\n        $hostnameResult = $this->hostnameValidator->isValid($this->_hostname);\n        if (!$hostnameResult) {\n            $this->_error(self::INVALID_HOSTNAME);\n\n            \/\/ Get messages and errors from hostnameValidator\n            foreach ($this->hostnameValidator->getMessages() as $message) {\n                $this->_messages[] = $message;\n            }\n            foreach ($this->hostnameValidator->getErrors() as $error) {\n                $this->_errors[] = $error;\n            }\n        }\n{noformat}\n\nThere is no possibility to break the chain at any place to only get one single user defined error message when the hostname was invalid."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2224\/watchers",
                "isWatching": false,
                "watchCount": 7
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-10690",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10690",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10130",
                    "id": 10130,
                    "description": "Mini Release",
                    "name": "1.0.2",
                    "userReleaseDate": "25\/Sep\/07",
                    "archived": true,
                    "releaseDate": "2007-09-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10140",
                    "id": 10140,
                    "name": "Zend_Validate",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18643",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Each validation class can emit multiple messages, each of which corresponding to a cause for validation failure. A validation failure may indeed be caused by more than one reason, and this is why validation classes can emit multiple messages. There is no method in the public API to change all of the validation failure messages to a single message because this would obfuscate the reasons for validation failure. These reasons are not necessarily intended for display to users, however, and this is where the confusion seems to be.\n\nOf course, you may only want to show a single, consolidated validation failure message to your end users, and this is a common and perfectly valid use case.\n\nIt should be simple to implement in at least one of the following ways:\n\n* If you use the validation class with composition, you can detect whether a validation failure has occurred and display whatever message you want to users.\n* Extend the validation class and perform the message consolidation there.\n* Try Zend_Form for consolidating validation failure messages for display to users.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2008-01-29T09:28:00.000+0000",
                    "updated": "2008-01-29T09:28:00.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18644",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Reducing priority to minor, since an easy workaround should be present.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2008-01-29T09:29:14.000+0000",
                    "updated": "2008-01-29T09:29:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21158",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Please evaluate and categorize\/assign as necessary.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-04-18T16:55:03.000+0000",
                    "updated": "2008-04-18T16:55:03.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21438",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=andries",
                        "name": "andries",
                        "displayName": "Andries Seutens",
                        "active": true
                    },
                    "body": "The validation failure messages are *not really meant for user consumption*. However, I undestand that a lot of people are using them this way.\n\nI suggest that we create 2 new methods:\n\n{code}\n\n$validator = new Zend_Validate_StringLength(2);\n\n$validator->setUserMessage(\n    'Your firstname should be at least 2 characters long',\n    Zend_Validate_StringLength::TOO_SHORT);\n\nif (!$validator->isValid('A')) {\n    $messages = $validator->getUserMessages();\n    echo current($messages);\n\n    \/\/ echoes \"Your firstname should be at least 2 characters long\"\n}\n{code}\n\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=andries",
                        "name": "andries",
                        "displayName": "Andries Seutens",
                        "active": true
                    },
                    "created": "2008-04-24T08:42:26.000+0000",
                    "updated": "2008-04-24T08:42:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21439",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=andries",
                        "name": "andries",
                        "displayName": "Andries Seutens",
                        "active": true
                    },
                    "body": "I would also like to note that it would be nice if created a special constant that overrides *all* error messages. This is particulary usefull for the email validator:\n\n{code}\n$validator->setUserMessage(\n    'Your email address it not valid'\n    Zend_Validate::OVERRIDE_ALL);\n{code}\n\nthis would override *all* error messages in the stack.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=andries",
                        "name": "andries",
                        "displayName": "Andries Seutens",
                        "active": true
                    },
                    "created": "2008-04-24T08:44:42.000+0000",
                    "updated": "2008-04-24T08:44:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29200",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=travisp",
                        "name": "travisp",
                        "displayName": "Travis Pew",
                        "active": true
                    },
                    "body": "It seems strange to state that the validation failure messages are \"not really meant for user consumption\" given that Zend_Form by default renders these messages in the form when validation fails and that Zend_Validate automatically will use Zend_Translate if set in the registry to translate its messages for the user.  \n\nIn particular, the inability to set a single error message breaks the ability to quickly and easily add a Text form element that uses the EmailAddress validator and have a single message such as \"Invalid e-mail address\" be provided by Zend_Translate.  For example, if one sets all of the error messages to \"Invalid e-mail address\", \"Invalid e-mail address\" will appear 3 times when a user enters the email address \"test@!\".\n\nThe \"easy\" workaround for the developer is of course to extend Zend_Validate_EmailAddress (and every other validation class that can output multiple methods) to consolidate error messages after Zend_Validate_EmailAddress' isValid() function is called.  However, it seems to be a very common use case to want to display a single simple error message to the user (and there have been a number of questions about this exact problem).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=travisp",
                        "name": "travisp",
                        "displayName": "Travis Pew",
                        "active": true
                    },
                    "created": "2009-02-27T11:57:20.000+0000",
                    "updated": "2009-02-27T11:57:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29202",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "When you want to display a single error from an failed validation use setError() on the form element.\nThis has nothing to do with the bahaviour or the messages returned from the element itself and is only related to the form which is being displayed to the user.\n\nAnother way is to define the messages option on the form element which does the same.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-02-27T12:28:33.000+0000",
                    "updated": "2009-02-27T12:28:33.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30419",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Closing issue as setErrorMessage does exactly what was described as problem in this issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-04-25T09:51:05.000+0000",
                    "updated": "2009-04-25T09:51:05.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2224\/transitions"
}