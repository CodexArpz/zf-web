{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8413",
    "key": "ZF-8413",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Output view filter applied twice"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8413\/votes",
                "votes": 2,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gixx",
                "name": "gixx",
                "displayName": "Gabor Ivan",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-11-28T06:22:46.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-05-30T04:46:39.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When I use Zend_Layout and Zend_View, the Filters added to the View are applied twice: first for the view script and second for the layout script no matters whether I set it in the Bootstrap, or in the Resource (with config file).\r\n\r\nI think it should run only when the whole output is generated (that is why its name is output filter).\r\n\r\nUnfortately there's no publicated, viewable test page, so I write as much info as needed.\r\nThe problem came up in the following case:\r\n\r\n\u2014 application.ini ------------------------------------\r\nresources.view.encoding = \"UTF-8\"\r\nresources.view.scriptPath = APPLICATION_PATH \"\/views\"\r\nresources.view.helperPath.My_View_Helper = APPLICATION_PATH \"\/library\/My\/View\/Helper\"\r\nresources.view.filterPath.My_View_Filter = APPLICATION_PATH \"\/library\/My\/View\/Filter\"\r\nresources.view.filter[] = \"Copyright\"\r\n\r\nresources.layout.layout = \"masterPage\"\r\nresources.layout.layoutPath = APPLICATION_PATH \"\/views\/layouts\"\r\n\r\n\u2014 library\/My\/View\/Filter\/Copyright.php --------------\r\nclass My_View_Filter_Copyright implements Zend_Filter_Interface{\r\n  public function filter($value){\r\n    return $value.'<!-- Copyright 2009. -->';\r\n \r\n  }\r\n}\r\n\r\n--- masterPage.phtml -----------------------------------\r\n<html>\r\n  <body>\r\n    <?php echo $this->layout()->content; ?>\r\n  <\/body>\r\n<\/html>\r\n\r\n\r\n--- index.phtml --------------------------------------\r\n    <h1>Hi!<\/h1>\r\n\r\n\r\n\u2014 output ---------------------------------------------\r\n<html>\r\n  <body>\r\n    <h1>Hi!<\/h1><!-- Copyright 2009. -->\r\n  <\/body>\r\n<\/html><!-- Copyright 2009. -->"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8413\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10390",
                    "id": 10390,
                    "description": "Mini Release",
                    "name": "1.9.6",
                    "userReleaseDate": "24\/Nov\/09",
                    "archived": false,
                    "releaseDate": "2009-11-24",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10270",
                    "id": 10270,
                    "name": "Zend_Layout",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10026",
                    "id": 10026,
                    "name": "Zend_View",
                    "description": "View portion of the ZF MVC",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36551",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Detaching Zend_Filter from the affected components.\r\nZend_Filter is not the reason why filters are applied twice.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-11-28T08:03:02.000+0000",
                    "updated": "2009-11-28T08:03:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36552",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "Since both the view Zend_App resource plugin as well as the layout resource plugin only pass the options on to resp. Zend_View and Zend_Layout, this is not a bug in Zend_Application_Resource_Layout. Therefore I'm -deassigning (why does my spellchecker not recognize that word?)- revoking the zend_application_resouce component and myself as assignee.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-11-28T08:19:35.000+0000",
                    "updated": "2009-11-28T08:22:00.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50859",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=k4200",
                        "name": "k4200",
                        "displayName": "Kazuo KASHIMA",
                        "active": true
                    },
                    "body": "For those looking for a fix, here's a quick patch. Tested briefly in ZF 1.11.10\r\nI'm pretty new to ZF, so there should be a better way.\r\n\r\n--- Zend\/Layout.php.org 2012-05-30 13:31:21.207926764 +0900\r\n+++ Zend\/Layout.php     2012-05-30 13:31:23.843942826 +0900\r\n@@ -782,6 +782,7 @@\r\n         }\r\n \r\n         $view = $this->getView();\r\n+        $view->setFilter(null);\r\n \r\n         if (null !== ($path = $this->getViewScriptPath())) {\r\n             if (method_exists($view, 'addScriptPath')) {\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=k4200",
                        "name": "k4200",
                        "displayName": "Kazuo KASHIMA",
                        "active": true
                    },
                    "created": "2012-05-30T04:46:39.000+0000",
                    "updated": "2012-05-30T04:46:39.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8413\/transitions"
}