{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12284",
    "key": "ZF-12284",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Http_UserAgent_Features_Adapter_WurflApi Sends Persistence Information using WURFL_Configuration_InMemoryConfig to WURFL_WURFLManagerFactory incorrectly"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12284\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-10-24T15:49:52.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=henryhayes",
                "name": "henryhayes",
                "displayName": "Henry Hayes",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2012-06-12T14:35:52.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-10-24T15:49:52.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When using the {{INI}} configuration method and using the {{Zend_Application_Resource_UserAgent}} resource loader to initialise {{Zend_Http_UserAgent}} to use {{Zend_Http_UserAgent_Features_Adapter_WurflApi}}; the persistence params are sent through incorrectly.\r\n\r\n{code}\r\nresources.useragent.wurflapi.wurfl_api_version = \"1.1\"\r\nresources.useragent.wurflapi.wurfl_lib_dir = APPLICATION_PATH \"\/..\/library\/Wurfl\/\"\r\nresources.useragent.wurflapi.wurfl_config_array.wurfl.main-file = APPLICATION_PATH \"\/..\/data\/wurfl\/wurfl.zip\"\r\nresources.useragent.wurflapi.wurfl_config_array.wurfl.patches = APPLICATION_PATH \"\/..\/data\/wurfl\/web_browsers_patch.xml\"\r\nresources.useragent.wurflapi.wurfl_config_array.persistence.provider = \"File\"\r\n\r\nresources.useragent.wurflapi.wurfl_config_array.persistence.dir  = APPLICATION_PATH \"\/..\/data\/wurfl\/cache\/\"\r\n\r\nresources.useragent.wurflapi.wurfl_config_array.cache.provider = \"Null\"\r\nresources.useragent.storage.adapter = \"Zend_Http_UserAgent_Storage_NonPersistent\"\r\n{code}\r\n\r\nThe line of code above that causes the problem is:\r\n\r\n{code}\r\nresources.useragent.wurflapi.wurfl_config_array.persistence.dir  = APPLICATION_PATH \"\/..\/data\/wurfl\/cache\/\"\r\n\/\/ This is completely ignored:\r\nresources.useragent.wurflapi.wurfl_config_array.persistence.expiration  = 3600\r\n{code}\r\n\r\nThis is sent through to line 85 of {{Zend_Http_UserAgent_Features_Adapter_WurflApi}} as {{$c['persistence']['dir']}} and is a string. When this is passed though to {{WURFL_Configuration_InMemoryConfig::persistence()}} it is of course a string. However {{WURFL_Configuration_InMemoryConfig::persistence()}} expects it to be an array with a key of {\"dir\"}, e.g. {{array('dir'=>'\/temp\/my-dir\/wurfl\/cache\/');}} Also, the \"expiration\" field is not taken into account at all, meaning that we cannot set an \"expiration\" time for an adaptor\/provider.\r\n\r\nThere is a workaround for this by defining the {{dir}} as follows, and some people have done as follows:\r\n\r\n{code}\r\nresources.useragent.wurflapi.wurfl_config_array.persistence.dir.dir  = APPLICATION_PATH \"\/..\/data\/wurfl\/cache\/\"\r\nresources.useragent.wurflapi.wurfl_config_array.persistence.dir.expiration  = 3600\r\n{code}\r\n\r\nMy patch below amends this to be in-keeping with what seems to be Zend Framework Config conventions in using a \"params\" array. This patch also takes into account those who have used the workaround above and so backward compatible and will not break people's code who have already used the workaround above.\r\n\r\nPatch is suggested as follows:\r\n\r\nINI File Contents:\r\n\r\n{code}\r\nresources.useragent.wurflapi.wurfl_config_array.persistence.params.dir  = APPLICATION_PATH \"\/..\/data\/wurfl\/cache\/\"\r\nresources.useragent.wurflapi.wurfl_config_array.persistence.params.expiration  = 3600\r\n{code}\r\n\r\n{{Zend_Http_UserAgent_Features_Adapter_WurflApi}} Patch (Line 80)\r\n\r\nExisting:\r\n\r\n{code}\r\n} elseif (!empty($config['wurfl_config_array'])) {\r\n    $c            = $config['wurfl_config_array'];\r\n    $wurflConfig  = new WURFL_Configuration_InMemoryConfig();\r\n    $wurflConfig->wurflFile($c['wurfl']['main-file'])\r\n                ->wurflPatch($c['wurfl']['patches'])\r\n                ->persistence($c['persistence']['provider'], $c['persistence']['dir']);\r\n}\r\n{code}\r\n\r\nProposed:\r\n\r\n{code}\r\n} elseif (!empty($config['wurfl_config_array'])) {\r\n    $c            = $config['wurfl_config_array'];\r\n    $wurflConfig  = new WURFL_Configuration_InMemoryConfig();\r\n    $wurflConfig->wurflFile($c['wurfl']['main-file'])\r\n                ->wurflPatch($c['wurfl']['patches']);\r\n    $persistence = array();\r\n    if (array_key_exists('dir', $c['persistence']) {\r\n        if (is_string($c['persistence']['dir']) {\r\n            $persistence['dir'] = $c['persistence']['dir'];\r\n        } elseif (is_array($c['persistence']['dir'])) {\r\n            $persistence = array_merge($persistence, $c['persistence']['dir']);\r\n        }\r\n    }\r\n    if (array_key_exists('params', $c['persistence']) {\r\n        $persistence = array_merge($persistence, $c['persistence']['params']);\r\n    }\r\n    $wurflConfig->persistence($c['persistence']['provider'], $persistence);\r\n}\r\n{code}\r\n\r\nThis patch allows total backward compatibility, and fix the bug. And so any of the following combinations will work:\r\n\r\n\"dir\" as a string:\r\n\r\n{code}\r\nresources.useragent.wurflapi.wurfl_config_array.persistence.dir  = APPLICATION_PATH \"\/..\/data\/wurfl\/cache\/\"\r\nresources.useragent.wurflapi.wurfl_config_array.persistence.params.expiration  = 3600\r\n{code}\r\n\r\nOld workaround, \"dir\" array:\r\n\r\n{code}\r\nresources.useragent.wurflapi.wurfl_config_array.persistence.dir.dir  = APPLICATION_PATH \"\/..\/data\/wurfl\/cache\/\"\r\nresources.useragent.wurflapi.wurfl_config_array.persistence.dir.expiration  = 3600\r\n{code}\r\n\r\nNew \"params\" array:\r\n\r\n{code}\r\nresources.useragent.wurflapi.wurfl_config_array.persistence.params.dir  = APPLICATION_PATH \"\/..\/data\/wurfl\/cache\/\"\r\nresources.useragent.wurflapi.wurfl_config_array.persistence.params.expiration  = 3600\r\n{code}\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12284\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frosch",
                "name": "frosch",
                "displayName": "Frank Br\u00fcckner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-10795",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10795",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10981",
                    "id": 10981,
                    "description": "Mini Release",
                    "name": "1.11.11",
                    "userReleaseDate": "29\/Sep\/11",
                    "archived": false,
                    "releaseDate": "2011-09-29",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10500",
                    "id": 10500,
                    "name": "Zend_Http_UserAgent",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51076",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=henryhayes",
                        "name": "henryhayes",
                        "displayName": "Henry Hayes",
                        "active": true
                    },
                    "body": "I noticed, after I submitted this issue, that there is already a bug in place for this.\r\n\r\nhttp:\/\/framework.zend.com\/issues\/browse\/ZF-10795\r\n\r\nHowever, as I mentioned above, the patch above is more comprehensive and is backward compatible for those who may have used the workaround mentioned.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=henryhayes",
                        "name": "henryhayes",
                        "displayName": "Henry Hayes",
                        "active": true
                    },
                    "created": "2012-06-12T16:06:50.000+0000",
                    "updated": "2012-06-12T16:06:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51079",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frosch",
                        "name": "frosch",
                        "displayName": "Frank Br\u00fcckner",
                        "active": true
                    },
                    "body": "Hi Henry,\r\nto accept your patch you must fill out the [CLA|http:\/\/framework.zend.com\/cla] and add a patch (as file) with unit tests to this issue.\r\n\r\nThanks!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frosch",
                        "name": "frosch",
                        "displayName": "Frank Br\u00fcckner",
                        "active": true
                    },
                    "created": "2012-06-12T16:47:26.000+0000",
                    "updated": "2012-06-12T16:48:31.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52146",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=henryhayes",
                        "name": "henryhayes",
                        "displayName": "Henry Hayes",
                        "active": true
                    },
                    "body": "There's not really much point as Wurfl support has been removed from ZF as of version 1.12 - See this thread here:\r\n\r\nhttp:\/\/www.websitefactors.co.uk\/php\/2012\/06\/zend-useragent-wurfl-explained\/\r\n\r\nAlso, I have written a comprehensive guide to getting the Browscap running using your application ini:\r\n\r\nhttp:\/\/www.websitefactors.co.uk\/zend-framework\/2012\/06\/zend-framework-useragent-browscap-implementation\/\r\n\r\nI'll request that this is now closed.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=henryhayes",
                        "name": "henryhayes",
                        "displayName": "Henry Hayes",
                        "active": true
                    },
                    "created": "2012-10-24T07:35:18.000+0000",
                    "updated": "2012-10-24T07:35:18.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12284\/transitions"
}