{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6576",
    "key": "ZF-6576",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Filter_File_Rename getNewName parameters (Bit of Zend_Transfer_Adapter_Http too)"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6576\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10310",
                    "id": 10310,
                    "description": "Mini Release",
                    "name": "1.8.1",
                    "userReleaseDate": "12\/May\/09",
                    "archived": false,
                    "releaseDate": "2009-05-12",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-05-08T04:36:16.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=oximoron",
                "name": "oximoron",
                "displayName": "Harro van der Klauw",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-05-08T00:47:43.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-06-11T05:13:24.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "Adapter",
                "Element",
                "File",
                "Filter",
                "Form",
                "Http",
                "Rename",
                "Transfer"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "In 1.8.0 Beta you would get the original filename in the getNewName function, in the 1.8.0 release it was changed to the temporary name.\n\nSo currently we have extended the Zend_Filter_File_Rename because we want to apply our own naming scheme to the uploaded files, But we still need to know the original files extension to do this. Before we got the original filename and could use that, now we get the temporary name, which on Windows includes a .tmp extension and on linux doesn't have an extension at all.\n\nAt the point where the function get's called (in the Zend_Transfer_Adapter_Http line 163) the $this->_files property hasn't been set yet. We could do it in a hackish way and get the information from $_FILES, but I much rather have all the information available to the function at that point.\n\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/6",
                "name": "N\/A"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6576\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10241",
                    "id": 10241,
                    "description": "Minor Release",
                    "name": "1.8.0",
                    "userReleaseDate": "30\/Apr\/09",
                    "archived": false,
                    "releaseDate": "2009-04-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10013",
                    "id": 10013,
                    "name": "Zend_Filter",
                    "description": "methods for filtering data",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30762",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "According to API the getNetName() returns the new name of a filtered file without moving it.\nIt's an undocumented internal method and a preparation for an improvement of this filter.\n\nAnother point is, that Zend_Filter_File_Rename does not know about original, new or old names.\nThis informations are stored within Zend_File_Transfer.\n\nTo get the old name simply call getFileName() BEFORE calling getValues() or receive().\nCalling it afterwards return the new set filename.\n\nThe filter is definetly the wrong point to get file informations.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-05-08T02:14:46.000+0000",
                    "updated": "2009-05-08T02:14:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30763",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=oximoron",
                        "name": "oximoron",
                        "displayName": "Harro van der Klauw",
                        "active": true
                    },
                    "body": "Never mind.. I'm an idiot !",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=oximoron",
                        "name": "oximoron",
                        "displayName": "Harro van der Klauw",
                        "active": true
                    },
                    "created": "2009-05-08T02:16:52.000+0000",
                    "updated": "2009-05-08T02:16:52.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31740",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "body": "Hello Thomas,\n\nI Am facing the same issue as Haro will trying to move from *ZF* *1.6*  to *1.8* \nI had extended  *Zend_Filter_File_Rename* because I wanted my own naming scheme. \n\nBut now *Zend_Transfer_Adapter_Http* line 163 call the  Zend_Filter_File_Rename::getNewName() with the temp name. Why such change ?\n\nAnd I 'cant use the solution you describe above because I'm using Zend_Form and everything is seamless handle by Zend_Form\n\nSo right now I'm stuck. The only solution I found is patching Zend_Transfer_Adapter_Http. which is not nice. \nWhat do you suggest ?  \n\nThanks",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "created": "2009-06-11T02:56:11.000+0000",
                    "updated": "2009-06-11T02:56:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31757",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "body": "Ok,\n\n I found that even if my filter is named Mmx_Filter_File_AutoRename, it get catch by Zend_Transfer_Adapter_Http::getFilter('Rename') on line 161\nOr if it wasn't catch *$filename = $rename->getNewName($content['tmp_name']);* wouldn't be called directly and my AutoRename will work has usual.\n\nI see 2 solutions :\n\n\n*1)* So what about to be more restrictive on the regex line 1468 in Zend_Transfer_Adapter_Abstract::_getFilterIdentifier($name) so Mmx_Filter_File_Rename would match and not Mmx_Filter_File_AutoRename\n\nthis change will do the trick\n\n{code}\n      foreach (array_keys($this->_filters) as $test) {\n            if (preg_match('\/_' . preg_quote($name) . '$\/i', $test)) {\n                return $test;\n            }\n        }\n{code}\n\nAnd it could also avoid some weird thing  \n\n*2)*  after  get Zend_Transfer_Adapter_Http::getFilter('Rename') called make sure the filter is Zend_Filter_File_Rename  like so\n\n{code}\n           $rename   = $this->getFilter('Rename');\n                if ($rename !== null && 'Zend_Filter_File_Rename' == get_class($rename)) {\n                    $filename = $rename->getNewName($content['tmp_name']);\n                    $key      = array_search(get_class($rename), $this->_files[$file]['filters']);\n                    unset($this->_files[$file]['filters'][$key]);\n                }\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "created": "2009-06-11T03:40:45.000+0000",
                    "updated": "2009-06-11T03:40:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31758",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "When you have the same problem as Harro then also the solution is the same.\n\nTo get the original name you have to store it before calling the rename filter.\nBefore the rename filter is called the original name is returned by getFileName, afterwards the new filename is returned.\n\nAccording to Zend_Filter_File_Rename: This feature was integrated with 1.8 to allow the rename filter to be integrated with Zend_File_Transfer. Otherwise Zend_File_Transfer would have no way to know how the rename filter wants to rename the files. There were several bugs related to this.\n\nPS: Zend_Transfer does not exist.\n\nExtending Zend_Filter_File_Rename correct would work. But patching Zend_File_Transfer_Adapter_Http to 1.6 again is the wrong way. This introduces again several bugs which have been fixed.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-06-11T03:42:22.000+0000",
                    "updated": "2009-06-11T03:42:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31767",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "body": "{quote}\nWhen you have the same problem as Harro then also the solution is the same.\n{quote}\nWell, my question is different (how about with zend_form ?) so i guess the solution could be different.\n\n{quote}\nTo get the original name you have to store it before calling the rename filter.\nBefore the rename filter is called the original name is returned by getFileName, afterwards the new filename is returned.\n{quote}\n\nSo I need to do all kind of tricking stuff to have it working with Zend_Form and it is not what I want.\n\n{quote}\nExtending Zend_Filter_File_Rename correct would work.\n{quote}\nYes it would work but right now it won't if the filter name end by \"Rename\" (AutoRename, MyCustomeRename, etc...)\nhave you consider one of my fix in my previous message for that ?\n\nThanks",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=laurent+melmoux",
                        "name": "laurent melmoux",
                        "displayName": "Laurent Melmoux",
                        "active": true
                    },
                    "created": "2009-06-11T05:13:24.000+0000",
                    "updated": "2009-06-11T05:13:24.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6576\/transitions"
}