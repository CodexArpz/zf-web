{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2614",
    "key": "ZF-2614",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "findDependentRowset(...)  bugs in loop"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2614\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10320",
                    "id": 10320,
                    "description": "Minor Release",
                    "name": "1.9.0",
                    "userReleaseDate": "31\/Jul\/09",
                    "archived": false,
                    "releaseDate": "2009-07-31",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-07-17T13:58:41.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mathi",
                "name": "mathi",
                "displayName": "Mathieu Decaffmeyer",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-02-11T12:46:15.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-07-31T20:27:30.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I use findDependentRowset for each Zend_Db_Table_Row_Abstract object of my fetchAll query.\nSince 1.5 version, the sql queries are wrong if I add the third parameter.\n\nI logged the queries via the profiler :\n\nWithout third parameter :\nSELECT\n\t`photos_article`.`id_photo`,\n\t`photos_article`.`path`,\n\t`photos_article`.`article_id`\nFROM `photos_article`\nWHERE\n\t(`article_id` = 1)\n***********************\nSELECT\n\t`photos_article`.`id_photo`,\n\t`photos_article`.`path`,\n\t`photos_article`.`article_id`\nFROM `photos_article`\nWHERE\n\t(`article_id` = 2)\n........\n\nWith third parameter (see code below) :\nSELECT\n\t`photos_article`.*\nFROM `photos_article`\nWHERE\n\t(to_delete = 0)\n\tAND (`article_id` = '1')\n**************************\nSELECT\n\t`photos_article`.*\nFROM `photos_article`\nWHERE\n\t(to_delete = 0)\n\tAND (`article_id` = '1')\n\tAND (`article_id` = '2')   <----- This will never work\n........\n\n\n\nHere is the code in my application:\n\n$articles = new Articles();   \/\/ <- extends Zend_Db_Table_Abstract\n$myArticles = $articles->fetchAll($where, $order);\n\n$articlePhotos = new ArticlePhotos();   \/\/ <- extends Zend_Db_Table_Abstract\n$selectPhotos= $articlePhotos->select()->where('to_delete = ?', 0);\n\nforeach ($myArticles as $article) {\n   [...]\n   echo $article->findDependentRowset('ArticlePhotos', null, $selectPhotos)->count();\n   [...]\n} \n\n\nthe problem is located on line 813 in file Zend_Db_Table_Row_Abstract :\n$select->where(\"$dependentColumn = ?\", $value, $type);\n\na solution could be ( probably stupid :) ) :\n$selectTmp = clone $select;\n$selectTmp->where(\"$dependentColumn = ?\", $value, $type);\nthen it works"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/customFieldOption\/10040",
                "value": " Nice to Have"
            }
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2614\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10050",
                    "id": 10050,
                    "description": "Minor Release Candidate",
                    "name": "1.6.0RC2",
                    "userReleaseDate": "11\/Aug\/08",
                    "archived": true,
                    "releaseDate": "2008-08-11",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10133",
                    "id": 10133,
                    "name": "Zend_Db_Table",
                    "description": "Lightweight OO interface to database tables and rowsets.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19417",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Unsetting 'fix version priority' until this issue is reviewed. Setting correct 'affects version'.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-02-25T14:00:48.000+0000",
                    "updated": "2008-02-25T14:00:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19421",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "OK, I've identified the bug and the cause within Zend_Db_Select. I'll investigate a fix shortly - the 'major' fix priority is warranted.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2008-02-25T16:34:19.000+0000",
                    "updated": "2008-02-25T16:34:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21753",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mathi",
                        "name": "mathi",
                        "displayName": "Mathieu Decaffmeyer",
                        "active": true
                    },
                    "body": "Hello, may I know when this major bug will approximatively be resolved ? Thank you for any info.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mathi",
                        "name": "mathi",
                        "displayName": "Mathieu Decaffmeyer",
                        "active": true
                    },
                    "created": "2008-05-15T03:20:36.000+0000",
                    "updated": "2008-05-15T03:20:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22572",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "I'm inclined not to be treating this as a bug. It's a known behaviour for objects to be passed by reference.\n\nIn your example, you could remove the issue simply by re-ordering your query to:-\n{code}$articles = new Articles(); \/\/ <- extends Zend_Db_Table_Abstract\n$myArticles = $articles->fetchAll($where, $order);\n\n$articlePhotos = new ArticlePhotos(); \/\/ <- extends Zend_Db_Table_Abstract\n\nforeach ($myArticles as $article) {\n    $selectPhotos= $articlePhotos->select()->where('to_delete = ?', 0);\n    [...]\n    echo $article->findDependentRowset('ArticlePhotos', null, $selectPhotos)->count();\n    [...]\n}{code}\n\nUnless there's a particularly critical reason that this behaviour is undesirable, I'll be marking this as 'won't fix'",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2008-06-19T04:56:17.000+0000",
                    "updated": "2008-06-19T04:56:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22974",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mathi",
                        "name": "mathi",
                        "displayName": "Mathieu Decaffmeyer",
                        "active": true
                    },
                    "body": "It was narural for me to create the WHERE clause before the loop as it was the same for each iteration.\nIf there are specific reasons that it needs to be passed by reference, well then close this bug.\nThank you",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mathi",
                        "name": "mathi",
                        "displayName": "Mathieu Decaffmeyer",
                        "active": true
                    },
                    "created": "2008-07-22T07:47:14.000+0000",
                    "updated": "2008-07-22T07:47:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/27802",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "No action on this issue for too long. I'm reassigning to Ralph for re-evaluation and categorization.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2009-01-06T10:51:44.000+0000",
                    "updated": "2009-01-06T10:51:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/27989",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Will evaluate this within 2 weeks.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2009-01-10T11:15:41.000+0000",
                    "updated": "2009-01-10T11:15:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32676",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "When using Zend_Db_Table_Select objects, they are typically passed by reference, and in using them, their state is typically changed (this is the nature of Zend_Db_Table_Select to fill in the from part when it needs to).\n\nSince this is the case, its best that if you want to reuse such objects, you clone them first.  This will preserve their state inside the table consuming them.\n\n-ralph",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2009-07-17T13:58:39.000+0000",
                    "updated": "2009-07-17T13:58:39.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2614\/transitions"
}