{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2779",
    "key": "ZF-2779",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "chmod in Zend_Search_Lucene_Storage_Directory_Filesystem causes problems"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2779\/votes",
                "votes": 5,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10240",
                    "id": 10240,
                    "description": "Minor Release",
                    "name": "1.6.0",
                    "userReleaseDate": "02\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-02",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-07-25T08:47:18.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=drewb",
                "name": "drewb",
                "displayName": "Drew Bertola",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-03-01T16:12:30.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-01-21T06:45:02.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "[reference issue ZF-1429]\nOnly file owners can chmod files.  Since the apache user is usually a restricted user, with no shell, it's difficult to fire off cron jobs to update indexes out of band.  This means that typically another user should do this.  But the other user needs to take over ownership of the index files, and in that case, apache can no longer read the indexes and search breaks.\n\nI don't see a problem with ZSL checking to see if the files are writable because that level of permission can be assigned to a group (apache user + indexer user).  In that case, search only needs to check if the files are readable, no?\n\nI haven't seen any reason for ZSL to chmod files (am I missing something?), and doing so breaks good OS admin practices.\n\n\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/customFieldOption\/10037",
                "value": "   Must Have"
            }
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2779\/watchers",
                "isWatching": false,
                "watchCount": 5
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                "name": "alexander",
                "displayName": "Alexander Veremyev",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-1429",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1429",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-3500",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3500",
                    "type": {
                        "name": "Duplicate",
                        "direction": "OUTBOUND",
                        "description": "duplicates"
                    }
                },
                {
                    "issueKey": "ZF-2744",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2744",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11331",
                    "filename": "Zend_Search_Lucene_Storage_Directory_Filesystem.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fterrasson",
                        "name": "fterrasson",
                        "displayName": "Fabrice Terrasson",
                        "active": true
                    },
                    "created": "2008-06-12T00:50:45.000+0000",
                    "size": 1089,
                    "mimeType": "text\/x-diff",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11331\/Zend_Search_Lucene_Storage_Directory_Filesystem.patch"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11708",
                    "filename": "Zend_Search_Lucene_Storage_Directory_Filesystem.RL.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robert",
                        "name": "robert",
                        "displayName": "Robert Lemke",
                        "active": true
                    },
                    "created": "2009-01-21T06:45:00.000+0000",
                    "size": 1029,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11708\/Zend_Search_Lucene_Storage_Directory_Filesystem.RL.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10170",
                    "id": 10170,
                    "description": "Mini Release",
                    "name": "1.0.4",
                    "userReleaseDate": "26\/Feb\/08",
                    "archived": true,
                    "releaseDate": "2008-02-26",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10021",
                    "id": 10021,
                    "name": "Zend_Search_Lucene",
                    "description": "pure PHP robust, general purpose text search engine",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19630",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "body": "File privileges are changed only at a file creation time. That guarantees we have current user as file owner at chmod() call time.\n\nRight privileges for new files can be specified using Zend_Search_Lucene_Storage_Directory_Filesystem::setDefaultFilePermissions($mode) call (http:\/\/framework.zend.com\/manual\/en\/zend.search.lucene.index-creation.html#zend.search.lucene.index-creation.permissions).\n\nThis method should be used if someone wants to override default index files permissions (e.g. give read access only for owner). That may be necessary for some cases.\n\n\nProbably I don't see where the problem is.  Please describe it in more details.\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2008-03-05T16:59:57.000+0000",
                    "updated": "2008-03-05T16:59:57.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19631",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mfischer",
                        "name": "mfischer",
                        "displayName": "Markus Fischer",
                        "active": true
                    },
                    "body": "[copied comment from ZF-1429]\n\n\n\nPlease reconsider your thoughts on forcing the use of chmod.\n\nIn restrictive environments it is completely valid that a non-owner of the lucene index files has proper write permissions to write but still is not owner. And, as you're ware, chmod can only be issued by the owner of the files. Group ownership is not considered.\n\nI would strongly advice to remove this patch in its entirety. Zend_Search_Lucene should not deal with permission in anyway itself. This should be left to the environment it is running in, and especially under Unix systems this is easily done by making sure the proper umask is set.\n\nIf this is not an option, please at least consider the ability to disable the call to chmod().\n\nHere is an example scenario of mine:\nThe index is created from a non www-data user. When I do this and access the index from within the web, I get\n\nError: chmod(): Operation not permitted in includes\/Zend\/Search\/Lucene\/Storage\/Directory\/Filesystem.php on line 189\n#0 includes\/Zend\/Search\/Lucene\/LockManager.php(85): Zend_Search_Lucene_Storage_Directory_Filesystem->createFile('read.lock.file')\n#1 includes\/Zend\/Search\/Lucene.php(410): Zend_Search_Lucene_LockManager::obtainReadLock(Object(Zend_Search_Lucene_Storage_Directory_Filesystem))\n#2 includes\/App\/Search.php(252): Zend_Search_Lucene->__construct('\/var\/www\/netcar...')\n#3 http\/suche\/index2.php(59): App_Search->search('milbe', 0)\n#4 {main}\n\nHowever, there's actually no technical reason why a chmod() call is needed here. The permissions are completely fine as they're and it should not concern the web application that it is not the owner of some of the files. Still the write permissions to create the file are there.\n\nthanks\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mfischer",
                        "name": "mfischer",
                        "displayName": "Markus Fischer",
                        "active": true
                    },
                    "created": "2008-03-05T17:07:28.000+0000",
                    "updated": "2008-03-05T17:07:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19637",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "body": "Aha! I see.\n\nThe problem is in the several files used for index access synchronization. These files may be recreated (also by index 'readers'). All other index files are not updated during their lifetime, so chmod() is applied only to just created files and shouldn't make a problem in the case you described.\n\nReasons not to use chmod() at all are clear. But I am not sure we have other ways to provide right (user defined) permissions for index files.\numask is applied to all files created by application and non-index files permissions may differ from what we need for index files. In addition to this umask() usage may cause problems under multithreaded environment (http:\/\/www.php.net\/manual\/en\/function.umask.php) :(\n\nI see only one use case for applying different permissions to index files now. It's giving or restricting index read\/write access for everyone... but, I think, we need these possibilities.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2008-03-05T17:46:24.000+0000",
                    "updated": "2008-03-05T17:46:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19759",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mfischer",
                        "name": "mfischer",
                        "displayName": "Markus Fischer",
                        "active": true
                    },
                    "body": "Thanks for your reply, good to see this issue hasn't fell of the radar ;)\n\nWhat if setting up proper permissions is just left out completely of Z_S_L? I mean in the whole Java Lucene library there isn't a single bit of permission handling code. Why do we need it in PHP?\n\nI didn't mean that Z_S_L should take care of the umask from within PHP but the environment under which Z_S_L is operating should do so. There's probably a real-life problem with my suggestion I don't see (and why this change from ZF-1429 has been introduced) but I can't see this limits.\n\nthanks",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mfischer",
                        "name": "mfischer",
                        "displayName": "Markus Fischer",
                        "active": true
                    },
                    "created": "2008-03-07T17:24:25.000+0000",
                    "updated": "2008-03-07T17:24:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/20248",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Please categorize\/fix as needed.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-03-25T20:31:42.000+0000",
                    "updated": "2008-03-25T20:31:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22203",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fterrasson",
                        "name": "fterrasson",
                        "displayName": "Fabrice Terrasson",
                        "active": true
                    },
                    "body": "Got the same issue stated at response #2 (Markus Fischer - 05\/Mar\/08 05:07 PM). Another user created Lucene index but web search form query prints :\n\nexception 'Zend_Search_Lucene_Exception' with message 'chmod() [function.chmod]: Operation not permitted' in \/home\/fabrice\/library\/Zend\/Search\/Lucene\/Storage\/Directory\/Filesystem.php:189\nStack trace:\n#0 \/home\/fabrice\/library\/Zend\/Search\/Lucene\/LockManager.php(85): Zend_Search_Lucene_Storage_Directory_Filesystem->createFile('read.lock.file')\n#1 \/home\/fabrice\/library\/Zend\/Search\/Lucene.php(410): Zend_Search_Lucene_LockManager::obtainReadLock(Object(Zend_Search_Lucene_Storage_Directory_Filesystem))\n#2 \/home\/fabrice\/library\/Zend\/Search\/Lucene.php(186): Zend_Search_Lucene->__construct('\/home\/fabrice\/p...', false)\n#3 \/home\/fabrice\/public_html\/fabrice-tests\/minisite\/application\/default\/controllers\/RechercheController.php(34): Zend_Search_Lucene::open('\/home\/fabrice\/p...')\n#4 \/home\/fabrice\/library\/Zend\/Controller\/Action.php(502): RechercheController->indexAction()\n#5 \/home\/fabrice\/library\/Zend\/Controller\/Dispatcher\/Standard.php(293): Zend_Controller_Action->dispatch('indexAction')\n#6 \/home\/fabrice\/library\/Zend\/Controller\/Front.php(914): Zend_Controller_Dispatcher_Standard->dispatch(Object(Zend_Controller_Request_Http), Object(Zend_Controller_Response_Http))\n#7 \/home\/fabrice\/public_html\/fabrice-tests\/minisite\/html\/index.php(101): Zend_Controller_Front->dispatch()\n#8 {main}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fterrasson",
                        "name": "fterrasson",
                        "displayName": "Fabrice Terrasson",
                        "active": true
                    },
                    "created": "2008-06-09T08:03:43.000+0000",
                    "updated": "2008-06-09T08:03:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22309",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fterrasson",
                        "name": "fterrasson",
                        "displayName": "Fabrice Terrasson",
                        "active": true
                    },
                    "body": "Tristan Celder sent me this patch, thanks him !",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fterrasson",
                        "name": "fterrasson",
                        "displayName": "Fabrice Terrasson",
                        "active": true
                    },
                    "created": "2008-06-12T00:50:46.000+0000",
                    "updated": "2008-06-12T00:50:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22864",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jablko",
                        "name": "jablko",
                        "displayName": "Jack Bates",
                        "active": true
                    },
                    "body": "Our project is glad to use Zend_Search_Lucene: http:\/\/code.google.com\/p\/qubit-toolkit\/\n\n- however we also encountered this issue: http:\/\/groups.google.com\/group\/qubit-dev\/browse_thread\/thread\/b664af4613eda0a8\n\nIn our case, it is an exception if we cannot read \/ write to one of the index files, but if we can read \/ write to the file, it is not an exception if we cannot chmod() it.\n\nSince normally all the files in our project have the correct permissions, though they may be owned by a user other than Apache, I think it would solve our problem if, in the case that chmod() fails, Zend_Search_Lucene only threw an exception if the file permissions did not already match $_defaultFilePermissions",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jablko",
                        "name": "jablko",
                        "displayName": "Jack Bates",
                        "active": true
                    },
                    "created": "2008-07-12T19:46:52.000+0000",
                    "updated": "2008-07-12T19:46:52.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23065",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "body": "Fixed.\n\nThenks for all for really productive discussion around the problem!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2008-07-25T08:47:18.000+0000",
                    "updated": "2008-07-25T08:47:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24129",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Updating for the 1.6.0 release.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-09-02T10:39:30.000+0000",
                    "updated": "2008-09-02T10:39:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28359",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robert",
                        "name": "robert",
                        "displayName": "Robert Lemke",
                        "active": true
                    },
                    "body": "The current solution still gives us some headaches because in the development context of our application even PHP notices are converted into exceptions (with good reason) and if the app is used via CLI and web, we've got a problem.\n\nSo, why not add a check for the file owner? See the second patch for a version which works for us.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robert",
                        "name": "robert",
                        "displayName": "Robert Lemke",
                        "active": true
                    },
                    "created": "2009-01-21T06:44:30.000+0000",
                    "updated": "2009-01-21T06:44:30.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2779\/transitions"
}