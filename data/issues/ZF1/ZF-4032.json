{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4032",
    "key": "ZF-4032",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Paginator DBselect adapter not propperly counting rows when using DISTINCT()"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4032\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10201",
                    "id": 10201,
                    "description": "Mini Release",
                    "name": "1.6.1",
                    "userReleaseDate": "15\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-15",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-08-22T14:01:42.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dae",
                "name": "dae",
                "displayName": "Dae Daluz",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-08-22T07:34:12.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-08-17T22:04:02.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When using the Zend_Paginator_Adapter_DBselect() on a select statement as such;\n\n$select = $this->db->select()\n->from(\"IPLog\", \"DISTINCT(IP)\");\n\nor \n\n$select = $this->db->select()\n->from(\"IPLog\", \"IP\")\n->DISTINCT(true);\n\nthe counting of rows goes wrong, since in my case there's 2 unique IP's in the table, but I get 43 since there's 43 rows in total. This causes my paginator controls to show more pages then there really are. The problem seems to be that the count() method of the DBselect adapter resets the columns, without checking for result limitting expressions.\n\n\n\/\/update;\n\nThanks updating to latest svn and using the group by did the trick, doesn't work with 1.6.0RC2 though, so any change made after that did the trick."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4032\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                "name": "norm2782",
                "displayName": "Jurrien Stutterheim",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10050",
                    "id": 10050,
                    "description": "Minor Release Candidate",
                    "name": "1.6.0RC2",
                    "userReleaseDate": "11\/Aug\/08",
                    "archived": true,
                    "releaseDate": "2008-08-11",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10315",
                    "id": 10315,
                    "name": "Zend_Paginator",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23583",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "body": "Could you please try this with the latest version from the SVN? There have been a lot of improvements to the DbSelect adapter since RC2.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "created": "2008-08-22T07:37:21.000+0000",
                    "updated": "2008-08-22T07:37:21.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23584",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "body": "I've managed to write a fix for this for the simple usecase where you would want to select only one column. Full support for multiple columns is somewhat more complicated. Please note that I've not committed the fix just yet.\n\nAn alternate solution is to use GROUP BY instead of DISTINCT, so I'm inclined to use that fact as a solution to this issue. What would be a usecase where DISTINCT is preferred over GROUP BY?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "created": "2008-08-22T08:44:41.000+0000",
                    "updated": "2008-08-22T08:44:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23591",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "body": "Resolved in revision 10981",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "created": "2008-08-22T14:01:42.000+0000",
                    "updated": "2008-08-22T14:01:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25372",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=regilero",
                        "name": "regilero",
                        "displayName": "Regis Leroy",
                        "active": true
                    },
                    "body": "For me this is not completly fixed (tested with 1.6.1).\nI had to change a distinct in Group By for a query  using several tables where one off the fields of the select were present in several tables of the request.\nI obtained something like:\n  SELECT COUNT(DISTINCT ce_fiche_id,ce_fiche_foo,ce_fiche_bar) AS zend_paginator_row_count FROM `ce_fiche`\n  LEFT JOIN `ce_suivi_fiche` ON `ce_suivi_fiche`.ce_fiche_id = `ce_fiche`.ce_fiche_id \n WHERE ....\n==> this count query cannot work because ce_fiche_id is ambigous. \nInitial query was of this form (simplified, more complex in reality and getting the group by working was not so simple):\n  SELECT DISTINCT `ce_fiche`.`ce_fiche_id` AS `Id`, \n `ce_fiche`.`ce_fiche_foo` AS `foo`, \n `ce_fiche`.`ce_fiche_bar` AS `Bar`,\n FROM `ce_fiche` \n LEFT JOIN `ce_suivi_fiche` ON `ce_suivi_fiche`.ce_fiche_id = `ce_fiche`.ce_fiche_id \n ORDER BY 1 ASC LIMIT 10;\n\nweel, why removing table names?\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=regilero",
                        "name": "regilero",
                        "displayName": "Regis Leroy",
                        "active": true
                    },
                    "created": "2008-10-23T16:27:36.000+0000",
                    "updated": "2008-10-23T16:27:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47991",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vguyard",
                        "name": "vguyard",
                        "displayName": "GUYARD Vincent",
                        "active": true
                    },
                    "body": "The bug is still here !!!\r\n\r\nThe query below is an example :\r\n\r\n    \t$query = parent::select(true)->setIntegrityCheck(false)->distinct(true)\r\n    \t\t->from(array('fu1'=>$this->_name), null)\r\n    \t\t\t->join(array('b'=>Model_Table_Blabla::$name), 'b.facebook_uid = fu1.facebook_uid', null)\r\n    \t\t\t->join(array('v'=>Model_Table_Vote::$name), 'v.id_blabla = b.id_blabla', null)\r\n    \t\t\t->join(array('fu2'=>$this->_name), 'v.facebook_uid = fu2.facebook_uid')\r\n    \t\t\t\t->where('fu1.facebook_uid = ?', $array['facebook_user']->getFacebookUid());",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vguyard",
                        "name": "vguyard",
                        "displayName": "GUYARD Vincent",
                        "active": true
                    },
                    "created": "2011-08-17T22:04:02.000+0000",
                    "updated": "2011-08-17T22:04:02.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4032\/transitions"
}