{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11717",
    "key": "ZF-11717",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Corrupt index files with Zend_Search_Lucene"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11717\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jcardona",
                "name": "jcardona",
                "displayName": "Jordi Cardona",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-09-02T12:46:07.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-09-06T08:53:19.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "After several attempts to index data coming from a DB I always obtain the following Exception:\r\n\r\nFatal error: Uncaught exception 'Zend_Search_Lucene_Exception' with message 'Error occured while file reading.' in \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Storage\/File\/Filesystem.php:174\r\nStack trace:\r\n#0 \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Storage\/File.php(471): Zend_Search_Lucene_Storage_File_Filesystem->_fread(33554431)\r\n#1 \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Index\/SegmentMerger.php(203): Zend_Search_Lucene_Storage_File->readBinary()\r\n#2 \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Index\/SegmentMerger.php(126): Zend_Search_Lucene_Index_SegmentMerger->_mergeStoredFields()\r\n#3 \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Index\/Writer.php(385): Zend_Search_Lucene_Index_SegmentMerger->merge()\r\n#4 \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Index\/Writer.php(341): Zend_Search_Lucene_Index_Writer->_mergeSegments(Array)\r\n#5 \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Index\/Writer.php(250): Zend_Search_Luce in \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Storage\/File\/Filesystem.php on line 174\r\n\r\n\r\nNotice the the param in the _fread call causing the exception is always 33554431 (which I believe is the data in the index file causing the corruption when merging). In the tries the exception is not always in the same set of data (as the data is changing) but is very likely that it happens more or less after the same amount of data sets are read from DB.\r\n\r\nThe indexing is made by a separate program and is not concurrent (i.e: is the only process writing the index and there is no other neither writing nor reading from index files).\r\n\r\nWhen trying to optimize the index the following is obtained:\r\n\r\nFatal error: Uncaught exception 'Zend_Search_Lucene_Exception' with message 'Error occured while file reading.' in \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Storage\/File\/Filesystem.php:174\r\nStack trace:\r\n#0 \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Storage\/File.php(471): Zend_Search_Lucene_Storage_File_Filesystem->_fread(33554431)\r\n#1 \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Index\/SegmentMerger.php(203): Zend_Search_Lucene_Storage_File->readBinary()\r\n#2 \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Index\/SegmentMerger.php(126): Zend_Search_Lucene_Index_SegmentMerger->_mergeStoredFields()\r\n#3 \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Index\/Writer.php(385): Zend_Search_Lucene_Index_SegmentMerger->merge()\r\n#4 \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Index\/Writer.php(807): Zend_Search_Lucene_Index_Writer->_mergeSegments(Array)\r\n#5 \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene.php(1456): Zend_Search_Lucene_Index_Wri in \/usr\/local\/ZendFramework-1.11.10\/library\/Zend\/Search\/Lucene\/Storage\/File\/Filesystem.php on line 174\r\n\r\nI've downloaded lucene-2.9.4 and run Check.Index on the index file and while it recovers the index (by deleting several hundreds of docuemnts) the resulting index files are in a format not (yet, I hope) understood by Zend Framework.\r\n\r\nMy Zend Framework is 1.11.10.\r\n\r\nMy PHP is 5.3.6 with the following modules compiled in:\r\n\r\n[PHP Modules]\r\nCore\r\nctype\r\ncurl\r\ndate\r\ndom\r\nereg\r\nfileinfo\r\nfilter\r\ngd\r\ngettext\r\nhash\r\niconv\r\njson\r\nlibxml\r\nmbstring\r\nmhash\r\nmysqli\r\nopenssl\r\npcntl\r\npcre\r\nPDO\r\npdo_mysql\r\npdo_sqlite\r\nPhar\r\nposix\r\nReflection\r\nrrdtool\r\nsession\r\nSimpleXML\r\nsockets\r\nSPL\r\nSQLite\r\nsqlite3\r\nstandard\r\ntidy\r\ntokenizer\r\nxml\r\nxmlreader\r\nxmlwriter\r\nzip\r\nzlib\r\n\r\nFinally, I found that at least 1 document what misidentified as being UTF-8 encoded but really it was ISO-8859-1. All documents were indexed as being UTF-8. Enforcing a hard encoding identification seems to have solved the problem. As documents were downloaded from the Internet it is unwise to trust given document encoding.\r\n\r\nWhereas programmer should assure the documents are properly encoded I do really believe that some kind of check\/fix index files should be provided inside the framework as relying in other tools (i.e: Lucene core pack) could recover the corrupted index files but leave them in a format not (yet) handled by the Framework.\r\n\r\n\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11717\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                "name": "alexander",
                "displayName": "Alexander Veremyev",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10980",
                    "id": 10980,
                    "description": "Mini Release",
                    "name": "1.11.10",
                    "userReleaseDate": "04\/Aug\/11",
                    "archived": false,
                    "releaseDate": "2011-08-04",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10021",
                    "id": 10021,
                    "name": "Zend_Search_Lucene",
                    "description": "pure PHP robust, general purpose text search engine",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [

            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11717\/transitions"
}