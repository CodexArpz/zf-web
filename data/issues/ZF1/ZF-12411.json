{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12411",
    "key": "ZF-12411",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Cache_Frontend_Page . Whitelist for Superglobals to be used when making the cacheid."
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12411\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/8",
                "name": "Issue Moved"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2013-04-05T16:07:18.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fruske",
                "name": "fruske",
                "displayName": "Frank Ruske",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2012-09-08T19:52:31.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2013-04-05T16:07:19.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Hi,\r\n\r\nI had the following problem when working with Zend_Cache_Frontend_Page:\r\n\r\nWe have a multilingual webseite. The user gets the webseite displayed based on a language cookie set on his client.\r\nFor this reason we have to use the COOKIE values to generate the hash id else only one language version would be cached.\r\n\r\nWhen using the Fullpage Cache it was not enough for us to generate the Key based on the _COOKIE superglobal using this options:\r\n\r\n{code}\r\nfrontend.options.regexps.1.make_id_with_cookie_variables = true\r\nfrontend.options.default_options.cache_with_cookie_variables = true\r\n{code}\r\n\r\nThe problem here is that there are also other COOKIES (or superglobals) which may change with every request but are totally irelevant for our full page cache.\r\nFor example Google Analytics changes it COOKIE values every request. Thus there was 0% Cache hits.\r\n\r\nI have implemented a whitelist to use together with Zend_Cache_Frontend_Page.\r\n\r\nFind below my adjustments. Maybe you can consider using it, if not maybe anyone else will run into the same problem.\r\n\r\nIn Zend_Cache_Frontend_Page:\r\n{code}\r\n    protected $_specificOptions = array(\r\n        'http_conditional' => false,\r\n        'debug_header' => false,\r\n        'content_type_memorization' => false,\r\n        'memorize_headers' => array(),\r\n        'default_options' => array(\r\n            'cache_with_get_variables' => false,\r\n            'cache_with_post_variables' => false,\r\n            'cache_with_session_variables' => false,\r\n            'cache_with_files_variables' => false,\r\n            'cache_with_cookie_variables' => false,\r\n            'make_id_with_get_variables' => true,\r\n            'make_id_with_get_whitelist' => false, \/\/new option\r\n            'make_id_with_post_variables' => true,\r\n            'make_id_with_post_whitelist' => false, \/\/new option\r\n            'make_id_with_session_variables' => true,\r\n            'make_id_with_session_whitelist' => false, \/\/new option\r\n            'make_id_with_files_variables' => true,\r\n            'make_id_with_files_whitelist' => false,  \/\/new option\r\n            'make_id_with_cookie_variables' => true,\r\n            'make_id_with_cookie_whitelist' => false, \/\/new option\r\n            'cache' => true,\r\n            'specific_lifetime' => false,\r\n            'tags' => array(),\r\n            'priority' => null\r\n        ),\r\n        'regexps' => array()\r\n    );\r\n{code}\r\nZend_Cache_Frontend_Page::_makePartialId() got a new parameter $whitelist\r\n{code}\r\n    \/**\r\n     * Make a partial id depending on options\r\n     *\r\n     * @param  string $arrayName Superglobal array name\r\n     * @param  bool   $bool1     If true, cache is still on even if there are some variables in the superglobal array\r\n     * @param  bool   $bool2     If true, we have to use the content of the superglobal array to make a partial id\r\n     * @param  mixed  $whitelist  If an array with more then one index then only use the defined indexes to create cache\r\n     * @return string|false Partial id (string) or false if the cache should have not to be used\r\n     *\/\r\n    protected function _makePartialId($arrayName, $bool1, $bool2, $whitelist = false)\r\n    {\r\n        switch ($arrayName) {\r\n            case 'Get':\r\n                $var = $_GET;\r\n                break;\r\n            case 'Post':\r\n                $var = $_POST;\r\n                break;\r\n            case 'Session':\r\n                if (isset($_SESSION)) {\r\n                    $var = $_SESSION;\r\n                } else {\r\n                    $var = null;\r\n                }\r\n                break;\r\n            case 'Cookie':\r\n                if (isset($_COOKIE)) {\r\n                    $var = $_COOKIE;\r\n                } else {\r\n                    $var = null;\r\n                }\r\n                break;\r\n            case 'Files':\r\n                $var = $_FILES;\r\n                break;\r\n            default:\r\n                return false;\r\n        }\r\n        if ($bool1) {\r\n            if ($bool2) {\r\n                \/\/ We have a whitelist so only return the defined indexes.\r\n                if (true === is_array($whitelist) && count($whitelist) > 0) {\r\n                    $tmpArray = array();\r\n\r\n                    foreach ($whitelist as $index) {\r\n                        if (true === isset($var[$index])) {\r\n                            $tmpArray[$index] = $var[$index];\r\n                        }\r\n                    }\r\n\r\n                    if (count($tmpArray) > 0) {\r\n                        return serialize($tmpArray);\r\n                    }\r\n                    return '';\r\n                }\r\n\r\n                return serialize($var);\r\n            }\r\n            return '';\r\n        }\r\n        if (count($var) > 0) {\r\n            return false;\r\n        }\r\n        return '';\r\n    }\r\n{code}\r\n\r\n\r\nZend_Cache_Frontend_Page::_makeId() calls self::_makePartialId() and thus has to be adjusted too\r\n{code}\r\n    protected function _makeId()\r\n    {\r\n        $tmp = $_SERVER['REQUEST_URI'];\r\n\r\n        $array = explode('?', $tmp, 2);\r\n        $tmp = $array[0];\r\n        foreach (array('Get', 'Post', 'Session', 'Files', 'Cookie') as $arrayName) {\r\n\r\n            $tmp2 = $this->_makePartialId(\r\n                        $arrayName,\r\n                        $this->_activeOptions['cache_with_' . strtolower($arrayName) . '_variables'],\r\n                        $this->_activeOptions['make_id_with_' . strtolower($arrayName) . '_variables'],\r\n                        $this->_activeOptions['make_id_with_' . strtolower($arrayName) . '_whitelist']\r\n                    );\r\n\r\n            if ($tmp2===false) {\r\n                return false;\r\n            }\r\n\r\n            $tmp = $tmp . $tmp2;\r\n        }\r\n\r\n        return md5($tmp);\r\n    }\r\n{code}\r\n\r\n\r\nNow you can easly define which GET, POST, COOKIE,SERVER or FILES indexes should be used to generate the Cache id.\r\n\r\n{code}\r\n   frontend.options.regexps.1.make_id_with_cookie_variables = true\r\n    frontend.options.default_options.cache_with_cookie_variables = true\r\n    frontend.options.regexps.1.make_id_with_cookie_whitelist[] = \"languageCookie\"\r\n    frontend.options.regexps.1.make_id_with_cookie_whitelist[] = \"usernameCookie\"\r\n{code}\r\n\r\n\r\n\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12411\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "caching"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                "name": "alexander",
                "displayName": "Alexander Veremyev",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10028",
                    "id": 10028,
                    "name": "Zend_Cache",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/53525",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "This issue has been closed on Jira and moved to GitHub for issue tracking.  To continue following the resolution of this issues, please visit: https:\/\/github.com\/zendframework\/zf1\/issues\/14",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2013-04-05T16:07:19.000+0000",
                    "updated": "2013-04-05T16:07:19.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12411\/transitions"
}