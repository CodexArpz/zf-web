{
    "expand": "html",
    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-326",
    "key": "ZF-326",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "SMTP transport is not prepending dots to lines beginning with a dot"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-326\/votes",
                "votes": 3,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-01-18T21:31:19.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=konforce",
                "name": "konforce",
                "displayName": "Matthew Leverton",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2006-08-18T11:00:04.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-06-06T11:08:58.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Zend\/Mail\/Transport\/Smtp.php does not insert a leading dot for every line that begins with a dot.  I've quoted the RFC below.\n\nSee Section 4.5.2 of RFC 2821\n   -  Before sending a line of mail text, the SMTP client checks the\n      first character of the line.  If it is a period, one additional\n      period is inserted at the beginning of the line.\n\n   -  When a line of mail text is received by the SMTP server, it checks\n      the line.  If the line is composed of a single period, it is\n      treated as the end of mail indicator.  If the first character is a\n      period and there are other characters on the line, the first\n      character is deleted."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-326\/watchers",
                "isWatching": false,
                "watchCount": 5
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                "name": "peptolab",
                "displayName": "Simon Mundy",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-2074",
                    "issue": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2074",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/attachment\/10093",
                    "filename": "smtp-dot.diff",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=konforce",
                        "name": "konforce",
                        "displayName": "Matthew Leverton",
                        "active": true
                    },
                    "created": "2006-08-18T11:00:41.000+0000",
                    "size": 667,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/framework.zend.com\/issues\/secure\/attachment\/10093\/smtp-dot.diff"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/attachment\/10103",
                    "filename": "UPDATED-smtp-dot.diff",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2006-09-20T18:28:39.000+0000",
                    "size": 668,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/framework.zend.com\/issues\/secure\/attachment\/10103\/UPDATED-smtp-dot.diff"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/version\/10001",
                    "id": 10001,
                    "description": "Preview Release",
                    "name": "0.1.5",
                    "userReleaseDate": "11\/Jul\/06",
                    "archived": true,
                    "releaseDate": "2006-07-11",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/component\/10018",
                    "id": 10018,
                    "name": "Zend_Mail",
                    "description": "high-level utility to build MIME-compliant messages and send using a mail transport adapter",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/10718",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=konforce",
                        "name": "konforce",
                        "displayName": "Matthew Leverton",
                        "active": true
                    },
                    "body": "A patch to conform to the RFC.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=konforce",
                        "name": "konforce",
                        "displayName": "Matthew Leverton",
                        "active": true
                    },
                    "created": "2006-08-18T11:00:41.000+0000",
                    "updated": "2006-08-18T11:00:41.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/10859",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "I've updated the priority to Major, as this still has the potential to mangle emails (e.g. broken images) in rare situations.\n\nFurther to this, I discovered that Matthew Leverton's patch still wasn't catching a few examples of lines where the leading character was a '.'. I traced it back to the fact that Zend_Mail_Transport_Abstract defines a line end as '\/r\/n' whereas Zend_Mime was using '\/n' as a line end.\n\nSubstituting $this->EOL with Zend_Mime::LINEEND did the trick - here's the diff (and will attach separately):-\n\n===================================================================\n--- library\/Zend\/Mail\/Transport\/Smtp.php        (revision 1084)\n+++ library\/Zend\/Mail\/Transport\/Smtp.php        (working copy)\n@@ -187,10 +187,10 @@\n     {\n         $this->_send('DATA');\n         $this->_expect(354);\n-        foreach(explode($this->EOL, $data) as $line) {\n-            if ($line=='.') {\n+        foreach(explode(Zend_Mime::LINEEND, $data) as $line) {\n+            if (strpos($line, '.') === 0) {\n                 \/\/ important. replace single dot on a line\n-                $line='..';\n+                $line = '.' . $line;\n             }\n             $this->_send($line);\n         }\n\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2006-09-20T18:28:00.000+0000",
                    "updated": "2006-09-20T18:28:00.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/10860",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "Fixes erroneous detection of line endings",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2006-09-20T18:28:39.000+0000",
                    "updated": "2006-09-20T18:28:39.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11705",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Scheduling for 0.7.0 release.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2006-11-28T17:51:46.000+0000",
                    "updated": "2006-11-28T17:51:46.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/15751",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=aren",
                        "name": "aren",
                        "displayName": "Aren Sandersen",
                        "active": true
                    },
                    "body": "This issue has regressed.  Simon's comments on 20 Sep still apply -- the \"foreach(explode($this->EOL, $data) as $line) { \" (now in Mail\/Protocol\/Smtp.php) is using self::EOL instead of Zend_Mime::LINEEND.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=aren",
                        "name": "aren",
                        "displayName": "Aren Sandersen",
                        "active": true
                    },
                    "created": "2007-07-11T16:40:23.000+0000",
                    "updated": "2007-07-11T16:40:23.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/15758",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Reopening on behalf of [~aren].",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-07-12T06:48:55.000+0000",
                    "updated": "2007-07-12T06:48:55.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/15796",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "I'm not quite sure why this was re-opened - the updated patch applies to Zend_Mail_Transport_Smtp, but for a long time now the handling of pre-prending the dot is carried out by Zend_Mail_Protocol_Smtp, and the code in data() definitely handles the 'dot' correctly.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2007-07-14T16:06:25.000+0000",
                    "updated": "2007-07-14T16:06:25.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/15810",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=aren",
                        "name": "aren",
                        "displayName": "Aren Sandersen",
                        "active": true
                    },
                    "body": "Zend_Mime's encodeQuotedPrintable() uses LINEND (\"\\n\")  as the line-break sequence, but Zend_Mail_Protocol_Smtp's data() method is looking for self::EOL (\"\\r\\n\") as line-breaks.  Since these don't match, newlines inserted as a result of quoted-printable encoding aren't detected properly and this issue happens.\n\nPlease re-open.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=aren",
                        "name": "aren",
                        "displayName": "Aren Sandersen",
                        "active": true
                    },
                    "created": "2007-07-15T20:14:26.000+0000",
                    "updated": "2007-07-15T20:14:26.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/15842",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "Further investigation of the issue by Aren Sandersen pointed to a logic error in Smtp components",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2007-07-17T05:50:18.000+0000",
                    "updated": "2007-07-17T05:50:18.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/15843",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "Resolution committed in SVN revision 5724 - please test and confirm the issue is fixed.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2007-07-17T05:52:33.000+0000",
                    "updated": "2007-07-17T05:52:33.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/15851",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=aren",
                        "name": "aren",
                        "displayName": "Aren Sandersen",
                        "active": true
                    },
                    "body": "Confirmed; my tests show the issue is fixed.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=aren",
                        "name": "aren",
                        "displayName": "Aren Sandersen",
                        "active": true
                    },
                    "created": "2007-07-17T15:26:25.000+0000",
                    "updated": "2007-07-17T15:26:25.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/15874",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=rhodesbud",
                        "name": "rhodesbud",
                        "displayName": "Todd Rhodes",
                        "active": true
                    },
                    "body": "This also fixed my missing dot issue, but seemed to introduce a new issue.  When I use setBodyHtml() and setBodyText() together to create the email, the resulting sent email only shows the text version with:\n\n'Content-Type: text\/plain; charset=\"iso-8859-1\"\nContent-Transfer-Encoding: quoted-printable'\n\ndisplayed at the top of the received email text.  The text version of the email is shown, not the html as would be expected.  In addition, long email text is mangled and interspersed with various line break characters.  \n\n\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=rhodesbud",
                        "name": "rhodesbud",
                        "displayName": "Todd Rhodes",
                        "active": true
                    },
                    "created": "2007-07-19T15:09:28.000+0000",
                    "updated": "2007-07-19T15:09:28.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/16033",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Fix version after 1.0.1.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-07-30T09:29:01.000+0000",
                    "updated": "2007-07-30T09:29:01.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/17405",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "Todd, can you please verify this behaviour occurs in release 1.0.2? If so, can you please attach new files to this issue with your code, the original message you are trying to send and - if possible - a dump of the resulting Zend_Mail object just before it is sent.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2007-11-05T19:50:44.000+0000",
                    "updated": "2007-11-05T19:50:44.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/18395",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "No further evidence of bug exists",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2008-01-18T21:31:19.000+0000",
                    "updated": "2008-01-18T21:31:19.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/47001",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=michal.bisco",
                        "name": "michal.bisco",
                        "displayName": "Michal Bi\u0161\u010do",
                        "active": true
                    },
                    "body": "The issue is still partially present in versions 1.11.6 and 1.11.0. It seems that only Windows environments are affected. The problem is in PHP mail function. It is mentioned in the official PHP documentation at http:\/\/php.net\/mail (caution text for \"message\" parameter).\r\n\r\nIs it possible to alter the current Zend_Mail_Transport_Smtp implementation, so it would consider this bug and the developer using Zend_Mail_Transport_Smtp would not need to worry about it?",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=michal.bisco",
                        "name": "michal.bisco",
                        "displayName": "Michal Bi\u0161\u010do",
                        "active": true
                    },
                    "created": "2011-06-06T11:08:58.000+0000",
                    "updated": "2011-06-06T11:08:58.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-326\/transitions"
}