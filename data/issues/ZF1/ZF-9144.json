{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9144",
    "key": "ZF-9144",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Locale_Data not handling alias\/inheritance rules correctly"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9144\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lsaferite",
                "name": "lsaferite",
                "displayName": "Lee Saferite",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-02-11T04:52:01.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T21:38:02.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Currently Zend_Locale_Data is incorrectly handling the <alias> element and the inheritance that it provides.  The current code does respect the <alias> element, but does not reset the locale code to the top of the chain when resolving the alias.  The means that an alias defined in the 'root' locale (root.xml) is only resolved agains data in the same locale, not the top-level locale like en_US or de_DE.  This bug is subtle in that you mostly never see it unless you depend on data that is using the <alias> elements. \r\n\r\nA concrete example of this is:\r\n\r\n{code}\r\nZend_Locale::getTranslationList('month', 'de_DE', array('gregorian', 'stand-alone', 'abbreviated'));\r\n{code}\r\n\r\nThis returns a mixed list of abbreviated months and numbers.  The reason for this is\r\n{code:title=\/Zend\/Locale\/Data\/de.xml}\r\n<monthContext type=\"stand-alone\">\r\n\t<monthWidth type=\"abbreviated\">\r\n\t\t<month type=\"3\">M\u00e4r<\/month>\r\n\t\t<month type=\"7\">Jul<\/month>\r\n\t\t<month type=\"8\">Aug<\/month>\r\n\t\t<month type=\"9\">Sep<\/month>\r\n\t\t<month type=\"10\">Okt<\/month>\r\n\t\t<month type=\"11\">Nov<\/month>\r\n\t\t<month type=\"12\">Dez<\/month>\r\n\t<\/monthWidth>\r\n<\/monthContext>\r\n{code}\r\n\r\n{code:title=\/Zend\/Locale\/Data\/root.xml}\r\n<monthContext type=\"stand-alone\">\r\n\t<monthWidth type=\"abbreviated\">\r\n\t\t<alias source=\"locale\" path=\"..\/..\/monthContext[@type='format']\/monthWidth[@type='abbreviated']\"\/>\r\n\t<\/monthWidth>\r\n<\/monthContext>\r\n{code}\r\n\r\nThe XML shown above SHOULD tell Zend_Locale_Data to pull any missing months using de_DE:monthContext[@type='format']\/monthWidth[@type='abbreviated'], but instead it pulls the missing months from root:monthContext[@type='format']\/monthWidth[@type='abbreviated']\r\n\r\nThis is a patch to my current 'fix' for the problem.  It's not the most elegant, but it seems to function properly.  I'm not 100% it is bug free, so YMMV.\r\n\r\n{code:title=Zend_Locale_Data.php patch}\r\ndiff --git a\/lib\/Zend\/Locale\/Data.php b\/lib\/Zend\/Locale\/Data.php\r\nindex f508b8f..d170c76 100644\r\n--- a\/lib\/Zend\/Locale\/Data.php\r\n+++ b\/lib\/Zend\/Locale\/Data.php\r\n@@ -132,7 +132,7 @@ class Zend_Locale_Data\r\n      * @throws Zend_Locale_Exception\r\n      * @access private\r\n      *\/\r\n-    private static function _findRoute($locale, $path, $attribute, $value, &$temp)\r\n+    private static function _findRoute($locale, $path, $attribute, $value, &$temp, $topLocale)\r\n     {\r\n         \/\/ load locale file if not already in cache\r\n         \/\/ needed for alias tag when referring to other locale\r\n@@ -192,7 +192,7 @@ class Zend_Locale_Data\r\n                         $locale = $source;\r\n                     }\r\n \r\n-                    $temp = self::_getFile($locale, $path, $attribute, $value, $temp);\r\n+                    $temp = self::_getFile($topLocale, $path, $attribute, $value, $temp, $topLocale);\r\n                     return false;\r\n                 }\r\n \r\n@@ -212,9 +212,14 @@ class Zend_Locale_Data\r\n      * @param  string $value\r\n      * @access private\r\n      *\/\r\n-    private static function _getFile($locale, $path, $attribute = false, $value = false, $temp = array())\r\n+    private static function _getFile($locale, $path, $attribute = false, $value = false, $temp = array(), $topLocale = null)\r\n     {\r\n-        $result = self::_findRoute($locale, $path, $attribute, $value, $temp);\r\n+       if(empty($topLocale))\r\n+       {\r\n+          $topLocale = $locale;\r\n+       }\r\n+\r\n+        $result = self::_findRoute($locale, $path, $attribute, $value, $temp, $topLocale);\r\n         if ($result) {\r\n             $temp = self::_readFile($locale, $path, $attribute, $value, $temp);\r\n         }\r\n@@ -228,9 +233,9 @@ class Zend_Locale_Data\r\n         if (($locale != 'root') && ($result)) {\r\n             $locale = substr($locale, 0, -strlen(strrchr($locale, '_')));\r\n             if (!empty($locale)) {\r\n-                $temp = self::_getFile($locale, $path, $attribute, $value, $temp);\r\n+                $temp = self::_getFile($locale, $path, $attribute, $value, $temp, $topLocale);\r\n             } else {\r\n-                $temp = self::_getFile('root', $path, $attribute, $value, $temp);\r\n+                $temp = self::_getFile('root', $path, $attribute, $value, $temp, $topLocale);\r\n             }\r\n         }\r\n         return $temp;\r\n{code}\r\n\r\nReference: [http:\/\/www.unicode.org\/reports\/tr35\/#Locale_Inheritance]"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9144\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10360",
                    "id": 10360,
                    "description": "Minor Release",
                    "name": "1.10.0",
                    "userReleaseDate": "27\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-27",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10073",
                    "id": 10073,
                    "name": "Zend_Locale",
                    "description": "Zend_Locale is a basic wrapper for all I18N and L10N issues for the Zend Framework. It provides the userbasically with access to translation functionality. It can handle different source file types for translation.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38400",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lsaferite",
                        "name": "lsaferite",
                        "displayName": "Lee Saferite",
                        "active": true
                    },
                    "body": "As an example, perhaps ticket ZF-6632 would be resolved with this fix since the rest of the data would be pulled in properly.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lsaferite",
                        "name": "lsaferite",
                        "displayName": "Lee Saferite",
                        "active": true
                    },
                    "created": "2010-02-11T05:02:08.000+0000",
                    "updated": "2010-02-11T05:02:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38479",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lsaferite",
                        "name": "lsaferite",
                        "displayName": "Lee Saferite",
                        "active": true
                    },
                    "body": "As a note, my patch has an opening for some form of recursion bug.  But, the base problem still remains and needs a proper solution.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lsaferite",
                        "name": "lsaferite",
                        "displayName": "Lee Saferite",
                        "active": true
                    },
                    "created": "2010-02-16T04:04:05.000+0000",
                    "updated": "2010-02-16T04:04:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38481",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "I know this and that's also the reason why I did not apply this patch after I added your patch internally.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-02-16T04:25:38.000+0000",
                    "updated": "2010-02-16T04:25:38.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9144\/transitions"
}