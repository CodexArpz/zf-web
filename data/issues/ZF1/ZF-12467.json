{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12467",
    "key": "ZF-12467",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Invalid controller name specified into request"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12467\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-11-16T16:31:37.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hqjatu",
                "name": "hqjatu",
                "displayName": "Jari Turkia",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2012-11-14T10:56:26.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T19:14:48.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "controller_name",
                "router"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "If user makes a mistake on accidentally enters incorrect controller, it is set into request as-is in Zend_Controller_Router_Rewrite::_setRequestParams(). However, in Zend_Controller_Dispatcher_Abstract::_formatName() there is a preg_replace('\/[^a-z0-9 ]\/', '') when forming the controller name.\r\n\r\nNow, in my code I cannot rely that controller name has been properly filtered, nor what the class name ended up to be!\r\n\r\nI'm currently studying the implications of rejecting illegal controller names or alternatively, silently accepting the filtering result."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12467\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dasprid",
                "name": "dasprid",
                "displayName": "Ben Scholzen",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10510",
                    "id": 10510,
                    "description": "Minor Release",
                    "name": "1.12.0",
                    "userReleaseDate": "27\/Aug\/12",
                    "archived": false,
                    "releaseDate": "2012-08-27",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10490",
                    "id": 10490,
                    "name": "Zend_Controller_Router",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52249",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hqjatu",
                        "name": "hqjatu",
                        "displayName": "Jari Turkia",
                        "active": true
                    },
                    "body": "I ended up inheriting my own Controller_Router_Rewrite. The only thing I'm doing there is:\r\n{noformat} \r\n    \/**\r\n     * Set module, controller and action to request\r\n     * Confirm that they are sane\r\n     *\/\r\n    protected function _setRequestParams($request, $params)\r\n    {\r\n        parent::_setRequestParams($request, $params);\r\n\r\n        if (!preg_match('\/^[a-z0-9 ]+$\/', strtolower($request->getModuleName()))) {\r\n            require_once 'Zend\/Controller\/Router\/Exception.php';\r\n            throw new Zend_Controller_Router_Exception('Badly formatted module: ' . $request->getModuleName(), 412);\r\n        }\r\n        if (!preg_match('\/^[a-z0-9 ]+$\/', strtolower($request->getControllerName()))) {\r\n            require_once 'Zend\/Controller\/Router\/Exception.php';\r\n            throw new Zend_Controller_Router_Exception('Badly formatted controller: ' . $request->getControllerName(), 412);\r\n        }\r\n        if (!preg_match('\/^[a-z0-9 ]+$\/', strtolower($request->getActionName()))) {\r\n            require_once 'Zend\/Controller\/Router\/Exception.php';\r\n            throw new Zend_Controller_Router_Exception('Badly formatted action: ' . $request->getActionName(), 412);\r\n        }\r\n    }\r\n{noformat} ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hqjatu",
                        "name": "hqjatu",
                        "displayName": "Jari Turkia",
                        "active": true
                    },
                    "created": "2012-11-14T11:58:20.000+0000",
                    "updated": "2012-11-14T11:58:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52271",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "body": "This won't be changed in the core of ZF as extending the class as noted in the comments is a good workaround for anyone who needs this functionality .",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "created": "2012-11-16T16:31:38.000+0000",
                    "updated": "2012-11-16T16:31:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52286",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hqjatu",
                        "name": "hqjatu",
                        "displayName": "Jari Turkia",
                        "active": true
                    },
                    "body": "Let's think this for a second. I'll present a really stupid example, but bear with me.\r\n\r\nAssume that somebody using Windows would define a controller in filename PrintglobalspasswordController.php like this:\r\n\r\n{noformat}\r\nglobal $password;\r\n$password = \"reallysecret123\";\r\n\r\nclass PrintglobalspasswordController extends Zend_Controller_Action\r\n{\r\n    public function indexAction()\r\n    {\r\n        $cntr = $this->getRequest()->getControllerName();\r\n        $PrintglobalspasswordController = \"not this\";\r\n        print eval($cntr);\r\n    }\r\n}\r\n{noformat}\r\n\r\nI'm the first one to state, that if anyone would write such a code, he would be a total dumbass. Also I'd say that the code would not work. But I've seen really wonderful things happen (and written).\r\n\r\nYou would see some sort of runtime error when accessing:\r\nhttp:\/\/myserver.com\/fi\/printglobalspassword\r\n\r\nBut guess what happens when user accesses it like this:\r\nhttp:\/\/myserver.com\/fi\/print $GLOBALS[\"password\"];\r\n\r\nYep. You guessed it!\r\n\r\nMy scenario is really far fetched and very stupid, but the way I run my business, I choose to sanitize user input. Period. Looks like at Zend you really don't care.\r\n\r\nThat's sad.\r\nI really thought that you are professionals there.\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hqjatu",
                        "name": "hqjatu",
                        "displayName": "Jari Turkia",
                        "active": true
                    },
                    "created": "2012-11-16T19:58:49.000+0000",
                    "updated": "2012-11-16T19:58:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52287",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "body": "I can't see how this theoretical attack could ever work as if you go to http:\/\/myserver.com\/fi\/print $GLOBALS[\"password\"]; then you get an exception of:\r\n\r\nInvalid controller specified (print%20$GLOBALS%5B%22password%22%5D;)\r\n\r\nwhich means that any code in the PrintglobalspasswordController class wouldn't run.\r\n\r\n\r\nWhat I'm saying is that I don't think that there's actually a possibly security issue here due to the way the router and dispatcher work. If you have a working proof of concept, please email zf-security@zend.com.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "created": "2012-11-20T11:00:29.000+0000",
                    "updated": "2012-11-20T11:00:29.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52288",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "body": "That error is actually:\r\n\r\n{code}Invalid controller specified (print%20$GLOBALS%5B%22password%22%5D;){code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "created": "2012-11-20T11:01:21.000+0000",
                    "updated": "2012-11-20T11:01:21.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52289",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hqjatu",
                        "name": "hqjatu",
                        "displayName": "Jari Turkia",
                        "active": true
                    },
                    "body": "Sir, you're correct.\r\nBut only if you did not touch routing. Out-of-the-box the only router is a Zend_Controller_Router_Route_Module which seems to do urlencoding for it's parameters.\r\n\r\nIn my case app, I don't have the luxury of using solely module-routes. There are a number of Zend_Controller_Router_Route routes which don't sanitize or encode input strings. Which is pretty much my point.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hqjatu",
                        "name": "hqjatu",
                        "displayName": "Jari Turkia",
                        "active": true
                    },
                    "created": "2012-11-20T19:14:48.000+0000",
                    "updated": "2012-11-20T19:14:48.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12467\/transitions"
}