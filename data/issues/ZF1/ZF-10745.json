{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10745",
    "key": "ZF-10745",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "form element using customDijit Dialog in custom form decorator placed outside form tag after dojo has been parsed"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10745\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tridem",
                "name": "tridem",
                "displayName": "Webdevilopers",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-11-26T01:28:37.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-01-14T00:33:58.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "In my form I have several horizontal sliders. Each element has an additional custom decorator.\r\nThis custom decorator captures the elements $content inside a dojo dialog.\r\n\r\n*In my form:*\r\n{code}\r\n\/*...*\/\r\n        $this->setElementDecorators(array(\r\n            'DijitElement',\r\n            'TasteToggleBox'\r\n        ));\r\n\/*...*\/\r\n{code}\r\n\r\n*My custom decorator:*\r\n{code}\r\n<?php\r\nclass Cookit_Form_Decorator_TasteToggleBox extends Zend_Form_Decorator_Abstract\r\n{\r\n    public function render($content)\r\n    {\r\n        $element = $this->getElement();\r\n        $view    = $element->getView();\r\n\r\n        $id = str_replace('-slider', '', $element->getId());\r\n\r\n        $boxCaptureStart = '<div id=' . $id . '-toggleBox\">';\r\n        $boxCaptureEnd   = '<\/div>';\r\n\r\n        $slider = '<div id=\"' . $element->getId() . '-toggleBox-slider\">';\r\n        $slider .= $content;\r\n        $slider .= '<a href=\"#\" onclick=\"saveTaste(\\'' . $id . '\\');\">' . $view->translate('form_decorator_tasteToggleBox_slider_saveTaste_label') . '<\/a>';\r\n        $slider .= '<\/div>';\r\n\r\n        $dialogId = $id . '-toggleBox-dialog';\r\n        $dialog = $view->customDijit($dialogId,\r\n            $slider,\r\n            array(\r\n                'dojoType' => 'dijit.Dialog',\r\n                'title'    => $element->getLabel()\r\n            ),\r\n            array(\r\n                'class' => 'taste-toggleBox-dialog'\r\n            )\r\n        );\r\n\r\n        $switch = '<div  class=\"taste-toggleBox-content\">';\r\n        $switch .= '<div class=\"taste-toggleBox-value\" id=\"' . $id . '-toggleBox-value\">' . $element->getValue() . '<\/div>';\r\n        $switch .= '<div class=\"taste-toggleBox-value\"> %<\/div>';\r\n        $switch .= '<div class=\"taste-toggleBox-label\">' . $element->getLabel() . '<\/div>';\r\n        $switch .= '<div class=\"taste-toggleBox-switch\" id=\"' . $id . '-toggleBox-switch\"><a href=\"#\" onclick=\"dijit.byId(\\'' . $dialogId . '\\').show();\">' . $view->translate('form_decorator_tasteToggleBox_switch_link_label') . '<\/a><\/div>';\r\n        $switch .= '<\/div>';\r\n\r\n        return $boxCaptureStart . $switch . $dialog . $boxCaptureEnd;\r\n    }\r\n}\r\n{code}\r\n\r\nSo far so good! *Looking at the generated code everything looks fine:*\r\n{code}\r\n<form id=\"tastesForm\" action=\"\/profile-taste\/save\" dojoType=\"dijit.form.Form\">\r\n\r\n<div id=tastes-1-toggleBox\">\r\n<div  class=\"taste-toggleBox-content\">\r\n<div class=\"taste-toggleBox-value\" id=\"tastes-1-toggleBox-value\">0.2<\/div><div class=\"taste-toggleBox-value\"> %<\/div>\r\n<div class=\"taste-toggleBox-label\">International<\/div><div class=\"taste-toggleBox-switch\" id=\"tastes-1-toggleBox-switch\">\r\n<a href=\"#\" onclick=\"dijit.byId('tastes-1-toggleBox-dialog').show();\">Change<\/a><\/div><\/div><div class=\"taste-toggleBox-dialog\" id=\"tastes-1-toggleBox-dialog\" title=\"International\" dojoType=\"dijit.Dialog\">\r\n<div id=\"tastes-1-toggleBox-slider\">\r\n<input id=\"tastes[1]\" name=\"tastes[1]\" value=\"0.2\" type=\"hidden\" \/>\r\n<div id=\"tastes-1-slider\" onChange=\"dojo.byId('tastes[1]').value = arguments[0];\" intermediateChanges=\"1\" minimum=\"0\" maximum=\"100\" discreteValues=\"101\" bottomDecorationDijit=\"HorizontalRule\" bottomDecorationContainer=\"bottomContainer\" required=\"false\" value=\"0.2\" dojoType=\"dijit.form.HorizontalSlider\">\r\n<div id=\"tastes-1-slider-bottomDecoration\" list=\"height:5em; font-size=75%;color:gray;\" container=\"bottomDecoration\" dojoType=\"dijit.form.HorizontalRule\"><\/div>\r\n<ol id=\"tastes-1-slider-bottomDecoration-labels\" list=\"height:5em; font-size=75%;color:gray;\" container=\"bottomDecoration\" dojoType=\"dijit.form.HorizontalRuleLabels\">\r\n<li>less<\/li>\r\n<li>more<\/li>\r\n<\/ol>\r\n<\/div>\r\n<a href=\"#\" onclick=\"saveTaste('tastes-1');\">Done<\/a><\/div><\/div>\r\n<\/div>\r\n\r\n\r\n\/*...*\/\r\n\r\n<\/form>\r\n{code}\r\n\r\nBut looking at the code in firebug after dojo has parsed all elements the slider elements (including the hidden inputs) are generated *outside of the form* and are not recognized after submitting the form:\r\n{code}\r\n<form widgetid=\"tastesForm\" dir=\"ltr\" id=\"tastesForm\" action=\"\/profile-taste\/save\" dojoattachpoint=\"containerNode\" dojoattachevent=\"onreset:_onReset,onsubmit:_onSubmit\">\r\n<div id=\"tastes-1-toggleBox&quot;\"><div class=\"taste-toggleBox-content\"><div class=\"taste-toggleBox-value\" id=\"tastes-1-toggleBox-value\">0.2<\/div><div class=\"taste-toggleBox-value\"> %<\/div>\r\n<div class=\"taste-toggleBox-label\">International<\/div><div class=\"taste-toggleBox-switch\" id=\"tastes-1-toggleBox-switch\"><a href=\"#\" onclick=\"dijit.byId('tastes-1-toggleBox-dialog').show();\">Change<\/a><\/div><\/div>\r\n<\/div>\r\n\r\n\/*...*\/\r\n\r\n<\/form>\r\n\r\n\r\n<div title=\"International\" dojoattachpoint=\"titleBar\" class=\"dijitDialogTitleBar\">\r\n<span dojoattachpoint=\"titleNode\" class=\"dijitDialogTitle\" id=\"tastes-1-toggleBox-dialog_title\">International<\/span>\r\n<span dojoattachpoint=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" dojoattachevent=\"onclick: onCancel\" title=\"Cancel\">\r\n<span dojoattachpoint=\"closeText\" class=\"closeText\" title=\"Abbrechen\">x<\/span>\r\n\t<\/span>\r\n\t<\/div>\r\n<div dojoattachpoint=\"containerNode\" class=\"dijitDialogPaneContent\"><div id=\"tastes-1-toggleBox-slider\">\r\n<input id=\"tastes[1]\" name=\"tastes[1]\" value=\"0.2\" type=\"hidden\">\r\n<table widgetid=\"tastes-1-slider\" dir=\"ltr\" id=\"tastes-1-slider\" class=\"dijit dijitReset dijitSlider dijitSliderH\" dojoattachevent=\"onkeypress:_onKeyPress,onkeyup:_onKeyUp\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" rules=\"none\">\r\n<tbody>\r\n<tr class=\"dijitReset\">\r\n<td class=\"dijitReset\" colspan=\"2\"><\/td>\r\n<td dojoattachpoint=\"topDecoration\" class=\"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH\"><\/td>\r\n<td class=\"dijitReset\" colspan=\"2\"><\/td>\r\n<\/tr>\r\n<tr class=\"dijitReset\">\r\n<td class=\"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH\">\r\n<div class=\"dijitSliderDecrementIconH\" tabindex=\"-1\" style=\"\" dojoattachpoint=\"decrementButton\"><span class=\"dijitSliderButtonInner\">-<\/span><\/div>\r\n<\/td>\r\n<td class=\"dijitReset\">\r\n<div class=\"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper\" dojoattachevent=\"onmousedown:_onClkDecBumper\"><\/div>\r\n<\/td>\r\n<td class=\"dijitReset\"><input value=\"0.2\" dojoattachpoint=\"valueNode\" type=\"hidden\"><div role=\"presentation\" class=\"dijitReset dijitSliderBarContainerH\" wairole=\"presentation\" dojoattachpoint=\"sliderBarContainer\">\r\n<div style=\"width: 0.2%;\" role=\"presentation\" wairole=\"presentation\" dojoattachpoint=\"progressBar\" class=\"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH\" dojoattachevent=\"onmousedown:_onBarClick\">\r\n<div class=\"dijitSliderMoveable dijitSliderMoveableH\">\r\n<div aria-valuemax=\"100\" aria-valuemin=\"0\" tabindex=\"0\" aria-valuenow=\"0.2\" role=\"slider\" dojoattachpoint=\"sliderHandle,focusNode\" class=\"dijitSliderImageHandle dijitSliderImageHandleH\" dojoattachevent=\"onmousedown:_onHandleClick\" wairole=\"slider\" valuemin=\"0\" valuemax=\"100\">\r\n<\/div>\r\n<\/div>\r\n<\/div>\r\n<div style=\"width: 99.8%;\" role=\"presentation\" wairole=\"presentation\" dojoattachpoint=\"remainingBar\" class=\"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH\" dojoattachevent=\"onmousedown:_onBarClick\">\r\n<\/div>\r\n<\/div>\r\n<\/td>\r\n<td class=\"dijitReset\">\r\n<div class=\"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper\" dojoattachevent=\"onmousedown:_onClkIncBumper\">\r\n<\/div>\r\n<\/td><td class=\"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH\">\r\n<div class=\"dijitSliderIncrementIconH\" tabindex=\"-1\" style=\"\" dojoattachpoint=\"incrementButton\"><span class=\"dijitSliderButtonInner\">+<\/span>\r\n<\/div><\/td><\/tr><tr class=\"dijitReset\"><td class=\"dijitReset\" colspan=\"2\"><\/td><td dojoattachpoint=\"containerNode,bottomDecoration\" class=\"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH\">\r\n<div widgetid=\"tastes-1-slider-bottomDecoration\" dir=\"ltr\" id=\"tastes-1-slider-bottomDecoration\" class=\"dijitRuleContainer dijitRuleContainerH\">\r\n<div class=\"dijitRuleMark dijitRuleMarkH\" style=\"left: 0%;\"><\/div>\r\n<div class=\"dijitRuleMark dijitRuleMarkH\" style=\"left: 50%;\"><\/div>\r\n<div class=\"dijitRuleMark dijitRuleMarkH\" style=\"left: 100%;\">\r\n<\/div><\/div>\r\n<div widgetid=\"tastes-1-slider-bottomDecoration-labels\" dir=\"ltr\" id=\"tastes-1-slider-bottomDecoration-labels\" class=\"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH\">\r\n<div class=\"dijitRuleLabelContainer dijitRuleLabelContainerH\" style=\"left: 0%;\">\r\n<div class=\"dijitRuleLabel dijitRuleLabelH\">less<\/div>\r\n<\/div>\r\n<div class=\"dijitRuleLabelContainer dijitRuleLabelContainerH\" style=\"left: 100%;\">\r\n<div class=\"dijitRuleLabel dijitRuleLabelH\">more<\/div>\r\n<\/div>\r\n<\/div>\r\n\r\n<\/td>\r\n<td class=\"dijitReset\" colspan=\"2\"><\/td>\r\n<\/tr>\r\n<\/tbody>\r\n<\/table>\r\n\r\n<a href=\"#\" onclick=\"saveTaste('tastes-1');\">Done<\/a><\/div>\r\n<\/div>\r\n\r\n{code}\r\n\r\n\r\nI think the reason for this is the way the customDijit View Helper generates the slider elements. The dojo parser starts after the first source code is generated.\r\nThen dojo appends the elements outside the form.\r\n\r\nIs this a dojo parsing problem or do I have to handle a customDijit inside my decorator in a different way?"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10745\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                "name": "alab",
                "displayName": "Christian Albrecht",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10420",
                    "id": 10420,
                    "description": "Minor Release",
                    "name": "1.11.0",
                    "userReleaseDate": "02\/Nov\/10",
                    "archived": false,
                    "releaseDate": "2010-11-02",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43341",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tridem",
                        "name": "tridem",
                        "displayName": "Webdevilopers",
                        "active": true
                    },
                    "body": "I tried this workaround without the customDijit:\r\n\r\n{code}\r\n        $dialog = '<div id=\"' . $dialogId . '\" dojoType=\"dijit.Dialog\" title=\"' . $element->getLabel() . '\" class=\"taste-toggleBox-dialog\">';\r\n        $dialog .= $slider;\r\n        $dialog .= '<\/div>';\r\n{code}\r\n\r\nThe behaviour is the same. Looks like dojo's parsing is the problem. But this issue is fatal to the form.\r\n\r\nIs there a better way to render the custom decorator? I guess a viewScript helper would end the same way?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tridem",
                        "name": "tridem",
                        "displayName": "Webdevilopers",
                        "active": true
                    },
                    "created": "2010-11-26T01:44:10.000+0000",
                    "updated": "2010-11-26T01:44:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44026",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tridem",
                        "name": "tridem",
                        "displayName": "Webdevilopers",
                        "active": true
                    },
                    "body": "Widgets within Dialogs are not included in the Form, and this is because the Dialog is attached directly to the body and not a child of your Form.\r\nSee http:\/\/dojo-toolkit.33424.n3.nabble.com\/Possible-issue-form-elements-slider-not-recognized-by-form-when-inside-dialog-td2056393.html\r\n\r\nThere are two ways to fix this.\r\n\r\n1. One would be to move the Dialog into the Form, although I wouldn't recommend this normally as it could effect the positioning of the Dialog. See http:\/\/telliott.net\/dojoExamples\/dojo-inputInDialog1.html for an example of this.\r\n2. You could create a hidden form element within the form and tie changes in the slider to update the value of the hidden form element. http:\/\/telliott.net\/dojoExamples\/dojo-inputInDialog2.html shows how this might work.\r\n\r\nMaybe this behaviour should at least be documented \"Using Zend Dojo Form Elements inside Dialog Dijit\".\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tridem",
                        "name": "tridem",
                        "displayName": "Webdevilopers",
                        "active": true
                    },
                    "created": "2011-01-14T00:33:50.000+0000",
                    "updated": "2011-01-14T00:33:50.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10745\/transitions"
}