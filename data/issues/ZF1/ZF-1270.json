{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1270",
    "key": "ZF-1270",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Error on deleting row with cascading delete"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1270\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10080",
                    "id": 10080,
                    "description": "Beta Release; bug fixes",
                    "name": "0.9.3",
                    "userReleaseDate": "05\/May\/07",
                    "archived": true,
                    "releaseDate": "2007-05-05",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-04-30T16:14:19.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shumkov",
                "name": "shumkov",
                "displayName": "Ivan Shumkov",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-04-13T09:50:08.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-05T14:44:05.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "{code}\nclass Products extends SmartShop_Db_Table_Abstract\n{\n    protected $_dependentTables = array('ProductImages');\n    protected $_referenceMap = array(\n        'Section' => array(\n            'columns'       => 'section_id',\n            'refTableClass' => 'ProductSections',\n            'refColumns'    => 'id',\n            'onDelete'      => self::CASCADE,\n        ),\n        'Image' => array(\n            'columns'       => 'image_id',\n            'refTableClass' => 'ProductImages',\n            'refColumns'    => 'id',\n\t    'onDelete'\t\t=> self::SET_NULL,\n        )\n    );\n}\nclass ProductSections extends SmartShop_Db_Table_Abstract\n{\n    protected $_dependentTables = array('Products');\n    protected $_referenceMap = array(\n        'Category' => array(\n\t        'columns'       => 'category_id',\n\t        'refTableClass' => 'ProductCategories',\n\t        'refColumns'    => 'id',\n\t        'onDelete'\t  => self::CASCADE,\n        )\n    );\n}\nclass ProductCategories extends SmartShop_Db_Table_Abstract\n{\n    protected $_dependentTables = array('ProductSections');\n}\nclass ProductImages extends SmartShop_Db_Table_Abstract\n{\n    protected $_rowClass = 'ProductImages_Row';\n    protected $_dependentTables = array('Products');\n    protected $_referenceMap = array(\n\t    'Product' => array(\n\t        'columns'         => 'product_id',\n\t        'refTableClass' => 'Products',\n\t        'refColumns'    => 'id',\n\t        'onDelete'        => self::CASCADE,\n\t\t)\n    );\n}\nclass ProductImages_Row extends Zend_Db_Table_Row_Abstract\n{\n    protected function _delete()\n    {\n        unlink(\"images\/products\/{$this->id}_{$this->width}_{$this->height}.jpg\");\n    }\n}\nclass ProductController extends SmartShop_Controller_Action\n{\n    public function deleteAction()\n    {\n        if ($this->_hasParam('id')) {\n            $products = new Products();\n            $product = $products->find($this->_getParam('id'))->current();\n            if ($product) {\n                $product->delete();\n                $this->_redirect('\/products');\n            } else {\n                $this->_forward('not-found', 'error');\n            }\n        } else {\n            $this->_forward('not-found', 'error');\n        }\n    }\n}\n{code}\nError:\n\nNotice: Undefined index: i in E:\\Projects\\ZendFramework\\library\\Zend\\Db\\Table\\Abstract.php on line 561\n\nFatal error: Uncaught exception 'Zend_Db_Adapter_Exception' with message 'SQLSTATE[42S22]: Column not found: 1054 Unknown column 'p' in 'where clause'' in E:\\Projects\\ZendFramework\\library\\Zend\\Db\\Adapter\\Pdo\\Abstract.php:177 Stack trace:\n#0 E:\\Projects\\ZendFramework\\library\\Zend\\Db\\Adapter\\Abstract.php(296): Zend_Db_Adapter_Pdo_Abstract->query('DELETE FROM `pr...')\n#1 E:\\Projects\\ZendFramework\\library\\Zend\\Db\\Table\\Abstract.php(542): Zend_Db_Adapter_Abstract->delete('product_images', Array)\n#2 E:\\Projects\\ZendFramework\\library\\Zend\\Db\\Table\\Abstract.php(564): Zend_Db_Table_Abstract->delete(Array)\n#3 E:\\Projects\\ZendFramework\\library\\Zend\\Db\\Table\\Row\\Abstract.php(355): Zend_Db_Table_Abstract->_cascadeDelete('Products', Array)\n#4 E:\\Projects\\SmartShop\\controllers\\ProductController.php(91): Zend_Db_Table_Row_Abstract->delete()\n#5 E:\\Projects\\ZendFramework\\library\\Zend\\Controller\\Action.php(501): ProductController->deleteAction()\n#6 E:\\Projects\\SmartShop\\classes\\SmartShop\\Controller\\Action.php(98): Zend_Controller_Action->d in E:\\Projects\\ZendFramework\\library\\Zend\\Db\\Adapter\\Pdo\\Abstract.php on line 177\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1270\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                "name": "darby",
                "displayName": "Darby Felton",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-1333",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1333",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10070",
                    "id": 10070,
                    "description": "Beta Release; bug fixes",
                    "name": "0.9.2",
                    "userReleaseDate": "06\/Apr\/07",
                    "archived": true,
                    "releaseDate": "2007-04-06",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10133",
                    "id": 10133,
                    "name": "Zend_Db_Table",
                    "description": "Lightweight OO interface to database tables and rowsets.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14385",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "It appears that the primary reason for encountering the error is because the {{columns}} and {{refColumns}} specifications in the reference map are defined (and assumed) to be arrays. Rather than consider the issue as solely invalid usage, I committed a suggested change with [SVN r4621|http:\/\/framework.zend.com\/fisheye\/changelog\/Zend_Framework\/?cs=4621] that enables single column specifications to be accepted as a string (in addition to the already supported array type).\n\nI find that additional unit tests are needed for covering both cascading deletes and updates, possibly revealing other weaknesses, and the documentation should be updated with respect to the usability improvement (i.e., demonstrating that it is possible to define single {{columns}} and single {{refColumns}} with a simple string).\n\nMinor update to Summary field, change priority to Minor, change issue type to Improvement, and commit to fixing for version 0.9.3.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-04-27T14:58:01.000+0000",
                    "updated": "2007-04-27T14:58:01.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14404",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Resolved with [SVN r4631|http:\/\/framework.zend.com\/fisheye\/changelog\/Zend_Framework\/?cs=4631].",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-04-30T16:14:19.000+0000",
                    "updated": "2007-04-30T16:14:19.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1270\/transitions"
}