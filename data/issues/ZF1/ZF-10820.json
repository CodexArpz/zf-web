{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10820",
    "key": "ZF-10820",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "PDF's created with Zend_Pdf::save($file, true) won't open in Adobe Reader"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10820\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10540",
                    "id": 10540,
                    "description": "Mini Release",
                    "name": "1.11.4",
                    "userReleaseDate": "03\/Mar\/11",
                    "archived": false,
                    "releaseDate": "2011-03-03",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-02-17T09:02:04.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jlogsdon",
                "name": "jlogsdon",
                "displayName": "James Logsdon",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-12-13T09:40:19.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-02-17T09:02:06.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "We have a report that generates large PDFs (almost 1,000 pages on our largest) that we've been working on cleaning up and fixing memory issues on. One of the biggest things we can change is incrementally saving the PDF instead of collecting all of the pages in memory before saving. Unfortunately every PDF we've created with the $updateOnly flag set will not open in Adobe Reader or OSX's Preview.app. Interestingly enough the PDF viewer evince on Linux displays the file correctly.\r\n\r\nThe error message from Reader is: Adobe Reader could not open 'test.pdf' because it is either not a supported file type or because the file has been damaged (for example, it was sent as an email attachment and wasn't correctly decoded).\r\n\r\n{code}\r\n<?php\r\n\r\nset_include_path(__DIR__ . '\/library');\r\n\r\nrequire '.\/library\/Zend\/Loader\/Autoloader.php';\r\n$loader = Zend_Loader_Autoloader::getInstance();\r\n\r\nif (is_file($file = sys_get_temp_dir() . DIRECTORY_SEPARATOR . 'test.pdf')) {\r\n    unlink($file);\r\n}\r\n\r\n$pdf = new Zend_Pdf();\r\nfor ($i = 0; $i < 5; $i++) {\r\n    $page = new Zend_Pdf_Page(Zend_Pdf_Page::SIZE_A4);\r\n    $page->setFont(Zend_Pdf_Font::fontWithName(Zend_Pdf_Font::FONT_COURIER), 7);\r\n\r\n    $page->drawText('Test Page ' . ($i + 1), 25, $page->getHeight() - 25);\r\n    $pdf->pages[] = $page;\r\n    $pdf->save($file, true);\r\n}\r\n\r\n?>\r\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10820\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                "name": "alexander",
                "displayName": "Alexander Veremyev",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13531",
                    "filename": "Pdf.php.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wenz",
                        "name": "wenz",
                        "displayName": "Christian Wenz",
                        "active": true
                    },
                    "created": "2010-12-16T04:50:58.000+0000",
                    "size": 399,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13531\/Pdf.php.diff"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10501",
                    "id": 10501,
                    "description": "Mini Release",
                    "name": "1.11.1",
                    "userReleaseDate": "30\/Nov\/10",
                    "archived": false,
                    "releaseDate": "2010-11-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10020",
                    "id": 10020,
                    "name": "Zend_Pdf",
                    "description": "pure PHP manipulation engine for composing PDFs",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43579",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jlogsdon",
                        "name": "jlogsdon",
                        "displayName": "James Logsdon",
                        "active": true
                    },
                    "body": "I have found the solution! Setting the $updateOnly flag on a brand new file does not work. I expected the library to be smart enough to realize it's a *new* file and operate on it as such. If this is intended behavior I believe it should be documented somewhere.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jlogsdon",
                        "name": "jlogsdon",
                        "displayName": "James Logsdon",
                        "active": true
                    },
                    "created": "2010-12-13T12:31:19.000+0000",
                    "updated": "2010-12-13T12:31:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43617",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wenz",
                        "name": "wenz",
                        "displayName": "Christian Wenz",
                        "active": true
                    },
                    "body": "I don't know if this is considered a breaking change, but IMVHO it would make sense to check whether the target file already exists before appending to it. The write mode (ab vs. wb) does not matter, but the flag value passed to the render() method does. I have prepared a simple patch that changes the $updateOnly flag to false if the target file does not exist.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wenz",
                        "name": "wenz",
                        "displayName": "Christian Wenz",
                        "active": true
                    },
                    "created": "2010-12-16T04:42:27.000+0000",
                    "updated": "2010-12-16T04:42:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43618",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wenz",
                        "name": "wenz",
                        "displayName": "Christian Wenz",
                        "active": true
                    },
                    "body": "Patch for ZF-10820",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wenz",
                        "name": "wenz",
                        "displayName": "Christian Wenz",
                        "active": true
                    },
                    "created": "2010-12-16T04:51:05.000+0000",
                    "updated": "2010-12-16T04:51:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44407",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "body": "Fixed.\r\n\r\nPDF is always saved as full document (not only incremental part) if it's created using:\r\n{code}\r\n$pdf = new Zend_Pdf();\r\n{code}\r\n\r\nbut if document is loaded it may be saved as incremental section for different purposes, it also allows to work with streams or other environments where file_exists() is not relevant.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2011-02-17T09:02:04.000+0000",
                    "updated": "2011-02-17T09:02:04.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10820\/transitions"
}