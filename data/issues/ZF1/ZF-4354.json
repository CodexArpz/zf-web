{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4354",
    "key": "ZF-4354",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Custom array-handling strategies"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/2",
                "name": "New Feature",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4354\/votes",
                "votes": 3,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-11-20T20:53:37.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cvogt",
                "name": "cvogt",
                "displayName": "Christopher Vogt",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-09-22T17:31:55.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T20:53:37.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Zend_Filter_Input handles an associative array of input values. If one of these values is again an array then Zend_Filter_Input traverses the array and applies the filter or validator to every element. (It linearly traverses the first level and does not recursively traverse the array, in case it has multiple dimensions.) This behavior might make sense for common use cases, but it is only one way to handle arrays, which is hard-coded and forced. It does not allow fine-grained array handling and also does not allow to filter or validate array keys.\n\nI propose a new boolean option called 'traverseArray' (or similar) that enables or disables the traversal. It defaults to true for backwards compatibility. Setting it to false makes Zend_Filter_Input pass values to validators or filters as they are, even if they are arrays. This allows array handling in the validator or filter. Common array-handling strategies, such as the default strategy described above, can be implemented using special meta validators and filters that decorate normal validators or filters as proposed by Bryce Lohr in http:\/\/www.nabble.com\/Zend_Filter_Input-and-Arrays-td17131495.html .\n\nI already implemented the new feature based on ZF 1.6.1:\n\n{code:title=Diff of Zend_Filter_Input against revision 11474 (ZF 1.6.1)|borderStyle=solid}\nIndex: C:\/xampp\/htdocs\/snk\/kalender.scoutnet.de\/lib\/ZendFramework\/library\/Zend\/Filter\/Input.php\n===================================================================\n--- C:\/xampp\/htdocs\/snk\/kalender.scoutnet.de\/lib\/ZendFramework\/library\/Zend\/Filter\/Input.php\t(revision 11474)\n+++ C:\/xampp\/htdocs\/snk\/kalender.scoutnet.de\/lib\/ZendFramework\/library\/Zend\/Filter\/Input.php\t(working copy)\n@@ -60,6 +60,7 @@\n     const PRESENCE_REQUIRED = 'required';\n     const RULE              = 'rule';\n     const RULE_WILDCARD     = '*';\n+    const TRAVERSE_ARRAY    = 'traverseArray';\n     const VALIDATE          = 'validate';\n     const VALIDATOR         = 'validator';\n     const VALIDATOR_CHAIN   = 'validatorChain';\n@@ -134,7 +135,8 @@\n         self::ESCAPE_FILTER       => 'HtmlEntities',\n         self::MISSING_MESSAGE     => \"Field '%field%' is required by rule '%rule%', but the field is missing\",\n         self::NOT_EMPTY_MESSAGE   => \"You must give a non-empty value for field '%field%'\",\n-        self::PRESENCE            => self::PRESENCE_OPTIONAL\n+        self::PRESENCE            => self::PRESENCE_OPTIONAL,\n+        self::TRAVERSE_ARRAY      => true\n     );\n \n     \/**\n@@ -516,7 +518,8 @@\n                 case self::BREAK_CHAIN:\n                 case self::MISSING_MESSAGE:\n                 case self::NOT_EMPTY_MESSAGE:\n-                case self::PRESENCE:\n+                case self::PRESENCE:\n+                case self::TRAVERSE_ARRAY:\n                     $this->_defaults[$option] = $value;\n                     break;\n                 default:\n@@ -565,7 +568,10 @@\n             if (!isset($filterRule[self::FIELDS])) {\n                 $filterRule[self::FIELDS] = $ruleName;\n             }\n-\n+            if (!isset($filterRule[self::TRAVERSE_ARRAY])) {\n+                $filterRule[self::TRAVERSE_ARRAY] = $this->_defaults[self::TRAVERSE_ARRAY];\n+            }\n+            \n             \/**\n              * Load all the filter classes and add them to the chain.\n              *\/\n@@ -604,7 +610,7 @@\n         if (!array_key_exists($field, $this->_data)) {\n             return;\n         }\n-        if (is_array($this->_data[$field])) {\n+        if ($filterRule[self::TRAVERSE_ARRAY] && is_array($this->_data[$field])) {\n             foreach ($this->_data[$field] as $key => $value) {\n                 $this->_data[$field][$key] = $filterRule[self::FILTER_CHAIN]->filter($value);\n             }\n@@ -708,6 +714,9 @@\n             if (!isset($validatorRule[self::PRESENCE])) {\n                 $validatorRule[self::PRESENCE] = $this->_defaults[self::PRESENCE];\n             }\n+            if (!isset($validatorRule[self::TRAVERSE_ARRAY])) {\n+                $validatorRule[self::TRAVERSE_ARRAY] = $this->_defaults[self::TRAVERSE_ARRAY];\n+            }\n             if (!isset($validatorRule[self::ALLOW_EMPTY])) {\n                 $validatorRule[self::ALLOW_EMPTY] = $this->_defaults[self::ALLOW_EMPTY];\n             }\n@@ -828,8 +837,8 @@\n             }\n         } else {\n             $failed = false;\n-            foreach ($data as $fieldKey => $field) {\n-                if (!is_array($field)) {\n+            foreach ($data as $fieldKey => $field) {\n+            \tif (!$validatorRule[self::TRAVERSE_ARRAY] || !is_array($field)) {\n                     $field = array($field);\n                 }\n                 foreach ($field as $value) {\n{code}\n\n{code:title=Two array filter strategies implemented as decorators|borderStyle=solid}\nclass Zend_Filter_ArrayRecurse implements Zend_Filter_Interface{\n\tvar $childFilter;\n\tpublic function __construct( $childFilter ){\n\t\t$this->childFilter = $childFilter;\n\t}\n\tpublic function filter( $value ){\n\t\tif( !is_array($value) ){\n\t\t\treturn $this->childFilter->filter( $value );\n\t\t} else {\n\t\t\tforeach( $value as $key => $item ){\n\t\t\t\t$value[$key] = $this->filter( $item );\n\t\t\t}\n\t\t\treturn $value;\n\t\t}\n\t}\n}\n\nclass Zend_Filter_ArrayRecurseKeys implements Zend_Filter_Interface{\n\tvar $childFilter;\n\tpublic function __construct( $childFilter ){\n\t\t$this->childFilter = $childFilter;\n\t}\n\tpublic function filter( $value ){\n\t\tif( !is_array($value) ){\n\t\t\treturn $value;\n\t\t} else {\n\t\t\t$new_value = array();\n\t\t\tforeach( $value as $key => $item ){\n\t\t\t\t$new_value[ $this->childFilter->filter($key) ] = $this->filter( $item );\n\t\t\t}\n\t\t\treturn $new_value;\n\t\t}\n\t}\n}\n{code}\n\n{code:title=Tests to demonstrate the effect. (More testing will be needed finally though).|borderStyle=solid}\n\/**\n * Filter for test purposes\n *\/\nclass FilterType implements Zend_Filter_Interface{\n\tpublic function filter( $value ){\n\t\treturn gettype( $value );\n\t}\n}\n\n\/\/ input used in tests\n$input = array( 'test' => array('a'=>array('a1')) );\n\n\/\/ typical filter definition\n$filters = array(\n\t'test' => array(new FilterType)\n);\n\n\/\/ Testing traverseArray enabled (default)\n$i = new Zend_Filter_Input( $filters, array(), $input );\n$expected_result = array(\n\t'test' => array( 'a' => 'array' )\n);\nassert( $expected_result == $i->getEscaped() );\n\n\/\/ Testing traverseArray disabled\n$i = new Zend_Filter_Input( $filters, array(), $input, array('traverseArray' => false) );\n$expected_result = array(\n\t'test' => 'array'\n);\nassert( $expected_result == $i->getEscaped() );\n\n\/\/ Testing recursive strategy filtering values\n$filters = array(\n\t'test' => array( new Zend_Filter_ArrayRecurse(new FilterType) )\n);\n$i = new Zend_Filter_Input( $filters, array(), $input, array('traverseArray' => false) );\n$expected_result = array(\n\t'test' => array( 'a' => array('string') )\n);\nassert( $expected_result == $i->getEscaped() );\n\n\/\/ Testing recursive strategy filtering keys\n$filters = array(\n\t'test' => array( new Zend_Filter_ArrayRecurseKeys(new FilterType) )\n);\n$i = new Zend_Filter_Input( $filters, array(), $input, array('traverseArray' => false) );\n$expected_result = array(\n\t'test' => array( 'string' => array('integer' => 'a1') )\n);\nassert( $expected_result == $i->getEscaped() );\n{code} "
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4354\/watchers",
                "isWatching": false,
                "watchCount": 4
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-6766",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6766",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10201",
                    "id": 10201,
                    "description": "Mini Release",
                    "name": "1.6.1",
                    "userReleaseDate": "15\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-15",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10180",
                    "id": 10180,
                    "name": "Zend_Filter_Input",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33956",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ota",
                        "name": "ota",
                        "displayName": "Ota Mares",
                        "active": true
                    },
                    "body": "Any news with this?\nTraversing the values of an array makes working with arrays unfeasible, as example you cant serialize an input array without nesting it into a dummy array.\nThe documentation does not state that values are traversed, is there a special reason for it?\n\nThe best solution would be to implement the option posted in the OP. or to remove the traversing logic completely.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ota",
                        "name": "ota",
                        "displayName": "Ota Mares",
                        "active": true
                    },
                    "created": "2009-08-26T07:40:44.000+0000",
                    "updated": "2009-08-26T07:40:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33957",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ota",
                        "name": "ota",
                        "displayName": "Ota Mares",
                        "active": true
                    },
                    "body": "Btw. http:\/\/framework.zend.com\/issues\/browse\/ZF-6766 is a duplicate of this issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ota",
                        "name": "ota",
                        "displayName": "Ota Mares",
                        "active": true
                    },
                    "created": "2009-08-26T07:43:13.000+0000",
                    "updated": "2009-08-26T07:43:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33963",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "As you can see I took over all Zend_Filter_Input issues 6 days ago...\n\nSorry to say that but I can not fix 80 issues within 6 days... ;-)\nYou will have to wait, as I am looking one after the other, into all of these issues.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-08-26T07:55:21.000+0000",
                    "updated": "2009-08-26T07:55:21.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33965",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ota",
                        "name": "ota",
                        "displayName": "Ota Mares",
                        "active": true
                    },
                    "body": "Ah, thats great. I didnt look at the assignment date but encountered the problem a few hours ago and it took me a moment to find the culprit and thought i should report it, yada yada.\nAnyway i am watching this issue now :D",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ota",
                        "name": "ota",
                        "displayName": "Ota Mares",
                        "active": true
                    },
                    "created": "2009-08-26T08:22:30.000+0000",
                    "updated": "2009-08-26T08:22:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34039",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cvogt",
                        "name": "cvogt",
                        "displayName": "Christopher Vogt",
                        "active": true
                    },
                    "body": "I think this is a pretty important issue. Nice to know there is going to be some progress. Thank you Thomas for taking over the assignment and looking into it.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cvogt",
                        "name": "cvogt",
                        "displayName": "Christopher Vogt",
                        "active": true
                    },
                    "created": "2009-08-28T04:46:31.000+0000",
                    "updated": "2009-08-28T04:46:31.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52868",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "body": "Bulk change of all issues last updated before 1st January 2010 as \"Won't Fix\".\r\n\r\nFeel free to re-open and provide a patch if you want to fix this issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "created": "2012-11-20T20:53:37.000+0000",
                    "updated": "2012-11-20T20:53:37.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4354\/transitions"
}