{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4238",
    "key": "ZF-4238",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Infinite loop when connection is closed"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField",
            "value": {
                "timeestimate": 0,
                "timespent": 40
            }
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4238\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10270",
                    "id": 10270,
                    "description": "Mini Release",
                    "name": "1.7.1",
                    "userReleaseDate": "01\/Dec\/08",
                    "archived": false,
                    "releaseDate": "2008-12-01",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-12-04T04:09:03.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexadriaanse",
                "name": "alexadriaanse",
                "displayName": "Alex Adriaanse",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-09-10T09:27:13.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-03-21T11:14:58.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When I use Zend_Http_Client it occasionally seems to get stuck in an infinite loop.  When I perform an strace on the offending process I see the following system calls being called in an infinite loop:\r\n\r\n{noformat}\r\npoll([{fd=6, events=POLLIN|POLLERR|POLLHUP, revents=POLLIN|POLLHUP}], 1, 300000) = 1\r\nrecvfrom(6, \"\", 8192, MSG_DONTWAIT, NULL, NULL) = 0\r\npoll([{fd=6, events=POLLIN|POLLERR|POLLHUP, revents=POLLIN|POLLHUP}], 1, 300000) = 1\r\nrecvfrom(6, \"\", 8192, MSG_DONTWAIT, NULL, NULL) = 0\r\npoll([{fd=6, events=POLLIN|POLLERR|POLLHUP, revents=POLLIN|POLLHUP}], 1, 300000) = 1\r\nrecvfrom(6, \"\", 8192, MSG_DONTWAIT, NULL, NULL) = 0\r\npoll([{fd=6, events=POLLIN|POLLERR|POLLHUP, revents=POLLIN|POLLHUP}], 1, 300000) = 1\r\nrecvfrom(6, \"\", 8192, MSG_DONTWAIT, NULL, NULL) = 0\r\n...\r\n{noformat}\r\n\r\nI noticed that Zend_Http_Client_Adapter_Socket::read() does not check whether the socket has been closed while it reads a response.  My hypothesis is that when a connection is closed while read() is in the process of reading the response, it gets stuck in an infinite loop as it is never able to finish reading $left_to_read bytes.\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/2",
                "name": "Critical"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4238\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/worklog\/21772",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4238",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=yoshida@zend.co.jp",
                        "name": "yoshida@zend.co.jp",
                        "displayName": "old of Satoru Yoshida",
                        "active": true
                    },
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=yoshida@zend.co.jp",
                        "name": "yoshida@zend.co.jp",
                        "displayName": "old of Satoru Yoshida",
                        "active": true
                    },
                    "comment": "",
                    "created": "2008-12-04T04:23:58.000+0000",
                    "updated": "2008-12-04T04:23:58.000+0000",
                    "started": "2008-12-04T04:23:00.000+0000",
                    "minutesSpent": 40
                }
            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                "name": "satoruyoshida",
                "displayName": "Satoru Yoshida",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-4561",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4561",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-4393",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4393",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11638",
                    "filename": "zend_http_client_infinite_loop_on_timeout_fix.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexadriaanse",
                        "name": "alexadriaanse",
                        "displayName": "Alex Adriaanse",
                        "active": true
                    },
                    "created": "2008-11-13T18:20:33.000+0000",
                    "size": 868,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11638\/zend_http_client_infinite_loop_on_timeout_fix.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10240",
                    "id": 10240,
                    "description": "Minor Release",
                    "name": "1.6.0",
                    "userReleaseDate": "02\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-02",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10015",
                    "id": 10015,
                    "name": "Zend_Http_Client",
                    "description": "performs HTTP requests",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24410",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexadriaanse",
                        "name": "alexadriaanse",
                        "displayName": "Alex Adriaanse",
                        "active": true
                    },
                    "body": "While I was reviewing Zend_Http_Client_Adapter_Socket::read(), I also noticed that it has lines like {{while ($line = @fgets($this->socket))}} and {{while ($buff = @fread($this->socket, 8192))}}.  Due to the loose comparisons performed by these statements, I'd imagine that when fgets() and fread() return a string such as \"0\" the read is aborted prematurely.  In addition to adding feof() checks, these conditions should probably be rewritten as {{(... === false)}} and\/or {{(... === '')}}.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexadriaanse",
                        "name": "alexadriaanse",
                        "displayName": "Alex Adriaanse",
                        "active": true
                    },
                    "created": "2008-09-10T09:36:41.000+0000",
                    "updated": "2008-09-10T09:36:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25031",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "body": "I added additional failure checks in changeset 11864 and an additional test to make sure lines with '0' or '' are not wrongly evaluated as FALSE. \nIn order to fully confirm that this issue is fixed I need either a clear reproduction, or you can test with the latest revision and see if this still happens. ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "created": "2008-10-11T04:41:47.000+0000",
                    "updated": "2008-10-11T04:41:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25053",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "body": "That seems ZF-4560 is caused by this problem.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2008-10-11T13:17:56.000+0000",
                    "updated": "2008-10-11T13:17:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25072",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "body": "I added some additional feof() checks to fix ZF-4560. \n\nIt seems that fread() \/ fgets() do not always return false when at EOF, and you need to manually check for EOF or it will just keep reading. This is the case when there is no content-length or \"transfer-encoding: chunked\" response, and you just need to read until the end of file, which is the case with some responses from the AudioScrobbler servers and maybe from other servers as well.\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "created": "2008-10-12T02:48:53.000+0000",
                    "updated": "2008-10-12T02:48:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25077",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "body": "It seems it's resolved with r11886 commit.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexander",
                        "name": "alexander",
                        "displayName": "Alexander Veremyev",
                        "active": true
                    },
                    "created": "2008-10-12T04:03:53.000+0000",
                    "updated": "2008-10-12T04:03:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25078",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "The Unit Test file: \/trunk\/tests\/Zend\/Http\/Client\/_files\/ZF4238-zerolineresponse.txt is missing, unit tests fail:\n\ntestZF4238FalseLinesInResponse()\ntestHttpAuthBasic()",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2008-10-12T04:28:54.000+0000",
                    "updated": "2008-10-12T04:28:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26108",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Changing issues in preparation for the 1.7.0 release.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-11-13T14:09:58.000+0000",
                    "updated": "2008-11-13T14:09:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26400",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexadriaanse",
                        "name": "alexadriaanse",
                        "displayName": "Alex Adriaanse",
                        "active": true
                    },
                    "body": "If the connection times out while Zend_Http_Client_Adapter_Socket is reading from the socket, it will still go into an infinite loop.  I am attaching a patch that appears to fix this.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexadriaanse",
                        "name": "alexadriaanse",
                        "displayName": "Alex Adriaanse",
                        "active": true
                    },
                    "created": "2008-11-13T18:19:56.000+0000",
                    "updated": "2008-11-13T18:19:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26945",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=yoshida@zend.co.jp",
                        "name": "yoshida@zend.co.jp",
                        "displayName": "old of Satoru Yoshida",
                        "active": true
                    },
                    "body": "I try to solve this issue at SVN r13013.\n\nI will happy if I receive any reviews.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=yoshida@zend.co.jp",
                        "name": "yoshida@zend.co.jp",
                        "displayName": "old of Satoru Yoshida",
                        "active": true
                    },
                    "created": "2008-12-04T04:09:02.000+0000",
                    "updated": "2008-12-04T04:09:02.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4238\/transitions"
}