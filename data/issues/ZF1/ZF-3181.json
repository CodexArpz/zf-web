{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3181",
    "key": "ZF-3181",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Controller_Action_Helper_Redirector triggers redirect in setGoto()"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3181\/votes",
                "votes": 2,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-05-28T19:11:41.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=noia",
                "name": "noia",
                "displayName": "Bjorn Soldal",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-04-25T17:01:02.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-05-29T02:14:51.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "During the declaration of a redirector as per the documentation as described at :\r\n\r\nhttp:\/\/framework.zend.com\/manual\/en\/zend.controller.actionhelpers.html#zend.controller.actionhelpers.redirector\r\n\r\n{code}\r\n$this->_redirector->setCode('303')\r\n                          ->setExit(false)\r\n                          ->setGoto(\"index\", \"index\");\r\n{code}\r\n\r\nThe process was redirected, this is in contention with the documentation which states that goto(), gotoRoute() and gotoUrl() are the only functions of Zend_Controller_Action_Helper_Redirector which should cause the actual redirection.\r\n\r\nWith kind regards,\r\nNoia"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/customFieldOption\/10039",
                "value": "  Should Have"
            }
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3181\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10011",
                    "id": 10011,
                    "name": "Zend_Controller",
                    "description": "front controller, including router and dispatcher",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21657",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Scheduling for next mini release and assigning to Ralph.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-05-09T11:10:39.000+0000",
                    "updated": "2008-05-09T11:10:39.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26534",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fredw",
                        "name": "fredw",
                        "displayName": "Fred Woolard",
                        "active": true
                    },
                    "body": "Having a similar problem with the setGotoSimple() call, and anybody using setGotoUrl(), setGotoRoute will have the same problem also.\n\nAt the end of each of these routines, there's this statement:\n\n$this->_redirect($url);\n\nThis is where the return code, and associated header info is being prematurely injected into the controller's response object.\n\nI think the last line should rather be:\n\n$this->_redirectUrl = $url;\n\nBut then the problem will become that the gotoXXXX, routines, which call redirectAndExit expect that the header info has already been pushed into the response object. So, a little re-think might be in order.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fredw",
                        "name": "fredw",
                        "displayName": "Fred Woolard",
                        "active": true
                    },
                    "created": "2008-11-20T15:04:23.000+0000",
                    "updated": "2008-11-20T15:04:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26535",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fredw",
                        "name": "fredw",
                        "displayName": "Fred Woolard",
                        "active": true
                    },
                    "body": "My work-around is this:\n\nReplace the routine _redirect (Because it doesn't really redirect, just forms up the full URL and puts the headers into the response object) with this:\n\n    \/**\n     * Set redirect in response object\n     *\n     * @return void\n     *\/\n    protected function _setRedirectInResponse()\n    {\n        $url = $this->_redirectUrl;\n        if ($this->getUseAbsoluteUri() && !preg_match('#^(https?|ftp):\/\/#', $url)) {\n            $host  = $_SERVER['HTTP_HOST'];\n            $proto = (empty($_SERVER['HTTPS'])) ? 'http' : 'https';\n            $port  = $_SERVER['SERVER_PORT'];\n            $uri   = $proto . ':\/\/' . $host;\n            if ((('http' == $proto) && (80 != $port)) || (('https' == $proto) && (443 != $port))) {\n                $uri .= ':' . $port;\n            }\n            $url = $uri . '\/' . ltrim($url, '\/');\n        }\n        $this->getResponse()->setRedirect($url, $this->getCode());\n    }\n\n\nThen in each of the setGotoXXX routines, change the last line as mentioned in previous comment:\n\n$this->_redirect($url);\n\n\nIn the redirectAndExit() routine, add the line to call $this->_setRedirectInResponse.\n\n    public function redirectAndExit()\n    {\n        \/\/ Close session, if started\n        if (class_exists('Zend_Session', false) && Zend_Session::isStarted()) {\n            Zend_Session::writeClose();\n        } elseif (isset($_SESSION)) {\n            session_write_close();\n        }\n\n        $this->_setRedirectInResponse();\n        \n        $this->getResponse()->sendHeaders();\n        exit();\n    }\n\n\nAnd in the gotoXXXX (not gotoXXXAndExit) routines add an else clause to the conditional check on whether to exit or not, e.g.:\n\n    public function gotoUrl($url, array $options = array())\n    {\n        $this->setGotoUrl($url, $options);\n\n        if ($this->getExit()) {\n            $this->redirectAndExit();\n        }\n        else {\n            $this->_setRedirectInResponse();            \n        }\n    }\n\n\nIn this way, the response code from the Redirector is not prematurely set in the controller's response object in any of the \"set\" methods; it is done only when the imperative redirectAndExit, and \"goto\" methods are called.\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fredw",
                        "name": "fredw",
                        "displayName": "Fred Woolard",
                        "active": true
                    },
                    "created": "2008-11-20T16:02:05.000+0000",
                    "updated": "2008-11-20T16:02:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28019",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "reassinging, this is more your realm.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2009-01-10T12:00:16.000+0000",
                    "updated": "2009-01-10T12:00:16.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44435",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "I am unsure what the issue is here to be honest.\r\n\r\nIn the above code, you are asking the redirector to set certain headers inside the response object.  If you don't do anything, those headers will be sent to the browser at the end of the request, completing the redirection.\r\n\r\nIf you use any of the gotoXXXandExit() methods, then the redirection will happen immediately and the request will stop.\r\n\r\nPlease help me understand the issue here.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2011-02-17T15:09:14.000+0000",
                    "updated": "2011-02-17T15:09:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44460",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=noia",
                        "name": "noia",
                        "displayName": "Bjorn Soldal",
                        "active": true
                    },
                    "body": "When I reported this issue the only three commands which should trigger a redirect were goto(), gotoRoute() and gotoUrl(). The issue was that when I was defining a redirector I didn't immediately want to redirect the user there and then but rather fire the redirector after some clean-up had been done.\r\n\r\nThe issue was that either your documentation is wrong, or the code is wrong.\r\n\r\nTypically anything which matches set*() won't be expected to change the behaviour of execution but is rather a step in defining another object or process.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=noia",
                        "name": "noia",
                        "displayName": "Bjorn Soldal",
                        "active": true
                    },
                    "created": "2011-02-18T02:15:00.000+0000",
                    "updated": "2011-02-18T02:15:00.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44490",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "I think your terminology is wrong here, and perhaps we should look at the docs.  You don't \"trigger\" a redirect. You can either set a redirect (header) and wait till the end of the request, or set the redirect (header) and exit.  Setting a redirect and not getting a redirect is not something anyone would expect to happen.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2011-02-18T09:48:14.000+0000",
                    "updated": "2011-02-18T09:48:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44492",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=noia",
                        "name": "noia",
                        "displayName": "Bjorn Soldal",
                        "active": true
                    },
                    "body": "Ok, prepare might be a better word then. The way I read the documentation at the time (bearing in mind this issue is now nearly 3 years old!) was that the redirect is configured with set methods but not actually issued to the client before a goto or other method invocation occurs. \r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=noia",
                        "name": "noia",
                        "displayName": "Bjorn Soldal",
                        "active": true
                    },
                    "created": "2011-02-18T09:52:54.000+0000",
                    "updated": "2011-02-18T09:52:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46811",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "My vote is with Ralph on this one - I can't see the issue.  The setGotoXXX methods all call _redirect, which in turn calls setRedirect on the Response object. That setRedirect method simply adds a Location header and sets the response code.  Under no circumstance would the redirect occur immediately at the point setGotoXXX is called.  ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-05-26T20:51:17.000+0000",
                    "updated": "2011-05-26T20:51:17.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3181\/transitions"
}