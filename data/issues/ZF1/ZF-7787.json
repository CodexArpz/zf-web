{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7787",
    "key": "ZF-7787",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "cache not taking locale into id"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7787\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10362",
                    "id": 10362,
                    "description": "Mini Release",
                    "name": "1.9.3",
                    "userReleaseDate": "22\/Sep\/09",
                    "archived": false,
                    "releaseDate": "2009-09-22",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-09-06T22:42:07.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mymy",
                "name": "mymy",
                "displayName": "s",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-09-06T16:24:45.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-09-07T10:50:17.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "cache",
                "locales",
                "translate"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Someone replaced in private function _addTranslationData($data, $locale, array $options = array()) in Zend_Translate_Adapter:\n\n$id = 'Zend_Translate_' . preg_replace('\/[^a-zA-Z0-9_]\/', '_', $data) . '_' . $locale . '_' . $this->toString();\n\nwith\n\n$id = 'Zend_Translate_' . md5(serialize($data)) . '_' . $this->toString();\n\nNow custom adapters that do not pass any locale info trough $data and using auto locale from browser, have same cache id for all languages (locales).\n\nSo I created my ($data = mysql) adapter but I can't use cache (+null $locales for auto locales detection) with it."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7787\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10361",
                    "id": 10361,
                    "description": "Mini Release",
                    "name": "1.9.2",
                    "userReleaseDate": "25\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10099",
                    "id": 10099,
                    "name": "Zend_Translate",
                    "description": "Provides translation functionality, based on standards such as TMX and Gettext.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34279",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Internal caching is not done by locale but by given data (which is normally a filename). Otherwise caching for multilocale input like TMX or array files would not work.\n\nCaching is a internal process. It has no effect on how translation works externally when the same data is provided.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-09-06T22:41:46.000+0000",
                    "updated": "2009-09-06T22:41:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34284",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mymy",
                        "name": "mymy",
                        "displayName": "s",
                        "active": true
                    },
                    "body": "It has effect. Lets say you use null $locale (browser determines locale) and you have mysql adapter for language. You can't put filename into $data since it is mysql. So $data = 'mysql' all the time. \n\nNow someone enters with browser language EN - it gets saved in cache and next guest comes in with browser US (or other locale) it doesn't matter now since cache is loaded with EN for everyone until cache timeout. Id for EN and US locale is the same and locale is set in adapter if $locale = null.\n\nSo cache causes one language for all guests until cache timeout. Right now adapter acts as if there can only be files used to store translation. Other custom adapters will not work with cache and auto locale from browser.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mymy",
                        "name": "mymy",
                        "displayName": "s",
                        "active": true
                    },
                    "created": "2009-09-07T01:16:40.000+0000",
                    "updated": "2009-09-07T01:16:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34285",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "When you say \"regardless of what is called, it's always the same data\"... then of course also cache expects that data is always the same.\n\nWith the actual aproach I see no problem even to use the old (errorous) behaviour when you are doing an individual adapter. You define within your adapter yourself what's being delivered to _addTranslationData and how it should behave.\n\nThe actual implementation works when single languages are seperated in multiple sources.\nIt works when single languages are in single sources.\nAnd  it works when multiple language are in single sources.\nActually I see no single usecase where it does not work.\n\nBeside that you are free to define what's written within cache and used as basis for caching. This is on your own implementation.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-09-07T03:55:51.000+0000",
                    "updated": "2009-09-07T03:55:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34286",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mymy",
                        "name": "mymy",
                        "displayName": "s",
                        "active": true
                    },
                    "body": "Look here:\n\nbootstrap:\n\nZend_Translate::setCache($cache);\n$translate = new Zend_Translate('My_Translate_Adapter_Mysql', 'mysql', null, array('scan' => Zend_Translate::LOCALE_DIRECTORY, 'disableNotices' => true));\n\nadapter:\n\n<?php\n\nclass My_Translate_Adapter_Mysql extends Zend_Translate_Adapter\n{\n    public function __construct($data, $locale = null, array $options = array())\n    {\n        parent::__construct($data, $locale, $options);\n    }\n\n    protected function _loadTranslationData($data, $locale, array $options = array())\n    {\n\t\t   $this->_data = array();\n\t\t\t\t\n\/\/here i get translation data from mysql!\t\n\t\t\t\n        if (!isset($this->_data[$locale])) {\n            $this->_data[$locale] = array();\n        }\n\n        $this->_data[$locale] = array_merge($this->_data[$locale], $mysql_translated);\t\n\t\t\t\n        return $this->_data;\n    }\n\n    public function toString()\n    {\n        return \"Mysql\";\n    }\n}\n\nNow tell me that \"And it works when multiple language are in single sources.\" You can't. Cache will cause guests to see only ONE language that is currently cached.\n\nI have fixed this by disabling cache in bootstrap and using standard cache in my adapter. But it will not cache options and other translations (in forms).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mymy",
                        "name": "mymy",
                        "displayName": "s",
                        "active": true
                    },
                    "created": "2009-09-07T04:55:17.000+0000",
                    "updated": "2009-09-07T04:55:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34292",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "No reason to get angry.\n\nWhy are you not reading all translations into the cache (as it should be done) but instead only single translations ?\n\nExample:\nThe user says - I want only english - then you load only english and say english is the only supported language...\n\nWhy don't you, eighter load all languages at once, or load the languages on demand when you see they are not loaded ?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-09-07T06:53:08.000+0000",
                    "updated": "2009-09-07T06:53:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34296",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mymy",
                        "name": "mymy",
                        "displayName": "s",
                        "active": true
                    },
                    "body": "Well why would I want to load 3 times more data and process it every time someone opens page?\n\nAll that data is serialized must be loaded etc. Zend is slow enough - dont want to add to it. And I don't want to limit size of the translation database. There will be much multilanguage content. I also use per page translations - loading all at once is no fun.\n\nProblem is only with cache id that is not using $locale. Only this that was working before is standing in my way to happines :P",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mymy",
                        "name": "mymy",
                        "displayName": "s",
                        "active": true
                    },
                    "created": "2009-09-07T08:21:16.000+0000",
                    "updated": "2009-09-07T08:21:16.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34297",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "The caching algorithm will can not be changed to use the locale as target. This would reintroduce several bugs and break several things.\n\nBut you could still load the translations on demand like described before.\n\nSomething like this mock example:\n{code}\nif (!$translate->isAvailable($locale)) {\n    $translate->addTranslation($data, $locale, array('reload' => true));\n}\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-09-07T10:50:12.000+0000",
                    "updated": "2009-09-07T10:50:12.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7787\/transitions"
}