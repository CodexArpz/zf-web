{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11419",
    "key": "ZF-11419",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Http_Client_Adapter_Socket duplicate memory usage of request body"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11419\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                "name": "shahar",
                "displayName": "Shahar Evron",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-05-30T12:08:21.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-09-05T12:23:12.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Zend_Http_Client_Adapter_Socket duplicate memory usage of request body for no good reason, when concatenating the body to the headers in Socket.php line 291. This may cause PHP to reach it's memory limit when sending large requests for no good reason. \r\n\r\nOne possible solution is to write the headers then the body without creating a new variable concatenating both, and then returning both as an array - they will only be concatenated in the client's ->getLastRequest() method, if needed - as this method is rarely called (only in debugging and testing scenarios)."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11419\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "state:need-feedback",
                "zf-caretaker-adamlundrigan",
                "zf-crteam-padraic",
                "zf-crteam-priority",
                "zf-crteam-review"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                "name": "shahar",
                "displayName": "Shahar Evron",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10015",
                    "id": 10015,
                    "name": "Zend_Http_Client",
                    "description": "performs HTTP requests",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48228",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Your suggested fix would require changing the return value of {{Zend_Http_Client_Adapter_Socket::write()}} from string to array.  Would that be considered a BC break, or is {{write}} only used internally (despite being public)?\r\n\r\nI've implemented the first part (write the headers and body separately) in the patch below:\r\n{code}\r\nIndex: library\/Zend\/Http\/Client\/Adapter\/Socket.php\r\n===================================================================\r\n--- library\/Zend\/Http\/Client\/Adapter\/Socket.php (revision 24408)\r\n+++ library\/Zend\/Http\/Client\/Adapter\/Socket.php (working copy)\r\n@@ -283,25 +283,25 @@\r\n             if (is_string($k)) $v = ucfirst($k) . \": $v\";\r\n             $request .= \"$v\\r\\n\";\r\n         }\r\n+        $request .= \"\\r\\n\";\r\n\r\n-        if(is_resource($body)) {\r\n-            $request .= \"\\r\\n\";\r\n-        } else {\r\n-            \/\/ Add the request body\r\n-            $request .= \"\\r\\n\" . $body;\r\n-        }\r\n-\r\n         \/\/ Send the request\r\n         if (! @fwrite($this->socket, $request)) {\r\n             require_once 'Zend\/Http\/Client\/Adapter\/Exception.php';\r\n             throw new Zend_Http_Client_Adapter_Exception('Error writing request to server');\r\n         }\r\n\r\n+        \/\/ Send the body\r\n         if(is_resource($body)) {\r\n             if(stream_copy_to_stream($body, $this->socket) == 0) {\r\n                 require_once 'Zend\/Http\/Client\/Adapter\/Exception.php';\r\n                 throw new Zend_Http_Client_Adapter_Exception('Error writing request to server');\r\n             }\r\n+        } else {\r\n+            if (! @fwrite($this->socket, $body)) {\r\n+                require_once 'Zend\/Http\/Client\/Adapter\/Exception.php';\r\n+                throw new Zend_Http_Client_Adapter_Exception('Error writing request to server');\r\n+            }\r\n         }\r\n\r\n         return $request;\r\n{code}\r\n\r\nWe may also want to rename {{$request}} to {{$headers}} for clarity sake. ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-08-27T01:06:35.000+0000",
                    "updated": "2011-08-27T01:06:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51802",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peterhil",
                        "name": "peterhil",
                        "displayName": "Peter Hillerstr\u00f6m",
                        "active": true
                    },
                    "body": "Why this hasn't been fixed yet? It's trivial to fix, so why it's still open?\r\n\r\nI ran into this issue trying to upload a large video file, and got \"PHP Fatal error:  Allowed memory size of 2147483648 bytes exhausted (tried to allocate 754951466 bytes) in \/Users\/peterhil\/code\/opetustarvike\/oppimisymparisto\/vendor\/zf2\/library\/Zend\/Http\/Client\/Adapter\/Socket.php on line 280\"",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peterhil",
                        "name": "peterhil",
                        "displayName": "Peter Hillerstr\u00f6m",
                        "active": true
                    },
                    "created": "2012-09-05T12:04:48.000+0000",
                    "updated": "2012-09-05T12:04:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51803",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peterhil",
                        "name": "peterhil",
                        "displayName": "Peter Hillerstr\u00f6m",
                        "active": true
                    },
                    "body": "I'd like to edit that comment to remove the unrelevant parts of the path...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peterhil",
                        "name": "peterhil",
                        "displayName": "Peter Hillerstr\u00f6m",
                        "active": true
                    },
                    "created": "2012-09-05T12:13:07.000+0000",
                    "updated": "2012-09-05T12:13:07.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51805",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frosch",
                        "name": "frosch",
                        "displayName": "Frank Br\u00fcckner",
                        "active": true
                    },
                    "body": "@[~peterhil]\r\nAsk the author of the report.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frosch",
                        "name": "frosch",
                        "displayName": "Frank Br\u00fcckner",
                        "active": true
                    },
                    "created": "2012-09-05T12:23:12.000+0000",
                    "updated": "2012-09-05T12:23:12.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11419\/transitions"
}