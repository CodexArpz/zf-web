{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3025",
    "key": "ZF-3025",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Invalid bind-variable position  when colon used in quoted parameter (using Mysqli)"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/11",
                "name": "Patch",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3025\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-06-19T05:22:03.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=antych",
                "name": "antych",
                "displayName": "Karol Grecki",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-04-02T11:15:16.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2013-03-04T10:22:09.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "$db->query(\"SELECT `foo`.`bar` FROM `xxx` WHERE (zzz = 'a\\'b+c:d')\");\n\nThis query was build using Db_Select\nsingle quote was properly escaped and passed to fetch method where it failed\n\nThe message is: 'Invalid bind-variable position ':d'\n\nFrom what I can tell the :d was mistaken for named parameter \nit only happens if the single quote was present in the same parameter\nafter removing it the query is processed correctly\n$db->query(\"SELECT `foo`.`bar` FROM `xxx` WHERE (zzz = 'ab+c:d')\");\n\nusing Mysqli adapter"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3025\/watchers",
                "isWatching": false,
                "watchCount": 7
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "zf-caretaker-adamlundrigan"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                "name": "peptolab",
                "displayName": "Simon Mundy",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-2059",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2059",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-7911",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7911",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-5063",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5063",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11215",
                    "filename": "statement.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sherrmann",
                        "name": "sherrmann",
                        "displayName": "Sven Herrmann",
                        "active": true
                    },
                    "created": "2008-04-09T12:55:54.000+0000",
                    "size": 419,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11215\/statement.diff"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10174",
                    "id": 10174,
                    "description": "Mini Release",
                    "name": "1.5.1",
                    "userReleaseDate": "25\/Mar\/08",
                    "archived": true,
                    "releaseDate": "2008-03-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10012",
                    "id": 10012,
                    "name": "Zend_Db",
                    "description": "interfaces, APIs, and adapters for various third-party data stores",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/20667",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=antych",
                        "name": "antych",
                        "displayName": "Karol Grecki",
                        "active": true
                    },
                    "body": "Another example\n{code}\n$db->query(\"REPLACE INTO foo (aaa) VALUES (('a\\'s aa '),('rv:1.8.1.11'))\");\n{code}\nescaped single quote in first parameter confuses the code\n'Zend_Db_Statement_Exception' with message 'Invalid bind-variable position ':1'",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=antych",
                        "name": "antych",
                        "displayName": "Karol Grecki",
                        "active": true
                    },
                    "created": "2008-04-03T03:28:43.000+0000",
                    "updated": "2008-04-03T03:28:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/20668",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=antych",
                        "name": "antych",
                        "displayName": "Karol Grecki",
                        "active": true
                    },
                    "body": "One more example with zend select\n{code}\n$db->select()->from('foo', 'bar')->where('xxx = ?', \"as'as:x\")->query();\n{code}\nInvalid bind-variable position ':x'",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=antych",
                        "name": "antych",
                        "displayName": "Karol Grecki",
                        "active": true
                    },
                    "created": "2008-04-03T03:42:12.000+0000",
                    "updated": "2008-04-03T03:42:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/20669",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ota",
                        "name": "ota",
                        "displayName": "Ota Mares",
                        "active": true
                    },
                    "body": "The same happens when a qurestion mark is used as value. \n\n{code}$db->select()->from('foo', 'bar')->where('xxx = ?', \"__'?__\")->query();{code}\n\nResult: SQLSTATE[HY093]: Invalid parameter number: no parameters were bound\n\nI think this is not fixable because of the nature of pdo querys. A workaround is to use parametrized querys instead of the zend_db quoting features.\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ota",
                        "name": "ota",
                        "displayName": "Ota Mares",
                        "active": true
                    },
                    "created": "2008-04-03T03:57:58.000+0000",
                    "updated": "2008-04-03T03:57:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/20670",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=antych",
                        "name": "antych",
                        "displayName": "Karol Grecki",
                        "active": true
                    },
                    "body": "The same query works fine with plain mysqli, I believe the problem lies in ZF code where placeholders are parsed",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=antych",
                        "name": "antych",
                        "displayName": "Karol Grecki",
                        "active": true
                    },
                    "created": "2008-04-03T04:33:39.000+0000",
                    "updated": "2008-04-03T04:33:39.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/20770",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sherrmann",
                        "name": "sherrmann",
                        "displayName": "Sven Herrmann",
                        "active": true
                    },
                    "body": "Problem is caused by a typo in DB\/Statement.php\n\nAttached Patch to fix this",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sherrmann",
                        "name": "sherrmann",
                        "displayName": "Sven Herrmann",
                        "active": true
                    },
                    "created": "2008-04-09T12:55:54.000+0000",
                    "updated": "2008-04-09T12:55:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21089",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Please evaluate and categorize as necessary.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-04-18T13:20:27.000+0000",
                    "updated": "2008-04-18T13:20:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21542",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=antych",
                        "name": "antych",
                        "displayName": "Karol Grecki",
                        "active": true
                    },
                    "body": "Sven's patch seems to fix the problem, can it make its way into trunk please?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=antych",
                        "name": "antych",
                        "displayName": "Karol Grecki",
                        "active": true
                    },
                    "created": "2008-05-02T06:24:33.000+0000",
                    "updated": "2008-05-02T06:24:33.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21642",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=antych",
                        "name": "antych",
                        "displayName": "Karol Grecki",
                        "active": true
                    },
                    "body": "I found another case  when this happens and attached patch doesn't help this time.\n\nA multi insert query with escaped quote and backslash (it's fine with just a quote):\n{code}\nREPLACE INTO foo VALUES \n('rv:1.8.1.2) \\'\\\\'), \n('rv:1.8.1.7) ')\n{code}\n\nI put debug code around $sql = $this->_stripQuoted($sql); in Zend_Db_Statement::_parseParameters($sql) and it looks like that function fails to remove those quoted elements, instead the whole first row of values is gone and the second one is intact so later it triggers an exception because it contains \":1\"",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=antych",
                        "name": "antych",
                        "displayName": "Karol Grecki",
                        "active": true
                    },
                    "created": "2008-05-09T04:29:12.000+0000",
                    "updated": "2008-05-09T04:29:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21648",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=antych",
                        "name": "antych",
                        "displayName": "Karol Grecki",
                        "active": true
                    },
                    "body": "Ok, the problem is the ending \\\\  - escaped backlash was preventing this regex \"\/'(\\\\'|[^'])*'\/\" from matching ending quote\nI modified the expression to ignore matching backslashes : \"\/'(\\\\'|\\\\{2}|[^'])*'\/\"\n\n{code}\nIndex: library\/Zend\/Db\/Statement.php\n===================================================================\n--- .\t(revision 9404)\n+++ .\t(working copy)\n@@ -187,7 +187,7 @@\n         $sql = preg_replace(\"\/$d($de|[^$d])*$d\/\", '', $sql);\n         \/\/ remove 'foo\\'bar'\n         if (!empty($q)) {\n-            $sql = preg_replace(\"\/$q($qe|[^$q])*$q\/\", '', $sql);\n+            $sql = preg_replace(\"\/$q($qe|\\\\\\\\{2}|[^$q])*$q\/\", '', $sql);\n         }\n \n         return $sql;\n{code}\n\nMaybe someone can verify and commit it",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=antych",
                        "name": "antych",
                        "displayName": "Karol Grecki",
                        "active": true
                    },
                    "created": "2008-05-09T07:50:46.000+0000",
                    "updated": "2008-05-09T07:50:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22573",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "Resolved in trunk r9727",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2008-06-19T05:22:03.000+0000",
                    "updated": "2008-06-19T05:22:03.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34770",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vdelau",
                        "name": "vdelau",
                        "displayName": "Vincent de Lau",
                        "active": true
                    },
                    "body": "It seems that this issue is not fixed properly. The patch proposed by Karol Grecki was not applied correctly. Instead of the second preg_replace, the first one was replaced.\n\nI've added a patch to http:\/\/framework.zend.com\/issues\/browse\/ZF-5063 that will put back (a modified version of) the original replacement.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vdelau",
                        "name": "vdelau",
                        "displayName": "Vincent de Lau",
                        "active": true
                    },
                    "created": "2009-09-21T08:47:14.000+0000",
                    "updated": "2009-09-21T08:47:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48613",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Is this still an issue?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-10-05T14:38:38.000+0000",
                    "updated": "2011-10-05T14:38:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51297",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dblunk",
                        "name": "dblunk",
                        "displayName": "Dominik Blunk",
                        "active": true
                    },
                    "body": "I think this issue is still unresolved (tested with 1.12.0rc1). The following code will throw an error \"Invalid bind-variable name ':2'\"\r\n\r\n{noformat}\r\n$data = $dbAdapter->quote(serialize(array('alpha', 'omega')));\r\n$sql = sprintf(\"insert into `import` (field_value) VALUES (%s)\", $data);\r\n$results = $dbAdapter->query($sql);\r\n{noformat}\r\n\r\nWhen removing the quoted \" the query works:\r\n\r\n{noformat}\r\n$data = $dbAdapter->quote(serialize(array('alpha', 'omega')));\r\n$data = str_replace('\\\"', '\"', $data);\r\n$sql = sprintf(\"insert into `import` (field_value) VALUES (%s)\", $data);\r\n$results = $dbAdapter->query($sql);\r\n{noformat} \r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dblunk",
                        "name": "dblunk",
                        "displayName": "Dominik Blunk",
                        "active": true
                    },
                    "created": "2012-07-09T14:46:03.000+0000",
                    "updated": "2012-07-09T14:46:03.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/53272",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=luinnar",
                        "name": "luinnar",
                        "displayName": "Mateusz Ju\u015bci\u0144ski",
                        "active": true
                    },
                    "body": "Please reopen this issue. I have the same problem with serialized data on ZF 1.12.2.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=luinnar",
                        "name": "luinnar",
                        "displayName": "Mateusz Ju\u015bci\u0144ski",
                        "active": true
                    },
                    "created": "2013-03-04T10:22:09.000+0000",
                    "updated": "2013-03-04T10:22:09.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3025\/transitions"
}