{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1509",
    "key": "ZF-1509",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Auth_Adapter_DbTable not functional in Oracle Database environment"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1509\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-01-23T12:10:44.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ruunstalker",
                "name": "ruunstalker",
                "displayName": "Tobias Gies",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-06-07T01:24:42.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-01-23T12:10:44.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "In Zend_Auth_Adapter_DbTable, the following code is used to generate a SQL statement:\n\n{code}$credentialExpression = new Zend_Db_Expr(\n            $this->_zendDb->quoteInto(\n                $this->_zendDb->quoteIdentifier($this->_credentialColumn)\n                . ' = ' . $this->_credentialTreatment, $this->_credential\n                )\n            . ' AS zend_auth_credential_match'\n            );{code}\n\nwhich generates the following SQL:\n\n{code}SELECT auth_user.*, pwd  = '[[password hash]]'\nAS zend_auth_credential_match\nFROM auth_user\nWHERE login = 'admin'{code}\n\nSince Oracle does seemingly not support logical expressions in the part of the SELECT statement before WHERE, this query fails in Oracle. In a quick test, Oracle 10g returns the error code ORA-00923 - SQL Invalid. Suggested fix would be the following SQL statement:\n\n{code}SELECT CASE COALESCE(count( * ),0)\nWHEN 0 THEN 0\nWHEN 1 THEN 1\nELSE 0\nEND AS zend_auth_credential_match\nFROM auth_user\nWHERE login = 'admin'\nAND pwd = '[[password hash]]'{code}\n\nThis is supported by Oracle, DB2 and MySQL; I was not able to test it in a Postges environment since I currently do not have access to one.\n\nAnother option would be to do it the \"old-fashioned\" way using the following SQL:\n\n{code}SELECT auth_user.*\nFROM auth_user\nWHERE login = 'admin'\nAND pwd  = '[[password hash]]'{code}\n\nand then checking if the query returns a row to check if a user with the given name and password exists."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1509\/watchers",
                "isWatching": false,
                "watchCount": 5
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-2236",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2236",
                    "type": {
                        "name": "Dependency",
                        "direction": "INBOUND",
                        "description": "is dependecy of"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10023",
                    "id": 10023,
                    "description": "Release Candidate 1",
                    "name": "1.0.0 RC1",
                    "userReleaseDate": "28\/May\/07",
                    "archived": true,
                    "releaseDate": "2007-05-28",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10084",
                    "id": 10084,
                    "name": "Zend_Auth",
                    "description": "A abstraction for various concrete web application authentication implementations.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14978",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ruunstalker",
                        "name": "ruunstalker",
                        "displayName": "Tobias Gies",
                        "active": true
                    },
                    "body": "added error code that oracle returns",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ruunstalker",
                        "name": "ruunstalker",
                        "displayName": "Tobias Gies",
                        "active": true
                    },
                    "created": "2007-06-07T01:29:10.000+0000",
                    "updated": "2007-06-07T01:29:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15005",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Assign to Darby.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-06-07T11:26:36.000+0000",
                    "updated": "2007-06-07T11:26:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15696",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "In both of the solutions you have posted, you cannot know if the match failed due to incorrect password or due to no such account.  The only way to resolve that is by running two queries.\n\nBoth {{CASE}} and {{COALESCE()}} are ANSI\/ISO SQL, and are supported by all RDBMS brands supported by Zend_Db.  However, I would simplify it like this:\n\n{code}\nSELECT CASE WHEN pwd = '[[password hash]]' THEN 1 ELSE 0 END \n    AS zend_auth_credential_match\nFROM auth_user\nWHERE login = 'admin'\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-07-05T14:32:49.000+0000",
                    "updated": "2007-07-05T14:32:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15698",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Assigning to [~ralph].",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-07-05T14:37:57.000+0000",
                    "updated": "2007-07-05T14:37:57.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15707",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ruunstalker",
                        "name": "ruunstalker",
                        "displayName": "Tobias Gies",
                        "active": true
                    },
                    "body": "yep, that seems to be the right solution. I opened this issue for someone on the german forums, and asking for an update now, he stated that he now uses the same query you pointed out. a pity he did not say this earlier :(\n\nhe also supplied the PHP code he uses to generate that statement. the relevant part of the authenticate() function now reads like this:\n{code}\n\/\/ --[snip]--\n        if (empty($this->_credentialTreatment) || (strpos($this->_credentialTreatment, \"?\") === false)) {\n            $this->_credentialTreatment = '?';\n        }\n\n        $credentialExpression = new Zend_Db_Expr(\n            $this->_zendDb->quoteInto('CASE WHEN '\n                . $this->_zendDb->quoteIdentifier($this->_credentialColumn)\n                . '=' . $this->_credentialTreatment, $this->_credential)\n                . ' THEN 1 ELSE 0 END '\n                . ' AS ' . $this->_zendDb->quoteIdentifier('zend_auth_credential_match'));\n\n        \/\/ get select\n        $dbSelect = $this->_zendDb->select();\n        $dbSelect->from($this->_tableName, array('*', $credentialExpression))\n                 ->where($this->_zendDb->quoteIdentifier($this->_identityColumn) . ' = ?', $this->_identity);\n\/\/ --[snip]--{code]",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ruunstalker",
                        "name": "ruunstalker",
                        "displayName": "Tobias Gies",
                        "active": true
                    },
                    "created": "2007-07-06T06:04:54.000+0000",
                    "updated": "2007-07-06T06:04:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15708",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ruunstalker",
                        "name": "ruunstalker",
                        "displayName": "Tobias Gies",
                        "active": true
                    },
                    "body": "sorry, please delete the comment above. something went wrong with that code snippet :(\n\nnow again: this is the PHP code used to build the query suggested by you:\n{code}    if (empty($this->_credentialTreatment) || (strpos($this->_credentialTreatment, \"?\") === false)) {\n            $this->_credentialTreatment = '?';\n        }\n\n        $credentialExpression = new Zend_Db_Expr(\n            $this->_zendDb->quoteInto('CASE WHEN '\n                . $this->_zendDb->quoteIdentifier($this->_credentialColumn)\n                . '=' . $this->_credentialTreatment, $this->_credential)\n                . ' THEN 1 ELSE 0 END '\n                . ' AS ' . $this->_zendDb->quoteIdentifier('zend_auth_credential_match'));\n\n        \/\/ get select\n        $dbSelect = $this->_zendDb->select();\n        $dbSelect->from($this->_tableName, array('*', $credentialExpression))\n                 ->where($this->_zendDb->quoteIdentifier($this->_identityColumn) . ' = ?', $this->_identity);{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ruunstalker",
                        "name": "ruunstalker",
                        "displayName": "Tobias Gies",
                        "active": true
                    },
                    "created": "2007-07-06T06:08:47.000+0000",
                    "updated": "2007-07-06T06:08:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18069",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mikaelkael",
                        "name": "mikaelkael",
                        "displayName": "Mickael Perraud",
                        "active": true
                    },
                    "body": "This patch functions with adapters mysqli and oracle :\n{code}\nIndex: library\/Zend\/Auth\/Adapter\/DbTable.php\n===================================================================\n--- library\/Zend\/Auth\/Adapter\/DbTable.php\t(revision 7261)\n+++ library\/Zend\/Auth\/Adapter\/DbTable.php\t(working copy)\n@@ -299,18 +299,17 @@\n             $this->_credentialTreatment = '?';\n         }\n \n-        $credentialExpression = new Zend_Db_Expr(\n-            $this->_zendDb->quoteInto(\n-                $this->_zendDb->quoteIdentifier($this->_credentialColumn)\n-                . ' = ' . $this->_credentialTreatment, $this->_credential\n-                )\n-            . ' AS zend_auth_credential_match'\n-            );\n+         $credentialExpression = new Zend_Db_Expr(\n+            $this->_zendDb->quoteInto('CASE WHEN '\n+            . $this->_zendDb->quoteIdentifier($this->_credentialColumn, true)\n+            . '=' . $this->_credentialTreatment, $this->_credential)\n+            . ' THEN 1 ELSE 0 END '\n+            . ' AS ' . $this->_zendDb->quoteIdentifier('zend_auth_credential_match', true));\n \n         \/\/ get select\n         $dbSelect = $this->_zendDb->select();\n         $dbSelect->from($this->_tableName, array('*', $credentialExpression))\n-                 ->where($this->_zendDb->quoteIdentifier($this->_identityColumn) . ' = ?', $this->_identity);\n+                 ->where($this->_zendDb->quoteIdentifier($this->_identityColumn, true) . ' = ?', $this->_identity);\n \n         \/\/ query for the identity\n         try {\n@@ -337,13 +336,14 @@\n \n         $resultIdentity = $resultIdentities[0];\n \n-        if ($resultIdentity['zend_auth_credential_match'] != '1') {\n+        if ($resultIdentity['zend_auth_credential_match'] != '1' && $resultIdentity['ZEND_AUTH_CREDENTIAL_MATCH'] != '1') {\n             $authResult['code'] = Zend_Auth_Result::FAILURE_CREDENTIAL_INVALID;\n             $authResult['messages'][] = 'Supplied credential is invalid.';\n             return new Zend_Auth_Result($authResult['code'], $authResult['identity'], $authResult['messages']);\n         }\n \n         unset($resultIdentity['zend_auth_credential_match']);\n+        unset($resultIdentity['ZEND_AUTH_CREDENTIAL_MATCH']);\n         $this->_resultRow = $resultIdentity;\n \n         $authResult['code'] = Zend_Auth_Result::SUCCESS;\n{code}\n\n - use autoQuoteIdentifiers\n - function with folding  case (lower and upper)\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mikaelkael",
                        "name": "mikaelkael",
                        "displayName": "Mickael Perraud",
                        "active": true
                    },
                    "created": "2007-12-27T15:10:42.000+0000",
                    "updated": "2007-12-27T15:10:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18122",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mikaelkael",
                        "name": "mikaelkael",
                        "displayName": "Mickael Perraud",
                        "active": true
                    },
                    "body": "The modification in R7278 (incubator) functions for Oracle, if we change :\n\n{code}\nIndex: library\/Zend\/Auth\/Adapter\/DbTable.php\n===================================================================\n--- library\/Zend\/Auth\/Adapter\/DbTable.php\t(revision 7316)\n+++ library\/Zend\/Auth\/Adapter\/DbTable.php\t(working copy)\n@@ -313,9 +313,9 @@\n         }\n \n         $credentialExpression = new Zend_Db_Expr(\n-            '(CASE WHEN ' . \n+            '(CASE WHEN ' .\n             $this->_zendDb->quoteInto(\n-                $this->_zendDb->quoteIdentifier($this->_credentialColumn)\n+                $this->_zendDb->quoteIdentifier($this->_credentialColumn, true)\n                 . ' = ' . $this->_credentialTreatment, $this->_credential\n                 )\n             . ' THEN 1 ELSE 0 END) AS zend_auth_credential_match'\n@@ -324,7 +324,7 @@\n         \/\/ get select\n         $dbSelect = $this->_zendDb->select();\n         $dbSelect->from($this->_tableName, array('*', $credentialExpression))\n-                 ->where($this->_zendDb->quoteIdentifier($this->_identityColumn) . ' = ?', $this->_identity);\n+                 ->where($this->_zendDb->quoteIdentifier($this->_identityColumn, true) . ' = ?', $this->_identity);\n \n         return $dbSelect;\n     }\n@@ -378,13 +378,19 @@\n \n     protected function _authenticateValidateResult($resultIdentity)\n     {\n-        if ($resultIdentity['zend_auth_credential_match'] != '1') {\n+        if (isset($resultIdentity['zend_auth_credential_match'])) {\n+            $key='zend_auth_credential_match';\n+        }\n+        if (isset($resultIdentity['ZEND_AUTH_CREDENTIAL_MATCH'])) {\n+            $key='ZEND_AUTH_CREDENTIAL_MATCH';\n+        }\n+        if ($resultIdentity[$key] != '1') {\n             $authResult['code'] = Zend_Auth_Result::FAILURE_CREDENTIAL_INVALID;\n             $authResult['messages'][] = 'Supplied credential is invalid.';\n             return new Zend_Auth_Result($authResult['code'], $authResult['identity'], $authResult['messages']);\n         }\n \n-        unset($resultIdentity['zend_auth_credential_match']);\n+        unset($resultIdentity[$key]);\n         $this->_resultRow = $resultIdentity;\n \n         $authResult['code'] = Zend_Auth_Result::SUCCESS;\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mikaelkael",
                        "name": "mikaelkael",
                        "displayName": "Mickael Perraud",
                        "active": true
                    },
                    "created": "2007-12-31T05:03:28.000+0000",
                    "updated": "2007-12-31T05:03:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18123",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ruunstalker",
                        "name": "ruunstalker",
                        "displayName": "Tobias Gies",
                        "active": true
                    },
                    "body": "Ralph, will you add Mickael's diff file to the incubator or should I write to the ML to ask the community to test the changes before we apply it?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ruunstalker",
                        "name": "ruunstalker",
                        "displayName": "Tobias Gies",
                        "active": true
                    },
                    "created": "2007-12-31T05:53:12.000+0000",
                    "updated": "2007-12-31T05:53:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18126",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Essentially, (and I know very little about oracle's intricacies), this looks like its handling an issue of column identifier case translations right?\n\nI am gonna reach out to [~bkarwin] (since he the db guru) and get his OK on this patch, and perhaps he might have other insights...\n\n-ralph",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2007-12-31T11:55:17.000+0000",
                    "updated": "2007-12-31T11:55:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18130",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Yes, I think the patch including Mickael's last modifications looks pretty good.  Using the SQL {{CASE}} expression should work, since that expression is standard SQL and I have tested that before in all the database brands supported by Zend_Db.  \n\nYou have unit tests for the Auth DbTable adapter, but they are hardcoded to use SQLite.  You should allow configuration so testers can change the adapter type in {{TestConfiguration.php}} and try it with MySQL, Oracle, DB2, etc.    \n\nThe second argument for {{quoteIdentifier()}} is needed for Oracle and DB2.  Oracle and DB2 do some weird things to simulate case-insensitivity of identifiers, so users of those databases requested a feature to globally disable automatic quoting of identifiers in queries run by ZF internal code.\n\nHowever, for the column alias {{zend_auth_credential_match}}, I think you should quote the alias without the conditional effect.  Use {{quoteIdentifier()}} without the second arg, thus forcing it to be the case of the string you give.  This will simplify the rest of the code.  Users should be able to cope with the {{zend_auth_credential_match}} column in the query result set being case-sensitive.\n\nAnother suggestion:  don't feel compelled to do everything in as few PHP statements as possible.  Long, multi-line statements with deep nested parentheses are hard to read.  It's fine to create a few local variables that hold quoted identifiers and SQL expressions.  It makes the code easier to read and easier to update later if you need to.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-12-31T14:17:15.000+0000",
                    "updated": "2007-12-31T14:17:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18139",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mikaelkael",
                        "name": "mikaelkael",
                        "displayName": "Mickael Perraud",
                        "active": true
                    },
                    "body": "With the corrections suggested by [~bkarwin]:\n{code}\nIndex: DbTable.php\n===================================================================\n--- DbTable.php\t(revision 7327)\n+++ DbTable.php\t(working copy)\n@@ -315,16 +315,17 @@\n         $credentialExpression = new Zend_Db_Expr(\n             '(CASE WHEN ' . \n             $this->_zendDb->quoteInto(\n-                $this->_zendDb->quoteIdentifier($this->_credentialColumn)\n+                $this->_zendDb->quoteIdentifier($this->_credentialColumn, true)\n                 . ' = ' . $this->_credentialTreatment, $this->_credential\n                 )\n-            . ' THEN 1 ELSE 0 END) AS zend_auth_credential_match'\n+            . ' THEN 1 ELSE 0 END) AS '\n+            . $this->_zendDb->quoteIdentifier('zend_auth_credential_match')\n             );\n \n         \/\/ get select\n         $dbSelect = $this->_zendDb->select();\n         $dbSelect->from($this->_tableName, array('*', $credentialExpression))\n-                 ->where($this->_zendDb->quoteIdentifier($this->_identityColumn) . ' = ?', $this->_identity);\n+                 ->where($this->_zendDb->quoteIdentifier($this->_identityColumn, true) . ' = ?', $this->_identity);\n \n         return $dbSelect;\n     }\n{code}\nThis functions for mysqli and oracle without need to check the case of zend_auth_credential_match.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mikaelkael",
                        "name": "mikaelkael",
                        "displayName": "Mickael Perraud",
                        "active": true
                    },
                    "created": "2008-01-01T14:55:28.000+0000",
                    "updated": "2008-01-01T14:55:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18140",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Patch commited in r7328.  Please check :)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2008-01-01T19:47:18.000+0000",
                    "updated": "2008-01-01T19:47:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18142",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mikaelkael",
                        "name": "mikaelkael",
                        "displayName": "Mickael Perraud",
                        "active": true
                    },
                    "body": "I omit this correction :\n{code}\nIndex: DbTable.php\n===================================================================\n--- DbTable.php\t(revision 7329)\n+++ DbTable.php\t(working copy)\n@@ -388,6 +388,7 @@\n         unset($resultIdentity['zend_auth_credential_match']);\n         $this->_resultRow = $resultIdentity;\n \n+        $authResult['identity'] = $this->_identity;\n         $authResult['code'] = Zend_Auth_Result::SUCCESS;\n         $authResult['messages'][] = 'Authentication successful.';\n         return new Zend_Auth_Result($authResult['code'], $authResult['identity'], $authResult['messages']);\n{code}\ndue to the code division.\nI confirm it's OK for MySQL 5.0 and Oracle 9i.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mikaelkael",
                        "name": "mikaelkael",
                        "displayName": "Mickael Perraud",
                        "active": true
                    },
                    "created": "2008-01-02T01:07:40.000+0000",
                    "updated": "2008-01-02T01:07:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18468",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Resolved in r7598",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2008-01-23T12:10:44.000+0000",
                    "updated": "2008-01-23T12:10:44.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1509\/transitions"
}