{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8894",
    "key": "ZF-8894",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "StripTags PREG_BACKTRACK_LIMIT_ERROR when stripping html comments "
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8894\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/5",
                "name": "Cannot Reproduce"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-01-21T14:00:47.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=espinaemmanuel",
                "name": "espinaemmanuel",
                "displayName": "Emmanuel Espina",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-01-21T12:17:50.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-01-22T12:58:32.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "The new implementation of Zend_Filter_StripTags fails on the next code \r\n\r\n{code}\r\n<?php\r\nrequire_once 'Zend\/Filter.php';\r\nrequire_once 'Zend\/Filter\/StripTags.php';\r\n\r\n$html = '<style type=\"text\/css\">\r\n\t\t<!--\r\n\t\t\tp { margin-bottom: 0.21cm }\r\n\t\t-->\r\n\t\t<\/style>\r\n\t\t<p>TEXT<\/p>';\r\n\t\r\n$chain = new Zend_Filter ( );\r\n$chain->addFilter ( new Zend_Filter_StripTags());\r\n$html = $chain->filter ( $html );\r\n\r\n{code}\r\n\r\nThe expected result is TEXT but an empty string is returned.\r\n\r\nThe error generates on this line of the Zend_Filter_StripTags implementation:\r\n\r\n{code}\r\npublic function filter($value)\r\n    {\r\n        \/\/ Strip HTML comments first\r\n        $valueCopy = preg_replace('#<!--(?:[^<]+|<(?!\\!--))*?(--\\s*>)#us', '', (string) $value);\r\n{code}\r\n\r\npreg_replace returns null because of a PREG_BACKTRACK_LIMIT_ERROR (acording to the output of preg_last_error()\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8894\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10400",
                    "id": 10400,
                    "description": "Mini Release",
                    "name": "1.9.7",
                    "userReleaseDate": "11\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-11",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10013",
                    "id": 10013,
                    "name": "Zend_Filter",
                    "description": "methods for filtering data",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37904",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Can you please test against trunk and\/or the release-1.10 branch? some minor changes were made to that regexp that might affect your scenario.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2010-01-21T12:20:28.000+0000",
                    "updated": "2010-01-21T12:20:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37906",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=espinaemmanuel",
                        "name": "espinaemmanuel",
                        "displayName": "Emmanuel Espina",
                        "active": true
                    },
                    "body": "I tried with this versions \r\nhttp:\/\/framework.zend.com\/svn\/framework\/standard\/branches\/release-1.10\/library\/Zend\/Filter\/StripTags.php\r\nhttp:\/\/framework.zend.com\/svn\/framework\/standard\/trunk\/library\/Zend\/Filter\/StripTags.php\r\n\r\nBoth have the same regular expression, and it still doesn't work.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=espinaemmanuel",
                        "name": "espinaemmanuel",
                        "displayName": "Emmanuel Espina",
                        "active": true
                    },
                    "created": "2010-01-21T12:39:04.000+0000",
                    "updated": "2010-01-21T12:39:04.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37908",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I can't reproduce the issue -- it runs without error for me, and correctly strips all tags and comments.\r\n\r\nWhat OS and PHP version (and 32 or 64 bit) are you using? I've tested on 5.2.10 and 5.3.1, both on linux 32bit.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2010-01-21T13:02:21.000+0000",
                    "updated": "2010-01-21T13:02:21.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37909",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=espinaemmanuel",
                        "name": "espinaemmanuel",
                        "displayName": "Emmanuel Espina",
                        "active": true
                    },
                    "body": "I've tested in\r\nPHP Version 5.2.10-2ubuntu6.4 (64 bits)\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=espinaemmanuel",
                        "name": "espinaemmanuel",
                        "displayName": "Emmanuel Espina",
                        "active": true
                    },
                    "created": "2010-01-21T13:32:23.000+0000",
                    "updated": "2010-01-21T13:32:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37911",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "@Emmanuel: Can you please also give the exact revision number you have tested against? (r20500 or above?)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-21T13:44:46.000+0000",
                    "updated": "2010-01-21T13:44:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37912",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I've had a colleague test under 64bit linux, with no issues. My inclination is that you are either (a) not providing the full HTML snippet that fails, or (b) the PCRE lib your PHP install was compiled against is really old (not unlikely, if you're really on ubuntu 6.4).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2010-01-21T14:00:26.000+0000",
                    "updated": "2010-01-21T14:00:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37916",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=espinaemmanuel",
                        "name": "espinaemmanuel",
                        "displayName": "Emmanuel Espina",
                        "active": true
                    },
                    "body": "I dont know where to find the revision number.\r\n\r\nIf i rise the pcre.backtrack_limit to a huge number (like 10000000) the script works\r\n\r\nThe version of php is the one that is downloaded from the repository in the last version of ubuntu (9.10). However the version is \"PHP Version 5.2.10-2ubuntu6.4\"\r\n\r\nThe version of PCRE is 7.8 2008-09-05\r\n\r\nI have tested this on 3 machines:\r\n\r\nAMD Turion X2 64 - Ubuntu 9.10\r\nAMD Phenom X3 64 - Ubuntu 9.10\r\nAMD Duron - Debian (i didn't write down the version)\r\n\r\nAll the versions of PHP are from the repository, i didn't compile them\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=espinaemmanuel",
                        "name": "espinaemmanuel",
                        "displayName": "Emmanuel Espina",
                        "active": true
                    },
                    "created": "2010-01-21T18:27:02.000+0000",
                    "updated": "2010-01-21T18:27:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37920",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "You can find the revision directly from SVN when you're on trunk.\r\n\r\nOr go to the file Zend_Filter_StripTags and simply look at the header. This is the revision number which is in interest for us.\r\n\r\nNote: This issue was fixed some days ago for 1.10, and yesterday for trunk.\r\nTry the new 1.10RC to see if you still have this issue. When it persists in the new revision I would ask to reopen this issue.\r\n\r\nNote2: As the new version does no longer unicode transisions the amount of  backtracks should now be very low.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-22T00:07:56.000+0000",
                    "updated": "2010-01-22T00:13:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37921",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Note3: The line you gave as result of the error shows me that you have used an outdated version which must be at last one or two weeks old.\r\n\r\nOn release 1.10 this line has been changed on 15.01. and on trunk with 21.01. as we had to test it more deeply.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-22T00:12:35.000+0000",
                    "updated": "2010-01-22T00:12:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37934",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=espinaemmanuel",
                        "name": "espinaemmanuel",
                        "displayName": "Emmanuel Espina",
                        "active": true
                    },
                    "body": "I downloaded revision 20514 from http:\/\/framework.zend.com\/svn\/framework\/standard\/branches\/release-1.10\/library\/Zend\/Filter\/StripTags.php\r\n\r\nAnd it doesnt work. I made a simpler test case of the part with the problem\r\n\r\n{code}\r\n$html = preg_replace('#<!--(?:[^<]+|<(?!\\!--))*?(--\\s*>)#s', '', '<div><!-- --><\/div><p>TEXT<\/p>');\r\n{code}\r\n\r\nthat results in $html = null (error!)\r\n\r\nbut\r\n\r\n{code}\r\n$html = preg_replace('#<!--(?:[^<]+|<(?!\\!--))*?(--\\s*>)#s', '', '<p><!-- --><\/p><p>TEXT<\/p>');\r\n{code}\r\n\r\nworks fine! (the only diference are the div replaced with p)\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=espinaemmanuel",
                        "name": "espinaemmanuel",
                        "displayName": "Emmanuel Espina",
                        "active": true
                    },
                    "created": "2010-01-22T05:05:13.000+0000",
                    "updated": "2010-01-22T05:05:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37951",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Seems to me like an PHP internal bug.\r\n\r\nIn my eyes there is no way for ZF to prevent running into preg_replace problems when they are dependend on the given input.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-22T12:58:32.000+0000",
                    "updated": "2010-01-22T12:58:32.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8894\/transitions"
}