{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6173",
    "key": "ZF-6173",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Mail doesn't send HTML email correctly - shows up an as attachment, or plaintext (client dependent)"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6173\/votes",
                "votes": 2,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stevebakh",
                "name": "stevebakh",
                "displayName": "Steven Bakhtiari",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-04-01T02:53:33.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T21:37:52.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "attachment",
                "email",
                "evolution",
                "exchange",
                "html",
                "mail",
                "microsoft",
                "outlook"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Attempting to send HTML email using Zend_Mail produces different results from using PHP's native mail function (when using the default transport (the wrapper for php's mail).\n\nI am using the postfix MTA and it works flawlessly when sending html email from PHP. When attempting to send using Zend_Mail, email shows up as an attachment in Microsoft Outlook and just shows as plaintext, revealing all the tags in Evolution. Sending to webmail, such as Gmail seemingly works fine.\n\nBelow are two examples, one using Zend_Mail, the other, PHP's mail function. They both send identical content, PHP's mail() works as expected, Zend_Mail does not. \n\n{code:none}\n$subject = 'Test HTML email';\n$message = '<html><body><p>This is <span style=\"color: red;\">HTML<\/span> email.<\/p><\/body><\/html>';\n\n$headers  = 'MIME-Version: 1.0' . \"\\n\";\n$headers .= 'Content-type: text\/html; charset=utf-8' . \"\\n\";\n\n\/\/mail('foobar@example.com', $subject, $message, $headers);\n\n$mail = new Zend_Mail('utf-8');\n$mail->addTo('foobar@example.com', 'Steven');\n$mail->setFrom(Zend_Registry::get('config')->email->noreply, 'no-reply');\n$mail->setSubject($subject);\n$mail->setBodyHtml($message);\n\/\/$mail->send();\n{code}\n\nI have been able to reproduce this continually and also from another ZF based website (sparia.de), which appears to suffer the same problem (register and check the email that's received).\n\nI will attempt to look further into the problem when I get home from work."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6173\/watchers",
                "isWatching": false,
                "watchCount": 4
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11850",
                    "filename": "headers.txt",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stevebakh",
                        "name": "stevebakh",
                        "displayName": "Steven Bakhtiari",
                        "active": true
                    },
                    "created": "2009-04-01T07:11:58.000+0000",
                    "size": 3516,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11850\/headers.txt"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10300",
                    "id": 10300,
                    "description": "Mini Release",
                    "name": "1.7.8",
                    "userReleaseDate": "30\/Mar\/09",
                    "archived": false,
                    "releaseDate": "2009-03-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10018",
                    "id": 10018,
                    "name": "Zend_Mail",
                    "description": "high-level utility to build MIME-compliant messages and send using a mail transport adapter",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29848",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dasprid",
                        "name": "dasprid",
                        "displayName": "Ben Scholzen",
                        "active": true
                    },
                    "body": "http:\/\/support.microsoft.com\/kb\/814111\n\nThe attachment part is actually a Microsoft issue. Simple way to fix it is to remove the (not required) content-disposition:\n\n{code}\nIndex: Zend\/Mail.php\n===================================================================\n--- Zend\/Mail.php\t(revision 14574)\n+++ Zend\/Mail.php\t(working copy)\n@@ -326,7 +326,6 @@\n         $mp = new Zend_Mime_Part($txt);\n         $mp->encoding = $encoding;\n         $mp->type = Zend_Mime::TYPE_TEXT;\n-        $mp->disposition = Zend_Mime::DISPOSITION_INLINE;\n         $mp->charset = $charset;\n \n         $this->_bodyText = $mp;\n@@ -367,7 +366,6 @@\n         $mp = new Zend_Mime_Part($html);\n         $mp->encoding = $encoding;\n         $mp->type = Zend_Mime::TYPE_HTML;\n-        $mp->disposition = Zend_Mime::DISPOSITION_INLINE;\n         $mp->charset = $charset;\n \n         $this->_bodyHtml = $mp;\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dasprid",
                        "name": "dasprid",
                        "displayName": "Ben Scholzen",
                        "active": true
                    },
                    "created": "2009-04-01T03:24:13.000+0000",
                    "updated": "2009-04-01T03:24:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29856",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dasprid",
                        "name": "dasprid",
                        "displayName": "Ben Scholzen",
                        "active": true
                    },
                    "body": "The HTML problem in evolution seems to be related to the Exchange server, getting the mail directly from the mail account works just fine. Testing Outlook without Exchange server soon.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dasprid",
                        "name": "dasprid",
                        "displayName": "Ben Scholzen",
                        "active": true
                    },
                    "created": "2009-04-01T05:04:35.000+0000",
                    "updated": "2009-04-01T05:04:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29863",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dasprid",
                        "name": "dasprid",
                        "displayName": "Ben Scholzen",
                        "active": true
                    },
                    "body": "The Outlook problem also only occurs when used via Exchange server, the patch is in any case not neccessary. Doing further testing.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dasprid",
                        "name": "dasprid",
                        "displayName": "Ben Scholzen",
                        "active": true
                    },
                    "created": "2009-04-01T05:49:31.000+0000",
                    "updated": "2009-04-01T05:49:31.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29864",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stevebakh",
                        "name": "stevebakh",
                        "displayName": "Steven Bakhtiari",
                        "active": true
                    },
                    "body": "Agreed - working with Ben, we've discovered the issue is not specific to the client, but more to exchange.\n\nThe tests carried out use both evolution and outlook, sitting behind an exchange server. HTML email sent from Zend_Mail exhibits the error, but when accessing POP or IMAP mail via outlook and evolution, there are no problems.\n\nNow to find out what Zend_Mail is doing that exchange is choking on...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stevebakh",
                        "name": "stevebakh",
                        "displayName": "Steven Bakhtiari",
                        "active": true
                    },
                    "created": "2009-04-01T05:50:10.000+0000",
                    "updated": "2009-04-01T05:50:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29871",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stevebakh",
                        "name": "stevebakh",
                        "displayName": "Steven Bakhtiari",
                        "active": true
                    },
                    "body": "The file contains headers from 4 emails.\n\nAll emails were opened in Microsoft Outlook using 2 different accounts - one IMAP, the other behind Microsoft exchange. All examples use the code presented in the initial post.\n\n* Sending HTML email from Zend_Mail to the account behind exchange doesn't work as intended. The html is sent as an attachment.\n\n* Sending HTML email from PHP's mail function to the account behind exchange works as expected.\n\n* Sending HTML email from Zend_mail to an IMAP account, bypassing exchange, works as intended.\n\n* Sending HTML email from PHP's mail function to an IMAP account, bypassing exchange, also works as intended.\n\nSo basically, in all the scenarios tried, only the scenario involving Zend_Mail and exchange doesn't work as intended. It appears the content-type and charset declarations are not present when sent from Zend_Mail to the exchange account. Without checking the code, I would assume that perhaps the content type is applied only to the content, not to the entire mail, whereas when sending using PHP's mail function, the content-type and charset are always set for the entire mail.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stevebakh",
                        "name": "stevebakh",
                        "displayName": "Steven Bakhtiari",
                        "active": true
                    },
                    "created": "2009-04-01T07:12:02.000+0000",
                    "updated": "2009-04-01T07:12:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29872",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stevebakh",
                        "name": "stevebakh",
                        "displayName": "Steven Bakhtiari",
                        "active": true
                    },
                    "body": "Whoops, just to add to the comment above, all tests were carried out with an unpatched Zend_Mail as previous testing determined that the content-disposition issue was not at fault here.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stevebakh",
                        "name": "stevebakh",
                        "displayName": "Steven Bakhtiari",
                        "active": true
                    },
                    "created": "2009-04-01T07:14:04.000+0000",
                    "updated": "2009-04-01T07:14:04.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31815",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "Reset the priority from \"Blocker\" to \"Minor\" since the issue does not seem to be a Zend_Mail, but an exchange problem (i also have the same problem with exchange with other mail sending libraries).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2009-06-12T14:36:16.000+0000",
                    "updated": "2009-06-12T14:36:16.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34618",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "I have tested this with Outlook 2007 behind an Exchange server and it works correctly with the Inline Content Disposition.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2009-09-18T06:23:13.000+0000",
                    "updated": "2009-09-18T06:23:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43462",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "Can we close this one?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2010-12-04T14:20:47.000+0000",
                    "updated": "2010-12-04T14:20:47.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6173\/transitions"
}