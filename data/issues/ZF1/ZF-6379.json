{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6379",
    "key": "ZF-6379",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "AjaxContext ->initContext doesn't set specified context for action"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6379\/votes",
                "votes": 2,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=unimatrix01",
                "name": "unimatrix01",
                "displayName": "Raymond van Velzen",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-04-22T07:47:19.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T21:37:56.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "ajaxContext",
                "initContext"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Hi,\n\nI've carefully followed the documentation for using AjaxContext. \n\nIn my controller, in the init() method, I've specified that a certain action ('check') has an json context:\n\n$this->_helper->ajaxContext->addActionContext('check', 'json');\n$this->_helper->ajaxContext->initContext();\n\nThis should suffice to make the action switch to JSON when called with XHR. However, this does not happen.\nOnly when the context is explicitly supplied, it will be used, like this:\n\n$this->_helper->ajaxContext->initContext('json');\n\nHowever, that means that the *whole* controller will be using this context, not just a specific action.\nWhat you'd expect, given the documentation, is that after adding the action context, that context will be switched to automatically for that action only.\n\nThis exact problem has been noticed by at least 3 different persons on the mailing list, and in one case, a discussion with Matthew resulted in an issue being added here (ZF-3162). Matthew agreed it made sense.\n\nI was hoping this would get fixed in the new 1.8 release, but I've just seen that the code there is still the same. The following code could easily fix it:\n\n    \tif (empty($format))  {\n    \t\t$action = $this->getRequest()->getActionName();\n    \t\t$formats = $this->getActionContexts($action);\n    \t\tif (count($formats) == 1) {\n    \t\t\t$format = $formats[0];\n    \t\t}\n    \t}\n\n(to be inserted in AjaxContext.php, line 69)\nThis is almost exactly the same code as was previously suggested, by the way.\n\nI hope the ZF dev team will seriously consider updating AjaxContext to make it work properly. If I just don't understand how it is supposed to work, I'd appreciate a clear explanation of how to better use AjaxContext.\n\nThank you very much. \n\nKind regards,\n\nRaymond\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6379\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10300",
                    "id": 10300,
                    "description": "Mini Release",
                    "name": "1.7.8",
                    "userReleaseDate": "30\/Mar\/09",
                    "archived": false,
                    "releaseDate": "2009-03-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10011",
                    "id": 10011,
                    "name": "Zend_Controller",
                    "description": "front controller, including router and dispatcher",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38382",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jamesthomson",
                        "name": "jamesthomson",
                        "displayName": "James Thomson",
                        "active": true
                    },
                    "body": "I too experienced this after following the examples here: http:\/\/framework.zend.com\/manual\/en\/zend.controller.actionhelpers.html#zend.controller.actionhelpers.contextswitch.ajaxcontext\r\n\r\nWhile I agree that this is a minor bug I think that it's impact is more severe in terms of denting the confidence of developers new to the framework, following the examples as I did.\r\n\r\nRaymond - thanks very much for the fix.\r\n\r\nJames.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jamesthomson",
                        "name": "jamesthomson",
                        "displayName": "James Thomson",
                        "active": true
                    },
                    "created": "2010-02-10T03:19:40.000+0000",
                    "updated": "2010-02-10T03:19:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38521",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=konrness",
                        "name": "konrness",
                        "displayName": "Konr Ness",
                        "active": true
                    },
                    "body": "Your request must have a parameter of format=json in it.\r\n\r\nEither like this:\r\nhttp:\/\/www.example.com\/mymodule\/mycontroller\/myaction\/format\/json\r\n\r\nor:\r\n\r\nhttp:\/\/www.example.com\/mymodule\/mycontroller\/myaction?format=json\r\n\r\nThis is mentioned in the documentation at the link that James provided:\r\n\r\n\"On the client end, your AJAX library will simply request the endpoints '\/comment\/view', '\/comment\/form', and '\/comment\/process', and pass the 'format' parameter: '\/comment\/view\/format\/html', '\/comment\/form\/format\/html', '\/comment\/process\/format\/json'. (Or you can pass the parameter via query string: e.g., \"?format=json\".)\"",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=konrness",
                        "name": "konrness",
                        "displayName": "Konr Ness",
                        "active": true
                    },
                    "created": "2010-02-17T20:48:17.000+0000",
                    "updated": "2010-02-17T20:48:17.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6379\/transitions"
}