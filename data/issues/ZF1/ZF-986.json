{
    "expand": "html",
    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-986",
    "key": "ZF-986",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Date_DateObject and date_default_timezone_get\/set()"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-986\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/version\/10022",
                    "id": 10022,
                    "description": "Beta Release; all components feature complete for 1.0",
                    "name": "0.9.0",
                    "userReleaseDate": "17\/Mar\/07",
                    "archived": true,
                    "releaseDate": "2007-03-17",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-03-02T02:14:06.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                "name": "gavin",
                "displayName": "Gavin",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-02-27T14:30:08.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-05T14:43:52.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Problem:\n\nThe function date_default_timezone_get()\/set() functions invoke PHP's error handler if the input is invalid.\nEither Zend_Date* should behave \"correctly\" with invalid input, or an error should be thrown, per coding standards.\n\nDetails:\n\nWhen working with Zend_Date objects, the date_default_timezone_get\/set() is used to regulate the timezone used within other PHP functions used by Zend_Date*.  Both of those functions invoke PHP's error handler on invalid input.  However, use of '@' to suppress error handling does not work as expected, when the developer has installed their own error handler bypassing the error suppression feature in PHP's error handler.\n\nhttp:\/\/php.net\/date_default_timezone_get\nhttp:\/\/php.net\/date_default_timezone_set\n\nUse of \ntimezone_identifier_list() produces a 500+ element size array, which can be used to check input before invoking date_default_timezone_set().  In our minimum required version of PHP {{#ifdef EXPERIMENTAL_DATE_SUPPORT}} wraps the function {{timezone_identifier_list()}}.  Thus, we have no way of reliably predicting whether or not {{date_default_timezone_set()}} will invoke PHP's error handler for ZF's minimal supported version of PHP.\n\nThus, using an older version of PHP without {{EXPERIMENTAL_DATE_SUPPORT}} enabled, and providing invalid timezones to Zend_Date will result in PHP notices, if the developer has installed their own error handler.\n\nIn all other situations, Zend_Date* should be able to efficiently detect if  {{timezone_identifier_list()}} is available and then cache the list (return results).  Then Zend_Date* could throw informative errors on invalid input (when necessary and appropriate) for newer versions of PHP or older versions with {{EXPERIMENTAL_DATE_SUPPORT}} enabled.  For example, if {{date_default_timezone_get()}} fails (i.e. system is not configured with a working default timezone), then Zend_Date* uses its own default.  However, for {{date_default_timezone_set()}}, attempts to use an invalid timezone should throw an error, when possible (see exception above, where detection of the problem is not possible) instead of ignoring the problem, because the resulting Zend_Date object will behave contrary to the developer's expectations (i.e. has the wrong timezone).\n\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-986\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/version\/10020",
                    "id": 10020,
                    "description": "Preview Release; I18N, Acl, Auth, Session",
                    "name": "0.7.0",
                    "userReleaseDate": "18\/Jan\/07",
                    "archived": true,
                    "releaseDate": "2007-01-18",
                    "released": true
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/version\/10021",
                    "id": 10021,
                    "description": "Preview release; DB, Filter, Log",
                    "name": "0.8.0",
                    "userReleaseDate": "21\/Feb\/07",
                    "archived": true,
                    "releaseDate": "2007-02-21",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/component\/10072",
                    "id": 10072,
                    "name": "Zend_Date",
                    "description": "Zend_Date is the basic library for the handling of all date, time and calendar-related issues.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/13019",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "body": "Is a unit test needed to help clarify this issue?",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "created": "2007-02-27T14:32:27.000+0000",
                    "updated": "2007-02-27T14:32:27.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/13020",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "We already have a unit test for testing invalid timezone id.\n\nIt is not practical to use PHPUnit to test what happens when timezone_identifier_list() is not available, because we can't trap a PHP error using PHPUnit.  So I would say don't bother to try to write a unit test for this case with our current tools.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-02-27T14:41:18.000+0000",
                    "updated": "2007-02-27T14:41:18.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/13021",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "This issue has already been fixed with SVN 3663 some hours ago.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2007-02-27T15:07:32.000+0000",
                    "updated": "2007-02-27T15:07:32.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/13023",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "body": "For any who might search and find this issue, if you get the following error, then see \"[Always Set a Default Timezone|http:\/\/framework.zend.com\/manual\/en\/zend.date.html#zend.date.setdefaulttimezone].\"\n\n{quote}Warning: date_default_timezone_get() [function.date-default-timezone-get]: It is not safe to rely on the system's timezone settings. Please use the date.timezone setting, the TZ environment variable or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We had to select 'UTC' because your platform doesn't provide functionality for the guessing algorithm in ...{quote}",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "created": "2007-02-27T15:45:36.000+0000",
                    "updated": "2007-02-27T15:45:36.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/13024",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "body": "{quote}This issue has already been fixed with SVN 3663 some hours ago.{quote}\n\nExcellent!  .. except the result is not cached in a static class variable, and this code executes on the creation of every Zend_Date object.\n\n{code}\nif (function_exists('timezone_identifiers_list')) {\n       if (!in_array($zone, timezone_identifiers_list())) {\n             throw new Zend_Date_Exception(\"timezone ($zone) is not a known timezone\");\n       }\n}\n$result = @date_default_timezone_set($zone);\n{code}\n\nAlso, a very minor issue, in principle we should provide relevant data as arguments to the exception class constructor (see Zend\/Date\/Exception.php) so that the data can be examined algorithmically without need to parse the error string.  I've added the data as arguments to the construction of the exception object.\n\nWhy are we using '@' with {{@date_default_timezone_set()}}?  If there is an error, when using {{date_default_timezone_set()}}, why should we suppress the error without throwing an exception?",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "created": "2007-02-27T16:05:12.000+0000",
                    "updated": "2007-02-27T16:05:12.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/13025",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "{quote}Why are we using '@' with @date_default_timezone_set()? If there is an error, when using date_default_timezone_set(), why should we suppress the error without throwing an exception?{quote}\n\nBecause WHEN timezone_identifier_list is not avaiable \nthen the error is suppressed if a user gives a false timezone.\n\nOnly if identifier_list is not avaiable and the user overwrites the error handler we are no longer able to supress possible errorous inputs.\n",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2007-02-27T16:56:09.000+0000",
                    "updated": "2007-02-27T16:56:09.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/13026",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "body": "Why are we suppressing the error, if a user gives an invalid timezone?\n\nDoesn't the resulting object behave contrary to the user's expectations, if the timezone was invalid (i.e. the developer made a typo in the name of the timezone)?",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "created": "2007-02-27T17:10:02.000+0000",
                    "updated": "2007-02-27T17:10:02.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/13027",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "body": "P.S. I updated the unit test to work with the new approach of throwing an error when we know that the requested timezone is not available.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "created": "2007-02-27T20:00:25.000+0000",
                    "updated": "2007-02-27T20:00:25.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/13088",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "We can not change the $_timezone to be static as proposed.\n\nThis would lead to the problem that ALL Zend_Date objects are fix coupled to only ONE timezone.\nNow you can have a different timezone into each Zend_Date object as it can also be done within php's date extension.\n\nNow I can create a date object for europe and one for america... and both are calculating the offset seperatly.\n\nData as argument was changed already by you... btw: I dont see the benefit because the I18N classes are almost the only one which have this behaviour. All other Zend classes have it not... shouldn't there be a coding standard for all or none classes supporting this behaviour ??? This is of course relevant for a new issue.\n\nA possible error will now not longer be suppressed if no date extension is installed.\n\nBtw: I also reworked the useage of timezone checking... we now try to create a timezone object instead of checking the complete list ourself... this is much faster.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2007-03-02T02:11:00.000+0000",
                    "updated": "2007-03-02T02:11:00.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/13089",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Fixed with SVN 3689",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2007-03-02T02:14:05.000+0000",
                    "updated": "2007-03-02T02:14:05.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/13156",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "body": "I only proposed caching the results of {{timezone_identifier_list()}}.  I did not suggest making $_timezone static.\nI think your alternative using http:\/\/php.net\/timezone_open is quite effective, better than the other alternatives above, and was reasonably fast in my simplistic benchmark test :)\n\n{quote}\"Data as argument was changed already by you... btw: I dont see the benefit because the I18N classes are almost the only one which have this behaviour. All other Zend classes have it not... shouldn't there be a coding standard for all or none classes supporting this behaviour ??? This is of course relevant for a new issue.\"{quote}\n\nSome ZF classes do pass data as arguments when creating custom exceptions.  The ZF coding standard encourages this practice.  Debate over this practice should occur on the mailing list and in comments on the draft coding standards wiki page:  http:\/\/framework.zend.com\/wiki\/x\/PQ\n\n{quote}\"A possible error will now not longer be suppressed if no date extension is installed.\"{quote}\nYes, and I like the comment that marks the line of code that might result in an error.  Since we can not detect or fix the error, and we can not throw an exception, it is better to allow the error to occur than hid the error from the developer, because the error is important and affects the behavior of the object in a bad way.  Thus, the error should not be suppressed, so that the developer can learn about the error and remedy the problem.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "created": "2007-03-05T21:15:40.000+0000",
                    "updated": "2007-03-05T21:15:40.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-986\/transitions"
}