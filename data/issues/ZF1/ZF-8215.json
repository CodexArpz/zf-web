{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8215",
    "key": "ZF-8215",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "FilteringSelect with ItemFileReadStore from \"data\" parameter fails when used programmatically"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8215\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tridem",
                "name": "tridem",
                "displayName": "Webdevilopers",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-11-04T04:13:18.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T21:38:10.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I create a Zend_Dojo_Form_Element_FilteringSelect element using a store. It comes from a data parameter (not url).\r\nThe data comes from an Zend_Dojo_Data object.\r\n\r\nUsing the declarative method I get a HTML Container with a data attribute that includes an esacped version of the data object. Working fine!\r\n\r\nSwitching to the programmatic method I get a Javascript line for creating the store. But the data attribute is empty. So the element can't find any items and is not working.\r\nThe correct error message for this case from dojo is:\r\ndijit.form.ComboBox: TypeError: this._arrayOfTopLevelItems is undefined\r\n\r\nI tried to change this behaviour with the context switch helper but could find no solution.\r\n\r\nCode in view for both usages:\r\n{code}\r\n<?php\r\n$data = array(\r\n    array(\r\n        'id' => 1,\r\n        'name' => 'foo'\r\n    ),\r\n    array(\r\n        'id' => 2,\r\n        'name' => 'bar'\r\n    )\r\n);\r\n\r\n$dojoData = new Zend_Dojo_Data('id', $data, 'name'); \/\/ results in: {\"identifier\":\"id\",\"items\":[{\"id\":1,\"name\":\"foo\"},{\"id\":2,\"name\":\"bar\"}],\"label\":\"name\"} \r\n\r\n$element = new Zend_Dojo_Form_Element_FilteringSelect(\r\n    'id',\r\n    array(\r\n        'label' => 'label',\r\n        'value' => 2,\r\n        'required' => false,\r\n\t    'storeId'   => 'store',\r\n\t    'storeType' => 'dojo.data.ItemFileReadStore',\r\n\t    'storeParams' => array(\r\n            'data' => $dojoData\r\n\t    ),\r\n\t    'dijitParams' => array(\r\n            'pageSize' => 5,\r\n            'autocomplete' => 'false',\r\n            'queryExpr' => '*${0}*'\r\n\t    )\r\n    )\r\n);\r\n?>\r\n\r\n<?php echo $element; ?>\r\n{code}\r\n\r\nResult for declarative usage (WORKING):\r\n{code}\r\nZend_Dojo_View_Helper_Dojo::setUseDeclarative();\r\n\r\n<div dojoType=\"dojo.data.ItemFileReadStore\" jsId=\"store\" \r\n\r\ndata=\"{&quot;identifier&quot;:&quot;id&quot;,&quot;items&quot;:[{&quot;id&quot;:1,&quot;name&quot;:&quot;foo&quot;},{&quot;id&quot;:2,&quot;name&quot;:&quot;bar&quot;}],&quot;label&quot;:&quot;name&quot;}\">\r\n<\/div>\r\n<input options=\"\" listsep=\"&lt;br \/&gt;\" id=\"id\" name=\"id\" value=\"2\" type=\"text\" store=\"store\" pageSize=\"5\" autocomplete=\"false\" queryExpr=\"*${0}*\" dojoType=\"dijit.form.FilteringSelect\">\r\n{code}\r\n\r\n\r\nResult for declarative usage (NOT WORKING):\r\n{code}\r\nZend_Dojo_View_Helper_Dojo::setUseDeclarative();\r\n\r\n<script type=\"text\/javascript\">\r\n\/\/<![CDATA[\r\ndojo.require(\"dojo.data.ItemFileReadStore\");\r\n    dojo.require(\"dijit.form.FilteringSelect\");\r\n    dojo.require(\"dojo.parser\");\r\ndojo.addOnLoad(function() {\r\n    dojo.forEach(zendDijits, function(info) {\r\n        var n = dojo.byId(info.id);\r\n        if (null != n) {\r\n            dojo.attr(n, dojo.mixin({ id: info.id }, info.params));\r\n        }\r\n    });\r\n    dojo.parser.parse();\r\n});\r\n    dojo.addOnLoad(function() {\r\nvar store = new dojo.data.ItemFileReadStore({\"data\":{}});\r\ndijit.byId(\"id\").attr(\"store\", store);\r\n});\r\nvar zendDijits = [{\"id\":\"id\",\"params\":{\"pageSize\":5,\"autocomplete\":\"false\",\"queryExpr\":\"*${0}*\",\"dojoType\":\"dijit.form.FilteringSelect\"}}];\r\n\/\/]]>\r\n<\/script>\r\n\r\n<input options=\"\" listsep=\"&lt;br \/&gt;\" id=\"id\" name=\"id\" value=\"2\" type=\"text\">\r\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8215\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10380",
                    "id": 10380,
                    "description": "Mini Release",
                    "name": "1.9.5",
                    "userReleaseDate": "27\/Oct\/09",
                    "archived": false,
                    "releaseDate": "2009-10-27",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10311",
                    "id": 10311,
                    "name": "Zend_Dojo",
                    "description": "Dojo integration with Zend Framework",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39220",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=philipp",
                        "name": "philipp",
                        "displayName": "Philipp",
                        "active": true
                    },
                    "body": "I looked into the source code creating the problem. The problem is \"Zend_Json::encode($extraParams)\", where $extraParams are the StoreParams at this point. So simply changing \"'data' => $dojoData\" to \"'data' => $dojoData->toArray()\" solves the issue. Somewhat unexpected, imho the behaviour should be changed in future releases to be more consistent.\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=philipp",
                        "name": "philipp",
                        "displayName": "Philipp",
                        "active": true
                    },
                    "created": "2010-03-14T04:46:27.000+0000",
                    "updated": "2010-03-14T04:46:27.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8215\/transitions"
}