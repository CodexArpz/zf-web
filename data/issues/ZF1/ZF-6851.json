{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6851",
    "key": "ZF-6851",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_File_Transfer_Adapter_Http rename filter issues, it clears the path set"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6851\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10320",
                    "id": 10320,
                    "description": "Minor Release",
                    "name": "1.9.0",
                    "userReleaseDate": "31\/Jul\/09",
                    "archived": false,
                    "releaseDate": "2009-07-31",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-06-11T13:06:46.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gatorv",
                "name": "gatorv",
                "displayName": "Christopher Valderrama",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-05-28T12:27:30.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-06-11T13:06:46.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "destination",
                "file",
                "http",
                "path",
                "rename",
                "transfer"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When you add a Rename Filter to the Transfer Adapter, it clears the path, the problem is here:\n{code:title=Http.php|borderStyle=solid}\n                $filename = $directory . $content['name'];\n                $rename   = $this->getFilter('Rename');\n                if ($rename !== null) {\n                    $filename = $rename->getNewName($content['tmp_name']);\n                    $key      = array_search(get_class($rename), $this->_files[$file]['filters']);\n                    unset($this->_files[$file]['filters'][$key]);\n                }\n{code} \n\nAfterwards this point, if there is a custom path move_uploaded_file doesn't recognize it, a solution is to add the directory after the rename:\n{code:title=Http.php|borderStyle=solid}\n                $filename = $content['name'];\n                $rename   = $this->getFilter('Rename');\n                if ($rename !== null) {\n                    $filename = $rename->getNewName($content['tmp_name']);\n                    $key      = array_search(get_class($rename), $this->_files[$file]['filters']);\n                    unset($this->_files[$file]['filters'][$key]);\n                }\n                \n            \t$directory   = '';\n                $destination = $this->getDestination($file);\n                if ($destination !== null) {\n                    $directory = $destination . DIRECTORY_SEPARATOR;\n                }\n                $filename = $directory . $filename;\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6851\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-6408",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6408",
                    "type": {
                        "name": "Duplicate",
                        "direction": "OUTBOUND",
                        "description": "duplicates"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10330",
                    "id": 10330,
                    "description": "Mini Release",
                    "name": "1.8.2",
                    "userReleaseDate": "27\/May\/09",
                    "archived": false,
                    "releaseDate": "2009-05-27",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10320",
                    "id": 10320,
                    "name": "Zend_File_Transfer",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31446",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Please provide a example of what you are doing.\nJust commenting ZF source code does not enable us to reproduce the behaviour.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-05-28T12:31:42.000+0000",
                    "updated": "2009-05-28T12:31:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31447",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gatorv",
                        "name": "gatorv",
                        "displayName": "Christopher Valderrama",
                        "active": true
                    },
                    "body": "Ok:\n{code:title=add.php|borderStyle=solid}\n               $image = $this->_form->image;\n\t\t$image->setDestination($this->_iconPath)\n\t\t\t      ->addFilter('Rename', 'Icon_'.$pKey);\n\t\tif (!$image->receive()) {\n\t\t\t\/\/ Ups a error\n\t\t\t$this->_helper->FlashMessenger('error'));\n\t\t} else {\n\t\t\t\/\/ Update the received row\n\t\t\t$icono = $this->_model->find($pKey)->current();\n\t\t\t$icono->imagen = $image->getFileName(null, false);\n\t\t\t$icono->save();\n\t\t}\n{code} \n\nUpon calling receive I have noticed that $icono->imagen contains .\/Icon_1 (if I get it with the path) and I see no file on the upload dir, upon debugging, the error was caused after the rename of the file, after the code entering:\n{code:title=Http.php|borderStyle=solid}\n$filename = $directory . $content['name'];\n                $rename   = $this->getFilter('Rename');\n                if ($rename !== null) {\n                    $filename = $rename->getNewName($content['tmp_name']);\n                    $key      = array_search(get_class($rename), $this->_files[$file]['filters']);\n                    unset($this->_files[$file]['filters'][$key]);\n                }\n{\/code}\n\n$filename contained only \"Icon_1\" not \"\/path\/to\/uploads\/Icon_1\" as expected.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gatorv",
                        "name": "gatorv",
                        "displayName": "Christopher Valderrama",
                        "active": true
                    },
                    "created": "2009-05-28T12:43:59.000+0000",
                    "updated": "2009-05-28T12:43:59.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31449",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "You know that the Rename filter has to be used with the complete path ? The examples in the manual and also the blog do not show any other usage nor has this been supported in past.\nBy omitting the path at the rename filter you said to use the actual path which is the temporary upload path of php.\n\nChanging this behaviour is not a bug, but a feature request. Note that this is partitially also a BC break and can not be integrated as is without deeper investigation.\nAdditionally your code makes it impossible to use the rename filter to set different directories as it's actually recommended.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-05-28T13:20:26.000+0000",
                    "updated": "2009-05-28T13:20:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31450",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gatorv",
                        "name": "gatorv",
                        "displayName": "Christopher Valderrama",
                        "active": true
                    },
                    "body": "Didn't saw that anotation, and in the tutorial in your blog you where using a only filename in the filter, I suppose I didn't read that well, I'll update my code.\n\nThanks for your fast respone.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gatorv",
                        "name": "gatorv",
                        "displayName": "Christopher Valderrama",
                        "active": true
                    },
                    "created": "2009-05-28T13:28:18.000+0000",
                    "updated": "2009-05-28T13:28:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31776",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Duplicate of ZF-6408",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-06-11T13:05:06.000+0000",
                    "updated": "2009-06-11T13:05:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31778",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "New feature implemented with r16009",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-06-11T13:06:46.000+0000",
                    "updated": "2009-06-11T13:06:46.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6851\/transitions"
}