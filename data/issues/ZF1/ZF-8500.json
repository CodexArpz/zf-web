{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8500",
    "key": "ZF-8500",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Mysql does not support nested transactions, code ignitor specifically supports this, zend does not (yet)"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8500\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=josh.ribakoff@gmail.com",
                "name": "josh.ribakoff@gmail.com",
                "displayName": "Josh Ribakoff",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-12-08T15:19:32.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T21:37:53.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I noticed if you nest transactions, if the inner transaction commits but the outer transaction rolls back, the changes take effect and ZF does not throw any exceptions or handle that nicely. It appears from this thread (http:\/\/codeigniter.com\/forums\/viewthread\/82771\/) that CI has a feature that makes it so only the outer commit\/rollback takes effect.\r\n\r\nThis prevented me from testing code that uses Zend_Db & transactions, because my test itself needed to rollback any changes that happened during the test. But the code I was testing had it's own beginTransaction() and commit()\r\n\r\nI guess in code ignitor that inner commit() would be ignored."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8500\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12469",
                    "filename": "transaction_emulation.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=josh.ribakoff@gmail.com",
                        "name": "josh.ribakoff@gmail.com",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "created": "2009-12-08T15:48:27.000+0000",
                    "size": 1857,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12469\/transaction_emulation.patch"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12471",
                    "filename": "transaction_emulation2.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=josh.ribakoff@gmail.com",
                        "name": "josh.ribakoff@gmail.com",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "created": "2009-12-08T16:46:49.000+0000",
                    "size": 1855,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12471\/transaction_emulation2.patch"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12472",
                    "filename": "transaction_emulation3.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=josh.ribakoff@gmail.com",
                        "name": "josh.ribakoff@gmail.com",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "created": "2009-12-08T17:27:19.000+0000",
                    "size": 1857,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12472\/transaction_emulation3.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10160",
                    "id": 10160,
                    "description": "Major Release",
                    "name": "Next Major Release",
                    "archived": false,
                    "released": false
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10131",
                    "id": 10131,
                    "name": "Zend_Db_Adapter_Mysqli",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36816",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=josh.ribakoff@gmail.com",
                        "name": "josh.ribakoff@gmail.com",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "body": "Possible patch is attached. The $_should_emulate_nesting flag which defaults to false will retain it's current behavior. Setting the flag to true mimics code ignitor's feature (which makes my green bar happy)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=josh.ribakoff@gmail.com",
                        "name": "josh.ribakoff@gmail.com",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "created": "2009-12-08T15:48:31.000+0000",
                    "updated": "2009-12-08T15:48:31.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36818",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=josh.ribakoff@gmail.com",
                        "name": "josh.ribakoff@gmail.com",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "body": "Fixed isNested() method (see patch2)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=josh.ribakoff@gmail.com",
                        "name": "josh.ribakoff@gmail.com",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "created": "2009-12-08T16:46:49.000+0000",
                    "updated": "2009-12-08T16:46:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36819",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=josh.ribakoff@gmail.com",
                        "name": "josh.ribakoff@gmail.com",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "body": "After trying it out in some more unit tests, it appears patch 3 would hold the correct logic.\r\n\r\nIt should be noted 1 caveat of using this patch, and enabling the flag, would be that extraneous calls to commit would put the transaction counter of sync. But this is good enough for my own development (I wrapped the adapter seeing as you may not desire to use this functionality in the zend core)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=josh.ribakoff@gmail.com",
                        "name": "josh.ribakoff@gmail.com",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "created": "2009-12-08T17:27:19.000+0000",
                    "updated": "2009-12-08T17:27:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42368",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jshpro2",
                        "name": "jshpro2",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "body": "On PDO you get an exception when you call beginTransaction() more than once, so I augmented the code like this:\r\n\r\nfunction beginTransaction()\r\n     {\r\n        $this->_transaction_depth++;\r\n        if( $this->_transaction_depth > 0 )\r\n        {\r\n            return;\r\n        }\r\n        return parent::beginTransaction();\r\n     }",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jshpro2",
                        "name": "jshpro2",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "created": "2010-09-24T23:19:22.000+0000",
                    "updated": "2010-09-24T23:19:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42369",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jshpro2",
                        "name": "jshpro2",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "body": "I should also note, this specific behavior (how it works now) is detrimental to unit testing. If you have a piece of code that uses the database, the standard unit testing practice is to wrap the unit test method in a transaction itself. However if the SUT tries to start it's own transaction, or commit it's \"inner\" transaction - you either crash your tests - or worse yet the \"inner\" transaction would be committed, leaving global state for the next unit test method.\r\n\r\nAs you can see, the way it works now is completely contrary to best practices. (in regards to this one issue - the rest of the component is terrific)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jshpro2",
                        "name": "jshpro2",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "created": "2010-09-24T23:23:10.000+0000",
                    "updated": "2010-09-24T23:23:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42925",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=josh.ribakoff@gmail.com",
                        "name": "josh.ribakoff@gmail.com",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "body": "One pitfall to this I discovered over the months, you'd have to make the 'nest' count a public property, and the user should remember to reset it to -1 when catching exceptions.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=josh.ribakoff@gmail.com",
                        "name": "josh.ribakoff@gmail.com",
                        "displayName": "Josh Ribakoff",
                        "active": true
                    },
                    "created": "2010-11-10T11:45:38.000+0000",
                    "updated": "2010-11-10T11:45:38.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8500\/transitions"
}