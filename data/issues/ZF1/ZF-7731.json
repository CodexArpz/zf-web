{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7731",
    "key": "ZF-7731",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Date_DateObject::date returns timestamp with added timezone offset when timestamp is outside the range of what PHP's date() can handle"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7731\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10360",
                    "id": 10360,
                    "description": "Minor Release",
                    "name": "1.10.0",
                    "userReleaseDate": "27\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-27",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-08-31T10:16:26.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robinlindroos",
                "name": "robinlindroos",
                "displayName": "Robin Lindroos",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-08-31T05:41:56.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-09-01T03:18:04.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Getting the timestamp of a Zend_Date object returns a wrong timestamp if the timestamp is outside the range of what PHP's date() function can handle. That is roughly years 1901 to 2038 on my system. In the method Zend_Date_DateObject::date the timestamp is added with the current timezone offset if the year is outside the range 1901 - 2038. As I have understood it the timestamp is not timezone-dependant and should therefore always be relative to the GMT timezone. In other words the timestamp should stay the same regardless of what timezone you are in. I'm in the timezone \"Europe\/Helsinki\" or \"EET\" with a timezone offset of 7200 seconds. This offset is always wrongly added to the timestamp if it is outside the 1901 - 2038 range, but stays as it is if inside that range.\n\nCode to proove the bug:\n<?php\ndate_default_timezone_set('EET');\n\/\/December 6th 1917 10:10:10\n$timeArr = array('day' => 6, 'month' => 12, 'year' => 1917, 'hour' => 10, 'minute' => 10, 'second' => 10);\n$dateObj = new Zend_Date($timeArr);\nvar_dump($dateObj); \/\/shows that the private _unixTimestamp has a value of -1643212190\necho $dateObj->get(Zend_Date::TIMESTAMP); \/\/returns -1643212190 which is correct\n\n\/\/December 6th 1817 10:10:10\n$timeArr = array('day' => 6, 'month' => 12, 'year' => 1817, 'hour' => 10, 'minute' => 10, 'second' => 10);\n$dateObj = new Zend_Date($timeArr);\nvar_dump($dateObj); \/\/shows that the private _unixTimestamp has a value of -4798885790\necho $dateObj->get(Zend_Date::TIMESTAMP); \/\/returns -4798878590 which is incorrect\n\n\/\/December 6th 2041 10:10:10\n$timeArr = array('day' => 6, 'month' => 12, 'year' => 2041, 'hour' => 10, 'minute' => 10, 'second' => 10);\n$dateObj = new Zend_Date($timeArr);\nvar_dump($dateObj); \/\/shows that the private _unixTimestamp has a value of 2269930210\necho $dateObj->get(Zend_Date::TIMESTAMP); \/\/returns 2269937410 which is incorrect\n?>"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7731\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-7740",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7740",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10361",
                    "id": 10361,
                    "description": "Mini Release",
                    "name": "1.9.2",
                    "userReleaseDate": "25\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10072",
                    "id": 10072,
                    "name": "Zend_Date",
                    "description": "Zend_Date is the basic library for the handling of all date, time and calendar-related issues.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34103",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "You should have checked yourself your assumption. Then you would have seen that it's incorrect.\nRun the following example code:\n{code}\ndate_default_timezone_set('EET');\nvar_dump(mktime(0,0,0,10,10,2008));\n$date = new Zend_Date('10.10.2008 00:00:00 EET');\nvar_dump($date->getTimestamp());\n\ndate_default_timezone_set('GMT');\nvar_dump(mktime(0,0,0,10,10,2008));\n$date = new Zend_Date('10.10.2008 00:00:00 GMT');\nvar_dump($date->getTimestamp());\n{code}\n\nThe returned content is:\n{code}\nint 1223586000\nstring '1223586000' (length=10)\nint 1223596800\nstring '1223596800' (length=10)\n{code}\n\nAs you can see the timestamp IS dependent from the timezone. When you think a little bit then the reason is quite logically.\n\nWhen you set a date within timezone 1 then within timezone 2 the ACTUAL date is not the same... it differs by the timezone at the same timestamp.\n\nAt the timestamp where GMT has 02:00:00 within GMT+1 you have 03:00:00. By setting 02:00:00 within the timezone GMT+1 you have of course a difference of one hour which you are setting.\n\nSo the behaviour you have seen is correct.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-08-31T10:15:48.000+0000",
                    "updated": "2009-08-31T10:15:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34107",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robinlindroos",
                        "name": "robinlindroos",
                        "displayName": "Robin Lindroos",
                        "active": true
                    },
                    "body": "Yes, everything is fine with dates inside the range of 1901 to 2038, so your example works fine as I new from my example. And Zend_Date::getTimestamp() always returns the correct timestamp. But if you call Zend_Date::get(Zend_Date::TIMESTAMP) then the value is incorrect. Let me give you another more simple example to demonstrate what goes wrong:\n\n{code}\n$timestamp = '-1643212190';\n$dateObj = new Zend_Date($timestamp);\necho $timestamp . \"\\n\";\necho $dateObj->getTimestamp() . \"\\n\";\necho $dateObj->get(Zend_Date::TIMESTAMP) . \"\\n\";\n\n$timestamp = '-4798885790';\n$dateObj = new Zend_Date($timestamp);\necho $timestamp . \"\\n\";\necho $dateObj->getTimestamp() . \"\\n\";\necho $dateObj->get(Zend_Date::TIMESTAMP);\n{code}\n\nThis produces the output:\n\n{code}\n-1643212190\n-1643212190\n-1643212190\n-4798885790\n-4798885790\n-4798878590\n{code}\n\nWhy is the last unix timestamp not the same when calling get(Zend_Date::TIMESTAMP) and calling getTimestamp()?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robinlindroos",
                        "name": "robinlindroos",
                        "displayName": "Robin Lindroos",
                        "active": true
                    },
                    "created": "2009-08-31T10:45:35.000+0000",
                    "updated": "2009-08-31T10:45:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34120",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robinlindroos",
                        "name": "robinlindroos",
                        "displayName": "Robin Lindroos",
                        "active": true
                    },
                    "body": "The explanation Thomas Weidner gives here does not solve the issue I have. Of course the timestamp differs depending on the timezone when SETTING the date of a Zend_Date object from a date. But the timestamp should not be different in different timezones when GETTING the timestamp from the Zend_Date object.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robinlindroos",
                        "name": "robinlindroos",
                        "displayName": "Robin Lindroos",
                        "active": true
                    },
                    "created": "2009-09-01T01:04:50.000+0000",
                    "updated": "2009-09-01T01:04:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34123",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "You noted in your description:\n{quote}\n As I have understood it the timestamp is not timezone-dependant and should therefore always be relative to the GMT timezone. In other words the timestamp should stay the same regardless of what timezone you are in.\n{quote}\n\nThis is a false assumption as you can see in the attached example. The timezone is always different for the same date when you are in another timezone.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-09-01T02:50:45.000+0000",
                    "updated": "2009-09-01T02:50:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34129",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robinlindroos",
                        "name": "robinlindroos",
                        "displayName": "Robin Lindroos",
                        "active": true
                    },
                    "body": "Yes, I just meant that the timestamp is not and should not be timezode-dependant when getting the timezone from the date object. So just problem in communication :)\n\nBut great work with Zend_Date! It will be an invaluable part of our PHP project where it is necessary to handle dates as timestamps before the year 1901.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robinlindroos",
                        "name": "robinlindroos",
                        "displayName": "Robin Lindroos",
                        "active": true
                    },
                    "created": "2009-09-01T03:18:03.000+0000",
                    "updated": "2009-09-01T03:18:03.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7731\/transitions"
}