{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8486",
    "key": "ZF-8486",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Db_Table->getRow() fails due to incorrect check in seek method"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8486\/votes",
                "votes": 4,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10501",
                    "id": 10501,
                    "description": "Mini Release",
                    "name": "1.11.1",
                    "userReleaseDate": "30\/Nov\/10",
                    "archived": false,
                    "releaseDate": "2010-11-30",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-11-18T14:23:01.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sverde1",
                "name": "sverde1",
                "displayName": "Sandi Verdev",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-12-07T02:25:44.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-11-18T14:23:02.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When using Zend_Db_Table for fetching data from certain row from DB table Zend Framework ncorrectly checks range of available\/seekable positions in Zend_Db_Table_Rowset_Abstract::seek() on line 323 and throws exception \"Illegal index is ...\".\r\n\r\nThe solution is to change condition which triggers exception with fixing comparison from grather or equal to grather.\r\n\r\nBEFORE:\r\n\r\nif ($position < 0 || $position >= $this->_count) { ...\r\n\r\nAFTER:\r\n\r\nif ($position < 0 || $position > $this->_count) { ..."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/1",
                "name": "Blocker"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8486\/watchers",
                "isWatching": false,
                "watchCount": 4
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13086",
                    "filename": "Abstract.php",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kalyanraj",
                        "name": "kalyanraj",
                        "displayName": "kalyanraj",
                        "active": true
                    },
                    "created": "2010-05-19T11:36:13.000+0000",
                    "size": 39746,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13086\/Abstract.php"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12770",
                    "filename": "ZF-8486_unit-test.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2010-02-19T12:46:08.000+0000",
                    "size": 763,
                    "mimeType": "text\/x-diff",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12770\/ZF-8486_unit-test.diff"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10390",
                    "id": 10390,
                    "description": "Mini Release",
                    "name": "1.9.6",
                    "userReleaseDate": "24\/Nov\/09",
                    "archived": false,
                    "releaseDate": "2009-11-24",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10133",
                    "id": 10133,
                    "name": "Zend_Db_Table",
                    "description": "Lightweight OO interface to database tables and rowsets.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37600",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bladed",
                        "name": "bladed",
                        "displayName": "Stephan \"Bladed\" de Souza",
                        "active": true
                    },
                    "body": "The issue still exists on 1.9.7, already checked!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bladed",
                        "name": "bladed",
                        "displayName": "Stephan \"Bladed\" de Souza",
                        "active": true
                    },
                    "created": "2010-01-12T03:04:06.000+0000",
                    "updated": "2010-01-12T03:04:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38115",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nyko18",
                        "name": "nyko18",
                        "displayName": "Nicolas Grevet",
                        "active": true
                    },
                    "body": "This happens when you apply a foreach (for example) on a rowset and then try to get a particular row of this same rowset. After the foreach, the Iterator index is left at the end, after the last element (max(index)+1). The getRow() method fails to seek back to the former index because it simply doesn't exists in the Iterator. Happens in 1.10.0.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nyko18",
                        "name": "nyko18",
                        "displayName": "Nicolas Grevet",
                        "active": true
                    },
                    "created": "2010-01-29T05:27:27.000+0000",
                    "updated": "2010-01-29T05:27:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38215",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bladed",
                        "name": "bladed",
                        "displayName": "Stephan \"Bladed\" de Souza",
                        "active": true
                    },
                    "body": "Still exists on 1.10.0",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bladed",
                        "name": "bladed",
                        "displayName": "Stephan \"Bladed\" de Souza",
                        "active": true
                    },
                    "created": "2010-02-02T10:29:17.000+0000",
                    "updated": "2010-02-02T10:29:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38248",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "I'm looking into this today",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2010-02-04T07:20:03.000+0000",
                    "updated": "2010-02-04T07:20:03.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38354",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "The issue is actually not in seek(), seek() seems to be preforming the proper checks.  I think the problem you are experiencing is using getRow().\r\n\r\nCurrently, when you iterate over a rowset, after iteration the internal pointer is set to point beyond the final row of the rowset.  While this pauses no general issue with iteration, it will cause an issue when you call getRow($count-1, false), where false is whether or not to seek() BACK to the pointers original position, which of course if invalid.\r\n\r\nI'll have to research if having a pointer point beyond the bounds after iteration is really what we want.  In the mean time, try to rewind() the rowset after use to avoid any issues with getRow() trying to seek to an invalid position.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2010-02-08T08:13:55.000+0000",
                    "updated": "2010-02-08T08:13:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38593",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Adding patch for unit test.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2010-02-19T12:46:09.000+0000",
                    "updated": "2010-02-19T12:46:09.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40544",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kalyanraj",
                        "name": "kalyanraj",
                        "displayName": "kalyanraj",
                        "active": true
                    },
                    "body": "The fix for the illegal index is \r\n        if ($seek == true) {\r\n            $this->seek($key);\r\n        }",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kalyanraj",
                        "name": "kalyanraj",
                        "displayName": "kalyanraj",
                        "active": true
                    },
                    "created": "2010-05-19T11:36:16.000+0000",
                    "updated": "2010-05-19T11:36:16.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40545",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bladed",
                        "name": "bladed",
                        "displayName": "Stephan \"Bladed\" de Souza",
                        "active": true
                    },
                    "body": "The problem is a simple out of range checking, as proposed on the issue.\r\n\r\nIf you has a Rowset with 4 rows and you check the last on a while loop will assume:\r\n{noformat} \r\n$this->_count = 4 \/\/ The last index is 3 (count - 1)\r\n$position = 4 \/\/ The now working last index, not count - 1\r\n{noformat} \r\nThe script:\r\n{noformat} \r\nif ($position < 0 || $position >= $this->_count) {\r\n{noformat} \r\nThe result on Issue\r\n{noformat} \r\nif (4 < 0 || 4 >= 4) { \r\nTRUE\r\n{noformat} \r\n\r\nProposed\r\n{noformat} \r\nif ($position < 0 || $position > $this->_count) {\r\n{noformat} \r\nThe result\r\n{noformat} \r\nif (4 < 0 || 4 > 4) { \r\nFALSE\r\n{noformat} \r\n\r\nIt NOT throws an Exception and assuming the last pos is 4, and not 3 ( count - 1 ).\r\n\r\nAnd Ralph, do the unit-testing with proposed one, and check! I repeat myself: Its a simple \"out of range\", the count value is NEVER the last index!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bladed",
                        "name": "bladed",
                        "displayName": "Stephan \"Bladed\" de Souza",
                        "active": true
                    },
                    "created": "2010-05-19T12:39:35.000+0000",
                    "updated": "2010-05-19T12:39:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43112",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "I will agree that calling getRow() after an iteration throwing an exception is a bug.  The problem is this: iteration happens, the pointer is left if an invalid state (basically the last element plus 1)- which is the correct behavior in PHP.  The problem comes in that getRow() is (wrongly) attempting to leverage seeking and current() to find the desired row.  THIS is the wrong thing to do, especially since it will try to restore the seek position after it is done.  Since the seek position was invalid to begin off with, it will throw an exception when attempting to restore the seek position to the invalid state.\r\n\r\nWhen you say this:\r\n{code}\r\nif ($position < 0 || $position > $this->_count) {\r\n{code}\r\nis what should be done, this is wrong.  The last valid position is the count - 1, which is why the right hand side is $position >= $this->_count.  In other words, if the count is 4, the last valid position is index 3, not 4.  This is why we want the exception to be thrown.  Put yet another way, the valid range for seek() is 0 to N-1,  Not 1 to N.\r\n\r\nI have a fix none-the-less.  Will apply soon.\r\n\r\n-ralph",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2010-11-18T14:14:24.000+0000",
                    "updated": "2010-11-18T14:14:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43113",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Fixed at r23379 in trunk and at r23380 in release branch 1.11",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2010-11-18T14:23:02.000+0000",
                    "updated": "2010-11-18T14:23:02.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8486\/transitions"
}