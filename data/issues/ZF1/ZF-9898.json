{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9898",
    "key": "ZF-9898",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "hardcoded environment in Zend_Tool_Project_Context_Zf_BootstrapFile::getApplicationInstance()"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9898\/votes",
                "votes": 6,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mrolli",
                "name": "mrolli",
                "displayName": "Michael Rolli",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-05-27T03:47:46.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-01-03T09:19:37.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I'm currently trying to implement some Zend_Tool_Project_Provider to do application jobs (like search indexing) and therefore require to use resources from the webapp bootstrap, i.e. db connection. That's the way I'm doing it a provider right now:\r\n\r\n{code}\r\n$profile = $this->_loadProfileRequired();\r\n$app = $profile->search('BootstrapFile')->getApplicationInstance();\r\n$app->bootstrap();\r\n$db = $app->getBootstrap()->getResource('db');\r\n{code}\r\n\r\nRight now, the environment which is used for the Zend_Application instance generated in Zend_Tool_Project_Context_Zf_BootstrapFile::getApplicationInstance() is hardcoded to \"development\" but I need another environment to run the job in.\r\n\r\nI suggest to slightly modify Zend_Tool_Project_Context_Zf_BootstrapFile::getApplicationInstance() in the following way to be able to provide the needed environment while remaining bc:\r\n\r\n{code}\r\nIndex: Tool\/Project\/Context\/Zf\/BootstrapFile.php\r\n===================================================================\r\n--- Tool\/Project\/Context\/Zf\/BootstrapFile.php   (revision 22308)\r\n+++ Tool\/Project\/Context\/Zf\/BootstrapFile.php   (working copy)\r\n@@ -99,7 +99,7 @@\r\n         return $codeGenFile->generate();\r\n     }\r\n     \r\n-    public function getApplicationInstance()\r\n+    public function getApplicationInstance($environment = 'development')\r\n     {\r\n         if ($this->_applicationInstance == null) {\r\n             if ($this->_applicationConfigFile->getContext()->exists()) {\r\n@@ -108,7 +108,7 @@\r\n                 $applicationOptions['config'] = $this->_applicationConfigFile->getPath();\r\n     \r\n                 $this->_applicationInstance = new Zend_Application(\r\n-                    'development',\r\n+                    $environment,\r\n                     $applicationOptions\r\n                     );\r\n             }\r\n{code}\r\n\r\nThen I could simply set the environment within my provider:\r\n\r\n{code}\r\n$app = $profile->search('BootstrapFile')->getApplicationInstance('cli');\r\n{code}\r\n\r\nAny downside that I don't see?"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9898\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10460",
                    "id": 10460,
                    "description": "Mini Release",
                    "name": "1.10.5",
                    "userReleaseDate": "26\/May\/10",
                    "archived": false,
                    "releaseDate": "2010-05-26",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10380",
                    "id": 10380,
                    "name": "Zend_Tool",
                    "description": "Zend_Tool component",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42451",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beeboo",
                        "name": "beeboo",
                        "displayName": "B. Charbonneau",
                        "active": true
                    },
                    "body": "This issue is frustrating when working with [~beberlei]'s zf-doctrine and doing anything migration related in any non-development environment",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beeboo",
                        "name": "beeboo",
                        "displayName": "B. Charbonneau",
                        "active": true
                    },
                    "created": "2010-10-07T16:32:23.000+0000",
                    "updated": "2010-10-07T16:32:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43587",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stfalcon",
                        "name": "stfalcon",
                        "displayName": "Stepan Tanasiychuk",
                        "active": true
                    },
                    "body": "Yep. I want use zf-doctrine on staging\/production server to database migrations. But it makes it difficult.\r\n\r\nI can set APPLICATION_ENV in command line \"$ APPLICATION_ENV=staging zf\"\r\nAnd get it in the script from \"getenv('APPLICATION_ENV')\"",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stfalcon",
                        "name": "stfalcon",
                        "displayName": "Stepan Tanasiychuk",
                        "active": true
                    },
                    "created": "2010-12-14T01:18:22.000+0000",
                    "updated": "2010-12-14T01:18:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43896",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nvoyageur",
                        "name": "nvoyageur",
                        "displayName": "Shane",
                        "active": true
                    },
                    "body": "I've done just that and edited it to pull the APPLICATION_ENV with the getenv('APPLICATION_ENV') function.\r\n\r\n{noformat}\r\n--- BootstrapFile.php (saved version)\r\n+++ (current document)\r\n@@ -106,9 +106,11 @@\r\n                 define('APPLICATION_PATH', $this->_applicationDirectory->getPath());\r\n                 $applicationOptions = array();\r\n                 $applicationOptions['config'] = $this->_applicationConfigFile->getPath();\r\n+                \r\n+                $env = getenv('APPLICATION_ENV') ? getenv('APPLICATION_ENV') : 'development';\r\n     \r\n                 $this->_applicationInstance = new Zend_Application(\r\n-                    'development',\r\n+                    $env,\r\n                     $applicationOptions\r\n                     );\r\n             }\r\n,\r\n\r\n{noformat}\r\n\r\nNow I just store an environment variable in my shell for APPLICATION_ENV=\"local\" and it will use the \"local\" environment in the application.ini file.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nvoyageur",
                        "name": "nvoyageur",
                        "displayName": "Shane",
                        "active": true
                    },
                    "created": "2011-01-03T09:19:37.000+0000",
                    "updated": "2011-01-03T09:19:37.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9898\/transitions"
}