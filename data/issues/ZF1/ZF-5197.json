{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5197",
    "key": "ZF-5197",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Decorator aliases are lost when Zend_Form_Element_Captcha adds its own decorators in 'render' method"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/5",
                "name": "Sub-task",
                "subtask": true
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5197\/votes",
                "votes": 4,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10470",
                    "id": 10470,
                    "description": "Mini Release",
                    "name": "1.10.6",
                    "userReleaseDate": "22\/Jun\/10",
                    "archived": false,
                    "releaseDate": "2010-06-22",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-06-19T10:43:08.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=viperx",
                "name": "viperx",
                "displayName": "Andrei Nikolov",
                "active": true
            }
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-12-10T03:23:13.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-06-19T10:43:08.000+0000"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Reproduce code:\r\n\r\n          $captcha = new Zend_Form_Element_Captcha('captcha', array(\r\n                'captcha' => array(\r\n                    'captcha' => 'Image',\r\n                    'wordLen' => 6,\r\n                    'timeout' => 300,\r\n                    'font' => Zend_Registry::get('siteRootDir') . '\/application\/sketchh.ttf',\r\n                )\r\n            ));\r\n\r\n            $captcha->setDecorators(array(\r\n                \/\/captcha decorator are placed at the begining of the array by default by 'render' method\r\n                array('decorator' => array('foo' => 'HtmlTag'), 'options' => array('tag' => 'span')),                \r\n                array('decorator' => array('bar' => 'HtmlTag'), 'options' => array('tag' => 'div')),\r\n            ));\r\n\r\n\r\nwhat we expect is to have something like this:\r\n<div><span>CAPTCHA<\/span><\/div>\r\n\r\nbut the result is this:\r\n<div>CAPTCHA<\/div>\r\n\r\nThe problem is that the aliases of the decorators (foo and bar) are lost while the 'render' method of Zend_Form_Element_Captcha adds its own decorators at the begining of the decorators array. This is done by \"array_unshift\" and then call to \"setDecorators\" but \"setDecorators\" in fact removes all current decorators and adds the new one with \"addDecorators\". There we have\r\n\r\nforeach ($decorators as $decoratorInfo)\r\n\r\nand here in fact the alias of the decorator is lost (in this case the alias is the index of the decorator in the array)\r\n\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5197\/watchers",
                "isWatching": false,
                "watchCount": 6
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                "name": "alab",
                "displayName": "Christian Albrecht",
                "active": true
            }
        },
        "parent": {
            "name": "parent",
            "type": "issuelinks",
            "value": {
                "issueKey": "ZF-7552",
                "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7552",
                "type": {
                    "name": "Parent",
                    "direction": "INBOUND"
                }
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-9168",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9168",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-9338",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9338",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                },
                {
                    "issueKey": "ZF-7552",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7552",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12060",
                    "filename": "Element.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=chuso",
                        "name": "chuso",
                        "displayName": "Jesus Ruiz-Ayucar Vazquez",
                        "active": true
                    },
                    "created": "2009-07-04T15:20:02.000+0000",
                    "size": 5123,
                    "mimeType": "text\/x-diff",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12060\/Element.diff"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10270",
                    "id": 10270,
                    "description": "Mini Release",
                    "name": "1.7.1",
                    "userReleaseDate": "01\/Dec\/08",
                    "archived": false,
                    "releaseDate": "2008-12-01",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29201",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stas",
                        "name": "stas",
                        "displayName": "Stanislav Malyshev",
                        "active": false
                    },
                    "body": "Looks like defect in Zend_Form_Element::addDecorators not in Captcha. Matthew, could you take a look?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stas",
                        "name": "stas",
                        "displayName": "Stanislav Malyshev",
                        "active": false
                    },
                    "created": "2009-02-27T12:27:43.000+0000",
                    "updated": "2009-02-27T12:27:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31588",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shurakai",
                        "name": "shurakai",
                        "displayName": "Christian Heinrich",
                        "active": true
                    },
                    "body": "Yes, as you correctly assumed, the problem is located in Zend_Form_Element, but in addDecorator() (without the s!)\n\nThe problem is that all decorators are given as objects, therefore addDecorator() will determine the classname and save the decorators with this classname as the index.\n\nTherefore, if you use multiple decorators of the same kind, they will be overwritten.\n\nVersion: 1.8",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shurakai",
                        "name": "shurakai",
                        "displayName": "Christian Heinrich",
                        "active": true
                    },
                    "created": "2009-06-04T11:50:16.000+0000",
                    "updated": "2009-06-04T11:50:16.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31590",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "You can add concrete instances using aliasing as well:\n{code}\n$form->addElement('text', 'foo', array(\n    'decorators' => array(\n        array(array('Foo' => new My_Decorator_Foo())),\n    ),\n));\n\nYou can even do it with addDecorator():\n{code}\n$element->addDecorator(array('Foo' => new My_Decorator_Foo()));\n{code}\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-06-04T13:10:51.000+0000",
                    "updated": "2009-06-04T13:10:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32389",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=chuso",
                        "name": "chuso",
                        "displayName": "Jesus Ruiz-Ayucar Vazquez",
                        "active": true
                    },
                    "body": "I have attached a patch which works to me. It changes the way Zend_Form_Element_Captcha::render() adds its decorators.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=chuso",
                        "name": "chuso",
                        "displayName": "Jesus Ruiz-Ayucar Vazquez",
                        "active": true
                    },
                    "created": "2009-07-04T15:18:56.000+0000",
                    "updated": "2009-07-04T15:18:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33836",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shurakai",
                        "name": "shurakai",
                        "displayName": "Christian Heinrich",
                        "active": true
                    },
                    "body": "This issue still exists in 1.9.1\n\nMatthew, I use to add my decorators in a derived formclass like this:\n\n$this->setElementDecorators(array(\n             array(array('biglabelClose' => 'HtmlTag'), array('tag' => 'div', 'closeOnly' => true, 'placement' => Zend_Form_Decorator_Abstract::PREPEND )),\n             array('Label', array('placement' => Zend_Form_Decorator_Abstract::PREPEND)),\n             array(array('biglabelOpen' => 'HtmlTag'), array('tag' => 'div', 'openOnly' => true, 'class' => 'biglabel', 'placement' => Zend_Form_Decorator_Abstract::PREPEND))\n            )\n        );\n\nDoing it this way, the decorators with the aliases will be overwritten due to the way of saving in addDecorator.\n\nHowever, the patch from Jesus works for me but should be reviewed; there have been a lot of whitespace changings.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shurakai",
                        "name": "shurakai",
                        "displayName": "Christian Heinrich",
                        "active": true
                    },
                    "created": "2009-08-24T06:03:40.000+0000",
                    "updated": "2009-08-24T06:03:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33843",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "@Christian H.: Of course it still exists in 1.9.1 - the patch has not yet been reviewed or applied.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-08-24T07:26:53.000+0000",
                    "updated": "2009-08-24T07:26:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36654",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=webit",
                        "name": "webit",
                        "displayName": "Dominik Bulaj",
                        "active": true
                    },
                    "body": "@Matthew - why so many [bug hunt days|http:\/\/devzone.zend.com\/article\/11421-Results-of-Novembers-ZF-Bug-Hunt-Days] didn't resove that issue? It's quite old and annoying issue. Any plans to fix it in near future?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=webit",
                        "name": "webit",
                        "displayName": "Dominik Bulaj",
                        "active": true
                    },
                    "created": "2009-12-03T03:11:37.000+0000",
                    "updated": "2009-12-03T03:11:37.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36665",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "@Dominik -- Please be more polite when bumping issues. My own time during the bug hunt days is basically spent reviewing patch submissions and commits that occur _during_ the bug hunt. The various participants in the bug hunt work on the issues that affect them personally typically. Additionally, if you look at the backlog of issues, the shear volume means that we simply will not get to them all on any given bug hunt.\r\n\r\nOne problem with this particular patch is that it does not include unit tests, which means that whomever considers applying it will also need to create a reproduce case and capture it as a test -- which means it's a non-trivial amount of time to apply.\r\n\r\nIf you want this issue resolved faster, help by submitting a unit test case.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-12-03T04:59:13.000+0000",
                    "updated": "2009-12-03T04:59:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38005",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hendri.smit",
                        "name": "hendri.smit",
                        "displayName": "Hendri Smit",
                        "active": true
                    },
                    "body": "The patch provided is incorrect. It may work in some cases but the changes made simply add the captcha decorators on top of the decorator stack. They should be rendered first and need to be at the bottom of the stack as is currently the case. Imo the proposed fix for case ZF-7552 is the way to go for this issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hendri.smit",
                        "name": "hendri.smit",
                        "displayName": "Hendri Smit",
                        "active": true
                    },
                    "created": "2010-01-25T05:49:42.000+0000",
                    "updated": "2010-01-25T05:49:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40882",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mikaelkael",
                        "name": "mikaelkael",
                        "displayName": "Mickael Perraud",
                        "active": true
                    },
                    "body": "Change component",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mikaelkael",
                        "name": "mikaelkael",
                        "displayName": "Mickael Perraud",
                        "active": true
                    },
                    "created": "2010-06-06T08:01:09.000+0000",
                    "updated": "2010-06-06T08:01:09.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41101",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                        "name": "alab",
                        "displayName": "Christian Albrecht",
                        "active": true
                    },
                    "body": "Fixed in r22464 and merged into 1.10 release branch",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                        "name": "alab",
                        "displayName": "Christian Albrecht",
                        "active": true
                    },
                    "created": "2010-06-19T10:43:08.000+0000",
                    "updated": "2010-06-19T10:43:08.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5197\/transitions"
}