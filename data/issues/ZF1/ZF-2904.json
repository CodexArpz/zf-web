{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2904",
    "key": "ZF-2904",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Translate_Adapter ignores parameters when cache is used"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2904\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10240",
                    "id": 10240,
                    "description": "Minor Release",
                    "name": "1.6.0",
                    "userReleaseDate": "02\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-02",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-03-24T08:35:58.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=csm",
                "name": "csm",
                "displayName": "Christoph Schulte M\u00f6nting",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-03-17T15:16:36.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-09-02T10:39:13.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When a cache is set via Zend_Translate::setCache, the locale and options parameters passed to Zend_Translate's ctor are ignored if the cache already exists, causing unexpected behavior. This is caused by Zend_Translate_Adapter's ctor reading $this->_translate from the cache and then immediately returning.\n\nWith texts.tmx containing\n{code}\n<?xml version=\"1.0\" ?>\n<!DOCTYPE tmx SYSTEM \"tmx14.dtd\">\n<tmx version=\"1.4\">\n <header \/>\n <body>\n  <tu tuid='msg1'>\n   <tuv xml:lang=\"de\"><seg>German text 1<\/seg><\/tuv>\n   <tuv xml:lang=\"en\"><seg>English text 1<\/seg><\/tuv>\n  <\/tu>\n<\/body>\n{code}\nthe output of\n{code}\nfunction testTranslate() {\n   $translate = new Zend_Translate('tmx', 'texts.tmx', 'de');\n\n   Zend_Debug::dump($translate->getLocale(), 'Locale');\n   Zend_Debug::dump($translate->getMessages(), 'Messages');\n}\n\n$translationCache = Zend_Cache::factory('Page', 'File');\n$translationCache->clean();\nZend_Translate::setCache($translationCache);\n\ntestTranslate();\ntestTranslate();\n{code}\nis not as expected, but\n{code}\nLocale \nstring(2) \"de\"\n\nMessages \narray(1) {\n  [\"msg1\"] => string(13) \"German text 1\"\n}\n\nLocale \nNULL\n\nMessages \nNULL\n{code}\ninstead.\n\nAs a workaround I call $translate->setLocale('de'), but this should not be necessary."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2904\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10170",
                    "id": 10170,
                    "description": "Mini Release",
                    "name": "1.0.4",
                    "userReleaseDate": "26\/Feb\/08",
                    "archived": true,
                    "releaseDate": "2008-02-26",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10099",
                    "id": 10099,
                    "name": "Zend_Translate",
                    "description": "Provides translation functionality, based on standards such as TMX and Gettext.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19972",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "As stated in the manual you MUST set the cache BEFORE creating the object.\nSee http:\/\/framework.zend.com\/manual\/en\/zend.translate.adapter.html#zend.translate.adapter.caching\n\nUsing the same cache for different objects like in your case makes of course problems not only in this component... it leads to unexpectable behaviour as you do not know what's written and what's left from the first object.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-03-17T16:09:49.000+0000",
                    "updated": "2008-03-17T16:09:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19975",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=csm",
                        "name": "csm",
                        "displayName": "Christoph Schulte M\u00f6nting",
                        "active": true
                    },
                    "body": "But that is what my example code does: It creates and sets the cache, and then (by calling testTranslate()) twice creates a translate object and uses it. If you want, you can rewrite it to\n\n{code}\n$translationCache = Zend_Cache::factory('Page', 'File');\n$translationCache->clean();\nZend_Translate::setCache($translationCache);\n\n$translate1 = new Zend_Translate('tmx', 'texts.tmx', 'de');\n\nZend_Debug::dump($translate1->getLocale(), 'Locale');\nZend_Debug::dump($translate1->getMessages(), 'Messages');\n\n$translate2 = new Zend_Translate('tmx', 'texts.tmx', 'de');\n\nZend_Debug::dump($translate2->getLocale(), 'Locale');\nZend_Debug::dump($translate2->getMessages(), 'Messages');\n{code}\n\nwhich clearly is what the documentation says and does not work either. The point is not that the example creates two instances at the same time, the point is that writing and restoring from and to the cache will lead to parameters being ignored. Please have a look at Zend_Translate_Adapter's constructor, it is obviously not correct.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=csm",
                        "name": "csm",
                        "displayName": "Christoph Schulte M\u00f6nting",
                        "active": true
                    },
                    "created": "2008-03-18T03:10:55.000+0000",
                    "updated": "2008-03-18T03:10:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/20190",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "2 things to mention:\n\n*) You must not use the incubator in such situations\n*) You can try r9038 or higher where the options have been added to cache\n\nBut it has to be mentioned that using caches in the way you show it, is problematic.\nIt is not allowed to have 2 identical adapters with different options. This is against generic rules and leads to the problem that the user has to be aware of which class holds which translation. This is not allowed and also not supported.\n\nWith the actual revision there is no problem within your testcode.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2008-03-24T08:35:34.000+0000",
                    "updated": "2008-03-24T08:35:34.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24040",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Updating for the 1.6.0 release.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-09-02T10:39:13.000+0000",
                    "updated": "2008-09-02T10:39:13.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2904\/transitions"
}