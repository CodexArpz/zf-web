{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9679",
    "key": "ZF-9679",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Method isValid() carries validated Values to SubForms"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/11",
                "name": "Patch",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9679\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/3",
                "name": "Duplicate"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-04-15T19:31:01.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tridem",
                "name": "tridem",
                "displayName": "Webdevilopers",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-04-15T02:17:02.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-04-15T19:31:02.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I have a Zend Dojo Form named `test` including an element namend `id`.\r\n\r\nThis form also has a subform named `subform`. Latter uses array notation.\r\n(Note: using the method setIsArray(true) will not affect the issue!)\r\n\r\nIn this subform I have an element named `id` too. It is a MultiCheckbox.\r\nThe options include the keys `1` and `2` (NOT `3`!).\r\n\r\n\r\nActions:\r\n- Get the `id` element from the base form `test`. Set its value to `3`.\r\n- Don't choose any option on the `id` element in the subform `subform`.\r\n- Submit Form.\r\n\r\n\r\nExpected behaviours:\r\n- The `id` element from the base form `test` is set to `3`.\r\n- The `id` element from the subform `subform` is validated true.\r\n- Form is valid!\r\n\r\n\r\nActual behaviour:\r\n- The `id` element from the base form `test` is set to `3`.\r\n- The `id` element from the subform `subform` is ALSO SET TO `3`. Since this option does not exist \r\n\r\nit validates false.\r\n- Form is invalid!\r\n\r\n\r\nDebugging:\r\n\r\nThe `id` element from the base form `test`:\r\nThe dump on the element on line 46 shows the correct element. The other `id` element is never shown. Since the value is set correctely everything seems to work fine here.\r\n\r\nForm values:\r\nDumping the form values in line 58 shows that the setValue(3) Method has also addresses the value to the wrong `id` element in the subform.\r\n\r\n\r\nConclusion:\r\nThere seems to be a problem with the set methods on elements in a subform that share the same name as in the base form or maybe even other subforms.\r\n\r\n\r\nFurther problematics:\r\nIf the original `id` element was set to a value that IS AN OPTION of the MultiCheckbox the form would have been valid - even if NO OPTION was checked.\r\n\r\nNote:\r\nChecking an option will override the value `3` and the form will be correct.\r\n\r\n\r\nThe Code:\r\n{code}\r\n<?php\r\nclass Issues_MultiCheckboxController extends Zend_Controller_Action\r\n{\r\n    public function init()\r\n    {\r\n        $form = new Zend_Dojo_Form();\r\n        $form->setName('test')\r\n             ->setAction('\/issues\/multi-checkbox\/save\/')\r\n             ->setMethod(Zend_Form::METHOD_POST);\r\n\r\n        \/**\r\n         * Create subform with an element named `id` too - but in an array named `subform`\r\n         *\/\r\n        $subForm = new Zend_Dojo_Form_SubForm();\r\n        $subForm->setIsArray(true);\r\n\r\n        $fooElement = new Zend_Form_Element_MultiCheckbox('id');\r\n        $fooElement->setLabel('Allowed options: 1, 2');\r\n        $fooElement->setMultiOptions(array(\r\n            '1' => 'yes',\r\n            '2' => 'no'\r\n        ));\r\n        #$fooElement->setRequired(true);\r\n        $subForm->addElement($fooElement);\r\n\r\n        $form->addSubForm($subForm, 'subform');\r\n\r\n        \/**\r\n         * Create primary element named `id` too - its value will be set afterwards to 3\r\n         *\/\r\n        $barElement = new Zend_Form_Element_Hidden('id');\r\n        $barElement->setDecorators(array('ViewHelper'));\r\n        $form->addElement($barElement);\r\n\r\n        $sendElement = new Zend_Dojo_Form_Element_SubmitButton('send');\r\n        $sendElement->setLabel('Send');\r\n        $sendElement->setIgnore(true);\r\n        $form->addElement($sendElement);\r\n\r\n        $this->view->form = $form;\r\n    }\r\n\r\n    public function editAction()\r\n    {\r\n        $barElement = $this->view->form->getElement('id');\r\n        Zend_Debug::dump($barElement);\r\n        $barElement->setValue(3);\r\n    }\r\n\r\n    public function saveAction()\r\n    {\r\n        if (!$this->view->form->isValid($this->getRequest()->getPost())) {\r\n            echo \"Form not valid\";\r\n            $this->render('edit');\r\n        }\r\n\r\n        $values = $this->view->form->getValues(true);\r\n        Zend_Debug::dump($values);\r\n    }\r\n}\r\n{code}\r\n\r\nCorrectly generated HTML:\r\n{code}\r\n<form id=\"test\" action=\"\/issues\/multi-checkbox\/save\/\" method=\"post\" dojoType=\"dijit.form.Form\"><dl \r\n\r\nclass=\"zend_form_dojo\">\r\n<div name=\"subform\" id=\"subform-ContentPane\" title=\"\" dojoType=\"dijit.layout.ContentPane\"><dl>\r\n<dt id=\"id-label\"><label for=\"subform-id\" class=\"optional\">Allowed options: 1, 2<\/label><\/dt>\r\n<dd id=\"id-element\">\r\n<label for=\"subform-id-1\"><input type=\"checkbox\" name=\"subform[id][]\" id=\"subform-id-1\" value=\"1\" \r\n\r\n\/>yes<\/label><br \/><label for=\"subform-id-2\"><input type=\"checkbox\" name=\"subform[id][]\" \r\n\r\nid=\"subform-id-2\" value=\"2\" \/>no<\/label><\/dd><\/dl><\/div>\r\n\r\n\r\n<input type=\"hidden\" name=\"id\" value=\"3\" id=\"id\" \/>\r\n<dt id=\"send-label\">&nbsp;<\/dt><dd id=\"send-element\">\r\n<input id=\"send\" name=\"send\" value=\"Send\" type=\"submit\" label=\"Send\" dojoType=\"dijit.form.Button\" \r\n\r\n\/><\/dd><\/dl><\/form>\r\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9679\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                "name": "alab",
                "displayName": "Christian Albrecht",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10430",
                    "id": 10430,
                    "description": "Mini Release",
                    "name": "1.10.2",
                    "userReleaseDate": "24\/Feb\/10",
                    "archived": false,
                    "releaseDate": "2010-02-24",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39983",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                        "name": "alab",
                        "displayName": "Christian Albrecht",
                        "active": true
                    },
                    "body": "This patch fixes the Issue, Unit Test included\r\n{code}\r\nIndex: tests\/Zend\/Form\/FormTest.php\r\n===================================================================\r\n--- tests\/Zend\/Form\/FormTest.php\t(Revision 21858)\r\n+++ tests\/Zend\/Form\/FormTest.php\t(Arbeitskopie)\r\n@@ -1184,6 +1184,22 @@\r\n         $this->assertTrue($this->form->isValid($data));\r\n     }\r\n \r\n+    \/**\r\n+     * @group ZF-9679\r\n+     *\/\r\n+    public function testIsValidDiscardsValidatedValues()\r\n+    {\r\n+        $this->form->addElement('text', 'foo');\r\n+        $this->form->addSubForm(new Zend_Form_SubForm(), 'bar')\r\n+                   ->bar->addElement('text', 'foo')\r\n+                        ->foo->setAllowEmpty(true)\r\n+                             ->addValidator('Identical',\r\n+                                            true,\r\n+                                            '');\r\n+\r\n+        $this->assertTrue($this->form->isValid(array('foo' => 'foo Value')));\r\n+    }\r\n+\r\n     \/\/ Sub forms\r\n \r\n     public function testCanAddAndRetrieveSingleSubForm()\r\nIndex: library\/Zend\/Form.php\r\n===================================================================\r\n--- library\/Zend\/Form.php\t(Revision 21858)\r\n+++ library\/Zend\/Form.php\t(Arbeitskopie)\r\n@@ -2057,6 +2057,7 @@\r\n                 $valid = $element->isValid(null, $data) && $valid;\r\n             } else {\r\n                 $valid = $element->isValid($data[$key], $data) && $valid;\r\n+                unset($data[$key]);\r\n             }\r\n         }\r\n         foreach ($this->getSubForms() as $key => $form) {\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                        "name": "alab",
                        "displayName": "Christian Albrecht",
                        "active": true
                    },
                    "created": "2010-04-15T13:45:26.000+0000",
                    "updated": "2010-04-15T13:45:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39984",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                        "name": "alab",
                        "displayName": "Christian Albrecht",
                        "active": true
                    },
                    "body": "This is the similar to ZF-9666",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                        "name": "alab",
                        "displayName": "Christian Albrecht",
                        "active": true
                    },
                    "created": "2010-04-15T13:47:00.000+0000",
                    "updated": "2010-04-15T13:47:00.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39997",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                        "name": "alab",
                        "displayName": "Christian Albrecht",
                        "active": true
                    },
                    "body": "This Issue duplicates as of now the Issue ZF-9607, which also has given a patch with Unit Tests.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alab",
                        "name": "alab",
                        "displayName": "Christian Albrecht",
                        "active": true
                    },
                    "created": "2010-04-15T19:31:02.000+0000",
                    "updated": "2010-04-15T19:31:02.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9679\/transitions"
}