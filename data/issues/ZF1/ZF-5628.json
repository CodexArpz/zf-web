{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5628",
    "key": "ZF-5628",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "ContextSwitch not working with routers"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5628\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ivan.veretelnyk",
                "name": "ivan.veretelnyk",
                "displayName": "ivan",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-01-24T05:31:03.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-08-30T01:03:50.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "ContextSwitch"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "The bug with a Zend_Controller_Action_Helper_ContextSwitch\n\nWhen using custom routes it will not work at all. \nIn function public function initContext($format = null).....  $action     = $request->getActionName();\nThis action will be always null so context will not be switched. \n\nBy changing it to \n$action     = $request->getActionName();\nif (empty($action)) {\n $action = Zend_Controller_Front::getInstance()->getDefaultAction();\n}\nIt working fine.\n\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5628\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10271",
                    "id": 10271,
                    "description": "Mini Release",
                    "name": "1.7.2",
                    "userReleaseDate": "23\/Dec\/08",
                    "archived": false,
                    "releaseDate": "2008-12-23",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10011",
                    "id": 10011,
                    "name": "Zend_Controller",
                    "description": "front controller, including router and dispatcher",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46542",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=toneplex",
                        "name": "toneplex",
                        "displayName": "Anton Visser",
                        "active": true
                    },
                    "body": "We are running into this same issue with ZF 1.11.5. I'd be willing to help patch this, but is @ivan fix the correct way to fix this, or is there a better place?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=toneplex",
                        "name": "toneplex",
                        "displayName": "Anton Visser",
                        "active": true
                    },
                    "created": "2011-05-11T20:59:35.000+0000",
                    "updated": "2011-05-11T20:59:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48282",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendmartin",
                        "name": "zendmartin",
                        "displayName": "Martin",
                        "active": true
                    },
                    "body": "In ZendFramework-1.11.10 this problem still exists. I tried using a different layout for mobile devices with Zend_Controller_Action_Helper_ContextSwitch. After a long time searching for bugs in my code, I Googled and ran into this bug report.\r\n\r\nThe problem lies much deeper than Zend_Controller_Request_Http. The problem is that the default controller (index) and the default action (index) are never being set by the Router at all. The router fully relies on the config file as this code shows:\r\n{code:title=Zend_Controller_Router_Route_Regex (line 47)}\r\npublic static function getInstance(Zend_Config $config)\r\n{\r\n    $defs = ($config->defaults instanceof Zend_Config) ? $config->defaults->toArray() : array();\r\n    $map = ($config->map instanceof Zend_Config) ? $config->map->toArray() : array();\r\n    $reverse = (isset($config->reverse)) ? $config->reverse : null;\r\n    return new self($config->route, $defs, $map, $reverse);\r\n}\r\n\r\npublic function __construct($route, $defaults = array(), $map = array(), $reverse = null)\r\n{\r\n    $this->_regex    = $route;\r\n    $this->_defaults = (array) $defaults;\r\n    $this->_map      = (array) $map;\r\n    $this->_reverse  = $reverse;\r\n}{code}\r\nZend_Controller_Dispatcher_Standard on the other hand _does know_ what the default action and the default controller are, because they are inherited from Zend_Controller_Dispatcher_Abstract where they are both hardcoded as properties. They are however never passed to the request object.\r\n\r\nWhen the controller name or action name is missing in Zend_Controller_Request_Http this should (in my opinion) raise an exception so that users know what the problem is, because other functionality breaks when these parameters are missing. An other solutions could be setting the default controller and default action in Zend_Controller_Request_Http. They are documented as the default value when not provided by the user, but when the user forgets them, they are not being set.\r\n\r\nSee: http:\/\/framework.zend.com\/manual\/en\/zend.controller.quickstart.html#zend.controller.quickstart.go.controller\r\n??If no action is provided, the action index is assumed, and if no controller is provided, the controller index is assumed (following the Apache convention that maps a DirectoryIndex automatically).??\r\n\r\n\r\nThe easiest fix for now is too hardcode the controller and action in the routing.\r\n\r\nThis *does not* work when using ContextSwitch:\r\n{code:title=Routing in ini file}\r\nresources.router.routes.default.type = \"Zend_Controller_Router_Route_Regex\"\r\nresources.router.routes.default.route = \"([a-z0-9]*(?:\/[a-z0-9]+)*)\"\r\nresources.router.routes.default.defaults.module = \"default\"\r\nresources.router.routes.default.map.1 = \"page\"\r\n{code}\r\n\r\nThis _does work_ when using ContextSwitch:\r\n{code:title=Routing in ini file}\r\nresources.router.routes.default.type = \"Zend_Controller_Router_Route_Regex\"\r\nresources.router.routes.default.route = \"([a-z0-9]*(?:\/[a-z0-9]+)*)\"\r\nresources.router.routes.default.defaults.module = \"default\"\r\nresources.router.routes.default.defaults.controller = \"index\"\r\nresources.router.routes.default.defaults.action = \"index\"\r\nresources.router.routes.default.map.1 = \"page\"\r\n{code}\r\n\r\nIt would be nice if this bug gets fixed after more than 2 and a half years. If more info is needed, just let me know.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendmartin",
                        "name": "zendmartin",
                        "displayName": "Martin",
                        "active": true
                    },
                    "created": "2011-08-30T01:03:50.000+0000",
                    "updated": "2011-08-30T01:03:50.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5628\/transitions"
}