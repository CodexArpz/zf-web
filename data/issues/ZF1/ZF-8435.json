{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8435",
    "key": "ZF-8435",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Application_Resource_Locale uses default locale instead of auto-discovery"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8435\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10360",
                    "id": 10360,
                    "description": "Minor Release",
                    "name": "1.10.0",
                    "userReleaseDate": "27\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-27",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-01-02T16:33:32.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jollyblume",
                "name": "jollyblume",
                "displayName": "Jolly Blume",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-12-01T12:15:22.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-01-02T16:33:32.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "{code}For instance, the getLocale() function should be modified similar to this:\r\npublic function getLocale()\r\n{\r\n\/\/ Zend version incorrectly ignores HTTP_ACCEPT_LANGUAGE value when create locale object\r\nif (null === $this->_locale) {\r\n$options = $this->getOptions();\r\nif (isset($options['default'])) { \/\/ Set the fall-back locale Zend_Locale::setDefault($options['default']); } else { \/\/ Should the web server's locale be set as a default when none provided? }\r\n\/\/ Now create the locale with automatic locale discovery enabled (the default method)\r\n$this->_locale = new Zend_Locale();\r\n\r\n$key = (isset($options['registry_key']) && !is_numeric($options['registry_key']))\r\n? $options['registry_key']\r\n: self::DEFAULT_REGISTRY_KEY;\r\nZend_Registry::set($key, $this->_locale);\r\n}\r\nreturn $this->_locale;\r\n}{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8435\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                "name": "freak",
                "displayName": "Dolf Schimmel (Freeaqingme)",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-6878",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6878",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10390",
                    "id": 10390,
                    "description": "Mini Release",
                    "name": "1.9.6",
                    "userReleaseDate": "24\/Nov\/09",
                    "archived": false,
                    "releaseDate": "2009-11-24",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10460",
                    "id": 10460,
                    "name": "Zend_Application_Resource",
                    "description": "Plugin resources for Zend_Application",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36614",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jollyblume",
                        "name": "jollyblume",
                        "displayName": "Jolly Blume",
                        "active": true
                    },
                    "body": "When the application.ini file sets a default (fall-back) locale, Zend_Application_Resource_Locale incorrectly creates the locale object with it. This default should be set before creating the locale object and then create the object using automatic locale discovery.\r\n\r\nFor instance, the getLocale() function should be modified similar to this:\r\npublic function getLocale()\r\n{\r\n\/\/ Zend version incorrectly ignores HTTP_ACCEPT_LANGUAGE value when create locale object\r\nif (null === $this->_locale) {\r\n$options = $this->getOptions();\r\nif (isset($options['default'])) { \/\/ Set the fall-back locale Zend_Locale::setDefault($options['default']); } else { \/\/ Should the web server's locale be set as a default when none provided? }\r\n\/\/ Now create the locale with automatic locale discovery enabled (the default method)\r\n$this->_locale = new Zend_Locale();\r\n\r\n$key = (isset($options['registry_key']) && !is_numeric($options['registry_key']))\r\n? $options['registry_key']\r\n: self::DEFAULT_REGISTRY_KEY;\r\nZend_Registry::set($key, $this->_locale);\r\n}\r\nreturn $this->_locale;\r\n}\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jollyblume",
                        "name": "jollyblume",
                        "displayName": "Jolly Blume",
                        "active": true
                    },
                    "created": "2009-12-01T12:16:58.000+0000",
                    "updated": "2009-12-01T12:16:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36616",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "I edited the issue itself a bit, so that the issue itself makes immediately clear what the supposed problem would be, please check if I summarized and interpreted your problem correctly.\r\n\r\n- You marked the issue with affects version with 1.8.x, does it still occur with 1.9.6 (and\/or trunk)?\r\n- Could you please add some code, give its output, and give its expected output.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-12-01T12:23:51.000+0000",
                    "updated": "2009-12-01T12:23:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36645",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jollyblume",
                        "name": "jollyblume",
                        "displayName": "Jolly Blume",
                        "active": true
                    },
                    "body": "Here is some code notes:\r\n\r\n[configs\/application.ini]\r\nresources.locale.default = en_US\r\n\r\n[index\/index.phtml]\r\n<?php\r\necho '<br>HTTP_ACCEPT_LANGUAGE: ' . Zend_Controller_Front::getInstance()->getRequest()->getServer('HTTP_ACCEPT_LANGUAGE');\r\n$locale = Zend_Registry::get('Zend_Locale');\r\n$defaultLocale = $locale->getDefault();\r\nforeach ($defaultLocale as $key => $value)\r\n{\r\n echo '<br>Default locale: ' . $key . ' (' . $value. ')';\r\n}\r\necho '<br>Language: ' . $locale->getLanguage();\r\necho '<br>Region: ' . $locale->getRegion();\r\n?>\r\n\r\n[output with Zend version of Locale resource's getLocale()]\r\nHTTP_ACCEPT_LANGUAGE: de-de,en-us;q=0.7,en;q=0.3\r\nDefault locale: en_US (1)\r\nLanguage: en\r\nRegion: US\r\n\r\n(Notice that even though the preferred language in HTTP_ACCEPT_LANGUAGE is \"de-DE\",\r\nthe language set in the Locale is \"en_US\".  This is because the existing Locale\r\nresource sets the locale language to the default setting, instead of allowing it\r\nto detect the language using Zend_Locale automatic locale discovery)\r\n\r\n[output using getLocale() based on code in the above comment]\r\nHTTP_ACCEPT_LANGUAGE: de-de,en-us;q=0.7,en;q=0.3\r\nDefault locale: en_US (1)\r\nLanguage: de\r\nRegion: DE\r\n\r\n(Notice that the Locale created by the modified Locale resource is correctly set\r\nto \"de_DE\" because the locale is being created using automatic locale discovery.\r\nAutomatic locale discovery ($locale = new Zend_Locale();) will detect the locale\r\nby first looking at HTTP_ACCEPT_LANGUAGE.  If automatic discovery fails, it will\r\nultimately use the locale default.)\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jollyblume",
                        "name": "jollyblume",
                        "displayName": "Jolly Blume",
                        "active": true
                    },
                    "created": "2009-12-02T21:30:47.000+0000",
                    "updated": "2009-12-02T21:30:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36646",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jollyblume",
                        "name": "jollyblume",
                        "displayName": "Jolly Blume",
                        "active": true
                    },
                    "body": "Also, this problem exists in the current (1.9.4) release.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jollyblume",
                        "name": "jollyblume",
                        "displayName": "Jolly Blume",
                        "active": true
                    },
                    "created": "2009-12-02T21:31:55.000+0000",
                    "updated": "2009-12-02T21:31:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36647",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jollyblume",
                        "name": "jollyblume",
                        "displayName": "Jolly Blume",
                        "active": true
                    },
                    "body": "Ignore the previous comment.  It is a problem in the current release (1.9.6)\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jollyblume",
                        "name": "jollyblume",
                        "displayName": "Jolly Blume",
                        "active": true
                    },
                    "created": "2009-12-02T21:33:35.000+0000",
                    "updated": "2009-12-02T21:33:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36648",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jollyblume",
                        "name": "jollyblume",
                        "displayName": "Jolly Blume",
                        "active": true
                    },
                    "body": "I just checkout the SVN trunk code.  The problem exists in trunk.\r\n\r\nNote: this is a problem with Zend_Application_Resource_Locale::getLocale().",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jollyblume",
                        "name": "jollyblume",
                        "displayName": "Jolly Blume",
                        "active": true
                    },
                    "created": "2009-12-02T21:48:07.000+0000",
                    "updated": "2009-12-02T21:48:07.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37311",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "Should be fixed now, thank  you for reporting. If you still encounter this issue, please reopen it (and add a comment).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2010-01-02T16:33:05.000+0000",
                    "updated": "2010-01-02T16:33:05.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8435\/transitions"
}