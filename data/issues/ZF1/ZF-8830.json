{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8830",
    "key": "ZF-8830",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Navigation_Page_Mvc::isActive() produces false-negatives when coupled with custom routes"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8830\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/3",
                "name": "Duplicate"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10780",
                    "id": 10780,
                    "description": "Mini Release",
                    "name": "1.11.8",
                    "userReleaseDate": "07\/Jul\/11",
                    "archived": false,
                    "releaseDate": "2011-07-07",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-06-06T09:20:41.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dohpaz",
                "name": "dohpaz",
                "displayName": "Ken Stanley",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-01-15T06:37:34.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-06-06T10:45:43.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "According to [http:\/\/framework.zend.com\/manual\/en\/zend.navigation.pages.html#zend.navigation.pages.mvc.example.routes], navigation items using custom routes should include the module, controller, and action so that Zend_Navigation_Page_Mvc::isActive() can tell if a page is active or not. The problem that occurs from this is that the router's assemble() method will break the route by unnecessarily appending the module, controller, and action, even if the route is not supposed to display them. \r\n\r\nFor example, a route like:\r\n\r\n{code}\r\nnew Zend_Controller_Router_Route(':uniqueId\/edit\/:level',\r\n    array(\r\n        'controller'    => 'users',\r\n        'action'        => 'edit',\r\n        'module'        => 'admin'\r\n    ), array(\r\n        'uniqueId'      => (\\d+),\r\n        'level'         => '(admin|user|editor|foo)'\r\n    ))\r\n{code}\r\n\r\nAnd a navigation page like:\r\n\r\n{code}\r\n$config['admin']['pages'][$uniqueId] = array(\r\n    'label'         => 'Editing ' . $userName,\r\n    'module'        => 'admin',\r\n    'controller'    => 'users',\r\n    'action'        => 'edit',\r\n    'route'         => 'adminEditUser',\r\n    'params'        => array(\r\n        'uniqueId'      => $uniqueId,\r\n        'level'         => $level,\r\n    )\r\n)\r\n{code}\r\n\r\nWould produce a url:\r\n{code:borderStyle=solid}\r\n\/12345\/edit\/foo\/module\/admin\/controller\/users\/action\/edit\r\n{code}\r\nWhen the expected url should be:\r\n{code:borderStyle=solid}\r\n\/12345\/edit\/foo\r\n{code}\r\n\r\nAttached is a patch that looks at the route provided to the navigation page, checks to see if the front controller's router has the route, and if it does it will use the module, controller, and action from that route if the module, controller, and action were not provided as part of the configuration for the navigation page. This takes care of Zend_Navigation_Page_Mvc::isActive() not being able to recognize a page as active, and it removes the requirement of having to provide the module, controller, and action to the navigation configuration."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/1",
                "name": "Blocker"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8830\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                "name": "kaiuwe",
                "displayName": "Kai Uwe",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-11359",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11359",
                    "type": {
                        "name": "Duplicate",
                        "direction": "OUTBOUND",
                        "description": "duplicates"
                    }
                },
                {
                    "issueKey": "ZF-8438",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8438",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12625",
                    "filename": "ZF-8830.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dohpaz",
                        "name": "dohpaz",
                        "displayName": "Ken Stanley",
                        "active": true
                    },
                    "created": "2010-01-15T06:38:46.000+0000",
                    "size": 1930,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12625\/ZF-8830.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10390",
                    "id": 10390,
                    "description": "Mini Release",
                    "name": "1.9.6",
                    "userReleaseDate": "24\/Nov\/09",
                    "archived": false,
                    "releaseDate": "2009-11-24",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10400",
                    "id": 10400,
                    "description": "Mini Release",
                    "name": "1.9.7",
                    "userReleaseDate": "11\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-11",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10406",
                    "id": 10406,
                    "name": "Zend_Navigation",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46529",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=m%C3%B4shevds",
                        "name": "m\u00f4shevds",
                        "displayName": "M\u00f4she van der Sterre",
                        "active": true
                    },
                    "body": "A unit-test for this bug is here: http:\/\/pastie.org\/1886460\r\nThe patch fixes the problem.\r\n\r\nI did not expect a 16 month old issue to be a duplicate of my issue (ZF-11359), but at close inspection, it is.\r\nHowever, I think ZF-8438 is not a duplicate, and I think it is already fixed, but I'm not sure about this.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=m%C3%B4shevds",
                        "name": "m\u00f4shevds",
                        "displayName": "M\u00f4she van der Sterre",
                        "active": true
                    },
                    "created": "2011-05-11T08:39:32.000+0000",
                    "updated": "2011-05-11T08:39:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46530",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "body": "It is the same problem and the current issue (ZF-8830) is not solved.\r\nYour unit test is a plus and always welcome! :-)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-05-11T08:53:01.000+0000",
                    "updated": "2011-05-11T08:53:01.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47000",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "body": "Tests:\r\n{code}\r\npublic function testHrefGeneratedIsRouteAwareWithVariablePrefix()\r\n{\r\n    $page = new Zend_Navigation_Page_Mvc(array(\r\n        'label'  => 'foo',\r\n        'route'  => 'myroute',\r\n        'params' => array(\r\n            'id'   => 1337,\r\n            'page' => 'baz',\r\n        )\r\n    ));\r\n\r\n    $this->_front->getRouter()->addRoute(\r\n        'myroute',\r\n        new Zend_Controller_Router_Route(\r\n            ':id\/foobar\/:page',\r\n            array(\r\n                'module'     => 'default',\r\n                'controller' => 'foobar',\r\n                'action'     => 'bazbat',\r\n                'id'         => 1,\r\n                'page'       => 'foo',\r\n            ),\r\n            array(\r\n                'id'   => '(\\d+)',\r\n                'page' => '(foo|bar|baz|bat)'\r\n            )\r\n        )\r\n    );\r\n\r\n    $this->assertEquals('\/1337\/foobar\/baz', $page->getHref());\r\n}\r\n\r\npublic function testHrefGeneratedIsRouteAwareWithVariablePrefixWithoutParams()\r\n{\r\n    $page = new Zend_Navigation_Page_Mvc(array(\r\n        'label' => 'foo',\r\n        'route' => 'myroute',\r\n    ));\r\n\r\n    $this->_front->getRouter()->addRoute(\r\n        'myroute',\r\n        new Zend_Controller_Router_Route(\r\n            ':id\/foobar\/:page',\r\n            array(\r\n                'module'     => 'default',\r\n                'controller' => 'foobar',\r\n                'action'     => 'bazbat',\r\n                'id'         => 1,\r\n                'page'       => 'foo',\r\n            ),\r\n            array(\r\n                'id'   => '(\\d+)',\r\n                'page' => '(foo|bar|baz|bat)'\r\n            )\r\n        )\r\n    );\r\n\r\n    $this->assertEquals('\/1\/foobar', $page->getHref());\r\n}\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-06-06T10:45:43.000+0000",
                    "updated": "2011-06-06T10:45:43.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8830\/transitions"
}