{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11991",
    "key": "ZF-11991",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Json_Server only allows error codes RESERVED for JSON-RPC implementation"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11991\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                "name": "448191",
                "displayName": "John Kleijn",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2012-01-12T07:43:22.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-02-26T19:13:52.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Zend_Json_Server only allows errors in range(-32099, -32000).\r\n\r\nThis range is within the  -32768 to -32000 range the JSON-RPC spec reserves. Zend_Json_Server should NOT allow using these codes, but allow any other."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11991\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "zf-crteam-needsexpert",
                "zf-crteam-review"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF2-181",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-181",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10121",
                    "id": 10121,
                    "name": "Zend_Json_Server",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49482",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Um... Zend_Json_Server *is* a JSON-RPC implementation; how is this a problem?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2012-01-12T14:31:46.000+0000",
                    "updated": "2012-01-12T14:31:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49483",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                        "name": "448191",
                        "displayName": "John Kleijn",
                        "active": true
                    },
                    "body": "True, I did not say Zend_Json_Server should not use these codes, I said it should not ALLOW using these codes. The are reserved for the protocol implementation, ie Zend_Json_Server itself.\r\n\r\nYet client code can only invoke errors within the reserved range. This is not in compliance with the spec:\r\n\r\n\"The error codes from and including -32768 to -32000 are reserved for pre-defined errors. Any code within this range, but not defined explicitly below is reserved for future use. The error codes are nearly the same as those suggested for XML-RPC at the following url: http:\/\/xmlrpc-epi.sourceforge.net\/specs\/rfc.fault_codes.php\"\r\n\r\nThe spec then goes on listing the specific protocol error codes, and listing the range -32099 \/ -32000 as:\r\n\r\n-32000 to -32099\tServer error\tReserved for implementation-defined server-errors.\r\n\r\nThe section (5.1) closes with the following statement:\r\n\r\n\"The remainder of the space is available for application defined errors.\"\r\n\r\nClearly, the protocol implementation does not mean the whole ZF based application but just Zend_Json_Server. So Zend_Json_Server should limit itself to this range, not the application, as the remainder of the space is \"available\" for the application. Furthermore, the rest of the application should not even be allowed to set codes in this range, because they are \"reserved\" for the protocol implementation.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                        "name": "448191",
                        "displayName": "John Kleijn",
                        "active": true
                    },
                    "created": "2012-01-12T15:06:05.000+0000",
                    "updated": "2012-01-12T15:06:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49518",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                        "name": "448191",
                        "displayName": "John Kleijn",
                        "active": true
                    },
                    "body": "Anyone?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                        "name": "448191",
                        "displayName": "John Kleijn",
                        "active": true
                    },
                    "created": "2012-01-17T10:01:33.000+0000",
                    "updated": "2012-01-17T10:01:33.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49805",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Does allowing the userspace application to set protocol error codes cause any direct negative side-effects?  Unless there is a demonstrable problem, we shouldn't change this behaviour for fear of breaking those userspace implementations which are using those error codes. ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2012-02-26T05:21:24.000+0000",
                    "updated": "2012-02-26T05:21:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49822",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                        "name": "448191",
                        "displayName": "John Kleijn",
                        "active": true
                    },
                    "body": "I get that. At the very least, the right error codes should be allowed in the 1.9 cycle, and since 2.0 isn't final yet, disallowing wrong error codes should be added to that branch.\r\n\r\nTbh, I haven't checked the latest beta, but assuming it's not fixed there (which is a reasonable assumption), it should be ASAP. Otherwise this won't be fixed until 3.0 and god knows when that will be.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                        "name": "448191",
                        "displayName": "John Kleijn",
                        "active": true
                    },
                    "created": "2012-02-26T09:52:53.000+0000",
                    "updated": "2012-02-26T09:52:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49828",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Apologies, I misread your initial report.  I thought you meant they CAN set protocol error codes, but you meant they *CAN ONLY* set errors in that reserved range.  If that is the case, it is something which should be fixed.  Could you point to me where these error codes are defined for JSON-RPC? Their [v1 specification|http:\/\/json-rpc.org\/wiki\/specification] doesn't mention anything about it.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2012-02-26T15:48:49.000+0000",
                    "updated": "2012-02-26T15:48:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49830",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                        "name": "448191",
                        "displayName": "John Kleijn",
                        "active": true
                    },
                    "body": "Tbh, I do not understand your confusion. The spec says the range -32768 to -32000 is reserved for protocol implementation. In the context of ZF, this refers to Zend_Json_Server. Yet the implementation does not allow client code to set any error codes outside of this range, while that range should be private to that component. Client code should be allowed to use any code, other than the ones within that range.\r\n\r\nI really cannot interpret the spec in any other way.\r\n\r\nPlease refer to http:\/\/jsonrpc.org\/spec.html, section 5.1.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                        "name": "448191",
                        "displayName": "John Kleijn",
                        "active": true
                    },
                    "created": "2012-02-26T16:28:21.000+0000",
                    "updated": "2012-02-26T16:28:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49832",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Just a simple misread - missed the word \"only\" in your bug description.  I've never used JSON-RPC, and I don't pretend to know anything about it (as evidenced by the fact that I found the wrong spec).\r\n\r\nAfter reading the spec you linked to, you are definitely right.  The only constraints on the error code field are (1) that it must be an integer and (2) -32768 to -32000 are reserved.  \r\n\r\nNot being familiar with the usage of Zend_Json_Server, I have a (dumb) question: do clients listen for specific error codes?  I ask this because the simple change below to implement your request will cause some response codes to change.  Explanation:\r\n\r\nCurrently, when {{Zend_Json_Server_Error::setCode}} is given a code outside the reserved range it ignores it and the internal variable {{$_code}} remains set to the last \"valid\" code specified (-32000 by default).  This is important because when I updated {{Zend_Json_Server_Error::setCode}} to accept any integer code:\r\n{code}\r\nIndex: library\/Zend\/Json\/Server\/Error.php\r\n===================================================================\r\n--- library\/Zend\/Json\/Server\/Error.php  (revision 24665)\r\n+++ library\/Zend\/Json\/Server\/Error.php  (working copy)\r\n@@ -92,13 +92,7 @@\r\n             return $this;\r\n         }\r\n\r\n-        $code = (int) $code;\r\n-        if (in_array($code, $this->_allowedCodes)) {\r\n-            $this->_code = $code;\r\n-        } elseif (in_array($code, range(-32099, -32000))) {\r\n-            $this->_code = $code;\r\n-        }\r\n-\r\n+        $this->_code = (int) $code;\r\n         return $this;\r\n     }\r\n{code}\r\n\r\nA test fails:\r\n{code}\r\n1) Zend_Json_ServerTest::testHandleRequestWithExceptionShouldReturnErrorResponse\r\nFailed asserting that <integer:0> matches expected <integer:-32000>.\r\n{code}\r\n\r\nThis is due to {{Zend_Server_Abstract::_dispatch}} (called from Zend_Json_Server line 561) throwing an exception with code 0.  This code gets passed directly back to {{Zend_Json_Server_Error::setCode}}.  Before my above modification, this would result in an actual error code of -32000 being set and sent back to the client.  However, after my modification the code 0 is sent back instead.\r\n\r\nPerhaps [~matthew] can weigh in on this?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2012-02-26T17:24:59.000+0000",
                    "updated": "2012-02-26T17:24:59.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49835",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                        "name": "448191",
                        "displayName": "John Kleijn",
                        "active": true
                    },
                    "body": "Yes, clients MAY listen to error codes, obviously. If they did not, there would be no reason to change the component to comply to spec (a problem without symptoms wouldn't be a problem). I get your point though: any applications built on the faulty implementation that rely on the current faulty error code handling would fail.\r\n\r\nStill, can we please fix this upstream? In all honesty I've already worked around this by subclassing some classes (who can wait for a ticket here to be resolved, honestly), but I'm just very disappointed in the quality of this component. Lets just fix it upstream, please.\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                        "name": "448191",
                        "displayName": "John Kleijn",
                        "active": true
                    },
                    "created": "2012-02-26T18:09:55.000+0000",
                    "updated": "2012-02-26T18:09:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49838",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "I've opened a matching issue in the ZF2 space (ZF2-181).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2012-02-26T18:45:06.000+0000",
                    "updated": "2012-02-26T18:45:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49843",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                        "name": "448191",
                        "displayName": "John Kleijn",
                        "active": true
                    },
                    "body": "Thank you. Still, I would like someone to asses the scope of the change that fixes this (partly) in the 1.9 cycle. In other words, can someone give some weight to the proposed break of BC by NOT casting application error codes to the reserved range? For many leads like myself ZF 2.0 is very, very far away.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                        "name": "448191",
                        "displayName": "John Kleijn",
                        "active": true
                    },
                    "created": "2012-02-26T19:05:29.000+0000",
                    "updated": "2012-02-26T19:06:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49844",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "I've flagged this issue for the [CR Team|http:\/\/blog.astrumfutura.com\/2010\/06\/zend-framework-community-review-team\/] to review.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2012-02-26T19:09:38.000+0000",
                    "updated": "2012-02-26T19:09:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49845",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                        "name": "448191",
                        "displayName": "John Kleijn",
                        "active": true
                    },
                    "body": "Thank you. Glad someone finally took a look at this issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=448191",
                        "name": "448191",
                        "displayName": "John Kleijn",
                        "active": true
                    },
                    "created": "2012-02-26T19:13:52.000+0000",
                    "updated": "2012-02-26T19:13:52.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11991\/transitions"
}