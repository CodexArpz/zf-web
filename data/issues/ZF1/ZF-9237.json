{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9237",
    "key": "ZF-9237",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "New fix for plural translation returns only one letter"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9237\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10440",
                    "id": 10440,
                    "description": "Mini Release",
                    "name": "1.10.3",
                    "userReleaseDate": "01\/Apr\/10",
                    "archived": false,
                    "releaseDate": "2010-04-01",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-02-26T14:04:58.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matijs",
                "name": "matijs",
                "displayName": "Matijs de Jong",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-02-23T04:17:07.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-02-26T14:04:59.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "This issue has been raised multiple times and the solutions do not work as they misstate the problem.\r\n\r\nWhen using {{plural()}} on already translated strings the {{.po}} and {{.mo}} files may not contain the strings stored as plurals. But they do contain translations of the original texts, when these are found only one letter is returned instead of a string.\r\n\r\n{code:title=Example usage|borderStyle=solid}\r\n$one = $t->_('One');\r\n$two = $t->_('Two');\r\n        \r\necho $t->plural($one, $two, $i);\r\n{code}\r\n\r\nThis now returns {{'O'}} or {{'w'}} depending on the value {{$i}} when \"translating\" from English to English.\r\n\r\nNow I understand this is not the correct use of plural, but it does seems a very common use. When using plural on two variables you have little choice, e.g. poEdit will not see {{'One'}} and {{'Two'}} as instances of plural.\r\n\r\nHowever, we can make this case work without breaking the correct working of translate files by extending the Translate Adapter to check for the plural translation choosen being an array versus a string.\r\n\r\n{code:title=Zend\/Translate\/Adapter.php (line 558-584)|borderStyle=solid}\r\n$locale = (string) $locale;\r\nif (isset($this->_translate[$locale][$messageId])) {\r\n    \/\/ return original translation\r\n    if ($plural === null) {\r\n        return $this->_translate[$locale][$messageId];\r\n    }\r\n\r\n    $rule = Zend_Translate_Plural::getPlural($number, $locale);\r\n\r\n    \/\/ BUG FIX  added: && is_array($this->_translate[$locale][$plural[0]])\r\n    if (isset($this->_translate[$locale][$plural[0]][$rule]) && is_array($this->_translate[$locale][$plural[0]])) {\r\n        return $this->_translate[$locale][$plural[0]][$rule];\r\n    } elseif (isset($this->_translate[$locale][$plural[$rule]])) { \/\/ FIX Added\r\n        return $this->_translate[$locale][$plural[$rule]]; \/\/ FIX Added\r\n    }\r\n} else if (strlen($locale) != 2) {\r\n    \/\/ faster than creating a new locale and separate the leading part\r\n    $locale = substr($locale, 0, -strlen(strrchr($locale, '_')));\r\n\r\n    if (isset($this->_translate[$locale][$messageId])) {\r\n        \/\/ return regionless translation (en_US -> en)\r\n        if ($plural === null) {\r\n           return $this->_translate[$locale][$messageId];\r\n        }\r\n\r\n        $rule = Zend_Translate_Plural::getPlural($number, $locale);\r\n        \/\/ BUG FIX  added: && is_array($this->_translate[$locale][$plural[0]])\r\n        if (isset($this->_translate[$locale][$plural[0]][$rule]) && is_array($this->_translate[$locale][$plural[0]])) {\r\n           return $this->_translate[$locale][$plural[0]][$rule];\r\n        } elseif (isset($this->_translate[$locale][$plural[$rule]])) { \/\/ FIX Added\r\n           return $this->_translate[$locale][$plural[$rule]]; \/\/ FIX Added\r\n        }\r\n    }\r\n}\r\n{code}\r\n\r\nAs this makes the translate tools more flexible there seems little reason no to include it."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9237\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10320",
                    "id": 10320,
                    "description": "Minor Release",
                    "name": "1.9.0",
                    "userReleaseDate": "31\/Jul\/09",
                    "archived": false,
                    "releaseDate": "2009-07-31",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10350",
                    "id": 10350,
                    "description": "Mini Release",
                    "name": "1.9.1",
                    "userReleaseDate": "11\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-11",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10361",
                    "id": 10361,
                    "description": "Mini Release",
                    "name": "1.9.2",
                    "userReleaseDate": "25\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-25",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10362",
                    "id": 10362,
                    "description": "Mini Release",
                    "name": "1.9.3",
                    "userReleaseDate": "22\/Sep\/09",
                    "archived": false,
                    "releaseDate": "2009-09-22",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10370",
                    "id": 10370,
                    "description": "Mini Release",
                    "name": "1.9.4",
                    "userReleaseDate": "13\/Oct\/09",
                    "archived": false,
                    "releaseDate": "2009-10-13",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10380",
                    "id": 10380,
                    "description": "Mini Release",
                    "name": "1.9.5",
                    "userReleaseDate": "27\/Oct\/09",
                    "archived": false,
                    "releaseDate": "2009-10-27",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10390",
                    "id": 10390,
                    "description": "Mini Release",
                    "name": "1.9.6",
                    "userReleaseDate": "24\/Nov\/09",
                    "archived": false,
                    "releaseDate": "2009-11-24",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10400",
                    "id": 10400,
                    "description": "Mini Release",
                    "name": "1.9.7",
                    "userReleaseDate": "11\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-11",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10360",
                    "id": 10360,
                    "description": "Minor Release",
                    "name": "1.10.0",
                    "userReleaseDate": "27\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-27",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10099",
                    "id": 10099,
                    "name": "Zend_Translate",
                    "description": "Provides translation functionality, based on standards such as TMX and Gettext.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38662",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matijs",
                        "name": "matijs",
                        "displayName": "Matijs de Jong",
                        "active": true
                    },
                    "body": "Sorry, my first time reporting in, I assumed that cloning this issue I would be able to edit the original text.\r\n\r\nThis issue has been raised multiple times and the solutions do not work as they misstate the problem.\r\n\r\nWhen using plural() on already translated strings the .po and .mo files may not contain the strings as plurals. But they do contain translations of the original texts, when these are found only one letter is returned.\r\n\r\nNow maybe I misunderstand how I should use plural, but my use seems a very common one. Especially when using plural on two variable values.\r\n\r\nA solution that does not break the correct workings of translate files is to replace th current code:\r\n\r\n            if (isset($this->_translate[$locale][$plural[0]][$rule])) {\r\n                return $this->_translate[$locale][$plural[0]][$rule];\r\n            }\r\n\r\nWith this slightly long version that check for the _translate entry being a string versus an array:\r\n\r\n            if (isset($this->_translate[$locale][$plural[0]][$rule]) && is_array($this->_translate[$locale][$plural[0]])) {\r\n                return $this->_translate[$locale][$plural[0]][$rule];\r\n            } elseif (isset($this->_translate[$locale][$plural[$rule]])) {\r\n                return $this->_translate[$locale][$plural[$rule]];\r\n            }\r\n\r\nThis has to haappen twice in plural() in Zend_Translate_adapter.php",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matijs",
                        "name": "matijs",
                        "displayName": "Matijs de Jong",
                        "active": true
                    },
                    "created": "2010-02-23T04:26:13.000+0000",
                    "updated": "2010-02-23T04:26:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38663",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matijs",
                        "name": "matijs",
                        "displayName": "Matijs de Jong",
                        "active": true
                    },
                    "body": "Sorry, there is no preview available. Here is a second try to communicate the code.\r\n\r\nif (isset($this->_translate[$locale][$plural[0]][$rule])) {\r\n\r\nreturn $this->_translate[$locale][$plural[0]][$rule];\r\n\r\n}\r\n\r\nShould become:\r\n\r\nif (isset($this->_translate[$locale][$plural[0]][$rule]) && is_array($this->_translate[$locale][$plural[0]])) {\r\n\r\nreturn $this->_translate[$locale][$plural[0]][$rule];\r\n\r\n} elseif (isset($this->_translate[$locale][$plural[$rule]])) {\r\n\r\nreturn $this->_translate[$locale][$plural[$rule]];\r\n\r\n}\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matijs",
                        "name": "matijs",
                        "displayName": "Matijs de Jong",
                        "active": true
                    },
                    "created": "2010-02-23T04:29:23.000+0000",
                    "updated": "2010-02-23T04:29:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38664",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matijs",
                        "name": "matijs",
                        "displayName": "Matijs de Jong",
                        "active": true
                    },
                    "body": "FInally found out how this works. Sorry for the messy comments.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matijs",
                        "name": "matijs",
                        "displayName": "Matijs de Jong",
                        "active": true
                    },
                    "created": "2010-02-23T04:38:40.000+0000",
                    "updated": "2010-02-23T04:38:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38698",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Please give something reproducable... po file & mo file.\r\n\r\nIn past other files were broken or did have a false locale where plural rule and mo content did not match.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-02-23T14:02:19.000+0000",
                    "updated": "2010-02-23T14:02:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38751",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matijs",
                        "name": "matijs",
                        "displayName": "Matijs de Jong",
                        "active": true
                    },
                    "body": "I added a clarifying example and changed the priority and issue type.\r\n\r\nThis is not a bug, but including these changes would make the use of translations a little more flexible. If nothing else this issue will make the problem more clear to other people having the same problem.\r\n\r\nPS: As I did not add the {{.po}} and {{.mo}} files because this is not about their correctness but about how you can use the translation tool.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matijs",
                        "name": "matijs",
                        "displayName": "Matijs de Jong",
                        "active": true
                    },
                    "created": "2010-02-25T08:56:22.000+0000",
                    "updated": "2010-02-25T08:56:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38777",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "The newly added code example does not add a plural to gettext but 2 singulars.\r\n\r\nWhen you use singular within gettext then you can't expect that Zend_Translate will make plural from singular. The created mo file from gettext differs between singular and plural.\r\n\r\nWe will not add plural usage for singulars. This would introduce severe problems not only with gettext itself but also all other adapters.\r\n\r\nFor details about how to create plural source files please take a look into the gettext documentation, poedit or even the php manual.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-02-26T14:04:40.000+0000",
                    "updated": "2010-02-26T14:04:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38778",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Closing as won't fix",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-02-26T14:04:59.000+0000",
                    "updated": "2010-02-26T14:04:59.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9237\/transitions"
}