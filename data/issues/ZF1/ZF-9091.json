{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9091",
    "key": "ZF-9091",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Controller_Request_Http::setPathInfo setting path info to wrong string if base url doesnt exist in request uri"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9091\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10412",
                    "id": 10412,
                    "description": "Mini Release",
                    "name": "1.10.1",
                    "userReleaseDate": "10\/Feb\/10",
                    "archived": false,
                    "releaseDate": "2010-02-10",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-02-08T08:25:30.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=symphony",
                "name": "symphony",
                "displayName": "Symphony IT",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-02-05T03:10:06.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-02-08T08:53:35.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "The code is doing a substr on the request uri with the length of the base url without actually checking if the base url is in the request uri.  This can cause issues with it not finding either the module or the controller.\r\n\r\ne.g. If the request uri is set to \/auth\/login and the index.php is located at \/app\/index.php then the base url is set to '\/app'. In this case the path info is set to 'h\/login' rather than '\/auth\/login' which is quite clearly wrong as we're not looking for a controller\/module 'h', we're looking for auth.\r\n\r\nThe following code (line 626 in file Zend\/Controller\/Request\/Http.php):\r\n\r\nif ((null !== $baseUrl)\r\n\t&& (false === ($pathInfo = substr($requestUri, strlen($baseUrl)))))\r\n{\r\n\t\/\/ If substr() returns false then PATH_INFO is set to an empty string\r\n\t$pathInfo = '';\r\n} elseif (null === $baseUrl) {\r\n\t$pathInfo = $requestUri;\r\n}\r\n\r\nNeeds changing to:\r\n\r\nif (null !== $baseUrl\r\n\t&& ((!empty($baseUrl) && 0 === strpos($requestUri, $baseUrl)) || empty($baseUrl))\r\n\t&& false === ($pathInfo = substr($requestUri, strlen($baseUrl))))\r\n{\r\n\t\/\/ If substr() returns false then PATH_INFO is set to an empty string\r\n\t$pathInfo = '';\r\n} elseif (null === $baseUrl || (!empty($baseUrl) && false === strpos($requestUri, $baseUrl))) {\r\n\t$pathInfo = $requestUri;\r\n}\r\n\r\n\r\nor something similar to deal with this kind of situation.  This case is encountered when doing some rewrites of the url via apache (or other webserver software) before using the framework application."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/2",
                "name": "Critical"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9091\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10360",
                    "id": 10360,
                    "description": "Minor Release",
                    "name": "1.10.0",
                    "userReleaseDate": "27\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-27",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10011",
                    "id": 10011,
                    "name": "Zend_Controller",
                    "description": "front controller, including router and dispatcher",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38277",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Can you provide a reproducible test case, please?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2010-02-05T08:52:29.000+0000",
                    "updated": "2010-02-05T08:52:29.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38337",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=symphony",
                        "name": "symphony",
                        "displayName": "Symphony IT",
                        "active": true
                    },
                    "body": "in the .htaccess file in the webroot of the current folder we have the following:\r\n\r\nRewriteEngine on\r\nRewriteCond %{REQUEST_FILENAME} -s [OR]\r\nRewriteCond %{REQUEST_FILENAME} -l [OR]\r\nRewriteCond %{REQUEST_FILENAME} -d\r\nRewriteRule ^.*$ - [NC,L]\r\nRewriteRule ^.*$ \/app\/index.php [NC,L]\r\n\r\nredirecting any requests for files that don't exist through the new Zend Framework application's webroot (the Apache alias \"\/app\").\r\n\r\nSo in the case of someone requesting via a url:\r\n\r\nhttp:\/\/testdomain.com\/index\/index\r\n\r\nthis is obviously re-written via apache to:\r\n\r\nhttp:\/\/testdomain.com\/app\/index\/index\r\n\r\nhowever, php is seeing the request uri as \"\/index\/index\" not \"\/app\/index\/index\" because it is coming directly from the browser's request.\r\n\r\nThis means when it gets to the above mentioned code it is removing a sub-string of the length of \"\/app\" from \"\/index\/index\" producing \"ex\/index\" as the path info, obviously removing \"\/ind\" even though this isn't the same as the base url \"\/app\"\r\n\r\nThe same occurs, as mentioned above, with request uri \"\/auth\/login\" with it removing \"\/aut\" therefore producing \"h\/login\" as the path info\r\n\r\nI've tested the new code provided above with our separate web-sites that run from from other base URLs and it seems to run correctly from those.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=symphony",
                        "name": "symphony",
                        "displayName": "Symphony IT",
                        "active": true
                    },
                    "created": "2010-02-08T02:09:31.000+0000",
                    "updated": "2010-02-08T02:09:31.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38355",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Fixed in trunk and 1.10 release branch. Thanks for providing the extra information -- I was able to create a reproduce case from that.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2010-02-08T08:25:30.000+0000",
                    "updated": "2010-02-08T08:25:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38357",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=symphony",
                        "name": "symphony",
                        "displayName": "Symphony IT",
                        "active": true
                    },
                    "body": "Many Thanks, glad to help",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=symphony",
                        "name": "symphony",
                        "displayName": "Symphony IT",
                        "active": true
                    },
                    "created": "2010-02-08T08:53:35.000+0000",
                    "updated": "2010-02-08T08:53:35.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9091\/transitions"
}