{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4942",
    "key": "ZF-4942",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Auth_Adapter_Http MD5 Digest algorithm wrong"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4942\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/5",
                "name": "Cannot Reproduce"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-11-20T13:37:01.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jacwright",
                "name": "jacwright",
                "displayName": "Jacob Wright",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-11-13T16:17:03.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-11-24T10:22:17.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "The A1 hash in the digest algorithm is not being created correctly. It is currently:\n\n{code}\n$ha1 = $this->_digestResolver->resolve($data['username'], $data['realm']);\nif ($ha1 === false) {\n    return $this->_challengeClient();\n}\n\nif ($this->_algo == 'MD5-sess') {\n    $ha1 = hash('md5', $ha1.':'.$data['nonce'].':'.$data['cnonce']);\n}\n{code}\n\nand should be:\n\n{code}\n$ha1 = $this->_digestResolver->resolve($data['username'], $data['realm']);\nif ($ha1 === false) {\n    return $this->_challengeClient();\n}\n\n$ha1 = hash('md5', $data['username'] . ':' . $data['realm'] . ':' . $ha1);\n\nif ($this->_algo == 'MD5-sess') {\n    $ha1 = $ha1.':'.$data['nonce'].':'.$data['cnonce'];\n}\n{code}\n\nThis is according to RFC 2617 (http:\/\/tools.ietf.org\/html\/rfc2617#section-3.2.2.2) and is done correctly (except without MD5-sess support) on the PHP site http:\/\/us3.php.net\/manual\/en\/features.http-auth.php.\n\nThis looks like it has never worked, which makes me think I'm missing something and am wrong. Please correct me if needed.\n\n-- UPDATE --\n(I would have posted this as a comment but do not seem to have permissions)\n\nUsing the provided file resolver I created two files to test with. I would upload them if I had the option, but looks like I'll need to paste them in here.\n\n-- passwd.txt --\n{code}\nuser:realm:password\nfred:realm:test\n{code}\n\n-- http_auth_test.php --\n{code}\n<?php\n\n\/**\n * Testing HTTP authentication using the provided file resolver. File contains\n * a line for each user with the following format, username:realm:password\n * The resolver returns the password found, if any, from the resolve method it\n * implements.\n * \n * Navigating to this page will pop up an HTTP auth dialog in the browser, and\n * after entering a valid username and password allows you to view its content.\n * This is using 'basic' authentication. When using 'digest' authentication the\n * same username and password will not work. The auth dialog pops up, but after\n * submitting the credentials it will reply with unauthorized and asks again for\n * the correct credentials. This is corrected using the fix I provided.\n * \n * Is there another way it should be handled? Or a work-around that people have\n * been using? Has it always worked for others because they always set the\n * 'accept_schemes' config to 'basic digest'? This allows both and the browser\n * (at least Firefox 3 on Mac) uses basic when given the option. \n * \n * To test the methods upload this file to a server.\n * For basic  - http:\/\/server\/path\/http_auth_test.php?scheme=basic\n * For digest - http:\/\/server\/path\/http_auth_test.php?scheme=digest\n *\/\n\nrequire_once 'Zend\/Controller\/Request\/Http.php';\nrequire_once 'Zend\/Controller\/Response\/Http.php';\nrequire_once 'Zend\/Auth\/Adapter\/Http.php';\nrequire_once 'Zend\/Auth\/Adapter\/Http\/Resolver\/File.php';\n\n\/\/ just use the request\/response objects. No need to load up the entire\n\/\/ controller framework for this simple test.\n$request = new Zend_Controller_Request_Http();\n$response = new Zend_Controller_Response_Http();\n\n\/\/ create the resolver which will be used for both schemas\n$file = new Zend_Auth_Adapter_Http_Resolver_File('passwd.txt');\n\n\/\/ \n$scheme = $request->getParam('scheme');\n\nif ($scheme == null || !($scheme == 'basic' || $scheme == 'digest')) {\n\tthrow new Exception('The authentication scheme must be provided in the URL and\n\t\tit must be \"basic\" or \"digest\" (e.g. http:\/\/the\/url?scheme=basic)');\n}\n\n$auth = new Zend_Auth_Adapter_Http(array(\n\t'accept_schemes' => $scheme,\n\t'realm'          => 'realm',\n\t'digest_domains' => '\/',\n\t'nonce_timeout'  => 3600,\n));\n\n$auth->setBasicResolver($file);\n$auth->setDigestResolver($file);\n$auth->setRequest($request);\n$auth->setResponse($response);\n\n$result = $auth->authenticate();\n\n$response->sendHeaders();\n\n?>\n<html>\n<head>\n<title>HTTP Authentication Test<\/title>\n<\/head>\n<body>\n<?php if ($result->isValid()): ?>\n<h2>Successfully logged into the page<\/h2>\n<?php else: ?>\n<h2>Unauthorized to view this page<\/h2>\n<?php endif; ?>\n<\/body>\n<\/html>\n{code}\n\nMake sure the scheme does NOT include basic in any other tests you may run. The scheme 'basic digest' allows basic to be used and thus cannot test digest accurately. Set scheme to 'digest' in your tests.\n\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/2",
                "name": "Critical"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4942\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10260",
                    "id": 10260,
                    "description": "Minor Release",
                    "name": "1.7.0",
                    "userReleaseDate": "17\/Nov\/08",
                    "archived": false,
                    "releaseDate": "2008-11-17",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10084",
                    "id": 10084,
                    "name": "Zend_Auth",
                    "description": "A abstraction for various concrete web application authentication implementations.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26432",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "Upgraded priority to Critical",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2008-11-16T04:02:03.000+0000",
                    "updated": "2008-11-16T04:02:03.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26529",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I cannot reproduce --  I just followed the manual directly, and digest authentication worked flawlessly.\n\nI'm going to close this issue; if you are having problems, please post:\n* the minimum code necessary to reproduce the issue\n* expected behavior\n* actual behavior\n\nThanks!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-11-20T13:36:48.000+0000",
                    "updated": "2008-11-20T13:36:48.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4942\/transitions"
}