{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11420",
    "key": "ZF-11420",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Session doesn't allow you to destory and recreate a session"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11420\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-08-26T10:59:03.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tvgece",
                "name": "tvgece",
                "displayName": "venu",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-05-31T12:09:47.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-08-26T10:59:03.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "My requirement is, When user agent change session should destroy, and it should start new session. But Zend_Session::start() is throwing an exception if destroy was called before start().\r\n\r\n{code:title=bootstrap.php|borderStyle=solid} \r\ntry {\r\n  Zend_Session::start();\r\n} catch (Zend_Session_Exception $e) {\r\n  Zend_Session::destroy(true);\r\n  Zend_Session::start(); \/\/ breaking here\r\n  Zend_Session::regenerateId();\r\n}\r\nZend_Session::registerValidator(new Zend_Session_Validator_HttpUserAgent());\r\n{code} \r\n\r\nException:\r\n----------\r\nUncaught exception 'Zend_Session_Exception' with message 'The session was explicitly destroyed during this request, attempting to re-start is not allowed.' in library\\Zend\\Session.php:431"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11420\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "zendsession",
                "zf-crteam-padraic",
                "zf-crteam-priority"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=joust",
                "name": "joust",
                "displayName": "Artur Bodera",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-3378",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3378",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-1497",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1497",
                    "type": {
                        "name": "Duplicate",
                        "direction": "OUTBOUND",
                        "description": "duplicates"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10580",
                    "id": 10580,
                    "description": "Mini Release",
                    "name": "1.11.6",
                    "userReleaseDate": "05\/May\/11",
                    "archived": false,
                    "releaseDate": "2011-05-05",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10096",
                    "id": 10096,
                    "name": "Zend_Session",
                    "description": "A standardized interface to common functionality found in or indigenous to site session implementations. ",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46932",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tvgece",
                        "name": "tvgece",
                        "displayName": "venu",
                        "active": true
                    },
                    "body": "I have a global session management in bootstrap, which validates the request and starts session. By that time, request won't be dispatched. Then why to make another request to redirect to another page? As we already knew that session is wrong one? we could easily start new one right?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tvgece",
                        "name": "tvgece",
                        "displayName": "venu",
                        "active": true
                    },
                    "created": "2011-05-31T13:28:02.000+0000",
                    "updated": "2011-05-31T13:28:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46933",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tvgece",
                        "name": "tvgece",
                        "displayName": "venu",
                        "active": true
                    },
                    "body": "As I understood, The reason is the second start() command is silently ignored if it was already called in that request. ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tvgece",
                        "name": "tvgece",
                        "displayName": "venu",
                        "active": true
                    },
                    "created": "2011-05-31T13:34:02.000+0000",
                    "updated": "2011-05-31T13:34:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48179",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=joust",
                        "name": "joust",
                        "displayName": "Artur Bodera",
                        "active": true
                    },
                    "body": "*IMPORTANT!*\r\n\r\n{{session_destroy()}} will (by design) prevent any further session cookies to be sent.\r\nThis means your use case *must be avoided* if you are using cookies.\r\n\r\n\r\n\r\nHere is more info in php manual comments:\r\nhttp:\/\/www.php.net\/manual\/en\/function.session-destroy.php#85379\r\n\r\nHere are my analysis on the issue:\r\nhttp:\/\/framework.zend.com\/issues\/browse\/ZF2-52?focusedCommentId=48042&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-48042\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=joust",
                        "name": "joust",
                        "displayName": "Artur Bodera",
                        "active": true
                    },
                    "created": "2011-08-26T10:39:03.000+0000",
                    "updated": "2011-08-26T10:39:03.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48180",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=joust",
                        "name": "joust",
                        "displayName": "Artur Bodera",
                        "active": true
                    },
                    "body": "You don't need to destroy session in order to regenerate id.\r\nThat is a wrong understanding of how sessions work.\r\n\r\nHere is how you *clear* a session with ZF:\r\n{code}\r\n\/\/ assuming sessionData is the namespace you're using\r\n$sessionData->unsetAll();\r\n{code}\r\nThe above will result in all data in the namespace to be unset and this\r\nchange will be saved in your session storage.\r\n\r\nThis is how you change session ID by sending a different cookie to browser:\r\n{code}\r\nZend_Session::regenerateId();\r\n{code}\r\nThis will result in generating a new session id and sending a new session\r\ncookie to the browser. The old session id (old cookie) becomes invalid after\r\nthis function call.\r\n\r\nHere is a fixed version of your source code:\r\n{code}\r\nZend_Session::registerValidator(new Zend_Session_Validator_HttpUserAgent());\r\n\r\ntry {\r\n  Zend_Session::start();\r\n} catch (Zend_Session_Exception $e) {\r\n\r\n  \/\/ clear all data in all namespaces\r\n  foreach(Zend_Session::getIterator() as $name=>$ns){\r\n    Zend_Session::namespaceUnset($name); \r\n  }\r\n\r\n  \/\/ alternatively   $_SESSION = array()\r\n  \r\n  \/\/ generate new session id and send new cookie to browser\r\n  Zend_Session::regenerateId();\r\n}\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=joust",
                        "name": "joust",
                        "displayName": "Artur Bodera",
                        "active": true
                    },
                    "created": "2011-08-26T10:53:34.000+0000",
                    "updated": "2011-08-26T10:53:34.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48181",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=joust",
                        "name": "joust",
                        "displayName": "Artur Bodera",
                        "active": true
                    },
                    "body": "It is an expected behavior as Zend_Session wraps around php built-in session support. By PHP's design, after destroying a session it must not be started again.\n\nhttp:\/\/www.php.net\/manual\/en\/function.session-destroy.php",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=joust",
                        "name": "joust",
                        "displayName": "Artur Bodera",
                        "active": true
                    },
                    "created": "2011-08-26T10:59:03.000+0000",
                    "updated": "2011-08-26T10:59:03.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11420\/transitions"
}