{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3382",
    "key": "ZF-3382",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Cache_Backend_File problems under very high load"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3382\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10240",
                    "id": 10240,
                    "description": "Minor Release",
                    "name": "1.6.0",
                    "userReleaseDate": "02\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-02",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-06-26T14:19:34.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=daniel123",
                "name": "daniel123",
                "displayName": "caval ionut",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-06-04T05:13:00.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-09-02T10:39:33.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When using Zend_Cache and the site is under heavy load it does not use cache anymore. \nWe have tested using ab benchmark software and it seems that Zend_Cache cannot read each time the metadata file which generates a new cache instance so the cache is regenerated"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3382\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                "name": "fab",
                "displayName": "Fabien MARTY",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11342",
                    "filename": "better_log.txt",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-25T15:45:43.000+0000",
                    "size": 165665,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11342\/better_log.txt"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11343",
                    "filename": "better_log_with_locking.txt",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-25T15:48:38.000+0000",
                    "size": 159105,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11343\/better_log_with_locking.txt"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11341",
                    "filename": "log.txt",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=daniel123",
                        "name": "daniel123",
                        "displayName": "caval ionut",
                        "active": true
                    },
                    "created": "2008-06-25T08:25:00.000+0000",
                    "size": 190524,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11341\/log.txt"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11344",
                    "filename": "zend_cache.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-25T17:45:09.000+0000",
                    "size": 2720,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11344\/zend_cache.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10181",
                    "id": 10181,
                    "description": "Mini Release",
                    "name": " 1.5.2",
                    "userReleaseDate": "15\/May\/08",
                    "archived": true,
                    "releaseDate": "2008-05-15",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10028",
                    "id": 10028,
                    "name": "Zend_Cache",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22120",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=doctorrock83",
                        "name": "doctorrock83",
                        "displayName": "julien PAULI",
                        "active": true
                    },
                    "body": "Seems to be a file locking problem , have you tried such a test with a memory based backend ? (APC, Memcached ...)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=doctorrock83",
                        "name": "doctorrock83",
                        "displayName": "julien PAULI",
                        "active": true
                    },
                    "created": "2008-06-04T08:29:51.000+0000",
                    "updated": "2008-06-04T08:29:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22121",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=daniel123",
                        "name": "daniel123",
                        "displayName": "caval ionut",
                        "active": true
                    },
                    "body": "No we haven't tried that. Unfortunately we cannot use a memory based cached. \nAre there any other solutions that we might try?\nThank you",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=daniel123",
                        "name": "daniel123",
                        "displayName": "caval ionut",
                        "active": true
                    },
                    "created": "2008-06-04T08:41:45.000+0000",
                    "updated": "2008-06-04T08:41:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22124",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "following code works under heavy load with apache bench :\n\n{code}\n<?php\n\nrequire_once 'Zend\/Cache.php';\n\n$frontendOptions = array(\n   'lifetime' => 7200\n);\n\n$backendOptions = array(\n    'cache_dir' => '\/tmp\/' \/\/ Directory where to put the cache files\n);\n\n$cache = Zend_Cache::factory('Core', 'File', $frontendOptions, $backendOptions);\n\nif(!$result = $cache->load('myresult')) {\n    $result='foobar foobar foobar...';\n    $cache->save($result, 'myresult');\n    echo \"NOT CACHED\";\n} else {\n    echo \"CACHED\";\n}\n\n{code}\n\nI tried with \"ab -c 50 -n 1000\" (50 concurrent request)\n\nI got : \"Failed requests:        0\"\n\nIf you try the same example with a lifetime of 2 seconds for example (to get a NOT CACHED during the test), you have some \"Failed requests because of length which is not the same \"CACHED\" or \"NOT CACHED\").\n\nSo IMHO, File backend works under heavy load.\n\nHave try to activate logging ? If it's a file locking problem (because of specific software or hardware...), you can try to desactivate file locking in backend options ? \n\nCan you try my example on your servers ?\n\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2008-06-04T10:13:38.000+0000",
                    "updated": "2008-06-04T10:13:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22272",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=daniel123",
                        "name": "daniel123",
                        "displayName": "caval ionut",
                        "active": true
                    },
                    "body": "Hi,\nSorry for the late response but i was working on other solution of cache. I have tried your solution and the problem persists.\n<<I got : \"Failed requests: 0\">>\nI got that too but during that test the cached file was rewritten once\/second. Please try you test with more content on the page. I have tested using the the index page of my site which has most resource consuming modules. \nSo the problem is not that i don't get the response back from server, the problem is that sometime the script cannot read the file and therefore  it will generate another cache file.\nThank you, hope that helps",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=daniel123",
                        "name": "daniel123",
                        "displayName": "caval ionut",
                        "active": true
                    },
                    "created": "2008-06-10T02:59:49.000+0000",
                    "updated": "2008-06-10T02:59:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22599",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "no problem for me\n\nplease activate logging ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2008-06-20T12:55:38.000+0000",
                    "updated": "2008-06-20T12:55:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22629",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=daniel123",
                        "name": "daniel123",
                        "displayName": "caval ionut",
                        "active": true
                    },
                    "body": "I attach the code that i have used too:\n\n$logger = new Zend_Log();\n$writer = new Zend_Log_Writer_Stream(ROOT_DIR . '\/cache\/log.txt');\n\n$logger->addWriter($writer);\n\n$logger->log('>>>>START ' . $session_id, 1);\n\n$frontendOptions = array(\n'lifetime' => 600000,\n'logging' => true\n);\n\n$backendOptions = array(\n'cache_dir' => ROOT_DIR . '\/cache\/', \/\/ Directory where to put the cache files\n'file_locking' => false\n);\n\n$cache = Zend_Cache::factory('Core', 'File', $frontendOptions, $backendOptions);\n\nif(!$result = $cache->load('myresult')) {\n\tfor ($i=0;$i<100000;$i++) {\n\t\t$result .= $i . '<br>';\n\t}\n\t\/\/$result='foobar foobar foobar...';\n\t$cache->save($result, 'myresult');\n\t$logger->log('NOT CACHED', 1);\n\techo \"NOT CACHED\";\n\t$logger->log('<<<<END ' . $session_id, 1);\n} else {\n\t$logger->log('CACHED', 1);\n\techo \"CACHED\";\n\t$logger->log('<<<<END ' . $session_id, 1);\n}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=daniel123",
                        "name": "daniel123",
                        "displayName": "caval ionut",
                        "active": true
                    },
                    "created": "2008-06-25T08:25:01.000+0000",
                    "updated": "2008-06-25T08:25:01.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22630",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=daniel123",
                        "name": "daniel123",
                        "displayName": "caval ionut",
                        "active": true
                    },
                    "body": "Using the code above I was still getting the following results in ab:\n\n{panel}\nThis is ApacheBench, Version 2.0.40-dev <$Revision: 1.146 $> apache-2.0\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http:\/\/www.zeustech.net\/\nCopyright 2006 The Apache Software Foundation, http:\/\/www.apache.org\/\n\nBenchmarking www.intrebari-daniel.ro (be patient)\nCompleted 100 requests\nCompleted 200 requests\nCompleted 300 requests\nCompleted 400 requests\nCompleted 500 requests\nCompleted 600 requests\nCompleted 700 requests\nCompleted 800 requests\nCompleted 900 requests\nFinished 1000 requests\n\n\nServer Software:        Apache\/2.2.3\nServer Hostname:        www.intrebari-daniel.ro\nServer Port:            80\n\nDocument Path:          \/\nDocument Length:        6 bytes\n\nConcurrency Level:      50\nTime taken for tests:   51.9509 seconds\nComplete requests:      1000\nFailed requests:        35\n   (Connect: 0, Length: 35, Exceptions: 0)\nWrite errors:           0\nTotal transferred:      402000 bytes\nHTML transferred:       8000 bytes\nRequests per second:    19.60 [#\/sec] (mean)\nTime per request:       2550.476 [ms] (mean)\nTime per request:       51.010 [ms] (mean, across all concurrent requests)\nTransfer rate:          7.68 [Kbytes\/sec] received\n\nConnection Times (ms)\n              min  mean[+\/-sd] median   max\nConnect:        0   17  53.1      0     298\nProcessing:    33 2388 7297.9     64   41585\nWaiting:        2 1958 6057.9     61   41583\nTotal:         33 2405 7298.0     64   41585\n\nPercentage of the requests served within a certain time (ms)\n  50%     64\n  66%    180\n  75%    941\n  80%   1620\n  90%   4513\n  95%  15133\n  98%  36262\n  99%  38378\n 100%  41585 (longest request)\n{panel}\n\nI have tried using Sqlite engine and the cache was fine\n\nThank you",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=daniel123",
                        "name": "daniel123",
                        "displayName": "caval ionut",
                        "active": true
                    },
                    "created": "2008-06-25T08:29:23.000+0000",
                    "updated": "2008-06-25T08:29:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22635",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "I'm definitely seeing the same thing here.\n\nNot entirely sure whats happening, but the file backend is removing metadata and cache files before they expire under high load.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-25T15:12:30.000+0000",
                    "updated": "2008-06-25T15:12:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22636",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "I can reliably reproduce this using the testcase code using ab and -n 1000 -c 4 (instead of -c 50).\n\nPHP 5.2.6 running as FastCGI",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-25T15:28:39.000+0000",
                    "updated": "2008-06-25T15:28:39.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22637",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "Also... using APC 3.0.19",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-25T15:30:04.000+0000",
                    "updated": "2008-06-25T15:30:04.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22638",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "Still happens with file_locking turned off.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-25T15:35:24.000+0000",
                    "updated": "2008-06-25T15:35:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22639",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "Here is a better log, with the actual Zend_Cache_Backend_File logging output",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-25T15:45:43.000+0000",
                    "updated": "2008-06-25T15:45:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22640",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "Here is another log, this time with file_locking turned on",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-25T15:48:38.000+0000",
                    "updated": "2008-06-25T15:48:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22641",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "The problem still happens with file locking on and both read and write control turned off.\n\nNot sure whats going on here but it basically makes the File Backend completely useless under any kind of load.\n\npretty standard linux setup, 2.6.18 on an ext3 fs.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-25T15:55:18.000+0000",
                    "updated": "2008-06-25T15:55:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22642",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "OK, I've found the problem and a fix.\n\nI will post a patch after I've had a chance to verify it and clean it up.\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-25T16:06:34.000+0000",
                    "updated": "2008-06-25T16:06:34.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22643",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "I've attached a patch to fix this issue. apply with patch -p0\n\nBasically there were some implementation details of the reading and writing of files here that were very vulnerable to race conditions.\n\nI have tested this on linux 2.6 and windows, it performs perfectly in both cases.\n\nhere is a summary of the changes in the patch:\n\n- removed filesize check and fread from _fileGetContents and replaced with stream_get_contents, lessens race vulnerability\n- removed flock(LOCK_UN) calls from _fileGetContents\/_filePutContents, since fclose releases locks anyway, and they create a tiny and needless race condition between lock release and fclose.\n- added third optional parameter to _setMetadatas, to disable writing metadata to disk, eliminating the needless rewriting of metadatas file during _getMetadatas\n- changed fopen mode in _filePutContents to ab+ from wb, and added fseek(0) and ftruncate(0) calls after LOCK_EX, This virtually eliminates the race problems due to PHP fopen implementation. see http:\/\/bugs.php.net\/bug.php?id=28371 and http:\/\/www.rooftopsolutions.nl\/article\/107 for reasons why this is better",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-25T17:45:10.000+0000",
                    "updated": "2008-06-25T17:45:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22644",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=daniel123",
                        "name": "daniel123",
                        "displayName": "caval ionut",
                        "active": true
                    },
                    "body": "That seems to fix it. I have added the patch to Zend library. \n\nThanks a lot",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=daniel123",
                        "name": "daniel123",
                        "displayName": "caval ionut",
                        "active": true
                    },
                    "created": "2008-06-26T00:20:11.000+0000",
                    "updated": "2008-06-26T00:20:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22647",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "I will get a contributor license agreement sent to Zend today so that the patch can be applied for 1.5.3",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-26T05:18:13.000+0000",
                    "updated": "2008-06-26T05:18:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22649",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "Also, just a quick note, the likely reason Fabian didn't see the problem with his testcase, is the amount of data being cached in his testcase is small enough that it fits in the normal fwrite\/fread buffers and thus minimizes the race condition a bit, using Caval's test case will hit the problem every time.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-26T06:33:18.000+0000",
                    "updated": "2008-06-26T06:33:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22652",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "Also this patch improves performance greatly in the case of a php backend that does not have a particular cache id in its internal metadatas array, as it no longer rewrites the metadatas file to disk in this case.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-26T09:47:25.000+0000",
                    "updated": "2008-06-26T09:47:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22653",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "Can't reproduce this even with a 10 MB cache file !\n\n{{{code}}}\n<?php\n\nrequire_once 'Zend\/Cache.php';\n\n$frontendOptions = array(\n   'lifetime' => 7200\n);\n\n$backendOptions = array(\n    'cache_dir' => '\/tmp\/' \/\/ Directory where to put the cache files\n);\n\n$cache = Zend_Cache::factory('Core', 'File', $frontendOptions, $backendOptions);\n\nif(!$result = $cache->load('myresult')) {\n    $res = '';\n    for ($i = 0 ; $i < 1000000 ; $i++) {\n        $res .= '0123456789';\n    }\n    $cache->save($res, 'myresult');\n    echo \"NOT CACHED\";\n} else {\n    echo \"CACHED\";\n}\n\n?>\n\nab -c 50 -n 1000 URL\n\n=> no failed request (a \"not cached\" would produce a length error)\n\n{{{code}}}\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2008-06-26T10:41:59.000+0000",
                    "updated": "2008-06-26T10:41:59.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22654",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "some interesting things in the patch anyway\n\nI'm reviewing it \n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2008-06-26T10:50:10.000+0000",
                    "updated": "2008-06-26T10:50:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22655",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "The ab failed request is not what shows you the bug :-)\n\nactivate a logger for the cache and log cached vs not cached in a log file.\n\nWhat is happening is under load, without my patch, you will get constant cache misses as the metadatas and cache files are trampled due to race conditions. see the log files I have attached to the bug.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-26T11:01:36.000+0000",
                    "updated": "2008-06-26T11:01:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22656",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "2008-06-25T22:46:59+00:00 ALERT (1): >>>>START \n2008-06-25T22:46:59+00:00 ALERT (1): >>>>START \n2008-06-25T22:46:59+00:00 ALERT (1): >>>>START \n2008-06-25T22:46:59+00:00 WARN (4): Zend_Cache_Backend_File::load() \/ read_control : stored hash and computed hash do not match\n2008-06-25T22:46:59+00:00 WARN (4): Zend_Cache_Core::save() \/ write_control : written and read data do not match\n2008-06-25T22:46:59+00:00 ALERT (1): NOT CACHED\n2008-06-25T22:46:59+00:00 ALERT (1): <<<<END \n2008-06-25T22:46:59+00:00 WARN (4): Zend_Cache_Backend_File::load() \/ read_control : stored hash and computed hash do not match\n2008-06-25T22:46:59+00:00 WARN (4): Zend_Cache_Core::save() \/ write_control : written and read data do not match\n2008-06-25T22:46:59+00:00 ALERT (1): NOT CACHED\n2008-06-25T22:46:59+00:00 ALERT (1): <<<<END \n2008-06-25T22:46:59+00:00 ALERT (1): >>>>START \n2008-06-25T22:46:59+00:00 ALERT (1): NOT CACHED\n2008-06-25T22:46:59+00:00 ALERT (1): <<<<END \n2008-06-25T22:46:59+00:00 ALERT (1): >>>>START \n2008-06-25T22:46:59+00:00 ALERT (1): >>>>START \n2008-06-25T22:46:59+00:00 ALERT (1): NOT CACHED\n2008-06-25T22:46:59+00:00 ALERT (1): <<<<END \n2008-06-25T22:46:59+00:00 ALERT (1): >>>>START \n2008-06-25T22:46:59+00:00 ALERT (1): NOT CACHED\n2008-06-25T22:46:59+00:00 ALERT (1): <<<<END \n2008-06-25T22:46:59+00:00 ALERT (1): NOT CACHED\n2008-06-25T22:46:59+00:00 ALERT (1): <<<<END \n2008-06-25T22:46:59+00:00 ALERT (1): >>>>START \n2008-06-25T22:46:59+00:00 ALERT (1): >>>>START \n2008-06-25T22:46:59+00:00 ALERT (1): CACHED\n2008-06-25T22:46:59+00:00 ALERT (1): <<<<END \n2008-06-25T22:46:59+00:00 ALERT (1): NOT CACHED\n2008-06-25T22:46:59+00:00 ALERT (1): <<<<END \n2008-06-25T22:46:59+00:00 ALERT (1): >>>>START \n2008-06-25T22:46:59+00:00 WARN (4): Zend_Cache_Backend_File::load() \/ read_control : stored hash and computed hash do not match\n2008-06-25T22:46:59+00:00 ALERT (1): >>>>START \n2008-06-25T22:47:00+00:00 ALERT (1): NOT CACHED\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-26T11:04:05.000+0000",
                    "updated": "2008-06-26T11:04:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22657",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "My test case\n\n{{\n\n<?php\n\ndefine('ROOT_DIR', '\/var\/www\/test');\nset_include_path(ROOT_DIR . '\/lib' . PATH_SEPARATOR . get_include_path());\n\nrequire 'Zend\/Log.php';\nrequire 'Zend\/Log\/Writer\/Stream.php';\nrequire 'Zend\/Cache.php';\n\n$logger = new Zend_Log();\n$writer = new Zend_Log_Writer_Stream(ROOT_DIR . '\/cache\/log.txt');\n\n$logger->addWriter($writer);\n\n$logger->log('>>>>START ' . $session_id, 1);\n\n$frontendOptions = array(\n    'lifetime' => 600000,\n    'logging' => true,\n    'logger' => $logger\n);\n\n$backendOptions = array(\n    'cache_dir' => ROOT_DIR . '\/cache\/', \/\/ Directory where to put the cache files\n    'file_locking' => true\n);\n\n$cache = Zend_Cache::factory('Core', 'File', $frontendOptions, $backendOptions);\n\nif (!$result = $cache->load('myresult')) {\n    for ($i=0;$i<100000;$i++) { $result .= $i . '<br>'; }\n    $cache->save($result, 'myresult');\n    $logger->log('NOT CACHED', 1);\n    echo \"NOT CACHED\";\n    $logger->log('<<<<END ' . $session_id, 1);\n} else {\n    $logger->log('CACHED', 1);\n    echo \"CACHED\"; $logger->log('<<<<END ' . $session_id, 1);\n}\n\n}}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-26T11:09:48.000+0000",
                    "updated": "2008-06-26T11:09:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22661",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "The  part of the patch \"added third optional parameter to _setMetadatas, to disable writing metadata to disk, eliminating the needless rewriting of metadatas file during _getMetadatas\" is commited into the trunk and into the 1.5 branch\n\nOther parts should be commited only into the trunk (for 1.6 release)\n\nCould you try the head of the 1.5 branch to see if the problem is fixed for you ?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2008-06-26T14:03:24.000+0000",
                    "updated": "2008-06-26T14:03:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22662",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "other part of the patch commited to the trunk (for 1.6 release)\n\ngood job\n\nthanks",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2008-06-26T14:11:43.000+0000",
                    "updated": "2008-06-26T14:11:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/22666",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "body": "Tested 1.5 branch snapshot, definitely helps reduce the problem quite a bit, but does not totally eliminate it as the full patch does.\n\nThanks a ton for your work, and I really look forward to the next 1.5 release and more so to 1.6!!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cpisto",
                        "name": "cpisto",
                        "displayName": "Cody Pisto",
                        "active": true
                    },
                    "created": "2008-06-26T14:27:44.000+0000",
                    "updated": "2008-06-26T14:27:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24147",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Updating for the 1.6.0 release.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-09-02T10:39:33.000+0000",
                    "updated": "2008-09-02T10:39:33.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3382\/transitions"
}