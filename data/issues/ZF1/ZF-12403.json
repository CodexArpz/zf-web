{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12403",
    "key": "ZF-12403",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Cannot validate Date if end-user uses custom HTTP_ACCEPT_LANGUAGE"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12403\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/8",
                "name": "Issue Moved"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2013-04-05T16:07:21.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=powerkiki",
                "name": "powerkiki",
                "displayName": "Adrien Crivelli",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2012-09-04T07:34:08.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2013-04-05T16:07:21.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "HTTP_ACCEPT_LANGUAGE",
                "exception",
                "validate"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Date validation throw exception if the end-user enter custom values for HTTP_ACCEPT_LANGUAGE which are used internally in Zend_Locale. Those values are 'root', 'auto' and 'browser'.\r\n\r\nI believe those internal values should never be accepted from end-user. However I can't wrap my mind around Zend_Locale well enough to provide a patch for that.\r\n\r\n\r\nHere is a test script to be used via CLI (so we can manually set HTTP_ACCEPT_LANGUAGE):\r\n\r\n{code}<?php\r\nrequire_once('Zend\/Version.php');\r\nrequire_once('Zend\/Locale.php');\r\nrequire_once('Zend\/Registry.php');\r\nrequire_once('Zend\/Validate\/Date.php');\r\n\r\nif (php_sapi_name() != 'cli')\r\n\tdie('must run as CLI script');\r\n\r\n\/\/ Extends Zend_Locale, so we can reset its state between tests\r\nclass Zend_LocaleReset extends Zend_Locale {\r\n\tpublic static function reset() {\r\n\t\tself::$_auto = null;\r\n\t\tself::$_browser = null;\r\n\t\tself::$_environment = null;\r\n\t}\r\n}\r\n\r\nfunction test($accept) \r\n{\r\n\tZend_LocaleReset::reset();\r\n\t$_SERVER['HTTP_ACCEPT_LANGUAGE'] = $accept;\r\n\r\n\t$locale = new Zend_Locale();\r\n\tZend_Registry::set('Zend_Locale', $locale);\r\n\t\r\n\techo $accept . \"\\t=>\\t\" . $locale->getLanguage() . ': ';\r\n\ttry {\r\n\t\t$validator = new Zend_Validate_Date(array('format' => 'Y-m-d'));\r\n\t\t$validator->isValid('2012-08-08');\r\n\t\techo 'OK';\r\n\t} catch (Exception $exc) {\r\n\t\techo $exc->getMessage();\r\n\t}\r\n\techo PHP_EOL;\r\n\t\r\n}\r\n\r\necho 'Zend Version: ' . Zend_Version::VERSION . PHP_EOL . PHP_EOL;\r\ntest(null);\r\ntest('');\r\ntest('en');\r\ntest('en-US,en;q=0.8,ko;q=0.6');\r\ntest('fr');\r\ntest('non valid string');\r\ntest('root');\r\ntest('auto');\r\ntest('browser');\r\ntest('environment');\r\n{code}\r\n\r\nIt will output the following:\r\n{code}$ php test.php \r\nZend Version: 1.11.0dev\r\n\r\n\t=>\ten: OK\r\n\t=>\ten: OK\r\nen\t=>\ten: OK\r\nen-US,en;q=0.8,ko;q=0.6\t=>\ten: OK\r\nfr\t=>\tfr: OK\r\nnon valid string\t=>\ten: OK\r\nroot\t=>\troot: The locale '' is no known locale\r\nauto\t=>\troot: The locale '' is no known locale\r\nbrowser\t=>\troot: The locale '' is no known locale\r\nenvironment\t=>\ten: OK\r\n\r\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12403\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10550",
                    "id": 10550,
                    "description": "Mini Release",
                    "name": "1.11.5",
                    "userReleaseDate": "07\/Apr\/11",
                    "archived": false,
                    "releaseDate": "2011-04-07",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10580",
                    "id": 10580,
                    "description": "Mini Release",
                    "name": "1.11.6",
                    "userReleaseDate": "05\/May\/11",
                    "archived": false,
                    "releaseDate": "2011-05-05",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10680",
                    "id": 10680,
                    "description": "Mini Release",
                    "name": "1.11.7",
                    "userReleaseDate": "02\/Jun\/11",
                    "archived": false,
                    "releaseDate": "2011-06-02",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10780",
                    "id": 10780,
                    "description": "Mini Release",
                    "name": "1.11.8",
                    "userReleaseDate": "07\/Jul\/11",
                    "archived": false,
                    "releaseDate": "2011-07-07",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10880",
                    "id": 10880,
                    "description": "Mini Release",
                    "name": "1.11.9",
                    "userReleaseDate": "14\/Jul\/11",
                    "archived": false,
                    "releaseDate": "2011-07-14",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10980",
                    "id": 10980,
                    "description": "Mini Release",
                    "name": "1.11.10",
                    "userReleaseDate": "04\/Aug\/11",
                    "archived": false,
                    "releaseDate": "2011-08-04",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10981",
                    "id": 10981,
                    "description": "Mini Release",
                    "name": "1.11.11",
                    "userReleaseDate": "29\/Sep\/11",
                    "archived": false,
                    "releaseDate": "2011-09-29",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/11080",
                    "id": 11080,
                    "description": "Mini Release",
                    "name": "1.11.12",
                    "userReleaseDate": "22\/Jun\/12",
                    "archived": false,
                    "releaseDate": "2012-06-22",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/11180",
                    "id": 11180,
                    "description": "Mini Release",
                    "name": "1.11.13",
                    "userReleaseDate": "20\/Aug\/12",
                    "archived": false,
                    "releaseDate": "2012-08-20",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/11181",
                    "id": 11181,
                    "description": "Mini Release",
                    "name": "1.11.14",
                    "userReleaseDate": "27\/Aug\/12",
                    "archived": false,
                    "releaseDate": "2012-08-27",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10510",
                    "id": 10510,
                    "description": "Minor Release",
                    "name": "1.12.0",
                    "userReleaseDate": "27\/Aug\/12",
                    "archived": false,
                    "releaseDate": "2012-08-27",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10072",
                    "id": 10072,
                    "name": "Zend_Date",
                    "description": "Zend_Date is the basic library for the handling of all date, time and calendar-related issues.",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10073",
                    "id": 10073,
                    "name": "Zend_Locale",
                    "description": "Zend_Locale is a basic wrapper for all I18N and L10N issues for the Zend Framework. It provides the userbasically with access to translation functionality. It can handle different source file types for translation.",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10140",
                    "id": 10140,
                    "name": "Zend_Validate",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52144",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fgibaux",
                        "name": "fgibaux",
                        "displayName": "fgibaux",
                        "active": true
                    },
                    "body": "In fact if the value of HTTP_ACCEPT_LANGUAGE is any word of letter up to 8 chars that is not a language or a country, it fails :\r\n\r\n{code} \r\ntest('null');\r\ntest('top');\r\n{code} \r\n\r\nwill output\r\n\r\n{code} \r\nnull    =>      root: The locale '' is no known locale\r\ntop     =>      root: The locale '' is no known locale\r\n{code} \r\n\r\n\r\nA solution could be to validate input in static function getBrowser() of Zend_Locale :\r\n\r\nsomething like this ??\r\n\r\n{code}\r\nif (!isset(self::$_localeData[$region]) && !isset(self::$_territoryData[$region])) {\r\n    continue;\r\n}\r\nforeach ($countrys as $country) {\r\n{code}\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fgibaux",
                        "name": "fgibaux",
                        "displayName": "fgibaux",
                        "active": true
                    },
                    "created": "2012-10-22T16:34:19.000+0000",
                    "updated": "2012-10-22T16:34:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/53529",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "This issue has been closed on Jira and moved to GitHub for issue tracking.  To continue following the resolution of this issues, please visit: https:\/\/github.com\/zendframework\/zf1\/issues\/10",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2013-04-05T16:07:21.000+0000",
                    "updated": "2013-04-05T16:07:21.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12403\/transitions"
}