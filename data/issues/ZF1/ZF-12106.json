{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12106",
    "key": "ZF-12106",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "DomQuery fails to evaluate XPath when there are warnings in loaded Zend_Dom."
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12106\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10510",
                    "id": 10510,
                    "description": "Minor Release",
                    "name": "1.12.0",
                    "userReleaseDate": "27\/Aug\/12",
                    "archived": false,
                    "releaseDate": "2012-08-27",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-05-30T12:40:29.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mhujer",
                "name": "mhujer",
                "displayName": "Martin Hujer",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2012-03-19T19:15:50.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-05-30T12:40:29.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "DOM",
                "xml"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I couldn't get assertQuery from [Zend_Test_PHPUnit|http:\/\/framework.zend.com\/manual\/en\/zend.test.phpunit.html] working. Then I tried to hack in the ZF code and I realized that XPath does not work when there are warnings in the DOMDocument:\r\n\r\n{code}\r\n$doc = new DOMDocument();\r\n$doc->loadXML('<root><node>Fine<\/node><\/root>');\r\n$xpath = new DOMXPath($doc);\r\necho 'Count: ' . $xpath->evaluate('count(\/root\/node)') . \"\\n\"; \/\/1\r\n\r\n$doc = new DOMDocument();\r\n$doc->loadXML('<root><node>Unknown entity &copy;<\/node><\/root>');\r\n$xpath = new DOMXPath($doc);\r\necho 'Count: ' . $xpath->evaluate('count(\/root\/node)') . \"\\n\"; \/\/0\r\n{code}\r\n\r\nWhen the Zend_Test_PHPUnit_Constraint_DomQuery instances Zend_Dom_Query which loads the document (with unknown entities), it does not produce any warnings (although, there are populated in the documentErrors propery).\r\n\r\nThe assert just fails as if the XPath returned no results."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12106\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mhujer",
                "name": "mhujer",
                "displayName": "Martin Hujer",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-11376",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11376",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/15108",
                    "filename": "ZF-12106.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mhujer",
                        "name": "mhujer",
                        "displayName": "Martin Hujer",
                        "active": true
                    },
                    "created": "2012-05-23T13:45:16.000+0000",
                    "size": 1843,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/15108\/ZF-12106.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10981",
                    "id": 10981,
                    "description": "Mini Release",
                    "name": "1.11.11",
                    "userReleaseDate": "29\/Sep\/11",
                    "archived": false,
                    "releaseDate": "2011-09-29",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10310",
                    "id": 10310,
                    "name": "Zend_Dom_Query",
                    "description": "Use CSS selectors to query (X)HTML or XML documents.",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10312",
                    "id": 10312,
                    "name": "Zend_Test_PHPUnit",
                    "description": "PHPUnit test scaffolding for ZF MVC applications",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50066",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "If the document is malformed, why would it return results? Or are you suggesting we throw an exception?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2012-03-19T21:17:23.000+0000",
                    "updated": "2012-03-19T21:17:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50067",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tomas.fejfar@gmail.com",
                        "name": "tomas.fejfar@gmail.com",
                        "displayName": "Tom\u00e1\u0161 Fejfar",
                        "active": true
                    },
                    "body": "It should do something. Either try to recover and ignore that unknown entity along with issuing a warning or fail completly and throw \"malformed document\" exception. Only thing it SHOULD NOT do is to fail silently IMO. ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tomas.fejfar@gmail.com",
                        "name": "tomas.fejfar@gmail.com",
                        "displayName": "Tom\u00e1\u0161 Fejfar",
                        "active": true
                    },
                    "created": "2012-03-19T22:07:45.000+0000",
                    "updated": "2012-03-19T22:07:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50078",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mhujer",
                        "name": "mhujer",
                        "displayName": "Martin Hujer",
                        "active": true
                    },
                    "body": "Thanks for the quick answer!\r\n\r\nThe first problem is that is fails with misleading error.\r\n\r\nI have a test that does assertQuery() on response (using PHPUnit and Zend_Test), and when the returned webpage is not valid XML (although it is returned as valid xhtml from w3.org validator), it fails the assertion (failed asserting that sth is present). I would have expected to get info saying \"Document is malformed, couldn't evaluate the XPath expression.\".\r\n\r\nAnother problem is, that the document type detection perfomed in Zend_Dom_Query is based on document content, which resolves to xml, despite the fact that webpage returns header \"Content-Type:text\/html\". (It parses fine when I hack the ZF code to force the parsing as HTML. Also the XPath works fine in this case).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mhujer",
                        "name": "mhujer",
                        "displayName": "Martin Hujer",
                        "active": true
                    },
                    "created": "2012-03-20T09:15:53.000+0000",
                    "updated": "2012-03-20T09:15:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50733",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mhujer",
                        "name": "mhujer",
                        "displayName": "Martin Hujer",
                        "active": true
                    },
                    "body": "Attaching patch, which changes the regex added in ZF-11376 (+test)\r\n\r\nIt fixes this issue and does not break any tests for Zend_Dom",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mhujer",
                        "name": "mhujer",
                        "displayName": "Martin Hujer",
                        "active": true
                    },
                    "created": "2012-05-23T13:45:16.000+0000",
                    "updated": "2012-05-23T13:45:16.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50734",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mhujer",
                        "name": "mhujer",
                        "displayName": "Martin Hujer",
                        "active": true
                    },
                    "body": "Adam, can you please review the patch? (Assigning you, because you have worked on the closely related isssue ZF-11376)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mhujer",
                        "name": "mhujer",
                        "displayName": "Martin Hujer",
                        "active": true
                    },
                    "created": "2012-05-23T13:47:35.000+0000",
                    "updated": "2012-05-23T13:47:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50869",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Fixed in trunk r24820.  Thanks, Martin!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2012-05-30T12:40:29.000+0000",
                    "updated": "2012-05-30T12:40:29.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12106\/transitions"
}