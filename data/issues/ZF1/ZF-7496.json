{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7496",
    "key": "ZF-7496",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Impossible to use Zend_Test_PHPUnit_ControllerTestCase to test redirects issued in preDispatch() hooks"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7496\/votes",
                "votes": 18,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10980",
                    "id": 10980,
                    "description": "Mini Release",
                    "name": "1.11.10",
                    "userReleaseDate": "04\/Aug\/11",
                    "archived": false,
                    "releaseDate": "2011-08-04",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-09-08T22:58:22.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjh_ca",
                "name": "mjh_ca",
                "displayName": "Marc Hodgins",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-08-05T19:16:15.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-09-08T22:58:22.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "Redirect",
                "Zend_Test",
                "Zend_Test_PHPUnit",
                "Zend_Test_PHPUnit_ControllerTestCase",
                "preDispatch"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "This bug\/improvement request is related to ZF-7455 , but goes beyond it as this is more than a documentation problem.  Zend_Test_PHPUnit_ControllerTestCase seems to be unable to test redirects generated by preDispatch() hooks in action controllers and in controller plugins.  That is to say, you cannot apparently use the redirect assertions provided by Zend_Test to test for redirects issued by preDispatch() hooks and plug-ins.\r\n\r\nThe default behavior of Zend_Controller_Action_Helper_Redirector is to call exit() after a redirect has been issued.  This halts further processing of any code after the redirect. Zend_Test disables this default behavior.\r\n\r\nTo work around this, Matthew suggests that the correct method of calling the redirect action helper within a controller action is to 'return' so as to abort further processing within the action:\r\nhttp:\/\/www.mail-archive.com\/fw-general@lists.zend.com\/msg20208.html\r\n\r\nFor example:\r\n\r\n{noformat}\r\n\/\/ correct\r\nreturn $this->_helper->redirector('index');\r\n\r\n\/\/ incorrect\r\n$this->_helper->redirector('index');\r\n{noformat}\r\n\r\nThis practice is sufficient to allow redirects from within actions.  However, it seems there is no clean way to use those same assertions on redirects that are performed within a Zend_Controller_Action 's preDispatch() method, or,to test a redirect issued within a preDispatch() method on a Zend_Controller_Plugin that is attached to the controller.\r\n\r\nFor example, I have an ACL plugin which checks to see whether the user must be logged in to view the requested action.  If the user must be logged in, then the preDispatch() method of the plugin calls the redirector helper to redirect to the login controller.  However, since Zend_Test has disabled the exit() functionality of the redirector helper, the dispatcher still proceeds to dispatch to the originally requested action.  Since that originally requested action expected the user to be logged in, it throws errors of its own.  The end result being (I think because I have an error controller specified?) that an HTTP 500 error is thrown and Zend_Test's assertRedirect() methods return false instead of true ... \r\n\r\nThere has got to be a cleaner way to do this...  Surely there are cases where Zend_Test needs to be used for integration testing to confirm that preDispatch() code which issues redirects is playing well with the code in the actions?"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7496\/watchers",
                "isWatching": false,
                "watchCount": 22
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                "name": "adamlundrigan",
                "displayName": "Adam Lundrigan",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-5619",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5619",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-7455",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7455",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/14422",
                    "filename": "trunk_ZF-7496.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "created": "2011-06-25T01:39:25.000+0000",
                    "size": 3402,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/14422\/trunk_ZF-7496.diff"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/14426",
                    "filename": "ZF-7496.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-06-28T19:04:26.000+0000",
                    "size": 15602,
                    "mimeType": "text\/x-patch",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/14426\/ZF-7496.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10320",
                    "id": 10320,
                    "description": "Minor Release",
                    "name": "1.9.0",
                    "userReleaseDate": "31\/Jul\/09",
                    "archived": false,
                    "releaseDate": "2009-07-31",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10880",
                    "id": 10880,
                    "description": "Mini Release",
                    "name": "1.11.9",
                    "userReleaseDate": "14\/Jul\/11",
                    "archived": false,
                    "releaseDate": "2011-07-14",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10011",
                    "id": 10011,
                    "name": "Zend_Controller",
                    "description": "front controller, including router and dispatcher",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10312",
                    "id": 10312,
                    "name": "Zend_Test_PHPUnit",
                    "description": "PHPUnit test scaffolding for ZF MVC applications",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33245",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjh_ca",
                        "name": "mjh_ca",
                        "displayName": "Marc Hodgins",
                        "active": true
                    },
                    "body": "Fixing formatting...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjh_ca",
                        "name": "mjh_ca",
                        "displayName": "Marc Hodgins",
                        "active": true
                    },
                    "created": "2009-08-05T19:18:03.000+0000",
                    "updated": "2009-08-05T19:18:03.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34595",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "You are right, personally i think redirector action helper has to be refactored to skip the dispatching look somehow and call the redirect and exit after that, so that it behaves equally in the enviroments.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2009-09-18T01:41:31.000+0000",
                    "updated": "2009-09-18T01:41:31.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35002",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjs",
                        "name": "mjs",
                        "displayName": "Michael Stillwell",
                        "active": true
                    },
                    "body": "Maybe it's possible to do something with an exception?  That is, instead of exiting, a third return technique is added to the redirect helper (on top of \"continue\" and \"exit) so that in test mode it throws a custom exception from the redirect helper to effect the jump.  This exception could be caught somewhere in test harness.  It's a nasty fix though...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjs",
                        "name": "mjs",
                        "displayName": "Michael Stillwell",
                        "active": true
                    },
                    "created": "2009-09-30T06:26:39.000+0000",
                    "updated": "2009-09-30T06:26:39.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42568",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ezameku",
                        "name": "ezameku",
                        "displayName": "Olivier Doucet",
                        "active": false
                    },
                    "body": "I am also experiencing this problem. I have a authentification control in preDispatch()\r\nEverything is working fine in production, but when I'm executing the tests, my action is still triggered.\r\nI am currently using ZF 1.10.8\r\n\r\nHow to easily repeat it :\r\n{noformat} class MyController extends Zend_Controller_Action\r\n{\r\n    function preDispatch() {\r\n        return $this->_redirect('\/'); \/\/ I am using 'return' :)\r\n    }\r\n\r\n    function indexAction() {\r\n        var_dump('This should never be executed');\r\n    }\r\n}\r\n{noformat} Output : \r\n{noformat} \r\nstring(This should never be executed)\r\n{noformat} \r\n\r\nNote: using {{return $this->_redirect('\/', array('exit' => true));}}     is worse, as phpunit is also terminated.\r\n\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ezameku",
                        "name": "ezameku",
                        "displayName": "Olivier Doucet",
                        "active": false
                    },
                    "created": "2010-10-19T02:25:48.000+0000",
                    "updated": "2010-10-19T02:25:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43553",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fernandomm",
                        "name": "fernandomm",
                        "displayName": "Fernando Morgenstern",
                        "active": true
                    },
                    "body": "Another vote to have this bug fixed.\r\n\r\nI also have problems with Zend_Test and my ACL plugin.\r\n\r\nUnfortunately, as almost all of my applications uses preDispatch method, Zend Test becomes very limited as i have to keep checking if a test fail because of this bug or a real bug in my app.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fernandomm",
                        "name": "fernandomm",
                        "displayName": "Fernando Morgenstern",
                        "active": true
                    },
                    "created": "2010-12-10T15:26:08.000+0000",
                    "updated": "2010-12-10T15:26:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43789",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=twisty",
                        "name": "twisty",
                        "displayName": "Tim Brayshaw",
                        "active": true
                    },
                    "body": "Here's my workaround, but it's not pretty!\r\n\r\nIn the preDispatch method of my plugin, instead of issuing a redirect, I rewrite the request to specify a custom \"plugin-redirector\" action, setting the location of the redirect as a param.\r\n\r\n{code}\r\n$request->setModuleName('default');\r\n$request->setControllerName('index');\r\n$request->setActionName('plugin-redirector');\r\n$request->setParam('location', '\/foo');\r\n{code}\r\n\r\nThe action is called which then performs the redirect (note the return):\r\n\r\n{code}\r\nfunction pluginRedirectorAction()\r\n{\r\n    $location = $this->_getParam('location');\r\n    return $this->getHelper('Redirector')->gotoUrl($location);\r\n}\r\n{code}\r\n\r\nAs far as I can tell, this exhibits the same behaviour in production and testing.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=twisty",
                        "name": "twisty",
                        "displayName": "Tim Brayshaw",
                        "active": true
                    },
                    "created": "2010-12-21T14:06:25.000+0000",
                    "updated": "2010-12-21T14:06:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44064",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=niqo",
                        "name": "niqo",
                        "displayName": "Nicolas Qui\u00e9not",
                        "active": true
                    },
                    "body": "Having the same issue, any news on this ?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=niqo",
                        "name": "niqo",
                        "displayName": "Nicolas Qui\u00e9not",
                        "active": true
                    },
                    "created": "2011-01-19T05:04:33.000+0000",
                    "updated": "2011-01-19T05:04:33.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44286",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alex505",
                        "name": "alex505",
                        "displayName": "alexvandam",
                        "active": true
                    },
                    "body": "This problem isn't just limited to preDispatch.\r\n\r\nI am using a routeShutdown hook, for language detection.\r\n\r\nAnd I redirect to a url witch contains the url.\r\n\r\nLike: \/nl\/controller\/action\r\n\r\nThis isn't detected by zend_test either!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alex505",
                        "name": "alex505",
                        "displayName": "alexvandam",
                        "active": true
                    },
                    "created": "2011-02-06T06:06:54.000+0000",
                    "updated": "2011-02-06T06:06:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44287",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alex505",
                        "name": "alex505",
                        "displayName": "alexvandam",
                        "active": true
                    },
                    "body": "I found out that it works sometimes. But for some reason, when the error controller is used, it isn't detected as a redirect.\n\nSo when i go to \/abc (this doesn't exists, so it produces a 404 page), it redirects to \/nl\/abc. But that isn't detected! But when i go to \/index, which redirects to \/nl\/index, it \u00eds detected properly in zend_test. ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alex505",
                        "name": "alex505",
                        "displayName": "alexvandam",
                        "active": true
                    },
                    "created": "2011-02-06T06:12:47.000+0000",
                    "updated": "2011-02-06T06:12:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47239",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "body": "Hi Guys,\r\n\r\nI've developed a patch which seems to fix the behaviour for me (I'm only using redirects in preDispatch methods). We might need to tweak it a bit to work with routeShutdown etc. All I'm doing is 'returning early' in Zend_Controller_Action::dispatch() if the preDispatch method has turned the response into a redirect.\r\n\r\nThe Zend_Controller_Action & Zend_Test_PHPUnit_ControllerTestCase suites continue to pass as expected. My application's test suite now passes correctly as well.\r\n\r\n!trunk_ZF-7496.diff!\r\n\r\nRegards,\r\n\r\nRob",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "created": "2011-06-24T06:25:38.000+0000",
                    "updated": "2011-06-24T06:25:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47247",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "Hi Rob,\r\n\r\nThanks for the patch to contribute to ZF. However, before contributing code you should sign the cla (http:\/\/framework.zend.com\/wiki\/display\/ZFPROP\/Contributor+License+Agreement). After then you can attach files.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-06-24T09:44:28.000+0000",
                    "updated": "2011-06-24T09:44:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47248",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "body": "Oh I see,\r\n\r\nI tweeted Matthew asking, but he hasn't replied yet.\r\n\r\nI'll go sign the CLA.\r\n\r\nRegards,\r\n\r\nRob",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "created": "2011-06-24T09:52:23.000+0000",
                    "updated": "2011-06-24T09:52:23.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47252",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "Rob - Have you considered that it may be bad practice to do redirecting from {{preDispatch()}} or {{init()}} etc.? See what I have commented in ZF-5619. Thoughts?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-06-24T12:51:08.000+0000",
                    "updated": "2011-06-24T12:51:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47253",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "body": "bq. Rob - Have you considered that it may be bad practice to do redirecting from preDispatch() or init() etc.? See what I have commented in ZF-5619. Thoughts?\r\n\r\nHi Kim,\r\n\r\nNo I haven't. Why is it bad practice? For example if I wanted to check if a user is not 'logged-in' then deny them from the rest of the controller actions, what should I be doing? Ideally I don't want to repeat code in *every* controller action to check whether the user is logged in or not. It would be preferable to place this logic in one location and automatically deny access to all of the controller actions.\r\n\r\nRails offers a similar feature in their 'before_filters'. You can create a filter with redirects if required. Please refer to: [http:\/\/guides.rubyonrails.org\/action_controller_overview.html#filters].\r\n\r\nRegards,\r\n\r\nRob",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "created": "2011-06-24T14:22:58.000+0000",
                    "updated": "2011-06-24T14:22:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47258",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "body": "Okay,\r\n\r\nI've signed the CLA, please find my patch attached.\r\n\r\nRegards,\r\n\r\nRob",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "created": "2011-06-25T01:42:28.000+0000",
                    "updated": "2011-06-25T01:42:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47259",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "Rob,\r\n\r\nI'm refering Matthew (ZF-5619)\r\n\r\nbq. The primary issue I'm seeing right now is actually in your code. When you call _forward() or one of the _redirect() or redirector methods, you should always return immediately; if you do not do so, the action continues to execute, which can lead to the problems you're describing.\r\n\r\nand Olek (ZF-7455)\r\n\r\nbq. If I redirect from an action helper in init or preDispatch, I want the action controller not to even call the action. Unfortunately, this is not the case, and the regular action logic like rendering happens as well.\r\n\r\nSo have you tested that if you are calling redirector in {{preDispatch()}} and return there immediately, does it prevent action to be executed?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-06-25T07:03:48.000+0000",
                    "updated": "2011-06-25T07:03:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47260",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "body": "bq. So have you tested that if you are calling redirector in preDispatch() and return there immediately, does it prevent action to be executed?\r\n\r\nYes I have. The problem is this works in production, but if you are using {{Zend_Test_PHPUnit_ControllerTestCase}} to unit-test your controllers it won't work. This is because the {{setExit}} method on {{Zend_Controller_Action_Helper_Redirector}} is set to {{false}}, so performing a redirect won't call PHP's {{exit}} function - hence {{Zend_Controller_Action::dispatch()}} will call the controller action.\r\n\r\nDoes that make sense?\r\n\r\nRegards,\r\n\r\nRob",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "created": "2011-06-25T07:18:13.000+0000",
                    "updated": "2011-06-25T07:18:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47261",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "Ok then the patch looks good to me. Nice work, thanks.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-06-25T07:38:11.000+0000",
                    "updated": "2011-06-25T07:38:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47262",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "body": "bq. Ok then the patch looks good to me. Nice work, thanks.\r\n\r\nKim,\r\n\r\nKeep in mind we might need to play with it a bit to cater for some of the other issues the guys have mentioned above. e.g. I'm not sure if it fixes redirects in the {{routeShutdown}} hook for example as I didn't test for this.\r\n\r\nIt should be trivial to add another test though. I'll do it if I get some time.\r\n\r\nOr alternatively maybe we should open separate issues for these hooks? What are your thoughts?\r\n\r\nRegards,\r\n\r\nRob",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "created": "2011-06-25T07:46:16.000+0000",
                    "updated": "2011-06-25T07:48:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47263",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "bq. I'm not sure if it fixes redirects in the routeShutdown hook for example as I didn't test for this.\r\n\r\nBut that's the plugin method and thus beyound the issue addressed here? Though I could also test this in next week.\r\n\r\nedit:\r\n\r\nbq. Or alternatively maybe we should open separate issues for these hooks? What are your thoughts?\r\n\r\nYes.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-06-25T07:56:24.000+0000",
                    "updated": "2011-06-25T07:58:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47264",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "body": "Oh Cool,\r\n\r\nI think that's it from me then on this issue.\r\n\r\nRegards,\r\n\r\nRob",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "created": "2011-06-25T11:00:11.000+0000",
                    "updated": "2011-06-25T11:00:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47297",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "I've attached a modified version of Rob Morgan's fix and additional unit tests to support (ZF-7496.patch).\r\n\r\nThe modification I made was to allow the post-dispatch hooks to still run even if a redirect was invoked in the pre-dispatch hooks.\r\n\r\nThe provided unit tests show that the provided fix works for all pre-dispatch hooks (init, routeStartup, routeShutdown, dispatchLoopStartup and preDispatch)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-06-28T19:04:26.000+0000",
                    "updated": "2011-06-28T19:07:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47298",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "Adam - tested and working as expected from controller plugin hooks and from controller action hooks.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-06-28T19:31:14.000+0000",
                    "updated": "2011-06-28T19:31:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47299",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "I've run the patch through QA for our sites which use redirector in the affected locations and no adverse effects were observed.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-06-29T01:30:37.000+0000",
                    "updated": "2011-06-29T01:30:37.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47551",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "body": "Hey Adam,\r\n\r\nI've successfully run your patch and the updated unit-tests without any problems.\r\n\r\nI've also run the patch against one of my sites and it works as intended.\r\n\r\nHow do we go about getting this patch merged into ZF trunk?\r\n\r\nRegards,\r\n\r\nRob",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "created": "2011-07-19T08:54:15.000+0000",
                    "updated": "2011-07-19T08:54:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47587",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "The consensus seems to be that the fix works as expected, so i've committed it to trunk and merged into release. \n\nFixed in trunk r24252\nMerged to release-1.11 in r24253",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-07-22T00:15:15.000+0000",
                    "updated": "2011-07-22T00:15:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47682",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rdohms",
                        "name": "rdohms",
                        "displayName": "Rafael Machado Dohms",
                        "active": true
                    },
                    "body": "Not sure how this fits in the scenario, so i'll explain and let you judge.\r\n\r\nI have a test that does the following actions:\r\n\r\n1. Build dependencies\r\n2. Calls a dispatch on url X to setup dependencies (this url does a header-location redirect)\r\n3. Dispatches url Y\r\n4. Checks result.\r\n\r\nSince this commit was done this case is now failing and fails to ever execute the action in Url Y. I might be doing something wrong, i should probably clear the dispatcher after the first call but i'm looking into how to do this.\r\n\r\nI just wanted to share the scenario so you guys can look at another usercase.\r\n\r\nCheers",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rdohms",
                        "name": "rdohms",
                        "displayName": "Rafael Machado Dohms",
                        "active": true
                    },
                    "created": "2011-07-26T20:53:40.000+0000",
                    "updated": "2011-07-26T20:53:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47778",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "@Rafael \r\n\r\nCould you provide a short code sample illustrating your use case? The test code plus the code in the action method for \"url X\" (specifically the redirect) should be sufficient to allow me to get a good handle on how to correct the issue. \r\n\r\nOne of the changes introduced for this issue's fix is that action methods are not executed after a redirect has been invoked, and this is where you're problem lies. We may want to revisit that decision, as it appears to break the pre-existing functionality you outlined",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-07-29T13:01:50.000+0000",
                    "updated": "2011-07-29T13:01:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47779",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Reopened due to comments",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-07-29T13:02:15.000+0000",
                    "updated": "2011-07-29T13:02:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47814",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "body": "@Rafael \r\n\r\nI am interested to see your test code as well.\r\n\r\nRegards,\r\n\r\nRob",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robsta",
                        "name": "robsta",
                        "displayName": "Rob Morgan",
                        "active": true
                    },
                    "created": "2011-07-31T14:28:40.000+0000",
                    "updated": "2011-07-31T14:28:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47816",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rdohms",
                        "name": "rdohms",
                        "displayName": "Rafael Machado Dohms",
                        "active": true
                    },
                    "body": "Hey guys, i actually figured i needed to call a resetResponse between the dispatches to clear avoid the issue.\r\n\r\nIf you still want i can go fetch the code, but it was as i suspected my fault.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rdohms",
                        "name": "rdohms",
                        "displayName": "Rafael Machado Dohms",
                        "active": true
                    },
                    "created": "2011-07-31T17:43:50.000+0000",
                    "updated": "2011-07-31T17:43:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47817",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "@Rafael\r\nCould you still show the code where you build your dependencies and then dispatch to the final action?  I will update the ZF manual to include a note advising users that they must use resetResponse in that situation, but I would like to make sure I understand the use case properly first.  Thanks!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-07-31T19:26:01.000+0000",
                    "updated": "2011-07-31T19:26:01.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47831",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "There's actually a note in the examples already (http:\/\/framework.zend.com\/manual\/en\/zend.test.phpunit.html#zend.test.phpunit.examples), though we may want to pull that out as a separate, more explicit note prior to the examples.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2011-08-01T13:13:25.000+0000",
                    "updated": "2011-08-01T13:13:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47869",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rdohms",
                        "name": "rdohms",
                        "displayName": "Rafael Machado Dohms",
                        "active": true
                    },
                    "body": "@Adam\r\n\r\nMy case is very close to the example Matthew pointed to. We have a few code policies here which prevent me from sharing the whole code, but its nature is the same.\r\n\r\nOne call to log the user in, one call to test something with a logged user. So the response stays dirty from one to another, doing a reset solves the issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rdohms",
                        "name": "rdohms",
                        "displayName": "Rafael Machado Dohms",
                        "active": true
                    },
                    "created": "2011-08-05T14:14:32.000+0000",
                    "updated": "2011-08-05T14:14:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47870",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "@Rafael, @Matthew\r\nThe fix for the issue has changed that facet of framework's behavior: you now have to resetResponse between redirects, which (AFAIK) you didn't need to do before.  Would this be considered a BC break, or is it OK?  ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-08-05T15:24:34.000+0000",
                    "updated": "2011-08-05T15:24:34.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7496\/transitions"
}