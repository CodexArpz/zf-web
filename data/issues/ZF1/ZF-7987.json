{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7987",
    "key": "ZF-7987",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Validate_Float locale"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7987\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10370",
                    "id": 10370,
                    "description": "Mini Release",
                    "name": "1.9.4",
                    "userReleaseDate": "13\/Oct\/09",
                    "archived": false,
                    "releaseDate": "2009-10-13",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-09-30T12:12:21.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kungla",
                "name": "kungla",
                "displayName": "Valter Kungla",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-09-30T07:29:33.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-01-24T12:39:14.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "My locale is et_EE\n\n(Zend_Locale::setDefault(LOCALE); is set)\n\nFloat validator fails if I use construct method without locale - it won't chek default locale but uses localeconv() instead\n\nSo I tried to set php locale to et_EE (decimal_point is \",\") but there is a bug when comapearing values in Float.php\n\n\n\n            $locale        = localeconv();\n            $valueFiltered = str_replace($locale['thousands_sep'], '', (string) $value);\n            $valueFiltered = str_replace($locale['decimal_point'], '.', $valueFiltered);\n\n            if (strval(floatval($valueFiltered)) != $valueFiltered) {\n                $this->_error(self::NOT_FLOAT);\n                return false;\n            }\n\n\n$valueFiltered is something like 1.1 but floatval($valueFiltered) return 1,1 if you resest PHP's locale with setlocale()"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7987\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-7986",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7986",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12652",
                    "filename": "validateFloatTest.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2010-01-21T02:18:55.000+0000",
                    "size": 1980,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12652\/validateFloatTest.diff"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10320",
                    "id": 10320,
                    "description": "Minor Release",
                    "name": "1.9.0",
                    "userReleaseDate": "31\/Jul\/09",
                    "archived": false,
                    "releaseDate": "2009-07-31",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10350",
                    "id": 10350,
                    "description": "Mini Release",
                    "name": "1.9.1",
                    "userReleaseDate": "11\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-11",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10361",
                    "id": 10361,
                    "description": "Mini Release",
                    "name": "1.9.2",
                    "userReleaseDate": "25\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-25",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10362",
                    "id": 10362,
                    "description": "Mini Release",
                    "name": "1.9.3",
                    "userReleaseDate": "22\/Sep\/09",
                    "archived": false,
                    "releaseDate": "2009-09-22",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10140",
                    "id": 10140,
                    "name": "Zend_Validate",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35010",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Why should Zend_Validate_Float work with the fallback locale from Zend_Locale ?\n\nYou set no locale to use for Zend_Validate_Float.\nThis means that Zend_Validate_Float works locale-independent.\n\nIt would be better when you say what's your problem.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-09-30T11:52:45.000+0000",
                    "updated": "2009-09-30T11:52:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35014",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Closing as non issue.\n\nI tested with \"de_AT\" which itself also uses \",\" as delimiter and found no problem.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-09-30T12:12:18.000+0000",
                    "updated": "2009-09-30T12:12:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35029",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kungla",
                        "name": "kungla",
                        "displayName": "Valter Kungla",
                        "active": true
                    },
                    "body": "problem comes when you use:\n\nsetlocale(LC_ALL, 'de_AT'); (locale must be installed on OS too) or setlocale(LC_ALL, 'de_AT.UTF-8');\n\nno try\n\n$valitator = Zend_Validate_Float()  \/\/ without locale\n\nthen validator takes system locale and bug comes out. It would be nice validator would chek Zend_Locale::getDefault()",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kungla",
                        "name": "kungla",
                        "displayName": "Valter Kungla",
                        "active": true
                    },
                    "created": "2009-10-01T00:34:24.000+0000",
                    "updated": "2009-10-01T00:34:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35036",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Using your code, after a little correction because it does not conform PHP, I get a true or false in return regardless of what the input is with the actual release.\n\nThere are no warnings, notices, errors, or exceptions, so there is no issue.\nCheck your installation.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-10-01T12:10:02.000+0000",
                    "updated": "2009-10-01T12:10:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37851",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "The issue still remains when using the float validator without locale. This is the default.\r\n\r\nCode to reproduce:\r\n{code}\r\n$v = new Zend_Validate_Float();\r\nsetlocale(LC_ALL, 'C');\r\nvar_dump($v->isValid(1.3));   \/\/true\r\nvar_dump($v->isValid(\"1.3\")); \/\/true\r\nvar_dump($v->isValid(\"1,3\")); \/\/false as expected\r\n\r\n$v = new Zend_Validate_Float(Zend_Locale::findLocale('de_AT'));\r\nvar_dump($v->isValid(1.3));   \/\/true\r\nvar_dump($v->isValid(\"1.3\")); \/\/true\r\nvar_dump($v->isValid(\"1,3\")); \/\/true\r\n\r\n$v = new Zend_Validate_Float();\r\nsetlocale(LC_ALL, 'de_AT');\r\nvar_dump($v->isValid(1.3));   \/\/false!!\r\nvar_dump($v->isValid(\"1.3\")); \/\/true\r\nvar_dump($v->isValid(\"1,3\")); \/\/false!!\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2010-01-20T08:23:20.000+0000",
                    "updated": "2010-01-20T08:23:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37859",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Insufficient informations:\r\nC seems to rely on \"en\" in your environment.\r\n\r\nRegarding using setlocale 'de_AT' I would like to know why you think that  1.3   or 1,4 are wrong.\r\n\r\nIn german the \",\" is used as precision separator.\r\nThis means   1.3   is wrong as it should be   1,3.\r\nIn english this is reversed.\r\n\r\nUsing setlocale the settings are completly dependend on your system as localeconv is used to get the correct settings in this case.\r\n\r\nTherefor this issue will not be reopened.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-20T11:53:25.000+0000",
                    "updated": "2010-01-20T11:53:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37864",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "{quote}\r\nRegarding using setlocale 'de_AT' I would like to know why you think that 1.3 or 1,4 are wrong.\r\n{quote}\r\n{code}\r\n$v = new Zend_Validate_Float();\r\nsetlocale(LC_ALL, 'de_AT');\r\nvar_dump($v->isValid(\"1,3\")); \/\/false!!\r\n{code}\r\n\"1,3\" should obviously be valid, as you wrote \",\" is used as decimal separator.\r\n\r\nAbout the second case I'm not that sure:\r\n{code}\r\n$v = new Zend_Validate_Float();\r\nsetlocale(LC_ALL, 'de_AT');\r\nvar_dump($v->isValid(1.3)); \/\/false!!\r\n{code}\r\nThe thing is that 1.3 is not a string but a \"real\" float (as php type), so imho it should be valid. If you execute \"echo 1.3;\" you get \"1,3\" - it's just a \".\" as it's hardcoded - that won't happen in a real world application.\r\nOther than that \"1.3\" as string is valid too.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2010-01-20T23:22:02.000+0000",
                    "updated": "2010-01-20T23:22:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37866",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Once again:\r\n\r\n{code}\r\n1.) $v = new Zend_Validate_Float();    \r\n2.) setlocale(LC_ALL, 'de_AT');\r\n3.) var_dump($v->isValid(\"1,3\")); \/\/false!!\r\n{code}\r\n\r\n1.) locale = \"en\"; decimal = \",\"; thousand = \".\";\r\nSet locale = environment as no locale has been set\r\n\r\nBe aware that it COULD be that you registered a locale previously within the registry or your application. Those set objects would be used in such a case.\r\n\r\n2.) locale = \"de_AT\"; decimal = \".\"; thousand = \",\";\r\n\r\n3.) Value \"1,3\" string\r\nAs locale is de_AT it is converted to the value \"1x3\" where the x stands for a wrong character. It should be \"1.3\".\r\n\r\nYou can't depend on localized input and then expect that localization is not taken into account.\r\n\r\nAdditionally integer values (when you say \"1x3\" is stripped to \"13\") are also no valid float values. See into the PHP manual for is_float().\r\n\r\n\r\nI can not verify your second example. It returns true for me which is correct in my eyes.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-21T00:25:30.000+0000",
                    "updated": "2010-01-21T00:25:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37867",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "Ok, I'm not sure if we understand each other :D\r\n\r\nI created a test that should show the problem.\r\n\r\n- setup and tearDown I copied from Zend_Measure_TemperatureTest (resets setlocale and Zend_Registry::get('Zend_Locale'))\r\n- testNoZendLocaleButPhpLocale shows my problem (fails for me)\r\n- testLocaleDeFloatType passes (I added that to make sure if \"real\" floats are considered valid when using Zend_Locale de)\r\n- testPhpLocaleDeFloatType shows that is is not the case when setlocale is used (fails for me)\r\n\r\n(tested with latest trunk)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2010-01-21T02:19:01.000+0000",
                    "updated": "2010-01-21T02:19:01.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37931",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "I think that I understood very well.\r\n\r\nRegarding your example you gave:\r\n{code}\r\n1.) $valueFiltered = str_replace($locale['thousands_sep'], '', (string) $value);\r\n2.) $valueFiltered = str_replace($locale['decimal_point'], '.', $valueFiltered);\r\n\r\n3.) if (strval(floatval($valueFiltered)) != $valueFiltered) {\r\n{code}\r\n\r\nThink of what you said an you will see that this is not the problem at all.\r\n\r\nLine 1.)\r\nThe value is converted into a string!!\r\nSo any float value like 1.1 would be converted into the string \"1,1\" when your locale enforces this.\r\n\r\nLine 2.)\r\nThe string has now be normalized to computional notation... in our case also \"1.1\"\r\n\r\nLine 3.)\r\nNow there is what you really don't think of...\r\nfloatval($valueFiltered) converts the string to a float value... so we have now a \"float 1.1\".... BUT and this is what you've missed, strval converts the float back to a string using the systems locale.\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-22T04:44:11.000+0000",
                    "updated": "2010-01-22T04:44:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37937",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "Ok, you explained why it's broken by showing me the implementation.\r\nYou still think this is not a bug?\r\n{code}\r\nsetlocale(LC_ALL, 'de_AT');\r\n$v = new Zend_Validate_Float();    \r\nvar_dump($v->isValid(\"1,3\"));\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2010-01-22T06:07:22.000+0000",
                    "updated": "2010-01-22T06:07:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37939",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "I added your tests to the testbed and the repo and it are is no failures.\r\nSo eighter your testcases are broken when they show different behaviour, or you are not using latest trunk as you stated.\r\n\r\nPS: I used latest trunk, actually r20521 and your testcases have been added with r20515.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-22T06:36:12.000+0000",
                    "updated": "2010-01-22T06:36:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37940",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "Oh - so it's a php or system issue. I'm using PHP 5.2.6-1+lenny4 on debian.\r\n\r\nThanks for adding the test.\r\n\r\none issue however:\r\n{code}\r\nIndex: FloatTest.php\r\n===================================================================\r\n--- FloatTest.php       (Revision 20521)\r\n+++ FloatTest.php       (Arbeitskopie)\r\n@@ -144,7 +144,7 @@\r\n     {\r\n         setlocale(LC_ALL, 'de');\r\n         $valid = new Zend_Validate_Float();\r\n-        $this->assertTrue($valid->isValid(123,456));\r\n+        $this->assertTrue($valid->isValid('123,456'));\r\n     }\r\n\r\n     \/**\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2010-01-22T06:56:49.000+0000",
                    "updated": "2010-01-22T06:56:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37950",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "And why should I add an invalid test?\r\n\r\nDid you try your example yourself?\r\nAccording to your test the following lines should always return the same output:\r\n\r\n{code}\r\nsetlocale(LC_ALL, 'de');\r\n$value = '123,456';\r\nvar_dump($value);\r\nvar_dump((string) $value);\r\nvar_dump(floatval($value));\r\n{code}\r\n\r\nBut as you can see PHP itself does NOT detect float values localized.\r\nAnd when you don't give a locale, then PHP is used to detect the value.\r\nOn the other hand, when you give a locale then localized values will be detected.\r\n\r\nSimply said... when PHP would be locale aware then your test would return true instead of false.\r\n\r\nZend Framework will not change PHP internal behaviour. Therefor this issue will still not be reopened.\r\n\r\nUse the locale parameter when you want localized detection or use it not when you want to use PHP native detection.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-22T12:55:59.000+0000",
                    "updated": "2010-01-22T12:55:59.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37952",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "Output from your code:\r\nstring(7) \"123.456\"\r\nstring(7) \"123.456\"\r\nfloat(123,456)\r\nSo yes, if the correct locale is set and it is supported, float values are converted from strings localized.\r\n\r\nThe code you added to the test:\r\n$valid->isValid(123,456)\r\nis just plain wrong - it gives two parameters, the first one being an int.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2010-01-22T13:16:24.000+0000",
                    "updated": "2010-01-22T13:16:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37953",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "How floatval behaves depends on the OS, not on PHP. PHP differs therefor depending on the used OS.\r\n\r\nIn my environment the third var_dump of floatval returns 123 and not 123.456.\r\n\r\nAnd you should know as you have stated yourself before, that within german the string '123,456' is equal to (float) 123.456.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-22T15:27:11.000+0000",
                    "updated": "2010-01-22T15:27:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37956",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "Then you don't have a 'de' locale avaliable on your system. setlocale returns the actually used locale, please verify that it returns 'de' for you.\r\n{code}\r\nvar_dump(setlocale(LC_ALL, array('de_DE', 'de_AT', 'de')));\r\n{code}\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2010-01-23T00:49:46.000+0000",
                    "updated": "2010-01-23T00:49:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37957",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "I am a austrian person... my native language is german... my OS is a german version... my OS returns de... my browser is set to de.\r\n\r\nAnd as you can see in the code I wrote I even force the locale DE in the first line.\r\n\r\nAdditionally I am the I18n team lead and have build this components... and you want to say me that I don't know how to check if I am really within a specified locale where I said that the test is OK? ;-)\r\n\r\nI think there is nothing more to say :-)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-23T03:13:47.000+0000",
                    "updated": "2010-01-23T03:13:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37969",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "Sorry, I didn't mean to upset you, and I'm sure you know more about I18n than me. Please ignore my last two comments.\r\n\r\nBut this *is* wrong:\r\n{code}\r\n$this->assertTrue($valid->isValid(123,456));\r\n{code}\r\n\r\nPS: I'm Austrian too :D",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2010-01-23T09:26:04.000+0000",
                    "updated": "2010-01-23T09:26:04.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37972",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Once again:\r\nA string is not always converted into a float. This depends on the OS.\r\n\r\nI used this example:\r\n{code}\r\nvar_dump(setlocale(LC_ALL, 0));\r\n$v = new Zend_Validate_Float();\r\nvar_dump($v->isValid(\"123,456\"));\r\n\r\n$value = \"123,456\";\r\nvar_dump((float) $value);\r\n{code}\r\n\r\nand the returned value was:\r\n{code}\r\nstring 'LC_COLLATE=C;LC_CTYPE=German_Austria.1252;LC_MONETARY=C;LC_NUMERIC=C;LC_TIME=C' (length=78)\r\nboolean false\r\nfloat 123\r\n{code}\r\n\r\nThis means for me that the string \"123,456\" is converted into a float 123 in my OS and a float 123,456 in your OS... so the behaviour is OS dependend.\r\n\r\nTherefor when the input is a string within Zend_Validate_Float, the result can not always be correct.\r\n\r\nSo, to be independend from OS and PHP implementation you must give a locale.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-23T10:53:14.000+0000",
                    "updated": "2010-01-23T10:53:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37974",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "But the issue is that this is not a string - the quotes are missing!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2010-01-23T11:13:38.000+0000",
                    "updated": "2010-01-23T11:13:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37975",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "I can not add a test for a not supported feature which seems to work in one environment but not in anothers.\r\n\r\nFor localized inputs you need to use the localized feature.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-23T13:18:41.000+0000",
                    "updated": "2010-01-23T13:18:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37979",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "This function call always passes two arguments, the first 123, the second 456:\r\n$valid->isValid(123,456)\r\nThis does never depend on any locale setting.\r\n\r\nAnd testNoZendLocaleButPhpLocale with quotes added fails for me. That's what\r\nis my original issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2010-01-24T00:57:55.000+0000",
                    "updated": "2010-01-24T00:57:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37980",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=valter",
                        "name": "valter",
                        "displayName": "Valter Kungla",
                        "active": true
                    },
                    "body": "If Float validator doesn't listen OS locale - so what, I will survive. But at least it would be nice if it would listen Zend Framework default locale:\r\n\r\nZend_Locale::setDefault('et_EE'); \/\/ also floats are presented like \"1.3\"\r\n$validator = new Zend_Validate_Float();\r\nvar_export($validator->isValid('1,3')); \/\/return false;\r\n\r\nIt is not normal to set a locale every time I haveto use Float_Validate.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=valter",
                        "name": "valter",
                        "displayName": "Valter Kungla",
                        "active": true
                    },
                    "created": "2010-01-24T01:35:40.000+0000",
                    "updated": "2010-01-24T01:35:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37981",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=valter",
                        "name": "valter",
                        "displayName": "Valter Kungla",
                        "active": true
                    },
                    "body": "Sorry:\r\nZend_Locale::setDefault('et_EE'); \/\/ also floats are presented like * \"1,3\" *",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=valter",
                        "name": "valter",
                        "displayName": "Valter Kungla",
                        "active": true
                    },
                    "created": "2010-01-24T01:39:15.000+0000",
                    "updated": "2010-01-24T01:39:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37982",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=valter",
                        "name": "valter",
                        "displayName": "Valter Kungla",
                        "active": true
                    },
                    "body": "And I can confirm:\r\n\r\nvar_dump(setlocale(LC_ALL, 'et_EE')); \/\/ returns 'et_EE'\r\n$v = new Zend_Validate_Float();\r\nvar_dump($v->isValid(\"123,456\")); \/\/ returns false !!!!!!!!!!!!\r\n\r\nI am sure that this is not what a developer wants",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=valter",
                        "name": "valter",
                        "displayName": "Valter Kungla",
                        "active": true
                    },
                    "created": "2010-01-24T01:54:33.000+0000",
                    "updated": "2010-01-24T01:54:33.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37992",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Take a look into the manual how to see how to set a locale which is used within the complete application. setDefault is not the application wide locale. Look into Zend_Locale or Zend_Application for details about this feature.\r\n\r\nRelated to OS dependend detection:\r\nAs I already said, when you give a string without a locale then the detection is based on OS behaviour. The problem is, that PHP knows only english locale settings for floats.\r\n\r\nTherefor as I already stated before, the detection can not be guaranteed in such a case. And this is also the reason why such a unittest will not be added, because we can't add a test for something which is not supported.\r\n\r\nPHP itself is not locale aware for floats. And when you depend on PHP internals (by explicitly NOT giving a locale) you declare to use PHPs internals. Run the above code to see results.\r\n\r\nIt has been verified under Windows, CentOS and Ubuntu that conversion to float does not work setlocale aware.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-24T11:13:07.000+0000",
                    "updated": "2010-01-24T12:39:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37995",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "For details to this PHP internal bug please take a look into ZF-8919 and vote for the solution you prefer (there are 2 ways we could go).\r\n\r\nThis issue will stay closed as this is actually a PHP bug.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2010-01-24T12:14:42.000+0000",
                    "updated": "2010-01-24T12:14:42.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7987\/transitions"
}