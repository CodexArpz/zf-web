{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9306",
    "key": "ZF-9306",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Thew new Zend_Loader::isReadable does not work properly with absolute paths"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9306\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/3",
                "name": "Duplicate"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10451",
                    "id": 10451,
                    "description": "Mini Release",
                    "name": "1.10.4",
                    "userReleaseDate": "28\/Apr\/10",
                    "archived": false,
                    "releaseDate": "2010-04-28",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-04-27T09:40:40.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=avantis",
                "name": "avantis",
                "displayName": "Cristian Bichis",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-03-02T07:32:24.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-04-27T09:46:33.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Hi,\r\n\r\nI raised now couple of days a ticket related to autoloading not working properly on 1.10.1 and 1.10.2\r\n\r\nhttp:\/\/framework.zend.com\/issues\/browse\/ZF-9263\r\n\r\nAs a part of the problem seems to be fixable i am posting here the problem.\r\n\r\nThe is_readable is producing a PHP warning if the filename is absolute, when checking against all the include paths.\r\nSo, the checking for against include_paths should be done ONLY if the filename is relative path ! Otherwise should be skipped.\r\n\r\nSample below:\r\n\r\nWarning: is_readable(): open_basedir restriction in effect. File(D:\\wamp\\frameworks\\ZendFramework-1.10.2\/D:_Work\\myapp\/application\/modules\\articles\/views\\helpers\/HeadLink.php) is not within the allowed path(s): (D:_Work\\;D:\\wamp\\;C:\\Windows\\Temp\\;c:\\php5\\pear) in D:\\wamp\\frameworks\\ZendFramework-1.10.2\\Zend\\Loader.php on line 190\r\n\r\nA quick (maybe not the best) fix would be to actually check the parent\r\n\r\npublic static function isReadable($filename)\r\n{\r\nif (is_readable($filename)) { \/\/ Return early if the filename is readable without needing the \/\/ include_path return true; }\r\n\r\n\/\/added the if, basically to skip any absolute filename path\r\nif(!is_readable(dirname($filename)))\r\nforeach (self::explodeIncludePath() as $path) {\r\nif ($path == '.') {\r\nif (is_readable($filename)) { return true; }\r\ncontinue;\r\n}\r\n$file = $path . '\/' . $filename;\r\nif (is_readable($file)) { return true; }\r\n}\r\n\r\nreturn false;\r\n}\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9306\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-9263",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9263",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10430",
                    "id": 10430,
                    "description": "Mini Release",
                    "name": "1.10.2",
                    "userReleaseDate": "24\/Feb\/10",
                    "archived": false,
                    "releaseDate": "2010-02-24",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10001",
                    "id": 10001,
                    "name": "Zend_Loader",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39301",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=avantis",
                        "name": "avantis",
                        "displayName": "Cristian Bichis",
                        "active": true
                    },
                    "body": "Pasting same error again:\r\n\r\nWarning: is_readable() [function.is-readable]: open_basedir restriction in effect. File(D:\\wamp\\frameworks\\ZendFramework-1.10.2\/D:\/_Work\/myapp\/application\/modules\/articles\/views\\helpers\/HeadTitle.php) is not within the allowed path(s): (D:\\_Work\\;D:\\wamp\\;C:\\Windows\\Temp\\;c:\\php5\\pear) in D:\\wamp\\frameworks\\ZendFramework-1.10.2\\Zend\\Loader.php on line 190 ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=avantis",
                        "name": "avantis",
                        "displayName": "Cristian Bichis",
                        "active": true
                    },
                    "created": "2010-03-17T02:45:30.000+0000",
                    "updated": "2010-03-17T02:45:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39302",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=avantis",
                        "name": "avantis",
                        "displayName": "Cristian Bichis",
                        "active": true
                    },
                    "body": "So i think before somehow the error text got screwed before i pasted here.\r\n\r\nSo the error is still present...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=avantis",
                        "name": "avantis",
                        "displayName": "Cristian Bichis",
                        "active": true
                    },
                    "created": "2010-03-17T02:46:26.000+0000",
                    "updated": "2010-03-17T02:46:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39378",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=avantis",
                        "name": "avantis",
                        "displayName": "Cristian Bichis",
                        "active": true
                    },
                    "body": "Andrew Ballard posted a sample case on fw-general illustrating the problem (at least on Windows). I was to do myself a sample case but i think Andrew sample case is more than relevant, and very easy to reproduce so i am posting here:\r\n\r\nActually, it turned out to be pretty simple to build a test case:\r\n\r\ntestcase.php\r\n<?php\r\n\r\n\r\ndefine('LIBRARY_PATH', realpath('D:\\\\Web\r\nServer\\\\wwwroot\\\\lib\\\\ZendFramework\\\\library\\\\1.10.1-no-require'));\r\n\r\n\/\/ Set the initial include_path. You may need to change this to ensure that\r\n\/\/ Zend Framework is in the include_path; additionally, for performance\r\n\/\/ reasons, it's best to move this to your web server configuration or php.ini\r\n\/\/ for production.\r\nset_include_path(implode(PATH_SEPARATOR, array(\r\n    LIBRARY_PATH,\r\n)));\r\n\r\nerror_reporting(E_ALL);\r\nini_set('display_errors', 1);\r\nini_set('display_startup_errors', 1);\r\n\r\n\/** Zend_Loader *\/\r\nrequire_once 'Zend\/Loader.php';\r\n\r\n\/\/ A Windows absolute file path for a file that does not exist\r\n$file = 'D:\\Web\r\nServer\\wwwroot\\lib\\MyApp\\application\/controllers\/helpers\/Redirector.php';\r\n\r\n\r\n$loader = new Zend_Loader();\r\n$result = $loader->isReadable($file);\r\n\r\necho '$loader->isReadable(' . \"'\" . str_replace('\\\\', '\\\\\\\\', $file) .\r\n\"') === \";\r\nvar_dump($result);\r\n\r\n?>\r\n\r\nExpected result:\r\n$loader->isReadable('D:\\\\Web\r\nServer\\\\wwwroot\\\\lib\\\\MyApp\\\\application\/controllers\/helpers\/Redirector.php')\r\n=== bool(false)\r\n\r\nActual result:\r\nWarning: is_readable() [function.is-readable]: open_basedir\r\nrestriction in effect. File(D:\\Web\r\nServer\\wwwroot\\lib\\ZendFramework\\library\\1.10.1-no-require\/D:\\Web\r\nServer\\wwwroot\\lib\\MyApp\\application\/controllers\/helpers\/Redirector.php)\r\nis not within the allowed path(s): (D:\\Web Server\\) in D:\\Web\r\nServer\\wwwroot\\lib\\ZendFramework\\library\\1.10.1-no-require\\Zend\\Loader.php\r\n on line 190\r\n$loader->isReadable('D:\\\\Web\r\nServer\\\\wwwroot\\\\lib\\\\MyApp\\\\application\/controllers\/helpers\/Redirector.php')\r\n=== bool(false)\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=avantis",
                        "name": "avantis",
                        "displayName": "Cristian Bichis",
                        "active": true
                    },
                    "created": "2010-03-19T01:08:01.000+0000",
                    "updated": "2010-03-19T01:08:01.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40244",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I've verified the reproduce case.\r\n\r\nWhile this is not critical (the script will continue to work), it's clearly going to be an issue if you are running the code in production on a Windows machine. However, making the changes as suggested by the reporter do not remove the warning for me -- the warning remains exactly as before. I'll see if I can find a patch today, but at this point, I'm applying guesswork.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2010-04-27T09:14:24.000+0000",
                    "updated": "2010-04-27T09:14:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40246",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aballard",
                        "name": "aballard",
                        "displayName": "Andrew Ballard",
                        "active": true
                    },
                    "body": "Matthew,\r\n\r\nDoes the proposed change I added in my comment on the related issue http:\/\/framework.zend.com\/issues\/browse\/ZF-9263 help any? Basically, if you know the OS is Windows and the path being tested begins with a drive letter, then you also know that the path being tested is absolute and there is no point in iterating through the include paths.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aballard",
                        "name": "aballard",
                        "displayName": "Andrew Ballard",
                        "active": true
                    },
                    "created": "2010-04-27T09:35:06.000+0000",
                    "updated": "2010-04-27T09:35:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40247",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aballard",
                        "name": "aballard",
                        "displayName": "Andrew Ballard",
                        "active": true
                    },
                    "body": "These two seem to be the same.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aballard",
                        "name": "aballard",
                        "displayName": "Andrew Ballard",
                        "active": true
                    },
                    "created": "2010-04-27T09:38:09.000+0000",
                    "updated": "2010-04-27T09:38:09.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40250",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Andrew: yes, I found the proposed change on ZF-9263, and that definitely works; as you'll note, I've added a unit test, and applied your fix. :)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2010-04-27T09:46:33.000+0000",
                    "updated": "2010-04-27T09:46:33.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9306\/transitions"
}