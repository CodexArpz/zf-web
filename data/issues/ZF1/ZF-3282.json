{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3282",
    "key": "ZF-3282",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "headscript and headLink used in a view helper in a layout don't work"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3282\/votes",
                "votes": 3,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-08-20T11:13:58.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dancet",
                "name": "dancet",
                "displayName": "Bart Dens",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-05-17T01:41:23.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-08-20T11:13:58.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Suppose a view helper like this:\n\n{code}\nclass My_View_Helper_Glow\n{\n\n    protected $view = null;\n    protected $cnt  = 1;\n    \n    \/**\n     * Set the view so it can be used in the helper\n     *\n     * @param Zend_View $view\n     *\/\n    public function setView(Zend_View_Interface $view)\n    {\n        $this->view = $view;\n        $this->_attachHeadScripts();\n    }\n\n    \/**\n     * Attaches the needed scripts in the html header\n     *\n     *\/\n    private function _attachHeadScripts()\n    {\n        $this->view->headScript()->appendFile('\/scripts\/swfobject.js');\n        $this->view->headScript()->appendFile('\/scripts\/sIFR\/sifr.js');\n        $this->view->headLink()->appendStylesheet('\/scripts\/sIFR\/sIFR-screen.css');\n    }\n    \n    public function glow($text, $align = 'center', $case = 'upper', $bgcolor = null, $color = '#c4dce2')\n    {\n        $cnt = $this->cnt++;\n        $id = 'sifr_glow_' . $cnt;\n        \n        $this->view->inlineScript()->appendScript('\n            if(typeof sIFR == \"function\"){    \n                sIFR.replaceElement(\n                    named({\n                        sSelector   : \"span#' . $id . '\" \n                        ,sFlashSrc  : \"\/scripts\/fonts\/helvetica_blue_glow.swf\"\n                        ,sColor     : \"' . $color . '\"\n                        ' . ($bgcolor? ',sBgColor:\"' . $bgcolor. '\"' : ',sWmode:\"transparent\"') . '\n                        ,sCase      : \"' . $case . '\"\n                        ,sFlashVars : \"textalign=' . $align . '\"\n                    })\n                );    \n            };\n        ');\n         \n        $return = '\n            <span class=\"sifr\" id=\"' . $id . '\">' . $text . '<\/span>\n        ';\n        \n        return $return;\n    }\n    \n}\n{code}\n\nSo we add headScript and headLink items through a View Helper.\n\nNow when this view helper is used in a layout file, than the scripts will not become attached, while they will if used in a controller action view script.\n\nTest scenario (failing)\nLAYOUT:\n{code}\n<?= $this->doctype('XHTML1_STRICT') ?>\n<html xmlns=\"http:\/\/www.w3.org\/1999\/xhtml\">\n<head>\n<?= $this->headTitle() ?>\n<?= $this->headMeta() ?>\n<?= $this->headScript() ?>\n<?= $this->headLink() ?>\n<?= $this->headStyle() ?>\n<\/head>\n<body>\n    <?= $this->layout()->content ?>\n    <h2> layout content <\/h2>\n    <?= $this->glow('My Account') ?>\n    <?= $this->inlineScript() ?>    \n<\/body>\n<\/html>\n{code}\n\nVIEW SCRIPT:\n<h2> action content <\/h2>\n\n\nTest scenario (working):\nLAYOUT:\n{code}\n<?= $this->doctype('XHTML1_STRICT') ?>\n<html xmlns=\"http:\/\/www.w3.org\/1999\/xhtml\">\n<head>\n<?= $this->headTitle() ?>\n<?= $this->headMeta() ?>\n<?= $this->headScript() ?>\n<?= $this->headLink() ?>\n<?= $this->headStyle() ?>\n<\/head>\n<body>\n    <?= $this->layout()->content ?>\n    <h2> layout content <\/h2>\n    <?= $this->glow('My Account') ?>\n    <?= $this->inlineScript() ?>    \n<\/body>\n<\/html>\n{code}\n\nVIEW SCRIPT:\n{code}\n<h2> action content <\/h2>\n<?= $this->glow('My Account') ?>\n{code}\n\nNeither is it possible to load headscripts or headlinks appended by a view helper called in a partial, while this kinda defeats the purpose of 'on demand loading' of files"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3282\/watchers",
                "isWatching": false,
                "watchCount": 4
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10172",
                    "id": 10172,
                    "description": "Minor Release",
                    "name": "1.5.0",
                    "userReleaseDate": "17\/Mar\/08",
                    "archived": true,
                    "releaseDate": "2008-03-17",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10270",
                    "id": 10270,
                    "name": "Zend_Layout",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10026",
                    "id": 10026,
                    "name": "Zend_View",
                    "description": "View portion of the ZF MVC",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21804",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dancet",
                        "name": "dancet",
                        "displayName": "Bart Dens",
                        "active": true
                    },
                    "body": "Funny thing is, this DOES work:\n<?= $this->doctype('XHTML1_STRICT') ?>\n<html xmlns=\"http:\/\/www.w3.org\/1999\/xhtml\">\n<head>\n<?= $this->glow('My Account') ?>\n<?= $this->headTitle() ?>\n<?= $this->headMeta() ?>\n<?= $this->headScript() ?>\n<?= $this->headLink() ?>\n<?= $this->headStyle() ?>\n<\/head>\n<body>\n    <?= $this->layout()->content ?>\n    <h2> layout content <\/h2>\n    <?= $this->inlineScript() ?>    \n<\/body>\n<\/html>\n\nMeaning if you append script before calling <?= $this->headScript() ?>, they will be appended. Again, this defeats the purpose (as you're not going to write the html contents in your HEAD section off course...)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dancet",
                        "name": "dancet",
                        "displayName": "Bart Dens",
                        "active": true
                    },
                    "created": "2008-05-17T01:56:04.000+0000",
                    "updated": "2008-05-17T01:56:04.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21815",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=andries",
                        "name": "andries",
                        "displayName": "Andries Seutens",
                        "active": true
                    },
                    "body": "added code markup",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=andries",
                        "name": "andries",
                        "displayName": "Andries Seutens",
                        "active": true
                    },
                    "created": "2008-05-19T01:19:41.000+0000",
                    "updated": "2008-05-19T01:19:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21849",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mcoakley",
                        "name": "mcoakley",
                        "displayName": "Mike Coakley",
                        "active": true
                    },
                    "body": "Bart,\n\nI came across this as well. There really isn't a great way to deal with this directly as the calls to $this->headLink() are actual calls to PHP code which is going to obviously execute right then. Also, it is working as designed, simply the Layout changes the workflow for the overall content rendering. While there are MANY ways to program around this using the current system here is the way I've gotten around this in my code (of course this played into my overall method of building view scripts also):\n\nIn your Layout script create something like this:\n\n{code}\n<?= $this->doctype('XHTML1_STRICT') ?>\n<html xmlns=\"http:\/\/www.w3.org\/1999\/xhtml\">\n<head>\n<?= $this->headTitle() ?>\n<?= $this->headMeta() ?>\n{HEADSCRIPT}\n{HEADLINK}\n<?= $this->headStyle() ?>\n<\/head>\n<body>\n    <?= $this->layout()->content ?>\n    <h2> layout content <\/h2>\n    <?= $this->glow('My Account') ?>\n    <?= $this->inlineScript() ?>    \n<\/body>\n<\/html>\n{code}\n\nThen create a filter that looks for the {HEADSCRIPT} and {HEADLINK} tags and calls the appropriate view helpers to render the actual content. Since filters are run after the view is rendered you should be good to go. I will also note you should only register the filters with the view associated with the layout instance. Here is an example of how a filter will look:\n\n{code:xml}\nclass MyApp_Wiki_Filter_HeadLink implements Zend_Filter_Interface\n{\n\n\tprotected $_view;\t\n\n\tpublic function setView($view) \n        { \n               $this->_view = $view;\n        }\n    \n\tpublic function filter($value) {\n\t\tif (preg_match(\"\/{HEADLINK}\/i\", $value, $match)) {\n\t\t\t$replaceValue = $this->_view->headLink();\n\t\t\t$value = preg_replace(\"\/\" . preg_quote($match[0], \"\/\") . \"\/\", $replaceValue, $value);\n\t\t}\n\t\treturn $value;\n    \t}\n}\n{code}\n\nHope that helps.\n\nThanks,\n\nMike",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mcoakley",
                        "name": "mcoakley",
                        "displayName": "Mike Coakley",
                        "active": true
                    },
                    "created": "2008-05-20T12:19:30.000+0000",
                    "updated": "2008-05-20T12:19:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23550",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=notmessenger",
                        "name": "notmessenger",
                        "displayName": "Jeremy Brown",
                        "active": true
                    },
                    "body": "The same thing happens when using the Dojo View Helper ( $this->dojo() ) and\/or $this->headScript()->captureStart() and $this->headScript()->captureEnd().  If you want to use Dojo functionality in your layout, this also becomes a problem.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=notmessenger",
                        "name": "notmessenger",
                        "displayName": "Jeremy Brown",
                        "active": true
                    },
                    "created": "2008-08-20T10:53:12.000+0000",
                    "updated": "2008-08-20T10:53:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23552",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I hate to say it, folks, but this is just the way things work, and it's a matter of concurrency.\n\nWhen you echo the view helper, it takes the _current_ object state and renders it to a string notation. What you are presenting will not work because you're rendering the view helper, and then expecting that later calls will affect what you've already rendered.\n\nTo get what you're looking for, we would need to compile templates, and have one template that is considered a master, and would _still_ need to somehow indicate an order of operations for controls -- i.e., you cannot echo a placeholder completely until all other updates are performed.\n\nYou _can_ actually update the placeholders within the layout script... so long as you do so _prior_ to rendering the placeholder. So, in Bart's original example, if he had captured the results of $this->glow() _before_ the <head> section, and then rendered the captured content later, it would work:\n\n{code}\n<? $glow = $this->glow('My Account'); ?>\n<?= $this->doctype() ?>\n<html>\n<head>\n...\n    <?= $this->headLink() ?>\n    <?= $this->headScript() ?>\n...\n<\/head>\n<body>\n...\n<?= $glow ?>\n...\n<\/body>\n<\/html>\n{code}\n\nThis technique will work for _all_ placeholders that you wish to use directly within your layout scripts.\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-08-20T11:13:16.000+0000",
                    "updated": "2008-08-20T11:13:16.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3282\/transitions"
}