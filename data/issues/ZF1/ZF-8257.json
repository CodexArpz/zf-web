{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8257",
    "key": "ZF-8257",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "ContextSwitch not respecting default context"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/11",
                "name": "Patch",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8257\/votes",
                "votes": 2,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dynom",
                "name": "dynom",
                "displayName": "Mark van der Velden",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-11-09T08:27:14.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-12-13T13:47:34.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Zend_Controller_Action_Helper_ContextSwitch is ignoring the default set with setDefaultContext()"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8257\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12357",
                    "filename": "Zend-Controller-Action-Helper-Contextswitch.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dynom",
                        "name": "dynom",
                        "displayName": "Mark van der Velden",
                        "active": true
                    },
                    "created": "2009-11-09T08:28:12.000+0000",
                    "size": 588,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12357\/Zend-Controller-Action-Helper-Contextswitch.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10380",
                    "id": 10380,
                    "description": "Mini Release",
                    "name": "1.9.5",
                    "userReleaseDate": "27\/Oct\/09",
                    "archived": false,
                    "releaseDate": "2009-10-27",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10011",
                    "id": 10011,
                    "name": "Zend_Controller",
                    "description": "front controller, including router and dispatcher",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36041",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "body": "I set component",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "created": "2009-11-16T13:38:08.000+0000",
                    "updated": "2009-11-16T13:38:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36050",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dynom",
                        "name": "dynom",
                        "displayName": "Mark van der Velden",
                        "active": true
                    },
                    "body": "The patch is no good, since it breaks functionality.\r\nI solved it in a different fashion, by doing the following:\r\n\r\n<?php\r\n \/\/ ..\r\n        $format = $this->_getParam('format', $this->_defaultContext);\r\n\r\n        \/\/ Set the context\r\n        $this->_helper\r\n            ->contextSwitch()\r\n                ->setDefaultContext($this->_defaultContext)\r\n                ->setAutoDisableLayout(true)\r\n                ->initContext($format);\r\n \/\/ ..\r\n?>\r\n\r\n\r\n\r\n(But it feels that I'm hacking broken functionality.)\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dynom",
                        "name": "dynom",
                        "displayName": "Mark van der Velden",
                        "active": true
                    },
                    "created": "2009-11-16T23:40:40.000+0000",
                    "updated": "2009-11-16T23:40:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46784",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "I cannot see problem here. If this has been an issue it is likely already fixed as the source code around the patch provided here has notably changed. Please feel free to reopen if something new appears.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-05-25T18:09:58.000+0000",
                    "updated": "2011-05-25T18:09:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47199",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexanderrv",
                        "name": "alexanderrv",
                        "displayName": "Alexander Romanenko",
                        "active": true
                    },
                    "body": "I have the same problem in latest 1.11.7",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexanderrv",
                        "name": "alexanderrv",
                        "displayName": "Alexander Romanenko",
                        "active": true
                    },
                    "created": "2011-06-15T17:53:34.000+0000",
                    "updated": "2011-06-15T17:53:34.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47202",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "Alexander - could you provide detailed code to reproduce this issue and I will look into it again.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-06-16T04:32:35.000+0000",
                    "updated": "2011-06-16T04:32:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47206",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexanderrv",
                        "name": "alexanderrv",
                        "displayName": "Alexander Romanenko",
                        "active": true
                    },
                    "body": "Code taken straight from my current project\r\n<?php\r\n\r\nclass TransactionController extends Zend_Controller_Action\r\n{\r\n\r\n    public function init()\r\n    {\r\n       $this->_request->setParam('format', 'xml');\r\n       $this->_helper->contextSwitch()\r\n                     ->addActionContext('getbymonth', array('xml'))\r\n                     ->setDefaultContext('xml')\r\n                     ->initContext();\r\n    }\r\n\r\n    public function getbymonthAction()\r\n    {\r\n        $month = $this->_request->getParam('month');\r\n        $year = $this->_request->getParam('year');\r\n        \r\n        $this->view->month = $month;\r\n        $this->view->year = $year;\r\n        \/\/ then I build XML file from these vars in getbymonth.xml.phtml\r\n        \r\n    }\r\n}\r\n\r\nWith setDefaultContext('xml') I should not have to use $this->_request->setParam('format', 'xml');  and probably addActionContext too but not sure about that one.\r\nRight now, I have setParam doing job of setDefaultContext.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexanderrv",
                        "name": "alexanderrv",
                        "displayName": "Alexander Romanenko",
                        "active": true
                    },
                    "created": "2011-06-16T14:10:36.000+0000",
                    "updated": "2011-06-16T14:10:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47225",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "I have checked that {{setDefaultContext()}} has no effect in context switch process. You can set and get it, but the class does not use it.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-06-22T07:24:17.000+0000",
                    "updated": "2011-06-22T07:24:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47229",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "I think that the use case addressed here is invalid and the way it was mentioned to be used is something like this\r\n\r\n{code}\r\n \/* Uses default context *\/\r\n$this->_helper->contextSwitch()\r\n              ->setDefaultContext('json')\r\n              ->addActionContext('foo')\r\n              ->addActionContexts(array('bar', 'baz'));\r\n\r\n\/* Does not use default context *\/\r\n$this->_helper->contextSwitch()\r\n              ->addActionContext('foo', 'json')\r\n              ->addActionContexts(array('bar' => 'json', 'baz' => 'json'));\r\n{code}\r\n\r\nAs far as I understand the format param cannot be set by default to match with the context, because it breaks the functionality.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-06-22T10:45:47.000+0000",
                    "updated": "2011-06-27T19:17:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47284",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexanderrv",
                        "name": "alexanderrv",
                        "displayName": "Alexander Romanenko",
                        "active": true
                    },
                    "body": "sorry, not fully understanding your comment. Do you mean there is no place to use setDefaultContext in this plugin at all? Or there is no place for it in controller? (maybe during bootstrap plugin helper configuration?)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=alexanderrv",
                        "name": "alexanderrv",
                        "displayName": "Alexander Romanenko",
                        "active": true
                    },
                    "created": "2011-06-28T02:54:43.000+0000",
                    "updated": "2011-06-28T02:54:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47286",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "bq. sorry, not fully understanding your comment. Do you mean there is no place to use setDefaultContext in this plugin at all? Or there is no place for it in controller? (maybe during bootstrap plugin helper configuration?)\r\n\r\nAlexander,\r\n\r\nYou can set the default context by using {{setDefaultContext()}}, but it does not have any effect while the decision of the context which to switch has been made. If you want to force the action context to be xml, it's correct to use {code}$this->_request->setParam('format', 'xml');{code} as you have done, and there is nothing wrong with it.\r\n\r\nbq. With setDefaultContext('xml') I should not have to use {{$this->_request->setParam('format', 'xml');}}\r\n\r\nAs said, I think that your logic is - unfortunately - invalid. {{setDefaultContext()}} wasn't designed to work like that and in my opinion it even shouldn't because that breaks the functionality of the normal action.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-06-28T13:26:32.000+0000",
                    "updated": "2011-06-28T13:26:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47801",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "Auto-reassign",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-07-30T16:24:27.000+0000",
                    "updated": "2011-07-30T16:24:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52950",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gemuesepudding",
                        "name": "gemuesepudding",
                        "displayName": "Volker Richert",
                        "active": true
                    },
                    "body": "I think changing initContext like this\r\n\r\n{code:php}\r\n        \/\/ Return if no context switching enabled, or no context switching\r\n        \/\/ enabled for this action\r\n        $contexts = $this->getActionContexts($action);\r\n        if (empty($contexts)) {\r\n            return;\r\n        }\r\n\r\n        \/\/ Return if no context parameter provided\r\n        if (!$context = $request->getParam($this->getContextParam())) {\r\n            if ($format === null && $this->_defaultContext === 0) {\r\n                return;\r\n            }\r\n            $context = $this->_defaultContext;\r\n        }\r\n{code}\r\n\r\nwill be a better solution. This will not break forcing a context but will allow to fall back to the defaultContext. \r\n\r\nAfter changing it you can sud the ContextSwitch like this:\r\n\r\n{code}\r\n$this->_helper->contextSwitch()->setDefaultContext('json')->initContext();\r\n{code}\r\n\r\nAfter that 'json' will be used if not format ist submited, but the format parameter will be used it submited. And it's still possible to force XML by \"initContext('xml')\"\r\n\r\ngemuesepudding",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gemuesepudding",
                        "name": "gemuesepudding",
                        "displayName": "Volker Richert",
                        "active": true
                    },
                    "created": "2012-12-13T13:29:49.000+0000",
                    "updated": "2012-12-13T13:29:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52951",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gemuesepudding",
                        "name": "gemuesepudding",
                        "displayName": "Volker Richert",
                        "active": true
                    },
                    "body": "A small fix. We have to check if _defaultContext is part of the action contexts:\r\n\r\n{code}\r\n\r\n        \/\/ Return if no context parameter provided\r\n        if (!$context = $request->getParam($this->getContextParam())) {\r\n            if ($format === null && $this->_defaultContext === null) {\r\n                return;\r\n            }\r\n            if ($this->hasActionContext($action, $this->_defaultContext)) {\r\n              $context = $this->_defaultContext;  \r\n            } else {\r\n              $context = $format;\r\n            }\r\n            \r\n        }\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gemuesepudding",
                        "name": "gemuesepudding",
                        "displayName": "Volker Richert",
                        "active": true
                    },
                    "created": "2012-12-13T13:46:11.000+0000",
                    "updated": "2012-12-13T13:46:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52952",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gemuesepudding",
                        "name": "gemuesepudding",
                        "displayName": "Volker Richert",
                        "active": true
                    },
                    "body": "and $format must be set to null;\r\n\r\n{code}\r\n        \/\/ Return if no context parameter provided\r\n        if (!$context = $request->getParam($this->getContextParam())) {\r\n            if ($format === null && $this->_defaultContext === null) {\r\n                return;\r\n            }\r\n            if ($this->hasActionContext($action, $this->_defaultContext)) {\r\n              $context = $this->_defaultContext;  \r\n            } else {\r\n              $context = $format;\r\n              $format = null;\r\n            }   \r\n        }\r\n{code}\r\n\r\nSorry",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gemuesepudding",
                        "name": "gemuesepudding",
                        "displayName": "Volker Richert",
                        "active": true
                    },
                    "created": "2012-12-13T13:47:34.000+0000",
                    "updated": "2012-12-13T13:47:34.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8257\/transitions"
}