{
    "expand": "html",
    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-589",
    "key": "ZF-589",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Problem with mail attachment"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-589\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/resolution\/5",
                "name": "Cannot Reproduce"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/version\/10021",
                    "id": 10021,
                    "description": "Preview release; DB, Filter, Log",
                    "name": "0.8.0",
                    "userReleaseDate": "21\/Feb\/07",
                    "archived": true,
                    "releaseDate": "2007-02-21",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-02-03T10:06:12.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=strfrank",
                "name": "strfrank",
                "displayName": "Franco A.",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2006-11-22T16:26:43.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-05T14:43:30.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I tried to send an attachment with a simple text mail using Zend_Mail::addAttachment() method, using default options.\nThe mail is generated correctly but there's some problem with the attachment, as it is malformed when received. \n\nUsing standard base64 encoding it looks that there's a problem with line breaks in the attachment bytes. After some trial and error I had success in sending the attachment by setting Zend_Mime::LINELENGTH to 72 (instead of 74), but I didn't investigate why. \nPlease let me know if something is needed to better understand the problem"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-589\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/attachment\/10171",
                    "filename": "mail_after.txt",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=strfrank",
                        "name": "strfrank",
                        "displayName": "Franco A.",
                        "active": true
                    },
                    "created": "2006-11-29T17:06:27.000+0000",
                    "size": 165737,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/framework.zend.com\/issues\/secure\/attachment\/10171\/mail_after.txt"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/attachment\/10170",
                    "filename": "mail_before.txt",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=strfrank",
                        "name": "strfrank",
                        "displayName": "Franco A.",
                        "active": true
                    },
                    "created": "2006-11-29T17:06:09.000+0000",
                    "size": 165504,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/framework.zend.com\/issues\/secure\/attachment\/10170\/mail_before.txt"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/attachment\/10172",
                    "filename": "test.pdf",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=strfrank",
                        "name": "strfrank",
                        "displayName": "Franco A.",
                        "active": true
                    },
                    "created": "2006-11-29T17:06:42.000+0000",
                    "size": 117160,
                    "mimeType": "application\/pdf",
                    "content": "http:\/\/framework.zend.com\/issues\/secure\/attachment\/10172\/test.pdf"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/version\/10002",
                    "id": 10002,
                    "description": "Preview Release; MVC refactoring and other enhancements and fixes",
                    "name": "0.2.0",
                    "userReleaseDate": "29\/Oct\/06",
                    "archived": true,
                    "releaseDate": "2006-10-29",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/component\/10018",
                    "id": 10018,
                    "name": "Zend_Mail",
                    "description": "high-level utility to build MIME-compliant messages and send using a mail transport adapter",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/component\/10019",
                    "id": 10019,
                    "name": "Zend_Mime",
                    "description": "support class for handling multi-part MIME messages",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11698",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Assigning to Matthew, scheduling for 0.7.0 release.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2006-11-28T17:50:43.000+0000",
                    "updated": "2006-11-28T17:50:43.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11726",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "Hi Franco - what transport were you using? Can you snip a portion of the encoded message to show a before \/ after of the lines that were affected? It may also help to know a little more about the environment you're sending the mail from (Platform, Mail software, etc)",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2006-11-28T19:54:03.000+0000",
                    "updated": "2006-11-28T19:54:03.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11740",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=strfrank",
                        "name": "strfrank",
                        "displayName": "Franco A.",
                        "active": true
                    },
                    "body": "Hi,\nTransport is default mail(), here's a test script I used:\n\n<?php \n  require_once 'Zend\/Mail.php';\n  $mail = new Zend_MAil();\n  $mail->setBodyText(\"Test body\");\n  $mail->setSubject(\"Test subject\");\n  $mail->setFrom(\"removed@rem.ove\");\n  $mail->addTo(\"removed@aaa\");\n  $att = file_get_contents(\"test.pdf\");\n  $at = $mail->addAttachment($att);\n  $at->filename = \"test.pdf\";\n  $mail->send();\n?>\n\n\nI'll attach two mail messages, one with no changes to Zend framework 0.2.0, the other with Zend_Mime::LINELENGTH = 72. I'll also attach the original test.pdf file.\nPlatform is ubuntu linux 6, postfix, php 5.1.6, apache 2.0\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=strfrank",
                        "name": "strfrank",
                        "displayName": "Franco A.",
                        "active": true
                    },
                    "created": "2006-11-29T16:59:40.000+0000",
                    "updated": "2006-11-29T16:59:40.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11741",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "Thanks for the info. I've tried a number of scenarios and can't reproduce the problem you're seeing. \n\nThere's a couple of things that may help identify the problem as well - could you try sending the message with different line endings? You can use the code below to change the line ending to either \"\\r\\n\" or \"\\n\" to see if that changes anything.\n\n{code}\n$transport = new Zend_Mail_Transport_Sendmail();\n$transport->EOL = \"\\n\";\n\n$mail = new Zend_Mail();\n$mail->setBodyText(\"Test body\");\n$mail->setSubject(\"Test subject\");\n$mail->setFrom(\"test@test.com\");\n$mail->addTo(\"test@test.com\");\n$att = file_get_contents(\"test.pdf\");\n$at = $mail->addAttachment($att);\n$at->filename = \"test.pdf\";\n$mail->send($transport);\n{code}\n\nSecondly, I'm scratching my head wondering why 74 chars has been used when 76 chars is the RFC2045 recommendation. Can you revert back to 74 chars for the above test, then perform another round of tests with 76 chars and see if that changes anything? I'm interested to see if your local mail (Postfix) is being difficult. You may also wish to try the SMTP transport to see if the problem persists.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2006-11-29T18:51:45.000+0000",
                    "updated": "2006-11-29T18:51:45.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11751",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=strfrank",
                        "name": "strfrank",
                        "displayName": "Franco A.",
                        "active": true
                    },
                    "body": "Hi,\nI had no luck with \"\\n\" but it works if I comment the second line ($transport->EOL = \"\\n\";) and set LINELENGTH to 76. Looking at the mail files I attached I noticed that, for each line, the sequence \\r\\n is repeated twice (there's a blank line between one encoded line and the other). MAybe this could be of some help.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=strfrank",
                        "name": "strfrank",
                        "displayName": "Franco A.",
                        "active": true
                    },
                    "created": "2006-11-30T17:02:59.000+0000",
                    "updated": "2006-11-30T17:02:59.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/11922",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=strfrank",
                        "name": "strfrank",
                        "displayName": "Franco A.",
                        "active": true
                    },
                    "body": "I experimented a bit with this issue, here's what I discovered:\n\n1. I couldn't make Zend_Mail_Transport_Smtp work, even with a small email:\n{code}\n\/\/I tried this server, maybe another one will work\n$tr = new Zend_Mail_Transport_Smtp(\"smtp.tiscali.it\"); \nZend_Mail::setDefaultTransport($tr);\n$m = new Zend_Mail();\n$m->setFrom(\"valid@email.addr\");\n$m->addTo(\"valid@email.addr\");\n$m->setSubject(\"Blah blah blah\");\n$m->setBodyText(\"AAAAA\");\n$m->send();\n{code}\n\nWith this code I get an error 554 Message refused\n\n2. Using Zend_Mail_Transport_Smtp passing \"localhost\" (Ubuntu 6.10 with Postfix installed) to the constructor I can send the mail correctly, even with LINELENGTH=74, so for now I'll be using this method.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=strfrank",
                        "name": "strfrank",
                        "displayName": "Franco A.",
                        "active": true
                    },
                    "created": "2006-12-19T08:32:31.000+0000",
                    "updated": "2006-12-19T08:32:31.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12506",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "Closed for now - but If this resurfaces and we can get some more tangible tests then it will be given some further consideration.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2007-02-03T10:06:12.000+0000",
                    "updated": "2007-02-03T10:06:12.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-589\/transitions"
}