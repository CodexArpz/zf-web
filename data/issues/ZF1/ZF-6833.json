{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6833",
    "key": "ZF-6833",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Loader::isReadable() returns false when valid file is in same directory but . is not in include_path"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6833\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10412",
                    "id": 10412,
                    "description": "Mini Release",
                    "name": "1.10.1",
                    "userReleaseDate": "10\/Feb\/10",
                    "archived": false,
                    "releaseDate": "2010-02-10",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-07-16T19:31:17.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=evalder",
                "name": "evalder",
                "displayName": "EV",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-05-28T00:54:24.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-07-16T19:31:20.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "First of all I guess I should apologise for posting two bug reports in one. They are very related though, so I hope it makes sense.\r\n\r\nMethod isReadable() in Loader.php will incorrectly return false when checking for a file in the same directory as the file calling isReadable() if \".\" is not part of the include_path (bug #1).\r\n\r\nThis could be fixed by adding \"if (is_readable($filename)) return true;\" before the call to fopen().\r\n\r\nMy suggested solution however, is to replace the entire method isReadable() with a new one using is_readable() instead of fopen(), which triggers a suppressed PHP warning if the file does not exist (bug #2).\r\n\r\nMy motivation for changing this function is that it triggers the error handler if the tested file is not found. The warning is suppressed so normally it won't show up anywhere, but I'm using a custom error handler and although I know how to ignore suppressed errors I can't do that. My custom error handler handles suppressed errors because they are often useful when dealing with real problems that are not application errors (for example to see the reason why a database connection failed, or why an xml parser could not parse). The suppressed error caused by Zend_Loader::isReadable() is not useful at all though (the warning reads \"failed to open stream: No such file or directory\", but we only need a true or false), and it should be unnecessary for a function that finds if a file is readable to cause a warning if the file is not readable. As it is, this is a huge annoyance because it causes Zend Framework to fill my error log with useless data and I can't work around it in my application.\r\n\r\nYou could argue that this is just my problem, and I guess it's not unlikely that I'm the only one with this problem right now, but I see no reason not to make the changes I suggest since both functionality and performance are the same as before, except you also get the added feature that isReadable() can be used with directories, just like the in-built PHP function is_readable().\r\n\r\nAs a sidenote, I think that this functionality really should be an integral part of PHP. If you agree, please consider voting for this 9 year old PHP feature request: http:\/\/bugs.php.net\/bug.php?id=6932.\r\n\r\nIn the meantime we have to work around it. Here's my suggestion:\r\n{code}\r\npublic static function isReadable($filename)\r\n{\r\n\tif (($filename = (string)$filename) === '') return false;\r\n\tif (is_readable($filename)) return true;\r\n\tforeach (explode(PATH_SEPARATOR, get_include_path()) as $path)\r\n\t{\r\n\t\tif (is_readable($path . DIRECTORY_SEPARATOR . $filename)) return true;\r\n\t}\r\n\treturn false;\r\n}\r\n{code}\r\n\r\nI've spent quite a few hours testing and comparing the performance of both the existing and my suggested function, and my conclusion is that this new method performs just as well as the old one, even though it involves parsing include_path and looping through the directories. My assumption as to why fopen() does not perform much better is that it must return a file handle, but this is just a wild guess. Also, fopen() performs really bad compared to is_readable() when the file does not exist, probably since it has to trigger a warning as well."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6833\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                "name": "ramon",
                "displayName": "Ramon Henrique Ornelas",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-7014",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7014",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10390",
                    "id": 10390,
                    "description": "Mini Release",
                    "name": "1.9.6",
                    "userReleaseDate": "24\/Nov\/09",
                    "archived": false,
                    "releaseDate": "2009-11-24",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10001",
                    "id": 10001,
                    "name": "Zend_Loader",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37085",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=evalder",
                        "name": "evalder",
                        "displayName": "EV",
                        "active": true
                    },
                    "body": "Rewrote large parts of the original report in order to make its purpose more clear and friendly to whoever ends up reviewing it some day. Removed code to test performance because it took too much focus from the issue. If you're interested in that test code please let me know and I'll send it to you.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=evalder",
                        "name": "evalder",
                        "displayName": "EV",
                        "active": true
                    },
                    "created": "2009-12-20T02:44:25.000+0000",
                    "updated": "2009-12-20T02:44:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41560",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "body": "Resolved in version 1.10.1 see [r20903|http:\/\/framework.zend.com\/code\/changelog\/Standard_Library?cs=20903].",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "created": "2010-07-16T19:31:18.000+0000",
                    "updated": "2010-07-16T19:31:18.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6833\/transitions"
}