{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10991",
    "key": "ZF-10991",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "ReCAPTCHA does work in forms using Array Notation"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10991\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10880",
                    "id": 10880,
                    "description": "Mini Release",
                    "name": "1.11.9",
                    "userReleaseDate": "14\/Jul\/11",
                    "archived": false,
                    "releaseDate": "2011-07-14",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-07-12T17:59:38.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lmakewell",
                "name": "lmakewell",
                "displayName": "Leigh Makewell",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-01-24T04:05:15.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-07-26T09:14:34.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "If you create a form containing a ReCaptcha captcha element it will not validate if that form is using array notation.\r\n\r\nThis form will validate correctly\r\n{code}\r\nclass Contact_Form_Test extends Zend_Form\r\n{\r\n    private static $_privKey = '';\r\n    private static $_pubKey = '';\r\n\r\n\r\n    public function init()\r\n    {\r\n        $this->setMethod('post');\r\n\r\n        $element = new Zend_Form_Element_Captcha('recaptcha', array(\r\n            'label' => \"Please verify you're a human\",\r\n            'captcha' => 'ReCaptcha',\r\n            'captchaOptions' => array(\r\n                'privKey' => self::$_privKey,\r\n                'pubKey' => self::$_pubKey,\r\n            ),\r\n        ));\r\n        $this->addElement($element);\r\n        $this->addElement('Submit', 'submit');\r\n    }\r\n\r\n}\r\n{code}\r\nThis form will not validate and dies with a 'missingValue' error. Note the addition of $this->setElementsBelongTo('contact');\r\n{code}\r\nclass Contact_Form_Test extends Zend_Form\r\n{\r\n    private static $_privKey = '';\r\n    private static $_pubKey = '';\r\n\r\n\r\n    public function init()\r\n    {\r\n        $this->setElementsBelongTo('contact');\r\n        $this->setMethod('post');\r\n\r\n        $element = new Zend_Form_Element_Captcha('recaptcha', array(\r\n            'label' => \"Please verify you're a human\",\r\n            'captcha' => 'ReCaptcha',\r\n            'captchaOptions' => array(\r\n                'privKey' => self::$_privKey,\r\n                'pubKey' => self::$_pubKey,\r\n            ),\r\n        ));\r\n        $this->addElement($element);\r\n        $this->addElement('Submit', 'submit');\r\n    }\r\n\r\n}\r\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10991\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10520",
                    "id": 10520,
                    "description": "Mini Release",
                    "name": "1.11.2",
                    "userReleaseDate": "30\/Dec\/10",
                    "archived": false,
                    "releaseDate": "2010-12-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44149",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "body": "Please use always the code tags!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-01-24T04:46:39.000+0000",
                    "updated": "2011-01-24T04:46:39.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44156",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=guyht",
                        "name": "guyht",
                        "displayName": "Guy Halford-Thompson",
                        "active": true
                    },
                    "body": "Edit: Added code tags",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=guyht",
                        "name": "guyht",
                        "displayName": "Guy Halford-Thompson",
                        "active": true
                    },
                    "created": "2011-01-24T05:34:55.000+0000",
                    "updated": "2011-01-24T05:35:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47415",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "On analysis, this appears to be due to a change in the ReCaptcha JavaScript API. Previously, it would use the element name in order to find and populate the challenge and response values, but now appears to be hard-coded to use only the keys \"recaptcha_challenge_field\" and \"recaptcha_response_field\" -- which makes it (a) impossible to namespace these in a form, and (b) have more than one ReCaptcha on a single page (since whichever ReCaptcha operates last populates those keys in the POST). \r\n\r\nWhat's more frustrating is that if you disable JS, it's actually possible to use namespaced values via the <noscript> section, as it uses the existing elements you create via Zend_Form.\r\n\r\nAs such, I'm unsure how to resolve this issue. We could potentially generate some JS that wraps the ReCaptcha API, but this could prove to be a moving target and maintenance nightmare. Another option is to support namespaces via <noscript> only, and document a methodology for pre-seeding the values yourself:\r\n{code}\r\n$formValues         = $this->_request->getPost('contact', array());\r\nif (!isset($formValues['recaptcha_challenge_field'])) {\r\n    $formValues['recaptcha_challenge_field'] = $this->_request->getPost('recaptcha_challenge_field', '');\r\n}\r\nif (!isset($formValues['recaptcha_response_field'])) {\r\n    $formValues['recaptcha_response_field'] = $this->_request->getPost('recaptcha_response_field', '');\r\n}\r\nif (!$form->isValid($formValues)) { ... }\r\n{code}\r\nFinally, we could raise an exception if we determine that the element is part of a form array.\r\n\r\nGuy, Leigh, which approach would you like to see?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2011-07-11T21:15:35.000+0000",
                    "updated": "2011-07-11T21:16:04.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47416",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I've discovered other folks have had similar issues: http:\/\/ish.io\/embedded\/formish\/recaptcha.html\r\n\r\nI think we may be able to munge this during onSubmit by doing a query on the given form for the appropriate elements, and then creating some new hidden ones that are namespaced but with the same values. I'll try and get something in for this in the next day or two. (We hit this on the ZF site, btw. :) )",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2011-07-11T21:35:12.000+0000",
                    "updated": "2011-07-11T21:35:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47472",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "The following dojo code worked for me to make the JS version of ReCaptcha work:\r\n{code}\r\ndojo.create(\"input\", {type: \"hidden\", id: \"contact-captcha-challenge\", name: \"contact[recaptcha_challenge_field]\"}, dojo.byId(\"captcha-element\"));\r\ndojo.create(\"input\", {type: \"hidden\", id: \"contact-captcha-response\", name: \"contact[recaptcha_response_field]\"}, dojo.byId(\"captcha-element\"));\r\ndojo.connect(dojo.byId(\"contact\"), \"onsubmit\", function(e) { dojo.attr(\"contact-captcha-response\", {value: dojo.attr(\"recaptcha_response_field\", \"value\")}); dojo.attr(\"contact-captcha-challenge\", {value: dojo.attr(\"recaptcha_challenge_field\", \"value\")});});\r\n{code}\r\nBasically, it adds two hidden fields named appropriately into the DOM where the captcha element should live, and then binds to the form's onSubmit event in order to copy the recaptcha information into those hidden fields.\r\n\r\nThis can probably be written as a custom decorator using generic JS (using document.getElementById() and element.value).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2011-07-12T16:01:06.000+0000",
                    "updated": "2011-07-12T16:01:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47474",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Fixed in current trunk and 1.11 release branch via a custom decorator for the ReCaptcha captcha element.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2011-07-12T17:59:38.000+0000",
                    "updated": "2011-07-12T17:59:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47536",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=djart",
                        "name": "djart",
                        "displayName": "Thanos Kyritsis",
                        "active": true
                    },
                    "body": "Subversion revision #24223 for library\/Zend\/Form\/Element\/Captcha.php may have fixed ReCaptcha, but broke at least two other Captchas (I tried Figlet and Image).\r\n\r\nThe example at http:\/\/framework.zend.com\/manual\/en\/learning.quickstart.create-form.html no longer works, because the developer now (since 1.11.9) needs to explicitly add the 'captcha' decorator to the figlet (or image captcha) form element.\r\n\r\nShould I open a new issue for this ?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=djart",
                        "name": "djart",
                        "displayName": "Thanos Kyritsis",
                        "active": true
                    },
                    "created": "2011-07-18T14:01:34.000+0000",
                    "updated": "2011-07-18T14:01:34.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47539",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Please do.\r\n \r\nI recall seeing the logic for adding the captcha decorator, as I had to add some conditional logic _not_ to load it if one was already loaded (as, for example, with the Word or ReCaptcha decorators); it may be that this conditional logic may have introduced a new break. I had to add tests to ensure that the ReCaptcha decorator was being invoked; my guess is that we're missing tests for the others.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2011-07-18T14:14:06.000+0000",
                    "updated": "2011-07-18T14:14:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47656",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "body": "[ZF-11609 - ZF 1.11.9: No Captcha img rendered|http:\/\/framework.zend.com\/issues\/browse\/ZF-11609]",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kaiuwe",
                        "name": "kaiuwe",
                        "displayName": "Kai Uwe",
                        "active": true
                    },
                    "created": "2011-07-26T09:14:34.000+0000",
                    "updated": "2011-07-26T09:14:34.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10991\/transitions"
}