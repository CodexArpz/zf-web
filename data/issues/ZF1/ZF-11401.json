{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11401",
    "key": "ZF-11401",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Use of $s3 getObjectsByBucket() when using a delimiter parameter does not provide access to CommonPrefix resultset."
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11401\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10510",
                    "id": 10510,
                    "description": "Minor Release",
                    "name": "1.12.0",
                    "userReleaseDate": "27\/Aug\/12",
                    "archived": false,
                    "releaseDate": "2012-08-27",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2013-02-12T16:58:24.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=layke",
                "name": "layke",
                "displayName": "Chris Atkinson",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-05-23T15:02:05.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2013-02-12T20:41:57.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "s3"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When you want to retrieve Objects within a bucket you can emulate a normal filesystem by using the params \"prefix\" and \"delimiter\". \r\n\r\nIf I were to use:\r\n{code}\r\n $s3 = new Zend_Service_Amazon_S3($aws_key, $aws_secret_key);\r\n $s3->getObjectsByBucket(\"my-bucket\");\r\n{code}\r\nThen I would get all of the keys in this bucket. \r\nSuch as \"folder\/\", \"folder\/childFolder\/anotherFolder\", \"someFile.jpg\", \"anotherImage.jpg\". \r\n\r\nHowever, if I only wanted the immediate children in order to emulate a \"Folders\" and \"Files\" hierarchy like you would see in a normal filesystem, then you would use a delimiter param of \"\/\". \r\nThis then aggregates the keys which have \"\/\" in their key name and adds them to the \"CommonPrefix\". \r\n\r\nHowever,  the getObjectsByBucket() mthod ignores the \"CommonPrefix\" result in the XML response object, and only checks if the Contents is set. \r\nAs a consequence, it does not provide access to the CommonPrefix anywhere. \r\n\r\n\r\nThis is a XML response. There is a CommonPrefixes key in this XML object, but it is ignored, making the use of $params for the most part useless. \r\n{code}\r\nobject(SimpleXMLElement)#265 (8) {\r\n  [\"Name\"]=>\r\n  string(7) \"samplebucket\"\r\n  [\"Prefix\"]=>\r\n  object(SimpleXMLElement)#267 (0) {\r\n  }\r\n  [\"Marker\"]=>\r\n  object(SimpleXMLElement)#268 (0) {\r\n  }\r\n  [\"MaxKeys\"]=>\r\n  string(3) \"100\"\r\n  [\"Delimiter\"]=>\r\n  string(1) \"\/\"\r\n  [\"IsTruncated\"]=>\r\n  string(5) \"false\"\r\n  [\"Contents\"]=>\r\n  array(2) {\r\n    [0]=>\r\n    object(SimpleXMLElement)#269 (6) {\r\n      [\"Key\"]=>\r\n      string(8) \"myobject\"\r\n      [\"LastModified\"]=>\r\n      string(24) \"2011-05-23T14:05:42.000Z\"\r\n      [\"ETag\"]=>\r\n      string(34) \"\"aefaf7502d52994c3b01957636a3cdd2\"\"\r\n      [\"Size\"]=>\r\n      string(1) \"8\"\r\n      [\"Owner\"]=>\r\n      object(SimpleXMLElement)#275 (2) {\r\n        [\"ID\"]=>\r\n        string(64) \"5021341ae50ddc73d3c34c6ae80d86d4f03b20cc71bbc99a6cddd720c2\"\r\n        [\"DisplayName\"]=>\r\n        string(9) \"username\"\r\n      }\r\n      [\"StorageClass\"]=>\r\n      string(8) \"STANDARD\"\r\n    }\r\n    [1]=>\r\n    object(SimpleXMLElement)#270 (6) {\r\n      [\"Key\"]=>\r\n      string(15) \"rowPosition.jpg\"\r\n      [\"LastModified\"]=>\r\n      string(24) \"2011-05-20T13:29:49.000Z\"\r\n      [\"ETag\"]=>\r\n      string(34) \"\"49e20234ad87244150e6092a47998b8a7d9\"\"\r\n      [\"Size\"]=>\r\n      string(6) \"294142\"\r\n      [\"Owner\"]=>\r\n      object(SimpleXMLElement)#275 (2) {\r\n        [\"ID\"]=>\r\n        string(64) \"50ca3cfbc61b7ae5021345ddc73d3c34c6ae80d86d4f03b20cc71bbc99a6cddd720c2\"\r\n        [\"DisplayName\"]=>\r\n        string(9) \"chrisacky\"\r\n      }\r\n      [\"StorageClass\"]=>\r\n      string(8) \"STANDARD\"\r\n    }\r\n  }\r\n  [\"CommonPrefixes\"]=>\r\n  array(4) {\r\n    [0]=>\r\n    object(SimpleXMLElement)#271 (1) {\r\n      [\"Prefix\"]=>\r\n      string(13) \"anhoterhfols\/\"\r\n    }\r\n    [1]=>\r\n    object(SimpleXMLElement)#272 (1) {\r\n      [\"Prefix\"]=>\r\n      string(6) \"asdaf\/\"\r\n    }\r\n    [2]=>\r\n    object(SimpleXMLElement)#273 (1) {\r\n      [\"Prefix\"]=>\r\n      string(7) \"folder\/\"\r\n    }\r\n    [3]=>\r\n    object(SimpleXMLElement)#274 (1) {\r\n      [\"Prefix\"]=>\r\n      string(9) \"original\/\"\r\n    }\r\n  }\r\n}\r\n{code}\r\n\r\n\r\n\r\n\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11401\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zimuel",
                "name": "zimuel",
                "displayName": "Enrico Zimuel",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10580",
                    "id": 10580,
                    "description": "Mini Release",
                    "name": "1.11.6",
                    "userReleaseDate": "05\/May\/11",
                    "archived": false,
                    "releaseDate": "2011-05-05",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10022",
                    "id": 10022,
                    "name": "Zend_Service_Amazon",
                    "description": "utility functions for using Amazon web services",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46801",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zimuel",
                        "name": "zimuel",
                        "displayName": "Enrico Zimuel",
                        "active": true
                    },
                    "body": "Hi Chris,\r\nmy proposal is to add a boolean optional parameter to the getObjectsByBucket() method of Zend_Service_Amazon_S3 to specify if include or not the CommonPrefix values in the result list.\r\nThis is the change in the source code of Zend_Service_Amazon_S3:\r\n\r\n{code}\r\npublic function getObjectsByBucket($bucket, $params = array(), $commonPrefix=false)\r\n{\r\n  $response = $this->_makeRequest('GET', $bucket, $params);\r\n  if ($response->getStatus() != 200) {\r\n    return false;\r\n  }\r\n  $xml = new SimpleXMLElement($response->getBody());\r\n  $objects = array();\r\n  if (isset($xml->Contents)) {\r\n    foreach ($xml->Contents as $contents) {\r\n      foreach ($contents->Key as $object) {\r\n        $objects[] = (string)$object;\r\n      }\r\n    }\r\n  }\r\n  if ($commonPrefix && isset($xml->CommonPrefixes)) {\r\n    foreach ($xml->CommonPrefixes as $prefix) {\r\n      foreach ($prefix->Prefix as $object) {\r\n        $objects[] = (string)$object;\r\n      }\r\n    }\r\n  }\r\n  return $objects;\r\n}\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zimuel",
                        "name": "zimuel",
                        "displayName": "Enrico Zimuel",
                        "active": true
                    },
                    "created": "2011-05-26T15:38:34.000+0000",
                    "updated": "2011-05-26T15:38:34.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46809",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=layke",
                        "name": "layke",
                        "displayName": "Chris Atkinson",
                        "active": true
                    },
                    "body": "The benefits of using a prefix is to be able to partition the main Objects listings from your prefix. Mixing them in the $objects response means that you can't easily retrieve the Objects and the grouped Common Prefixes. \r\n\r\nAlso, lets say that you were to return a two $objects arrays...\r\nIt might be better to check if $params has a prefix key. I don't know if Amazon AWS returns a XML key if no prefix matches. If this is the case then what you have proposed works okay, but if no prefixes match and they decide not to return a CommonPrefix XML key, then it might throw an unexpected result back as a response.\r\n\r\nWould it be bad for backwards compatibility to check if $commonPrefix boolean is set, and if it is, then return an array back like\r\n\r\n{code}\r\narray(\r\n'objects' => $objects,\r\n'prefixes' => $prefixes\r\n);\r\n{code}\r\n\r\nOnly people utilising the new boolean will be affected so it shouldn't affect BC and it will mean that the prefixes are clearly partitioned from the main objects resultset. (Which is in my opinion important). ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=layke",
                        "name": "layke",
                        "displayName": "Chris Atkinson",
                        "active": true
                    },
                    "created": "2011-05-26T18:26:50.000+0000",
                    "updated": "2011-05-26T18:26:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46828",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zimuel",
                        "name": "zimuel",
                        "displayName": "Enrico Zimuel",
                        "active": true
                    },
                    "body": "Following your considerations I think is better to create a new method to retrieve Objects and CommonPrefixes values (something like getObjectsAndPrefixesByBucket()). Your idea to get the result as associative array of 'objects' and 'prefixes' is very good. In this way we can easily distinguish between objects and prefixes. ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zimuel",
                        "name": "zimuel",
                        "displayName": "Enrico Zimuel",
                        "active": true
                    },
                    "created": "2011-05-27T08:17:01.000+0000",
                    "updated": "2011-05-31T12:42:21.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46931",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zimuel",
                        "name": "zimuel",
                        "displayName": "Enrico Zimuel",
                        "active": true
                    },
                    "body": "Added the getObjectsAndPrefixesByBucket() method in S3.php (trunk, commit 24095). Try it and let me know, thanks.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zimuel",
                        "name": "zimuel",
                        "displayName": "Enrico Zimuel",
                        "active": true
                    },
                    "created": "2011-05-31T13:20:18.000+0000",
                    "updated": "2011-05-31T13:20:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49130",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jonnott",
                        "name": "jonnott",
                        "displayName": "Jon Nott",
                        "active": true
                    },
                    "body": "This commit seems to not have made it into the 'release-1.11' branch on SVN. Any good reason? I *really* need to use this additional method, or I'll have to ditch Zend_Service_Amazon_S3 altogether.. :(",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jonnott",
                        "name": "jonnott",
                        "displayName": "Jon Nott",
                        "active": true
                    },
                    "created": "2011-11-17T21:03:43.000+0000",
                    "updated": "2011-11-17T21:03:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/53124",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jonnott",
                        "name": "jonnott",
                        "displayName": "Jon Nott",
                        "active": true
                    },
                    "body": "The new method appears to be present now (v1.12.1), so can this issue therefore be marked as resolved and closed?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jonnott",
                        "name": "jonnott",
                        "displayName": "Jon Nott",
                        "active": true
                    },
                    "created": "2013-02-12T16:47:24.000+0000",
                    "updated": "2013-02-12T16:47:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/53125",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frosch",
                        "name": "frosch",
                        "displayName": "Frank Br\u00fcckner",
                        "active": true
                    },
                    "body": "@Jon\r\nYou are right, we can close this issue.\r\n\r\nThanks for your feedback!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frosch",
                        "name": "frosch",
                        "displayName": "Frank Br\u00fcckner",
                        "active": true
                    },
                    "created": "2013-02-12T16:58:11.000+0000",
                    "updated": "2013-02-12T16:58:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/53126",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jonnott",
                        "name": "jonnott",
                        "displayName": "Jon Nott",
                        "active": true
                    },
                    "body": "Can the 'Fix Version' be added above? I'm not sure exactly when this was actually introduced..",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jonnott",
                        "name": "jonnott",
                        "displayName": "Jon Nott",
                        "active": true
                    },
                    "created": "2013-02-12T20:00:46.000+0000",
                    "updated": "2013-02-12T20:00:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/53127",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frosch",
                        "name": "frosch",
                        "displayName": "Frank Br\u00fcckner",
                        "active": true
                    },
                    "body": "@Jon\r\nDone. :)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=frosch",
                        "name": "frosch",
                        "displayName": "Frank Br\u00fcckner",
                        "active": true
                    },
                    "created": "2013-02-12T20:41:57.000+0000",
                    "updated": "2013-02-12T20:41:57.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11401\/transitions"
}