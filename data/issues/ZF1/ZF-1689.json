{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1689",
    "key": "ZF-1689",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Forcing Header Fields into Lowercase"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1689\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-07-16T07:23:18.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=livrenoir",
                "name": "livrenoir",
                "displayName": "Hakan Ensari",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-07-09T11:41:35.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-18T04:18:41.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I'm not sure if this issue is a bug per se, but it does render the component incompatible with certain web services.\n\nPut briefly, I cannot use Zend_Http_Client in its present state to interact with the Amazon Inventory Management (AIM) service.\n\nFor instance, to upload a batch refund file, I append the following line to the header:\n\nReportName: BatchRefund\n\nZend_Http_Client ends up putting the name into lowercase, resulting in a header field that is not recognizable by AIM's case-sensitive parsing:\n\nreportname: BatchRefund\n\nMy hack to make this work, instead of going back to my old curl classes, was to remove the line that lowercases field names from the code:\n\n{code}\n--- library\/Zend\/Http\/Client.php        (revision 5616)\n+++ library\/Zend\/Http\/Client.php        (working copy)\n@@ -326,10 +326,10 @@\n             if ($value === null && (strpos($name, ':') > 0))\n                 list($name, $value) = explode(':', $name, 2);\n \n-            $name = strtolower($name);\n+            \/\/$name = strtolower($name);\n             \n             \/\/ Make sure the name is valid\n-            if (! preg_match('\/^[a-z0-9-]+$\/', $name)) {\n+            if (! preg_match('\/^[a-z0-9-]+$\/i', $name)) {\n                 throw new Zend_Http_Client_Exception(\"{$name} is not a valid HTTP header name\");\n             }\n{code}\n\nI'd appreciate it if you consider dropping the strtolower in future releases to make the component compatible in scenarios similar to the above.\n\nHakan"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1689\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                "name": "shahar",
                "displayName": "Shahar Evron",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10031",
                    "id": 10031,
                    "description": "Major Release",
                    "name": "1.0.0",
                    "userReleaseDate": "30\/Jun\/07",
                    "archived": true,
                    "releaseDate": "2007-06-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10015",
                    "id": 10015,
                    "name": "Zend_Http_Client",
                    "description": "performs HTTP requests",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15715",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "body": "The strtolower() is needed to keep header storing consistent, that is for the client to understand that 'Cookie' and 'cookie' are the same. In fact, by treating 'ReportName' different from 'reportname' Amazon are breaking the HTTP specs. With that said, obviously there is an issue that we need to address (as I don't expect Amazon to do that). \n\nI will consider possible solutions for this as soon as I find the time. One possibility would be to use the lower-case version of the header name as an array key as we do now, but store the key + value combination in the array value, as in\n$headers = array(\n  'cookie' => 'Cookie: bla',\n  'reportname' => 'ReportName: BatchRefund'\n);\n\nBut I haven't really considered the effect of such change deeply. \n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "created": "2007-07-09T12:03:57.000+0000",
                    "updated": "2007-07-09T12:03:57.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15755",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=livrenoir",
                        "name": "livrenoir",
                        "displayName": "Hakan Ensari",
                        "active": true
                    },
                    "body": "Thanks for the quick response, Shahar.\n\nHonestly, I don't expect Amazon to change their code, either. Following your lead, I've hacked a tad more into the Client.php code to get what it appears to be a working solution for now.\n\nCheers,\nHakan\n\n{code}\n--- Client.php  (revision 5616)\n+++ Client.php  (working copy)\n@@ -325,11 +325,12 @@\n             \/\/ Check if $name needs to be split\n             if ($value === null && (strpos($name, ':') > 0))\n                 list($name, $value) = explode(':', $name, 2);\n-\n-            $name = strtolower($name);\n             \n+            \n+            \/\/$name = strtolower($name);\n+            \n             \/\/ Make sure the name is valid\n-            if (! preg_match('\/^[a-z0-9-]+$\/', $name)) {\n+            if (! preg_match('\/^[a-z0-9-]+$\/i', $name)) {\n                 throw new Zend_Http_Client_Exception(\"{$name} is not a valid HTTP header name\");\n             }\n \n@@ -339,9 +340,10 @@\n \n             \/\/ Else, set the header\n             } else {\n-                \/\/ Header names are storred lowercase internally.\n                 if (is_string($value)) $value = trim($value);\n-                $this->headers[$name] = $value;\n+                if (is_array($value)) $value = implode(', ', $value);\n+                \/\/ Header names are stored lowercase internally.\n+                $this->headers[strtolower($name)] = ucfirst($name) . \": {$value}\";\n             }\n         }\n \n@@ -361,7 +363,9 @@\n     {\n         $key = strtolower($key);\n         if (isset($this->headers[$key])) {\n-            return $this->headers[$key];\n+            $value = preg_replace('\/^([a-z0-9-]+:)\/i', '', $this->headers[$key]);\n+            if (strpos($value, ',') > 0) $value = explode(',', $value);\n+            return $value;\n         } else {\n             return null;\n         }\n@@ -569,7 +573,7 @@\n \n             $value = addslashes($value);\n \n-            if (! isset($this->headers['cookie'])) $this->headers['cookie'] = '';\n+            if (! isset($this->headers['cookie'])) $this->headers['cookie'] = 'Cookie: ';\n             $this->headers['cookie'] .= $cookie . '=' . $value . '; ';\n         }\n \n@@ -881,7 +885,8 @@\n             if (is_array($value))\n                 $value = implode(', ', $value);\n \n-            $headers[] = ucfirst($name) . \": {$value}\";\n+            \/\/$headers[] = ucfirst($name) . \": {$value}\";\n+            $headers[] = $value;\n         }\n \n         return $headers;\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=livrenoir",
                        "name": "livrenoir",
                        "displayName": "Hakan Ensari",
                        "active": true
                    },
                    "created": "2007-07-11T23:53:58.000+0000",
                    "updated": "2007-07-11T23:53:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15756",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=livrenoir",
                        "name": "livrenoir",
                        "displayName": "Hakan Ensari",
                        "active": true
                    },
                    "body": "Also, for the sake of accuracy, my initial example was is phrased somewhat incorrectly. prepare_headers() eventually normalizes the lowercase reportname to Reportname.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=livrenoir",
                        "name": "livrenoir",
                        "displayName": "Hakan Ensari",
                        "active": true
                    },
                    "created": "2007-07-12T00:03:14.000+0000",
                    "updated": "2007-07-12T00:03:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15823",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "body": "Hi Hakan,\n\nI used a slightly different approach (keeping original header as array of (key, value) instead of a single string as it seemed easier to handle. Please test your code with the latest SVN HEAD if you can (revision 5713) and let me know if it works any better.\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "created": "2007-07-16T07:23:17.000+0000",
                    "updated": "2007-07-16T07:23:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15860",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=livrenoir",
                        "name": "livrenoir",
                        "displayName": "Hakan Ensari",
                        "active": true
                    },
                    "body": "Just wanted to let you know that the SVN trunk worked like a charm :-)\n\nHakan",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=livrenoir",
                        "name": "livrenoir",
                        "displayName": "Hakan Ensari",
                        "active": true
                    },
                    "created": "2007-07-18T02:12:14.000+0000",
                    "updated": "2007-07-18T02:12:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/15861",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "body": "cool, thanks ;)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "created": "2007-07-18T04:18:41.000+0000",
                    "updated": "2007-07-18T04:18:41.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1689\/transitions"
}