{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9566",
    "key": "ZF-9566",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Feed_Writer_Renderer_Entry_Atom: a (utf-8) non breaking space makes atom feed creation fail"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9566\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10460",
                    "id": 10460,
                    "description": "Mini Release",
                    "name": "1.10.5",
                    "userReleaseDate": "26\/May\/10",
                    "archived": false,
                    "releaseDate": "2010-05-26",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-04-29T07:44:36.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lasse",
                "name": "lasse",
                "displayName": "Lasse Fister",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-03-29T08:00:49.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-04-29T07:44:37.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Warning: DOMDocument::loadXML() [domdocument.loadxml]: Entity 'nbsp' not defined in Entity, line: 1 in \/home\/commander\/web\/libraries\/ZendFramework-1.10.2\/library\/Zend\/Feed\/Writer\/Renderer\/Entry\/Atom.php on line 354\r\n\r\nThat's because Zend_Feed_Writer_Renderer_Entry_Atom::_loadXhtml() attempts to create XML using tidy. Tidy itself substitutes utf-8 non breaking spaces width &amp;nbsp; entities which in turn are not XML (and not Atom IMHO).\r\n\r\nreproduce:\r\n{code:title=a view script|borderStyle=solid}\r\n<?php\r\n$this->layout()->disableLayout();\r\n$feed = new Zend_Feed_Writer_Feed();\r\n$feed->setTitle('test');\r\n$feed->setLink('http:\/\/www.testtest.org');\r\n$feed->setFeedLink('http:\/\/www.testtest.org\/feed', 'atom');\r\n$feed->setDescription('test articles');\r\n$feed->setId('http:\/\/www.testtest.org\/feed\/atom\/');\r\n$feed->setEncoding('UTF-8');\r\n$feed->addAuthor(array(\r\n    'name'  => 'test',\r\n    'email' => 'test@testtest.org',\r\n    'uri'   => 'http:\/\/www.testtest.org',\r\n));\r\n$feed->setDateModified(new Zend_Date());\r\n$entry = $feed->createEntry();\r\n$entry->setTitle('test article');\r\n$entry->setId('http:\/\/www.testtest.org\/feed\/testarticle1id');\r\n$entry->setDateCreated(new Zend_Date());\r\n$entry->setDateModified(new Zend_Date());\r\n\r\n\/\/using html_entity_decode to get an utf-8 no breaking space\r\n$htmlSnippet = '<h1>Test'.html_entity_decode('&nbsp;', ENT_COMPAT, 'UTF-8').'Content<\/h1>';\r\n$entry->setContent($htmlSnippet);\r\n\r\n$entry->setDescription('test Description');\r\n$feed->addEntry($entry);\r\necho $feed->export('atom');\r\n{code}\r\n\r\nadding\r\n'quote-nbsp' => false\r\nto the tidy configuration resolved my problem:\r\n{code:title=Zend\/Feed\/Writer\/Renderer\/Entry\/Atom.php line 330|borderStyle=solid}\r\n\r\n    \/**\r\n     * Load a HTML string and attempt to normalise to XML\r\n     *\/\r\n    protected function _loadXhtml($content)\r\n    {\r\n        $xhtml = '';\r\n        if (FALSE && class_exists('tidy', false)) {\r\n            $tidy = new tidy;\r\n            $config = array(\r\n                'output-xhtml' => true,\r\n                'show-body-only' => true,\r\n                'quote-nbsp' => false\r\n            );\r\n...\r\n{code}\r\n\r\nBut a more robust implementation of _loadXhtml would propably be better. The concept of \"attempt[ing] to normalise to XML\" seems not to fit in here. The Example above doesn't fail when tidy isn't installed (or used) at all. Let the user take care of passing something valid and throw an Exception on failure or [turn the DOM warning into an Exception|http:\/\/www.php.net\/manual\/en\/domdocument.loadxml.php#69295] and try to handle that (possibly width tidy or a callback), instead of using tidy regardless of what the input is.\r\n\r\nRegards, Lasse"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9566\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                "name": "padraic",
                "displayName": "P\u00e1draic Brady",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10430",
                    "id": 10430,
                    "description": "Mini Release",
                    "name": "1.10.2",
                    "userReleaseDate": "24\/Feb\/10",
                    "archived": false,
                    "releaseDate": "2010-02-24",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10475",
                    "id": 10475,
                    "name": "Zend_Feed_Writer",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39640",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lasse",
                        "name": "lasse",
                        "displayName": "Lasse Fister",
                        "active": true
                    },
                    "body": "removed a typo",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lasse",
                        "name": "lasse",
                        "displayName": "Lasse Fister",
                        "active": true
                    },
                    "created": "2010-03-29T08:04:06.000+0000",
                    "updated": "2010-03-29T08:04:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39907",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=schmunk",
                        "name": "schmunk",
                        "displayName": "Tobias Munk",
                        "active": true
                    },
                    "body": "I got exactly the same problem.\r\n\r\nMy dev machine has no tidy and I created a valid XML string manually, while our production machine has tidy and the attempt to clean the string breaks it.\r\n\r\nI found a function for HTML to XML entity replacement here:http:\/\/inanimatt.com\/php-convert-entities.php",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=schmunk",
                        "name": "schmunk",
                        "displayName": "Tobias Munk",
                        "active": true
                    },
                    "created": "2010-04-09T08:52:41.000+0000",
                    "updated": "2010-04-09T08:52:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39947",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=schmunk",
                        "name": "schmunk",
                        "displayName": "Tobias Munk",
                        "active": true
                    },
                    "body": "> Let the user take care of passing something valid and throw an Exception on failure or turn the DOM warning into an Exception and try to handle that (possibly width tidy or a callback), instead of using tidy regardless of what the input is.\r\nI second that.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=schmunk",
                        "name": "schmunk",
                        "displayName": "Tobias Munk",
                        "active": true
                    },
                    "created": "2010-04-12T15:11:47.000+0000",
                    "updated": "2010-04-12T15:11:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40298",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                        "name": "padraic",
                        "displayName": "P\u00e1draic Brady",
                        "active": true
                    },
                    "body": "Resolved in r22054.\r\n\r\nI'll investigate a more robust solution in time for ZF 2.0 and experiment with a better cleanup approach. I'll also build in options to disable the Tidy stage (or remove it completely unless warranted\/can report on a fail with a consistently helpful message).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                        "name": "padraic",
                        "displayName": "P\u00e1draic Brady",
                        "active": true
                    },
                    "created": "2010-04-29T07:44:36.000+0000",
                    "updated": "2010-04-29T07:44:36.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9566\/transitions"
}