{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3379",
    "key": "ZF-3379",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Passing null value to Zend_Db_Select::where($cond, $value) leads to error in SQL"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3379\/votes",
                "votes": 4,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10290",
                    "id": 10290,
                    "description": "Mini Release",
                    "name": "1.7.6",
                    "userReleaseDate": "02\/Mar\/09",
                    "archived": false,
                    "releaseDate": "2009-03-02",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-02-25T14:33:13.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=katulus",
                "name": "katulus",
                "displayName": "Ji?\u00ed Tomek",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-06-04T01:19:33.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-21T08:09:55.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "{code}\n$select = new Zend_Db_Select($db);\n$select->from('f_actualities');\n$select->where('act_name = ?', null);\n$db->query($select)->fetchAll();\n{code}\n\nCode aboe raises Zend_Db_Statement_Exception with message \"SQLSTATE[HY093]: Invalid parameter number: no parameters were bound\".\n\nProblem is in file Zend\/Db\/Select.php\n{code}\n785: if ($value !== null) {\n786:     $condition = $this->_adapter->quoteInto($condition, $value, $type);\n787: }\n{code}\n\nIf null is passed as value, condition remains unchanged and so '?' remains there. This leads to SQL error above.\nIt is quite a problem, because when using Zend_Db_Table::find<SOME_TABLE>by<SOME_RULE>() and there is no matching row for some parent row, null value is supplied for it's primary key and it leads to above error.\n\nThis bug was not present in 1.5.0 but strated in 1.5.1."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/1",
                "name": "Blocker"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/customFieldOption\/10039",
                "value": "  Should Have"
            }
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3379\/watchers",
                "isWatching": false,
                "watchCount": 5
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-5699",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5699",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11760",
                    "filename": "dirty_hack.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sylvain",
                        "name": "sylvain",
                        "displayName": "Sylvain Filteau",
                        "active": true
                    },
                    "created": "2009-02-17T08:10:49.000+0000",
                    "size": 898,
                    "mimeType": "text\/x-diff",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11760\/dirty_hack.diff"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11770",
                    "filename": "dirty_patch-with-test-case.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sylvain",
                        "name": "sylvain",
                        "displayName": "Sylvain Filteau",
                        "active": true
                    },
                    "created": "2009-02-25T11:34:10.000+0000",
                    "size": 1646,
                    "mimeType": "text\/x-diff",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11770\/dirty_patch-with-test-case.diff"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10174",
                    "id": 10174,
                    "description": "Mini Release",
                    "name": "1.5.1",
                    "userReleaseDate": "25\/Mar\/08",
                    "archived": true,
                    "releaseDate": "2008-03-25",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10181",
                    "id": 10181,
                    "description": "Mini Release",
                    "name": " 1.5.2",
                    "userReleaseDate": "15\/May\/08",
                    "archived": true,
                    "releaseDate": "2008-05-15",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10132",
                    "id": 10132,
                    "name": "Zend_Db_Select",
                    "description": "OO interface to building a SELECT SQL query.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23506",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dvp",
                        "name": "dvp",
                        "displayName": "Dmitry Pereslegin",
                        "active": true
                    },
                    "body": "This issue precludes the possibility of using \"<=>\" operator in MySQL\n\ninstead \n\n{code:none}\n$param = $request->getParam('arg'); \/\/ some parameter\n\n$select = $db->select()->where('column <=> ?', $param);\n{code} \n\naccounting write\n{code:none}\n$param = $request->getParam('arg'); \/\/ some parameter\n\n$select = $db->select();\n\nif (is_null($param)) {\n    $select->where('column IS NULL');\n} else {\n    $select->where('column = ?', $param);\n}\n{code} ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dvp",
                        "name": "dvp",
                        "displayName": "Dmitry Pereslegin",
                        "active": true
                    },
                    "created": "2008-08-15T16:58:52.000+0000",
                    "updated": "2008-08-15T16:58:52.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24315",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=katulus",
                        "name": "katulus",
                        "displayName": "Ji?\u00ed Tomek",
                        "active": true
                    },
                    "body": "Your solution for using null value works, but it is not core of the problem. As I wrote, problem is with Zend_Db_Table::find<SOME_TABLE>by<SOME_RULE>(). If there is no row for in parent table, null value is supplied for underlying statement. Solving this issue requires extra database statement to check, if parent table contains any rows and use Zend_Db_Table::find<SOME_TABLE>by<SOME_RULE>() only if it contains something. Regarding your comment, this issue is probably related to Zend_Db_Table class where this should be checked.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=katulus",
                        "name": "katulus",
                        "displayName": "Ji?\u00ed Tomek",
                        "active": true
                    },
                    "created": "2008-09-06T04:30:15.000+0000",
                    "updated": "2008-09-06T04:30:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28731",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sylvain",
                        "name": "sylvain",
                        "displayName": "Sylvain Filteau",
                        "active": true
                    },
                    "body": "I don't know if it's a correct solution but when I tried to remove the if statement and it works.\n\nBut since I can't run the unit tests, I can't investigate more.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sylvain",
                        "name": "sylvain",
                        "displayName": "Sylvain Filteau",
                        "active": true
                    },
                    "created": "2009-02-10T10:19:51.000+0000",
                    "updated": "2009-02-10T10:19:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28821",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sylvain",
                        "name": "sylvain",
                        "displayName": "Sylvain Filteau",
                        "active": true
                    },
                    "body": "I can't upgrade from ZendFramework 1.0 to ZendFramework 1.7 because of this issue.\n\nI searched for a workaround but I use findDependentRowset with new a new row object too often to patch all my code base.\n\nMaybe someone have seen a workaround that I didn't found ?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sylvain",
                        "name": "sylvain",
                        "displayName": "Sylvain Filteau",
                        "active": true
                    },
                    "created": "2009-02-13T09:18:37.000+0000",
                    "updated": "2009-02-13T09:18:37.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28888",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sylvain",
                        "name": "sylvain",
                        "displayName": "Sylvain Filteau",
                        "active": true
                    },
                    "body": "I know it's a really dirty trick... but it work with my code in issue ZF-5699",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sylvain",
                        "name": "sylvain",
                        "displayName": "Sylvain Filteau",
                        "active": true
                    },
                    "created": "2009-02-17T08:10:52.000+0000",
                    "updated": "2009-02-17T08:10:52.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29093",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sylvain",
                        "name": "sylvain",
                        "displayName": "Sylvain Filteau",
                        "active": true
                    },
                    "body": "Added test case to the patch so everyone can test it",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sylvain",
                        "name": "sylvain",
                        "displayName": "Sylvain Filteau",
                        "active": true
                    },
                    "created": "2009-02-25T11:34:14.000+0000",
                    "updated": "2009-02-25T11:34:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29094",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sylvain",
                        "name": "sylvain",
                        "displayName": "Sylvain Filteau",
                        "active": true
                    },
                    "body": "When you pass the test case, the problem seems to be solved but there is another thing in the profiler that bugs but I can't track it. PHPUnit just tell me this :\n\n{noformat}\n1) testProfilerPreparedStatementWithParams(Zend_Db_Profiler_Pdo_MysqlTest)\nUndefined offset:  0\n\n2) testProfilerPreparedStatementWithBoundParams(Zend_Db_Profiler_Pdo_MysqlTest)\nUndefined offset:  0\n{noformat}\n\nI tested my patch with sqlite and pdo_mysql",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sylvain",
                        "name": "sylvain",
                        "displayName": "Sylvain Filteau",
                        "active": true
                    },
                    "created": "2009-02-25T11:36:52.000+0000",
                    "updated": "2009-02-25T11:36:52.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29095",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "I'm not sure there is an issue here actually.\n\nWhen you do this:\n{code}\n$select->where('something = ?', null);\n{code}\n\nits effectively the same as you doing this:\n{code}\n$select->where('something = ?');\n{code}\n\nand the latter is semantically wrong, and destined to fail.  You are passing in a PHP null value, and expecting it to be used as the SQL null value.  You are assuming that there is a direct mapping between PHP null and SQL NULL - which is not the case.  The select object in this case cannot determin what you \"mean\" by the php null, thus, no replacement is made.\n\nIn SQL \"something IS NULL\" is not the same as \"something = NULL\" [http:\/\/dev.mysql.com\/doc\/refman\/5.0\/en\/problems-with-null.html], and technically, Zend_Db_Select shouldn't be inferring meaning and re-writing SQL unless its a vendor specific implementation issue (for example limit in MSSQL) and not a PHP -> SQL issue (what is null in php and what is null in SQL).\n\nThat said, I think the proper logic (in your code) here would be this:\n\n{code}\nif ($value === null){\n   $select->where('something IS NULL');\n} else {\n   $select->where('something = ?', $value);\n}\n{code}\n\nI am inclined to close this as \"Not An Issue\"\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2009-02-25T13:10:53.000+0000",
                    "updated": "2009-02-25T13:10:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29096",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sylvain",
                        "name": "sylvain",
                        "displayName": "Sylvain Filteau",
                        "active": true
                    },
                    "body": "Maybe the problem was not explained appropriately.\n\nIn the code I wrote in the issue ZF-5699 (a duplicate of this issue, I think), I use a newly created row instance of Zend_Db_Table_Row_Abstract to find a dependent rowset :\n\n{code}\n<?php\n\nset_include_path('\/home\/sylvain\/Documents\/ZendFramework-1.7.4\/library');\n\nrequire_once('Zend\/Loader.php');\n\nZend_Loader::registerAutoload();\n\nclass Application {\n\n        public static function setUp() {\n                $db = Zend_Db::factory('pdo_mysql', array(\n                        'dbname' => 'test',\n                        'host' => 'localhost',\n                        'username' => 'root',\n                        'password' => ''\n                ));\n                Zend_Db_Table_Abstract::setDefaultAdapter($db);\n\n                $db->query('DROP TABLE IF EXISTS projects');\n                $db->query('DROP TABLE IF EXISTS components');\n\n                $db->query('CREATE TABLE projects (id INTEGER AUTO_INCREMENT, name VARCHAR(15), PRIMARY KEY (id));');\n                $db->query('CREATE TABLE components (id INTEGER AUTO_INCREMENT, name VARCHAR(15), fk_parent INTEGER, PRIMARY KEY (id));');\n        }\n\n}\n\nclass Projects extends Zend_Db_Table_Abstract {\n\n        protected $_name = 'projects';\n\n        protected $_dependentTables = array('Components');\n\n}\n\nclass Components extends Zend_Db_Table_Abstract {\n\n        protected $_name = 'components';\n\n        protected $_referenceMap = array(\n                'Parent' => array(\n                        'columns' => 'fk_parent',\n                        'refTableClass' => 'Projects',\n                        'refColumns' => 'id'\n                )\n        );\n\n}\n\nApplication::setUp();\n\n$tbl_projects = new Projects();\n$new_project = $tbl_projects->createRow();\n\n$components = $new_project->findDependentRowset('Components');\necho count($components) . \"\\n\";\n{code}\n\nThis code fail because of the if statement in Zend_Db_Select.\n\nThe same problem happen for the same reason when using Zend_Db_Table::find<SOME_TABLE>by<SOME_RULE>() as explained in the description of this issue.\n\nMaybe my solution is not appropriate but this is an issue and I think it should not be closed.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sylvain",
                        "name": "sylvain",
                        "displayName": "Sylvain Filteau",
                        "active": true
                    },
                    "created": "2009-02-25T14:02:10.000+0000",
                    "updated": "2009-02-25T14:02:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29097",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "The above use case is not related to this issue. For that, I will leave my comments in issue ZF-5699.\n\nAs for this issue, for the reasons I described above in the comments, I am marking as \"not an issue\".\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2009-02-25T14:33:11.000+0000",
                    "updated": "2009-02-25T14:33:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52911",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nike+shox",
                        "name": "nike shox",
                        "displayName": "nike shox",
                        "active": true
                    },
                    "body": "Med buzz Rundt utgivelsen, some folk http:\/\/www.nikeshoxsko.biz stylte opp as dring as 24 timer. Jeg today limited to some few utvalgte amerikanske forhandlere, h\u00e5pet many p\u00e5 http:\/\/www.nikeshoxsko.biz \"Miami Nights\" would Baere lik long-term importance as already classic \"South Beach\" http:\/\/www.nikeshoxsko.biz LeBron 8 Mid.Where it is a major time sneaker utgivelse, it is always kontrovers. ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nike+shox",
                        "name": "nike shox",
                        "displayName": "nike shox",
                        "active": true
                    },
                    "created": "2012-11-21T08:09:55.000+0000",
                    "updated": "2012-11-21T08:09:55.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3379\/transitions"
}