{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7874",
    "key": "ZF-7874",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Mail_Transport should not add charset parameter to multipart Content-Type header"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField",
            "value": {
                "timeoriginalestimate": 1440,
                "timeestimate": 1440
            }
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7874\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10390",
                    "id": 10390,
                    "description": "Mini Release",
                    "name": "1.9.6",
                    "userReleaseDate": "24\/Nov\/09",
                    "archived": false,
                    "releaseDate": "2009-11-24",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-10-31T06:13:19.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ovgray",
                "name": "ovgray",
                "displayName": "O Gray",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-09-17T12:32:48.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-10-31T06:13:22.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When generating a multipart (text and html) message, Zend_Mail includes the following in the headers:\n\n{code}\nContent-Type: multipart\/alternative; charset=iso-8859-1;\n boundary=\"=--whatever--\"\n{code}\n\nAs far as I can tell, the charset parameter is not appropriate to a multipart\/alternative Content-Type declaration. \n\nfrom RFC 2045, p. 10:\n\nFor example, the \"charset\" parameter is applicable to any subtype of\n   \"text\", while the \"boundary\" parameter is required for any subtype of\n   the \"multipart\" media type.\n\nAt http:\/\/www-01.ibm.com\/support\/docview.wss?rs=180&uid=swg1PK48897 I found this:\n\nThe\ncharset parameter isn't valid in the headers\n of ANY multipart type.  Neither the\nmultipart\/related specification nor any\nexample in any specification suggests that\n it should be allowed.  It only applies to\ntext and to text-related formats such as\napplication\/xml.  The body of a\nmultipart\/related document is not text so it\n cannot have a charset.  It is a collection\nof parts which are required to consist of\nvalid 7-bit ASCII headers combined with data\n in whatever encoding is specified in the\ncontent-type and content-encoding headers\nfor the relevant part.\n\nThe inclusion of the charset parameter causes at least one webmail client (UebiMiau 2.7.10) to choke on the message.\n\nmodifying the _getHeaders() fucntion in Zend\/Mail\/Transport\/Abstract.php to change this:\n\n{code}\n          $this->_headers['Content-Type'] = array(\n                $type . '; charset=' . $this->_mail->getCharset() . ';'\n                . $this->EOL\n                . \" \" . 'boundary=\"' . $boundary . '\"'\n            );\n{code}\n\nto this\n\n{code}\n           $this->_headers['Content-Type'] = array(\n                $type . ';'\n                . $this->EOL\n                . \" \" . 'boundary=\"' . $boundary . '\"'\n            );\n            $this->boundary = $boundary;\n        } \n{code}\n\nSolved the problem with the web client\n\nAlso, if a message generated by the existing code is run through message lint at http:\/\/www.apps.ietf.org\/node\/11, it warns: \"WARNING: Unexpected parameter 'charset' in header 'Content-Type'\" "
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/customFieldOption\/10039",
                "value": "  Should Have"
            }
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7874\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                "name": "satoruyoshida",
                "displayName": "Satoru Yoshida",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10361",
                    "id": 10361,
                    "description": "Mini Release",
                    "name": "1.9.2",
                    "userReleaseDate": "25\/Aug\/09",
                    "archived": false,
                    "releaseDate": "2009-08-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10018",
                    "id": 10018,
                    "name": "Zend_Mail",
                    "description": "high-level utility to build MIME-compliant messages and send using a mail transport adapter",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35088",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dewoob",
                        "name": "dewoob",
                        "displayName": "Oliver Baltz",
                        "active": true
                    },
                    "body": "This fix seems to work for me:\n\nprotected function _getHeaders($boundary)\n    {\n        if (null !== $boundary) {\n            \/\/ Build multipart mail\n            $type = $this->_mail->getType();\n            if (!$type) {\n                if ($this->_mail->hasAttachments) {\n                    $type = Zend_Mime::MULTIPART_MIXED;\n                } elseif ($this->_mail->getBodyText() && $this->_mail->getBodyHtml()) {\n                    $type = Zend_Mime::MULTIPART_ALTERNATIVE;\n                } else {\n                    $type = Zend_Mime::MULTIPART_MIXED;\n                }\n            }\n            \n            $addCharset = !in_array($type, array( \n                Zend_Mime::MULTIPART_MIXED,\n                Zend_Mime::MULTIPART_ALTERNATIVE,\n                Zend_Mime::MULTIPART_MIXED  \n            ));\n\n            $this->_headers['Content-Type'] = array(\n                $type . ( $addCharset ? ( '; charset=' . $this->_mail->getCharset() ) : \"\" ) . ';'\n                . $this->EOL\n                . \" \" . 'boundary=\"' . $boundary . '\"'\n            );\n            $this->boundary = $boundary;\n        }\n\n        $this->_headers['MIME-Version'] = array('1.0');\n\n        return $this->_headers;\n    }",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dewoob",
                        "name": "dewoob",
                        "displayName": "Oliver Baltz",
                        "active": true
                    },
                    "created": "2009-10-06T03:40:36.000+0000",
                    "updated": "2009-10-06T03:40:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35089",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ovgray",
                        "name": "ovgray",
                        "displayName": "O Gray",
                        "active": true
                    },
                    "body": "Mr. Baltz's proposed fix assumes that there is some Multipart type for which charset is a valid header parameter. The reference I quoted from the IBM site is categorical that this is not so. Is there some authority to the contrary?\n\nZend_Mime only contemplates three multipart types: MULTIPART_ALTERNATIVE, MULTIPART_MIXED and MULTIPART_RELATED. Zend_Mail only permits those three types (see Zend_Mail::setType). Thus, this fix would permit a charset header parameter for the MULTIPART_RELATED type only. That type is defined in http:\/\/tools.ietf.org\/html\/rfc2387. Nothing in that definition suggests that charset is a valid header parameter for that type.\n\nIt seems odd that Zend_Mime::MULTIPART_MIXED is mentioned twice in this part of the  _getHeaders function (this is presumably why Mr. Baltz includes Zend_Mime::MULTIPART_MIXED twice in the array his code adds):\n\nif (!$type) {\nif ($this->_mail->hasAttachments) { \n$type = Zend_Mime::MULTIPART_MIXED; \n} elseif ($this->_mail->getBodyText() && $this->_mail->getBodyHtml()) { \n$type = Zend_Mime::MULTIPART_ALTERNATIVE; \n} else { \n$type = Zend_Mime::MULTIPART_MIXED; \n}\n}\n\nI wonder if the code I have just quoted should have been:\n\nif (!$type) {\nif ($this->_mail->hasAttachments) { \n$type = Zend_Mime::MULTIPART_MIXED; \n} elseif ($this->_mail->getBodyText() && $this->_mail->getBodyHtml()) { \n$type = Zend_Mime::MULTIPART_ALTERNATIVE; \n} else { \n$type = Zend_Mime::MULTIPART_RELATED; \n}\n}\n\nIn any event, if charset is not a valid parameter in the header of any multipart type (as opposed to the header of a part), then its seems better (and simpler) just to eliminate it from the _getHeaders() function altogether.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ovgray",
                        "name": "ovgray",
                        "displayName": "O Gray",
                        "active": true
                    },
                    "created": "2009-10-06T05:08:42.000+0000",
                    "updated": "2009-10-06T05:08:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35101",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "body": "Thank you for the suggestions, Oliver Baltz and O Gray .  I'm working now, and I'll be happy if you give me several weeks, Thanks ;-)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "created": "2009-10-06T20:40:17.000+0000",
                    "updated": "2009-10-06T20:41:07.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35649",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "body": "Solved in SVN r18759 of trunk, r18760 of 1.9 branch.\r\n\r\nBut 2 Zend_Mime::MULTIPART_MIXEDs seem to be correct.\r\n\r\nI think 2nd Zend_Mime::MULTIPART_MIXED is default value if script can not set the type automatically. ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "created": "2009-10-31T06:13:19.000+0000",
                    "updated": "2009-10-31T06:13:19.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7874\/transitions"
}