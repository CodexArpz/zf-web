{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1899",
    "key": "ZF-1899",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Db_Table::createRow()->save() inserts row, but throws an exception"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1899\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10130",
                    "id": 10130,
                    "description": "Mini Release",
                    "name": "1.0.2",
                    "userReleaseDate": "25\/Sep\/07",
                    "archived": true,
                    "releaseDate": "2007-09-25",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-09-11T20:27:45.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aaroncampbell",
                "name": "aaroncampbell",
                "displayName": "Aaron D. Campbell",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-08-31T14:48:24.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-01-23T18:28:49.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "If I have a MySQL table with a multi-column PK, and I get an exception when I try something like:\n$table->createRow($newData)->save()\n\nI'm attaching a .sql file to create a sample table, two classes (a table class, and a table_row class), and a test.php file to show the problem.  The row gets inserted into the database, but then save() seems to be calling _refresh(), which SELECTs the data back from the database (I'm assuming to account for any triggers, etc that are handled by the database...might be nice to be able to disable this).  The SELECT statement that it creates doesn't have the right ID.  In the example, it says \"WHERE (`companyId` = 3) AND (`id` = 0)\" when it SHOULD be \"WHERE (`companyId` = 1) AND (`id` = 3)\""
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1899\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                "name": "bkarwin",
                "displayName": "Bill Karwin",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/10774",
                    "filename": "ZF-1899-patch.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aaroncampbell",
                        "name": "aaroncampbell",
                        "displayName": "Aaron D. Campbell",
                        "active": true
                    },
                    "created": "2007-09-02T13:13:49.000+0000",
                    "size": 1139,
                    "mimeType": "text\/x-patch",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/10774\/ZF-1899-patch.diff"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/10770",
                    "filename": "zferror.tar.bz2",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aaroncampbell",
                        "name": "aaroncampbell",
                        "displayName": "Aaron D. Campbell",
                        "active": true
                    },
                    "created": "2007-08-31T14:50:12.000+0000",
                    "size": 1685,
                    "mimeType": "application\/x-bzip",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/10770\/zferror.tar.bz2"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10133",
                    "id": 10133,
                    "name": "Zend_Db_Table",
                    "description": "Lightweight OO interface to database tables and rowsets.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/16516",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aaroncampbell",
                        "name": "aaroncampbell",
                        "displayName": "Aaron D. Campbell",
                        "active": true
                    },
                    "body": "Bill, I see that you assigned yourself to this one.  Were you able to duplicate it?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aaroncampbell",
                        "name": "aaroncampbell",
                        "displayName": "Aaron D. Campbell",
                        "active": true
                    },
                    "created": "2007-09-01T13:10:08.000+0000",
                    "updated": "2007-09-01T13:10:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/16517",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "I have not worked on this yet.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-09-01T14:22:41.000+0000",
                    "updated": "2007-09-01T14:22:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/16519",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aaroncampbell",
                        "name": "aaroncampbell",
                        "displayName": "Aaron D. Campbell",
                        "active": true
                    },
                    "body": "That's fine, I've been digging still, but being so new to ZF, there's a lot I don't know yet.  However, I think I've located the problem, AND the solution, but I'm not sure how you guys would prefer that it be coded.  Basically, Zend_Db_Table_Row_Abstract needs access to Zend_Db_Table_Abstract::_identity.  So I think there needs to be some kind of getIdentity method in Zend_Db_Table_Abstract that returns it.\n\nThe error starts on line 326 of Zend\/Db\/Table\/Row\/Abstract.php (I'm using SVN revision 6231).  It does:\n{{$newPrimaryKey = array({color:red}current((array)$this->_primary){color} => $primaryKey);}}\nWhich gives {{[companyId]=>X}} Where X is the insert id, that *actually* belongs to _id_.  This SHOULD end up being {{[id]=>X}}.  When I debug with Zend Platform, and use Zend Studio to manually change the value of $newPrimaryKey to array('id'=>'X'), it works fine.\n\nAt that point, what you need access to is $this->_table->_identity (which you obviously don't have, but that value is correct, 2 in this test case), so that you could do\n{{$newPrimaryKey = array({color:red}$this->_primary[$this->_table->_identity]{color} => $primaryKey);}}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aaroncampbell",
                        "name": "aaroncampbell",
                        "displayName": "Aaron D. Campbell",
                        "active": true
                    },
                    "created": "2007-09-01T15:26:53.000+0000",
                    "updated": "2007-09-01T15:26:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/16525",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aaroncampbell",
                        "name": "aaroncampbell",
                        "displayName": "Aaron D. Campbell",
                        "active": true
                    },
                    "body": "This fixes it for me.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aaroncampbell",
                        "name": "aaroncampbell",
                        "displayName": "Aaron D. Campbell",
                        "active": true
                    },
                    "created": "2007-09-02T13:13:49.000+0000",
                    "updated": "2007-09-02T13:13:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/16617",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Hi Aaron,\n\nCan you please test with revision 6320 and see if this resolves the issue for you?  It should not require your customizations to make {{Table::_identity}} public.\n\nBasically I found that {{Table::insert()}} mistakenly assumed the primary key is non-compound if it has an identity column, and it was always returning the scalar value of the last identity generated, instead of the array of column\/value pairs for the full PK.\n\nSo, no modification is needed to the Row class if the Table's {{insert()}} method returns the correct compound PK data.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-09-11T19:30:20.000+0000",
                    "updated": "2007-09-11T19:30:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/16619",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aaroncampbell",
                        "name": "aaroncampbell",
                        "displayName": "Aaron D. Campbell",
                        "active": true
                    },
                    "body": "That worked.  Thanks.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aaroncampbell",
                        "name": "aaroncampbell",
                        "displayName": "Aaron D. Campbell",
                        "active": true
                    },
                    "created": "2007-09-11T19:56:57.000+0000",
                    "updated": "2007-09-11T19:56:57.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/16620",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Fixed in trunk.  Waiting for review to be merged to ZF 1.0.2 branch.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-09-11T20:27:44.000+0000",
                    "updated": "2007-09-11T20:27:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/16655",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Changes reviewed by Darby Felton.\nMerged to branch for ZF 1.0.2 release.\nUpdated fix version.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-09-13T14:59:20.000+0000",
                    "updated": "2007-09-13T14:59:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/18523",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Updating Fix Version to follow issue tracker conventions.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-01-23T18:28:49.000+0000",
                    "updated": "2008-01-23T18:28:49.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1899\/transitions"
}