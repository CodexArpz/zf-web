{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10044",
    "key": "ZF-10044",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Test_PHPUnit_Db_Operation_Truncate doesn't heed the AUTO_QUOTE_IDENTIFIERS config option"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10044\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10530",
                    "id": 10530,
                    "description": "Mini Release",
                    "name": "1.11.3",
                    "userReleaseDate": "01\/Feb\/11",
                    "archived": false,
                    "releaseDate": "2011-02-01",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-01-22T06:16:35.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=andrewsharpe79",
                "name": "andrewsharpe79",
                "displayName": "Andrew Sharpe",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-06-23T23:44:14.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-01-22T06:16:36.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Zend_Test_PHPUnit_Db_Operation_Truncate::truncate() calls Zend_Db_Adapter_Abstract::quoteIdentifier() and doesn't pass the second argument to allow the developer to control identifier quoting.  This results in the truncate operation failing on (at least) Oracle."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10044\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                "name": "ramon",
                "displayName": "Ramon Henrique Ornelas",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10470",
                    "id": 10470,
                    "description": "Mini Release",
                    "name": "1.10.6",
                    "userReleaseDate": "22\/Jun\/10",
                    "archived": false,
                    "releaseDate": "2010-06-22",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10312",
                    "id": 10312,
                    "name": "Zend_Test_PHPUnit",
                    "description": "PHPUnit test scaffolding for ZF MVC applications",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41617",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=andrewsharpe79",
                        "name": "andrewsharpe79",
                        "displayName": "Andrew Sharpe",
                        "active": true
                    },
                    "body": "I'd still like to retain the truncate operation in the SimpleTester and the workaround I'm using ATM is rather cumbersome.\r\n\r\nI have subclassed SimpleTester with the following:\r\n\r\nclass My_Test_PHPUnit_Db_SimpleTester extends Zend_Test_PHPUnit_Db_SimpleTester {\r\n\tpublic function __construct(PHPUnit_Extensions_Database_DB_IDatabaseConnection $connection) {\r\n\t\tparent::__construct($connection);\r\n\r\n\t\t$this->setUpOperation = new PHPUnit_Extensions_Database_Operation_Composite(array(\r\n\t\t\tnew My_Test_PHPUnit_Db_Operation_Truncate(),\r\n\t\t\tnew Zend_Test_PHPUnit_Db_Operation_Insert(),\r\n\t\t));\r\n\t}\r\n}\r\n\r\nAnd also the Truncate operation:\r\n\r\nclass My_Test_PHPUnit_Db_Operation_Truncate extends Zend_Test_PHPUnit_Db_Operation_Truncate {\r\n    protected function _truncate(Zend_Db_Adapter_Abstract $db, $tableName) {\r\n\t\t\/\/ can't pass this through because when quoteIdentifier is called without\r\n\t\t\/\/ the second argument then quoting always happens => breakage\r\n\/\/\t\treturn parent::_truncate($db, $db->quoteIdentifier($tableName, true));\r\n\t\t$tableName = $db->quoteIdentifier($tableName, true);\r\n\t\tif($db instanceof Zend_Db_Adapter_Pdo_Sqlite) {\r\n\t\t\t$db->query('DELETE FROM '.$tableName);\r\n\t\t} else if($db instanceof Zend_Db_Adapter_Db2) {\r\n\t\t\tif(strstr(PHP_OS, \"WIN\")) {\r\n\t\t\t\t$file = tempnam(sys_get_temp_dir(), \"zendtestdbibm_\");\r\n\t\t\t\tfile_put_contents($file, \"\");\r\n\t\t\t\t$db->query('IMPORT FROM '.$file.' OF DEL REPLACE INTO '.$tableName);\r\n\t\t\t\tunlink($file);\r\n\t\t\t} else {\r\n\t\t\t\t$db->query('IMPORT FROM \/dev\/null OF DEL REPLACE INTO '.$tableName);\r\n\t\t\t}\r\n\t\t} else if($this->_isMssqlOrOracle_($db)) {\r\n\t\t\t$db->query('TRUNCATE TABLE '.$tableName);\r\n\t\t} else {\r\n\t\t\t$db->query('TRUNCATE '.$tableName);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate function _isMssqlOrOracle_($db) {\r\n\t\treturn (\r\n\t\t\t$db instanceof Zend_Db_Adapter_Pdo_Mssql ||\r\n\t\t\t$db instanceof Zend_Db_Adapter_Sqlsrv ||\r\n\t\t\t$db instanceof Zend_Db_Adapter_Pdo_Oci ||\r\n\t\t\t$db instanceof Zend_Db_Adapter_Oracle\r\n\t\t);\r\n\t}\r\n}\r\n\r\n\r\nHere is the patch to ZF 1.9.5 to allow this to work (can't upgrade to ZF 10.x due to project priorities):\r\n\r\nIndex: php\/library\/Zend\/Test\/PHPUnit\/Db\/Operation\/Truncate.php\r\n===================================================================\r\n--- php\/library\/Zend\/Test\/PHPUnit\/Db\/Operation\/Truncate.php     (revision 22559)\r\n+++ php\/library\/Zend\/Test\/PHPUnit\/Db\/Operation\/Truncate.php     (working copy)\r\n@@ -77,7 +77,7 @@\r\n      *\/\r\n     protected function _truncate(Zend_Db_Adapter_Abstract $db, $tableName)\r\n     {\r\n-        $tableName = $db->quoteIdentifier($tableName);\r\n+        $tableName = $db->quoteIdentifier($tableName, true);\r\n         if($db instanceof Zend_Db_Adapter_Pdo_Sqlite) {\r\n             $db->query('DELETE FROM '.$tableName);\r\n         } else if($db instanceof Zend_Db_Adapter_Db2) {\r\n@@ -111,4 +111,4 @@\r\n             $db instanceof Zend_Db_Adapter_Oracle\r\n         );\r\n     }\r\n-}\r\n\\ No newline at end of file\r\n+}\r\n\r\n\r\nUnfortunately this system munges the formatting. \r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=andrewsharpe79",
                        "name": "andrewsharpe79",
                        "displayName": "Andrew Sharpe",
                        "active": true
                    },
                    "created": "2010-07-19T17:06:56.000+0000",
                    "updated": "2010-07-19T17:06:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44112",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "body": "Fixed in trunk r23655 merged to release branch 1.11 r23656 - thanks.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "created": "2011-01-22T06:16:36.000+0000",
                    "updated": "2011-01-22T06:16:36.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10044\/transitions"
}