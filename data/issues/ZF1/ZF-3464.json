{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3464",
    "key": "ZF-3464",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "setEventItem calls passed function immediately"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3464\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/4",
                "name": "Incomplete"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-01-21T12:30:29.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=akzincdig",
                "name": "akzincdig",
                "displayName": "Ashley Kitson",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-06-16T10:26:02.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-01-21T23:55:33.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "The ->setEventItem() method calls the passed function reference immediately and sets the value straight away.  i.e. it binds the value before a log message is even sent.  This may be the intended functionality or it may not but it makes it unuseable in a dynamic environment.  Consider this scenario:\n\nYou want to set up logging for an application and want to log the user id of the logged on user.  You can't do this if your authentication service is not yet running or if the user hasn't yet logged on.  Binding the value this early on will not allow you to log the actual user id.  Thus the following code fails:\n\nself::$_logHandler[$tag]->setEventItem('uid',$this->getUid());\n$format = '%uid%|%timestamp%|%priorityName%|%priority%|%message%' . PHP_EOL;\n$formatter = new Zend_Log_Formatter_Simple($format);\n$writer->setFormatter($formatter);\n\nbecause getUid relies on a service (based on Zend_Auth) that, although instantiated hasn't be called yet to set up authentication and therefore fails.\n\nIt therefore makes more sense to implement the setEventItem function parameter as a call back function, that is called when the log message is created.\n\nI amended setEventItem as follows to achieve the desired effect\n\n    public function setEventItem($name, $value) {\n        if (isset($this->_extras[$name])) {\n            $this->_extras[$name] = $value;\n        } else {\n            $this->_extras = array_merge($this->_extras, array($name => $value));\n        }\n    }\n\nThis allows you to call the method after setting up the writer with a new new value i.e.\n\nself::$_logHandler[ZWARE_LOG_APP]->setEventItem('uid',$this->getUid());\n$this->log(ZWARE_LOG_APP,$message,$priority);\n\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3464\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                "name": "wil",
                "displayName": "Wil Sinclair",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10174",
                    "id": 10174,
                    "description": "Mini Release",
                    "name": "1.5.1",
                    "userReleaseDate": "25\/Mar\/08",
                    "archived": true,
                    "releaseDate": "2008-03-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10017",
                    "id": 10017,
                    "name": "Zend_Log",
                    "description": "classic logging utility functions",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28372",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Honestly, I just confused with what the proposal is here. It seems like you're talking about deferred execution of getUid(), but neither the original code snippet nor your proposed change would do this. The reason is simple: for method invocations, the arguments are evaluated before the method is called.\nPlease let me know if I'm missing something here, and, if so, reopen the bug.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2009-01-21T12:29:13.000+0000",
                    "updated": "2009-01-21T12:29:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28373",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Waiting for further information from reporter. Resolving issue for now as there is a simple workaround for what the reporter seems to be trying to do.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2009-01-21T12:30:29.000+0000",
                    "updated": "2009-01-21T12:30:29.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28388",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=akzincdig",
                        "name": "akzincdig",
                        "displayName": "Ashley Kitson",
                        "active": true
                    },
                    "body": "Will.  It's been so long since I opened this one I've almost forgotten what it was about and have overwritten my patch to Zend with latre revisions of the framework.\n\nWhat I am trying to achieve is late binding of the value that goes into the item.\n\nAs previously stated setEventItem needs to be rewritten to allow the value to be passed as the name of a callback function which will provide the value when the logger is actually invoked with a call to log()  The workaround I have shown is exactly that, a workaround.  It would be more elegant to have a callback facility and that will require rework to teh log() method as well as setEventItem().\n\nIf not, my workaround still needs to be incorporated into the Zend library. (Zend\/Log.php line 219 public function setEventItem() declaration) else its a patch that has to be applied every time the ZF library gets updated.\n\nUnless of course you have a better way :-)\n\nSo I think you either reopen this issue and get it incorporated into the build or state why it shouldn't be done.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=akzincdig",
                        "name": "akzincdig",
                        "displayName": "Ashley Kitson",
                        "active": true
                    },
                    "created": "2009-01-21T23:55:33.000+0000",
                    "updated": "2009-01-21T23:55:33.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3464\/transitions"
}