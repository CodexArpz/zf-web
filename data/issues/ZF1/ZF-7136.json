{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7136",
    "key": "ZF-7136",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Cache_Backend change in 1.8.4 broke Zend_Locale_Data (and by extension, Zend_Date)"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7136\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10320",
                    "id": 10320,
                    "description": "Minor Release",
                    "name": "1.9.0",
                    "userReleaseDate": "31\/Jul\/09",
                    "archived": false,
                    "releaseDate": "2009-07-31",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-07-25T08:00:51.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=admwiggin",
                "name": "admwiggin",
                "displayName": "Tianon Gravi",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-06-26T13:16:12.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-07-25T08:00:45.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "Zend_Cache_Backend",
                "Zend_Date",
                "Zend_Locale_Data"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "We just upgraded from 1.8.2 to 1.8.4, and noticed that our Zend_Date call to toString was no longer working.  We were getting an exception of \"Could not determine temp directory, please specify a cache_dir manually\" where it was working just great on 1.8.2 (and a downgrade to 1.8.2 made the exception go away again).\n\n{code:title=relevant parts of getTraceAsString}\n#0 \/var\/www\/html\/common\/php\/Zend-1.8.4\/Cache\/Backend.php(196): Zend_Cache::throwException('Could not deter...')\n#1 \/var\/www\/html\/common\/php\/Zend-1.8.4\/Cache\/Backend\/File.php(122): Zend_Cache_Backend->getTmpDir()\n#2 \/var\/www\/html\/common\/php\/Zend-1.8.4\/Cache.php(152): Zend_Cache_Backend_File->__construct(Array)\n#3 \/var\/www\/html\/common\/php\/Zend-1.8.4\/Cache.php(93): Zend_Cache::_makeBackend('File', Array, false, false)\n#4 \/var\/www\/html\/common\/php\/Zend-1.8.4\/Locale\/Data.php(843): Zend_Cache::factory('Core', 'File', Array, Array)\n#5 \/var\/www\/html\/common\/php\/Zend-1.8.4\/Date.php(612): Zend_Locale_Data::getContent('en_US', 'month', Array)\n#6 \/var\/www\/html\/common\/php\/Zend-1.8.4\/Date.php(515): Zend_Date->_parseIsoToDate('MMM', 'en_US')\n#7 \/var\/www\/html\/common\/php\/Zend-1.8.4\/Date.php(488): Zend_Date->_toToken('MMM dSS, yyyy', 'en_US')\n#8 \/var\/www\/html\/common\/php\/Zend-1.8.4\/Date.php(412): Zend_Date->get('MMM dSS, yyyy', 'en_US')\n#9 \/var\/www\/path\/to\/our\/view\/script.phtml(116): Zend_Date->toString('M jS, Y', 'php')\n{code}\n\nI did some digging and found that the only change that could have caused this was the following:\n{code:title=svn diff snippet from 1.8.2 to 1.8.4}\n--- Zend\/Cache\/Backend.php  (...\/release-1.8.2\/library) (revision 16310)\n+++ Zend\/Cache\/Backend.php  (...\/release-1.8.4\/library) (revision 16310)\n@@ -183,7 +183,9 @@\n         if ($tempFile) {\n            $dir = realpath(dirname($tempFile));\n             unlink($tempFile);\n-            return $dir;\n+            if ($this->_isGoodTmpDir($dir)) {\n+                return $dir;\n+            }\n         }\n         if ($this->_isGoodTmpDir('\/tmp')) {\n            return '\/tmp';\n{code}\n{code:title=the rest of the relevant code from the function in Zend\/Cache\/Backend.php}\n\/\/ ...\n            if ($this->_isGoodTmpDir($dir)) {\n                return $dir;\n            }\n        }\n        if ($this->_isGoodTmpDir('\/tmp')) {\n            return '\/tmp';\n        }\n        if ($this->_isGoodTmpDir('\\\\temp')) {\n            return '\\\\temp';\n        }\n        Zend_Cache::throwException('Could not determine temp directory, plea\nse specify a cache_dir manually');\n    }\n\/\/ ...\n{code}\n\nI don't know if the problem is that our temp directory really isn't a \"GoodTmpDir\", or whether \"_isGoodTmpDir\" is just failing.  (I would guess the latter, though, since it was working fantastic before this change.)\n\nTo be honest, I wasn't even aware that Zend_Locale_Data (and by extension Zend_Date) was using a cache until this exception came up.  Shouldn't all caching be disabled by default?  I know that one can disable it by hand, but that shouldn't be necessary, unless it really offers some amazing difference to the use of the class that we didn't have before (like a 10x speed gain or something).  My main concern, however, is that the code was working, but now it isn't.\n\nHopefully I've given enough information, but if not feel free to ask."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7136\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-6608",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6608",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-6668",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6668",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-7286",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7286",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10340",
                    "id": 10340,
                    "description": "Mini Release",
                    "name": "1.8.4",
                    "userReleaseDate": "23\/Jun\/09",
                    "archived": false,
                    "releaseDate": "2009-06-23",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10072",
                    "id": 10072,
                    "name": "Zend_Date",
                    "description": "Zend_Date is the basic library for the handling of all date, time and calendar-related issues.",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10073",
                    "id": 10073,
                    "name": "Zend_Locale",
                    "description": "Zend_Locale is a basic wrapper for all I18N and L10N issues for the Zend Framework. It provides the userbasically with access to translation functionality. It can handle different source file types for translation.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32221",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "It does provide a performance boost of factor x15-20... returning one single cache entry instead of reading up to 3 xml files. But it will be reverted latest in 1.9 (within Locale_Data) as more people have a problem with non working cache that with performance on localization.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-06-26T13:37:50.000+0000",
                    "updated": "2009-06-26T13:37:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32222",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=admwiggin",
                        "name": "admwiggin",
                        "displayName": "Tianon Gravi",
                        "active": true
                    },
                    "body": "Thanks for your comments, Thomas.  I've added a couple of these other issues you've mentioned to the \"is related to\" links.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=admwiggin",
                        "name": "admwiggin",
                        "displayName": "Tianon Gravi",
                        "active": true
                    },
                    "created": "2009-06-26T13:41:50.000+0000",
                    "updated": "2009-06-26T13:41:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32228",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "IMHO, it's not a Zend_Cache issue (so I remove it as affected component). In your particular configuration, it's impossible to find automatically a tmp dir (working for Zend_Cache).\n\nIn 1.8.2, cache should fail silently (which was \"bad\").\n\nIn 1.8.4, if there is no automatically found tmp dir, an exception is thrown\n\nIMHO, Zend_Locale_Data should intercept this exception and deactivate the cache (in this particular case).\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2009-06-27T12:41:13.000+0000",
                    "updated": "2009-06-27T12:41:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32237",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "@Fabien:\nEven if it was bad behaviour... by changing your code to throw a new exception you integrated a BC.\nSuch changes are ONLY allowed within Minor Releases (1.9) and not within Bugfix Releases.\n\n@Tianon:\nUse Zend_Locale::disableCache(true) to disable the caching within Zend_Locale",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-06-28T01:35:41.000+0000",
                    "updated": "2009-06-28T01:35:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32275",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=admwiggin",
                        "name": "admwiggin",
                        "displayName": "Tianon Gravi",
                        "active": true
                    },
                    "body": "Update: I decided to dig a little bit more, and found that \/tmp did NOT have read permission for others, which does explain why everything worked just fine before, but once we started checking for read permission it stopped working.  Not that this really matters too much, but might be something to think about.  (I also noticed that our \/tmp directory is full of zend_cache---Zend_LocaleC_* type files, so it was definitely caching things properly, despite not being able to \"read\" the directory.)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=admwiggin",
                        "name": "admwiggin",
                        "displayName": "Tianon Gravi",
                        "active": true
                    },
                    "created": "2009-06-29T12:14:55.000+0000",
                    "updated": "2009-06-29T12:14:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32922",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "As per internal discussion we decided NOT to erase the default caching.\nAs with ZF 1.9 a migration note has been added to Zend_Locale.\n\nDisabling the default cache is still possible with disableCache(true);",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-07-25T08:00:38.000+0000",
                    "updated": "2009-07-25T08:00:38.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7136\/transitions"
}