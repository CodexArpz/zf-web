{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4040",
    "key": "ZF-4040",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Wildfire_Protocol_JsonStream->_encode using bad internal Zend_Json encoder"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4040\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-08-24T17:32:14.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peterr",
                "name": "peterr",
                "displayName": "Repeterr",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-08-22T17:55:27.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-08-24T17:32:14.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "h3.The problem\n{code}\n\/**\n * Encodes messages into the Wildfire JSON Stream Communication Protocol.\n *\/\nclass Zend_Wildfire_Protocol_JsonStream\n{   ...\n    \/\/ Use the JSON encoding scheme for the value specified\n    protected function _encode($value)\n    {\n        return Zend_Json_Encoder::encode($value);\n    }\n    ...\n}\n{code}\n\nWhy there's *Zend_Json{color:red}_Encoder{color}* here in place of *Zend_Json*?!\nSo I've got my UTF-8 debug output corrupted in FirePHP because of that.\n\nRemoving *_Encoder* lets Zend_Json::encode method to choose appropriate JSON encoding method according to PHP's *json_encode* function availability.\nAfter that my UTF-8 text displays correctly.\n\nh3.Test code with string in russian:\n{code}\n\/\/ in bootstrap\n$logger = new Zend_Log(new Zend_Log_Writer_Firebug());\nZend_Registry::set('log', $logger);\n\/\/ in controller\nZend_Registry::get('log')->debug('Some debug text in english is OK'); \/\/ that's OK\nZend_Registry::get('log')->debug('\u041e\u0442\u043b\u0430\u0434\u043e\u0447\u043d\u044b\u0439 \u0440\u0443\u0441\u0441\u043a\u0438\u0439 \u0442\u0435\u043a\u0441\u0442 \u0438\u0441\u043a\u0430\u0436\u0430\u0435\u0442\u0441\u044f!'); \/\/ that's corrupted\n{code}\nMay be there's a reason to file another bug on Zend_Json_Encoder's _encodeString method?\nBy the way, give a glance at FirePHP's main standalone class \"FirePHP.class.php\" and its \"json_encode\" method. It actually does the job right! May be ZJE->_encodeString should follow this example?"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4040\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                "name": "cadorn",
                "displayName": "Christoph Dorn",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10050",
                    "id": 10050,
                    "description": "Minor Release Candidate",
                    "name": "1.6.0RC2",
                    "userReleaseDate": "11\/Aug\/08",
                    "archived": true,
                    "releaseDate": "2008-08-11",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10330",
                    "id": 10330,
                    "name": "Zend_Wildfire",
                    "description": "Supports the Wildfire protocol and provide a log writer to add Wildfire debugging messages to response.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23620",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                        "name": "cadorn",
                        "displayName": "Christoph Dorn",
                        "active": true
                    },
                    "body": "That was an oversight. Thanks for pointing it out.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                        "name": "cadorn",
                        "displayName": "Christoph Dorn",
                        "active": true
                    },
                    "created": "2008-08-22T18:01:48.000+0000",
                    "updated": "2008-08-22T18:01:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23621",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                        "name": "cadorn",
                        "displayName": "Christoph Dorn",
                        "active": true
                    },
                    "body": "Can you add some test code that logs a message where the UTF-8 test does not display properly?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                        "name": "cadorn",
                        "displayName": "Christoph Dorn",
                        "active": true
                    },
                    "created": "2008-08-22T23:22:02.000+0000",
                    "updated": "2008-08-22T23:22:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23644",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                        "name": "cadorn",
                        "displayName": "Christoph Dorn",
                        "active": true
                    },
                    "body": "I have looked into json_encode and Zend_Json_Encoder in more detail.\n\nWhile json_encode detects recursion, it does not silently truncate the resulting JSON string but instead throws an exception. Zend_Json_Encoder on the other hand truncates it and still returns a valid JSON string.\n\nIt is very common to have cyclical relationships in your object graph which should get JSON encoded and sent to the client in a truncated fashion.\n\nThe best solution for the encoding would be to try json_encode first and if it fails fall back to Zend_Json_Encoder. This would mean that UTF8 encoded messages cannot contain cyclical object relationships.\n\nThe alternative would be to add UTF8 encoding support to Zend_Json_Encoder which would be great, but not practical as an immediate fix for this issue.\n\nSo would the fallback approach work for now until Zend_Json_Encoder supports UTF8 characters?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                        "name": "cadorn",
                        "displayName": "Christoph Dorn",
                        "active": true
                    },
                    "created": "2008-08-24T12:12:35.000+0000",
                    "updated": "2008-08-24T12:12:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23659",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                        "name": "cadorn",
                        "displayName": "Christoph Dorn",
                        "active": true
                    },
                    "body": "Looks like my tests were not correct.\n\njson_encode() nor Zend_Json_Encoder silently truncate cyclical relationships.\n\nI'll have to submit a patch for Zend_Json_Encoder to silence the cyclical exception.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                        "name": "cadorn",
                        "displayName": "Christoph Dorn",
                        "active": true
                    },
                    "created": "2008-08-24T14:40:13.000+0000",
                    "updated": "2008-08-24T14:40:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23663",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                        "name": "cadorn",
                        "displayName": "Christoph Dorn",
                        "active": true
                    },
                    "body": "Waiting for resolution of ZF-4053.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                        "name": "cadorn",
                        "displayName": "Christoph Dorn",
                        "active": true
                    },
                    "created": "2008-08-24T14:49:24.000+0000",
                    "updated": "2008-08-24T14:49:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23682",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                        "name": "cadorn",
                        "displayName": "Christoph Dorn",
                        "active": true
                    },
                    "body": "I have decided to stick with Zend_Json_Encoder and not try json_encode() first for the following reasons:\n\n1) Zend_Json_Encoder adds more detailed information (i.e. the class name) when it trims cyclical relationships\n{code}\n\"* RECURSION ([Class Name]) *\"\n{code}\n\n2) Zend_Json_Encoder adds class hint information to the JSON string\n{code}\n{\"__className\":\"[Class Name]\", ... }\n{code}\n\nZend_Wildfire_Protocol_JsonStream will support UTF-8 characters as soon as Zend_Json_Encoder supports them. See issue ZF-4054.\n\nTo speed up general support for UTF-8 characters, please lobby for ZF-4054.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                        "name": "cadorn",
                        "displayName": "Christoph Dorn",
                        "active": true
                    },
                    "created": "2008-08-24T17:30:40.000+0000",
                    "updated": "2008-08-24T17:30:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23683",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                        "name": "cadorn",
                        "displayName": "Christoph Dorn",
                        "active": true
                    },
                    "body": "The request is for UTF-8 character support. To accomplish this issue ZF-4054 must be resolved.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cadorn",
                        "name": "cadorn",
                        "displayName": "Christoph Dorn",
                        "active": true
                    },
                    "created": "2008-08-24T17:32:14.000+0000",
                    "updated": "2008-08-24T17:32:14.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4040\/transitions"
}