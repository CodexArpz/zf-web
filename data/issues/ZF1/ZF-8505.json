{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8505",
    "key": "ZF-8505",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Translate + GetText Plural Appears Broken with Locale with no plural form"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8505\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10360",
                    "id": 10360,
                    "description": "Minor Release",
                    "name": "1.10.0",
                    "userReleaseDate": "27\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-27",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-12-15T12:51:44.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cbkihong",
                "name": "cbkihong",
                "displayName": "Bernard Chan",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-12-09T03:12:54.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-12-15T12:51:48.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "As described on the subject header. I used sample PO files from the pootle project to test which I think are valid. I used plural() to get the plural form but the consistently returned some garbage byte when the plural() is used on a GetText message store and the language file does not support plural (i.e. same translation for singular\/plural forms). No such behaviour exists with languages supporting plural form (say, Spanish in my testing).\r\n\r\nI'm using Zend Framework 1.9.5. I came up with a quick fix that seems to patch the issue but not sure whether it broke anything else."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8505\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12480",
                    "filename": "pootle_es.mo",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cbkihong",
                        "name": "cbkihong",
                        "displayName": "Bernard Chan",
                        "active": true
                    },
                    "created": "2009-12-10T17:45:32.000+0000",
                    "size": 39632,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12480\/pootle_es.mo"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12474",
                    "filename": "pootle_es.po",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cbkihong",
                        "name": "cbkihong",
                        "displayName": "Bernard Chan",
                        "active": true
                    },
                    "created": "2009-12-09T03:19:34.000+0000",
                    "size": 92434,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12474\/pootle_es.po"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12479",
                    "filename": "pootle_zh_TW.mo",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cbkihong",
                        "name": "cbkihong",
                        "displayName": "Bernard Chan",
                        "active": true
                    },
                    "created": "2009-12-10T17:45:31.000+0000",
                    "size": 5245,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12479\/pootle_zh_TW.mo"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12473",
                    "filename": "pootle_zh_TW.po",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cbkihong",
                        "name": "cbkihong",
                        "displayName": "Bernard Chan",
                        "active": true
                    },
                    "created": "2009-12-09T03:19:33.000+0000",
                    "size": 70646,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12473\/pootle_zh_TW.po"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12475",
                    "filename": "zend_translate_plural_1_9_5.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cbkihong",
                        "name": "cbkihong",
                        "displayName": "Bernard Chan",
                        "active": true
                    },
                    "created": "2009-12-09T03:19:34.000+0000",
                    "size": 993,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12475\/zend_translate_plural_1_9_5.diff"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10380",
                    "id": 10380,
                    "description": "Mini Release",
                    "name": "1.9.5",
                    "userReleaseDate": "27\/Oct\/09",
                    "archived": false,
                    "releaseDate": "2009-10-27",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10099",
                    "id": 10099,
                    "name": "Zend_Translate",
                    "description": "Provides translation functionality, based on standards such as TMX and Gettext.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36820",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cbkihong",
                        "name": "cbkihong",
                        "displayName": "Bernard Chan",
                        "active": true
                    },
                    "body": "<?php\r\n\r\n    require_once('Zend\/Translate.php');\r\n\r\n    \/\/ This one is okay\r\n    $i18n = new Zend_Translate('gettext', 'pootle_es.mo', 'es');\r\n    printf($i18n->plural('%d file', '%d files', 5), 5); echo \"\\n\";\r\n\r\n    \/\/ This one is not\r\n    $i18n = new Zend_Translate('gettext', 'pootle_zh_TW.mo', 'zh_TW');\r\n    printf($i18n->plural('%d file', '%d files', 5), 5); echo \"\\n\";\r\n\r\n?>\r\n\r\nI have attached the diff that appeared to fix the issue for me.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cbkihong",
                        "name": "cbkihong",
                        "displayName": "Bernard Chan",
                        "active": true
                    },
                    "created": "2009-12-09T03:19:34.000+0000",
                    "updated": "2009-12-09T03:19:34.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36853",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "po files can not be used within ZF.\r\nCan you please attach the MO files you've created ?\r\n\r\nNote that they can differ according to the system where they have been created.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-12-10T07:27:24.000+0000",
                    "updated": "2009-12-10T07:27:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36858",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cbkihong",
                        "name": "cbkihong",
                        "displayName": "Bernard Chan",
                        "active": true
                    },
                    "body": "As you requested, here are the MO files I generated using msgfmt (GNU gettext-tools) 0.14.6, on Linux i686.\r\n\r\nHowever, does the PO looks sane to you too?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cbkihong",
                        "name": "cbkihong",
                        "displayName": "Bernard Chan",
                        "active": true
                    },
                    "created": "2009-12-10T17:45:32.000+0000",
                    "updated": "2009-12-10T17:45:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36869",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "If this is a problem or not is more a theoretic question than a real problem.\r\n\r\n'zh' or chinese has 2 plural forms...\r\nIt could eighter have NO plural at all\r\nOr it could have a \"more than one\" plural form.\r\n\r\nZF uses actually the \"more than one\" form.\r\n\r\nThe generic problem is, that the MO format provides no way to detect the used plural behind the set locale. The string from the PO file is not stored within the binary format.\r\n\r\nActually I see 2 ways for zh.\r\n1. Reroute zh to another locale which is not used in your application and also has no plural form.\r\n2. When zh is used, revert the counting number always to 0. This would work as the counting number itself is not output in the translation. So you could set counting number to 0 and translation number to 5\r\n\r\nAs zh is a 2 plural form locale (it is the ONLY one), I see actually no way for a smart solution.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-12-11T11:30:58.000+0000",
                    "updated": "2009-12-11T11:30:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36870",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "PS: Your \"fix\" breaks the component",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-12-11T11:31:58.000+0000",
                    "updated": "2009-12-11T11:31:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36927",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cbkihong",
                        "name": "cbkihong",
                        "displayName": "Bernard Chan",
                        "active": true
                    },
                    "body": "I have re-read your comments a number of times over the last few days but still it did not make too much sense to me.\r\n\r\n1. I'm not sure if I misunderstood, that on which basis did you assert that 'zh' has 2 plural forms. For all production POs I can find on Internet, the header is \"Plural-Forms: nplurals=1; plural=0;\\n\".\r\n\r\nThis one from the GNU gettext-tools package:\r\n\r\nhttp:\/\/git.savannah.gnu.org\/cgit\/gettext.git\/tree\/gettext-tools\/po\/zh_TW.po\r\n\r\n2. I'm not exactly sure which string you mentioned in PO files that are not stored in the corresponding MO. I tried compare a PO file, and a corresponding MO re-converted back to PO using msgunfmt, only the comments and source references got stripped off as expected (there were ordering differences but not significant I suppose?). All the header lines seem to remain intact. So, if the PO contains the data needed, so should the MO I suppose, otherwise how does msgunfmt get them? As the example PO\/MO I found were from other production projects verbatim, it is not apparent to me why the plural forms function properly in those environments but being impossible with Zend_Translate.\r\n\r\n3. Would you consider telling me explicitly how my diff broke the component? Of course every change must alter behavior in some way otherwise that is not a change at all, considering I thought the change \"fixed\" something? This plural issue is a blocker for me and with your information I can better judge whether to retain this fix locally even if that is not considered for inclusion in ZF, as I may not necessarily run into those scenarios that it may potentially break, so it may be acceptable to me if not to the library as a whole. Frankly speaking, I did not encounter any erratic behavior myself with English, Spanish and Chinese, those that I checked.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cbkihong",
                        "name": "cbkihong",
                        "displayName": "Bernard Chan",
                        "active": true
                    },
                    "created": "2009-12-14T19:33:47.000+0000",
                    "updated": "2009-12-14T19:33:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36928",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "{quote}\r\nI'm not sure if I misunderstood, that on which basis did you assert that 'zh' has 2 plural forms.\r\n{quote}\r\n\r\nPootle itself, which you referred to, defines 2 different plural forms for zh:\r\n\r\n1) zh  Chinese  {color:red}nplurals=1; plural=0{color}\r\n2) zh  Chinese  {color:red}nplurals=2; plural=(n > 1){color}\r\n\r\nThis is correct, as it depends on the translation which plural form is used.\r\n\r\n{quote}\r\nFor all production POs I can find on Internet, the header is \"Plural-Forms: nplurals=1; plural=0;\\n\".\r\n{quote}\r\n\r\nAs said before these informations are *not* stored within the binary *.mo file. You can read about this within the gnu project which defined the gettext standard: http:\/\/www.gnu.org\/software\/gettext\/\r\n\r\nPlural forms are only detected by the target language you define.\r\n\r\n{quote}\r\nI tried compare a PO file, and a corresponding MO re-converted back to PO using msgunfmt, only the comments and source references got stripped off as expected (there were ordering differences but not significant I suppose?). All the header lines seem to remain intact. So, if the PO contains the data needed, so should the MO I suppose, otherwise how does msgunfmt get them?\r\n{quote}\r\n\r\nYour expectations are wrong.\r\n\r\nmsgunfmt makes expectations based on the contained information, some environment detections and some informations you give.\r\n\r\nAs said before the *.mo format does not include the header informations. You can inform yourself about contained information with the above link.\r\n\r\n{quote}\r\nWould you consider telling me explicitly how my diff broke the component? \r\n{quote}\r\n\r\nTo clearify:\r\nYour change does not work.\r\nWhen I change your code, so it would work, it breaks working for some cases.\r\n\r\nAs said before the ONLY correct ways are to use a locale with the plural rules you need f.e. 'vi' or 'ka'\r\nOR to fix the numbering when you don't want to have plurals as described before.\r\n\r\n\r\nNote:\r\nI did not close this issue. But what you reported is not a bug, as the component works as expected.\r\n\r\nStill, I will look if there is a way to allow selection of the used plural form. This is an improvement and not a bug!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-12-15T00:43:45.000+0000",
                    "updated": "2009-12-15T00:44:33.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36947",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Closing this one as \"non-issue\".\r\nThe component works correct.\r\n\r\nJust the plural definitions are not identical with those from the given PO file.\r\n\r\nWith r19669 it is possible to define own plurals when there is no matching one or you want to overwrite the existing ones.\r\n\r\nThe given patch must not be applied.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-12-15T12:51:44.000+0000",
                    "updated": "2009-12-15T12:51:44.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8505\/transitions"
}