{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11392",
    "key": "ZF-11392",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "UNION"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11392\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/3",
                "name": "Duplicate"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-08-14T12:08:31.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=primolan",
                "name": "primolan",
                "displayName": "Rodrigo Novelo Primolan",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-05-20T15:00:22.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-08-14T12:08:31.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "mysql",
                "select",
                "union",
                "zend_db_select"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Line 295 should be change from:\r\n\r\n$this->_parts[self::UNION][] = array($target, $type);\r\n\r\nTo:\r\n\r\n$this->_parts[self::UNION][] = array(\"({$target})\", $type);\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/1",
                "name": "Blocker"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11392\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "zf-crteam-padraic",
                "zf-crteam-priority"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                "name": "padraic",
                "displayName": "P\u00e1draic Brady",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-4338",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4338",
                    "type": {
                        "name": "Duplicate",
                        "direction": "OUTBOUND",
                        "description": "duplicates"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/14332",
                    "filename": "ZF-11392.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-05-28T06:35:46.000+0000",
                    "size": 343,
                    "mimeType": "text\/x-patch",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/14332\/ZF-11392.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10580",
                    "id": 10580,
                    "description": "Mini Release",
                    "name": "1.11.6",
                    "userReleaseDate": "05\/May\/11",
                    "archived": false,
                    "releaseDate": "2011-05-05",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10132",
                    "id": 10132,
                    "name": "Zend_Db_Select",
                    "description": "OO interface to building a SELECT SQL query.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46835",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ludwig",
                        "name": "ludwig",
                        "displayName": "Christian Ludwig",
                        "active": true
                    },
                    "body": "There might be some explanation needed.\r\n\r\nWithout the parentheses you get the wrong results i. e. when you want to order the complete query.\r\n\r\nThe example in the documentation ([http:\/\/framework.zend.com\/manual\/en\/zend.db.select.html#zend.db.select.building.union])\r\n\r\n{noformat}\r\n    $sql1 = $db->select();\r\n    $sql2 = \"SELECT ...\";\r\n     \r\n    $select = $db->select()\r\n        ->union(array($sql1, $sql2))\r\n        ->order(\"id\");\r\n{noformat}\r\n\r\nthis will output something like:\r\n{noformat}SELECT FROM ... UNION SELECT FROM ... ORDER BY `id`;{noformat}\r\nSo the ORDER BY will only sort the second query!\r\n\r\nWith the path it will work as expected and output:\r\n{noformat}(SELECT FROM ...) UNION (SELECT FROM ...) ORDER BY `id`;{noformat}\r\n\r\nHere once more the patch:\r\n{noformat}\r\ndiff U3B \/Zend\/Db\/Select.php\r\n--- Select.php 23775 2011-03-01 17:25:24Z ralph\r\n+++ Select.php Working Copy\r\n@@ -292,7 +292,7 @@\r\n         }\r\n \r\n         foreach ($select as $target) {\r\n-            $this->_parts[self::UNION][] = array($target, $type);\r\n+            $this->_parts[self::UNION][] = array('(' . $target . ')', $type);\r\n         }\r\n \r\n         return $this;\r\n{noformat}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ludwig",
                        "name": "ludwig",
                        "displayName": "Christian Ludwig",
                        "active": true
                    },
                    "created": "2011-05-27T15:20:55.000+0000",
                    "updated": "2011-05-27T15:20:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46843",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "I can see from mysql docs that parentheses are required, but still tried to write a unit test to see that the current code will fail. However couldn't make it happen. Could you help me with that? I modified {{_selectUniontString()}} method in {{tests\/Zend\/Db\/Select\/TestCommon.php}} and got the query like this\r\n\r\n{code}\r\nSELECT `bug_id` AS `id`, `assigned_to` AS `name` FROM `zfbugs` UNION SELECT `product_id` AS `id`, `product_name` AS `name` FROM `zfproducts` ORDER BY `name` ASC\r\n{code}\r\n\r\nand result like this\r\n\r\n{code}\r\nArray\r\n(\r\n    [0] => Array\r\n        (\r\n            [id] => 4\r\n            [name] => goofy\r\n        )\r\n\r\n    [1] => Array\r\n        (\r\n            [id] => 2\r\n            [name] => Linux\r\n        )\r\n\r\n    [2] => Array\r\n        (\r\n            [id] => 3\r\n            [name] => mmouse\r\n        )\r\n\r\n    [3] => Array\r\n        (\r\n            [id] => 1\r\n            [name] => mmouse\r\n        )\r\n\r\n    [4] => Array\r\n        (\r\n            [id] => 2\r\n            [name] => mmouse\r\n        )\r\n\r\n    [5] => Array\r\n        (\r\n            [id] => 3\r\n            [name] => OS X\r\n        )\r\n\r\n    [6] => Array\r\n        (\r\n            [id] => 1\r\n            [name] => Windows\r\n        )\r\n{code}\r\n\r\nLooks correct for me.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-05-27T17:27:10.000+0000",
                    "updated": "2011-05-27T17:27:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46853",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ludwig",
                        "name": "ludwig",
                        "displayName": "Christian Ludwig",
                        "active": true
                    },
                    "body": "I don't know what your data source is looking like, but the parentheses should always be there. Think about a query where you want to order the results of the second select of the UNION only.\r\n{noformat}\r\n(SELECT FROM ...) UNION (SELECT FROM ... ORDER BY `id`);\r\n{noformat}\r\nWithout parentheses it would end up in your query\r\n{noformat}\r\nSELECT FROM ... UNION SELECT FROM ... ORDER BY `id`;\r\n{noformat}\r\nOr use a LIMIT for your tests:\r\n{noformat}\r\n(SELECT FROM ...) UNION (SELECT FROM ... ORDER BY `id` LIMIT 1);\r\n{noformat}\r\nagainst\r\n{noformat}\r\n(SELECT FROM ...) UNION (SELECT FROM ...) ORDER BY `id` LIMIT 1;\r\n{noformat}\r\n ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ludwig",
                        "name": "ludwig",
                        "displayName": "Christian Ludwig",
                        "active": true
                    },
                    "created": "2011-05-27T22:03:16.000+0000",
                    "updated": "2011-05-27T22:03:16.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46856",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "Patch file attached as suggested by the author. Couldn't make a unit test though. Seems like this cannot be reproduced with the current test data.\n\nChristian - thank you for the explanation.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-05-28T06:35:46.000+0000",
                    "updated": "2011-05-28T06:35:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46887",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "Ok, looks like we still need the test. The test below cannot reproduce the issue atm. and should be fixed to do so. I'm pretty sure that I'm missing something and doing it wrong. You can find test data source from {{tests\/Db\/TestUtil\/Common.php}}.\r\n\r\n{code}\r\n    \/** @group ZF-11392 *\/\r\n    protected function _selectUnionStringWhichFailsIfParenthesesAreNotUsed()\r\n    {\r\n        $bugs = $this->_db->quoteIdentifier('zfbugs');\r\n        $bug_id = $this->_db->quoteIdentifier('bug_id');\r\n        $bug_assigned = $this->_db->quoteIdentifier('assigned_to');\r\n        $products = $this->_db->quoteIdentifier('zfproducts');\r\n        $product_id = $this->_db->quoteIdentifier('product_id');\r\n        $product_name = $this->_db->quoteIdentifier('product_name');\r\n        $id = $this->_db->quoteIdentifier('id');\r\n        $name = $this->_db->quoteIdentifier('name');\r\n        $sql1 = \"SELECT $bug_id AS $id, $bug_assigned AS $name FROM $bugs\";\r\n        $sql2 = \"SELECT $product_id AS $id, $product_name AS $name FROM $products\";\r\n\r\n        $select = $this->_db->select()\r\n            ->union(array($sql1, $sql2))\r\n            ->order('name');\r\n        return $select;\r\n    }\r\n\r\n    \/** @group ZF-11392 *\/\r\n    public function testSelectUnionStringHasToHaveParentheses()\r\n    {\r\n        $select = $this->_selectUnionStringWhichFailsIfParenthesesAreNotUsed();\r\n        $stmt = $this->_db->query($select);\r\n        $result = $stmt->fetchAll();\r\n-->     $this->assertEquals('goofy', $result[0]['name']); \/\/ should fail without the patch, i'm expecting 'mmouse'\r\n        \/\/echo $select;\r\n        \/\/print_r($result);\r\n    }\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-05-28T20:47:17.000+0000",
                    "updated": "2011-05-28T20:47:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46913",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "body": "See the comment by Christoph Roensch from ZF-4338 ...\r\n\r\nbq. I [believe|http:\/\/stackoverflow.com\/questions\/4653124\/what-does-the-sql-standard-say-about-parentheses-in-sql-union-except-intersect-st] this is non-standard SQL, because of that it cannot be included in Zend_Db_Select.\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kblomqvist",
                        "name": "kblomqvist",
                        "displayName": "Kim Blomqvist",
                        "active": true
                    },
                    "created": "2011-05-30T15:05:32.000+0000",
                    "updated": "2011-05-30T15:05:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47944",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                        "name": "padraic",
                        "displayName": "P\u00e1draic Brady",
                        "active": true
                    },
                    "body": "Marked as Won't Fix on the basis of:\n\n1. This is not standard SQL and is MySQL specific\n2. A known workaround exists and the fix would breach backwards compatibility.\n3. This is also a duplicate issue (duplicated issue resolved on same basis as above).\n\nReporters and Assignee are recommended to fix in ZF2 if still a problem - or open a ZF2 issue in its respect.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=padraic",
                        "name": "padraic",
                        "displayName": "P\u00e1draic Brady",
                        "active": true
                    },
                    "created": "2011-08-14T12:08:31.000+0000",
                    "updated": "2011-08-14T12:08:31.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11392\/transitions"
}