{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10970",
    "key": "ZF-10970",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Mail does not create multipart\/alternative messages with plain+HTML where the HTML has embedded images."
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/11",
                "name": "Patch",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10970\/votes",
                "votes": 2,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coling",
                "name": "coling",
                "displayName": "Colin Guthrie",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-01-20T06:34:52.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-09-01T11:29:59.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Hi,\r\n\r\nWhen converting a system I currently use to one based on Zend_Mail I discovered that it was not possible to create a message that had two primary parts (plain text and HTML) where the HTML part itself was really a multipart\/related section containing the HTML and all the images it uses. My existing system did this, so I decided to \"make it so\" with Zend_Mail.\r\n\r\nI have patched things in a way that is fully backwards compatible with the current usage (I've not actually run the unit tests but if none of the new APIs are called the old behaviour is preserved so I'm quite confident they will pass!).\r\n\r\nIt can be used in the following way:\r\n{quote}\r\n<?php\r\n\r\n$transport = new Zend_Mail_Transport_Smtp('localhost');\r\nZend_Mail::setDefaultTransport($transport);\r\n\r\n$mail = new Zend_Mail('utf-8');\r\n$mail->setFrom(\"apache@localhost.localdomain\", \"Jonathon Livingston Seagull\");\r\n$mail->addTo('user@localhost');\r\n$mail->setSubject('Test Email');\r\n\r\n\r\n$mail->setBodyText('Hello world.');\r\n\r\n$url = dirname(__FILE__).'\/world.jpg';\r\n$cid = md5($url);\r\n$jpg = file_get_contents($url);\r\n$mail->setBodyHtml('<html><body><p>Hello world<\/p><img src=\"cid:'.$cid.'\" \/><\/body><\/html>');\r\n$mail->createHtmlRelatedAttachment($jpg, $cid, 'image\/jpeg', Zend_Mime::DISPOSITION_INLINE, Zend_Mime::ENCODING_BASE64, 'world.jpg');\r\n\r\n$mail->send();\r\n\r\n{quote}\r\n\r\n\r\n\r\nIt should deal gracefully with HTML+Related Images (i.e. no plain text component) by forcing the type of the mail itself to multipart\/related.\r\n\r\nIt seems that someone (Ivan) basically asked this same question on the comments page for Zend_Mail just the other day so it seems I'm not alone!\r\nhttp:\/\/framework.zend.com\/manual\/en\/zend.mail.attachments.html"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10970\/watchers",
                "isWatching": false,
                "watchCount": 5
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                "name": "freak",
                "displayName": "Dolf Schimmel (Freeaqingme)",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13602",
                    "filename": "zend-mail-multipart-related-html.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coling",
                        "name": "coling",
                        "displayName": "Colin Guthrie",
                        "active": true
                    },
                    "created": "2011-01-20T07:21:14.000+0000",
                    "size": 8093,
                    "mimeType": "text\/x-patch",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13602\/zend-mail-multipart-related-html.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10520",
                    "id": 10520,
                    "description": "Mini Release",
                    "name": "1.11.2",
                    "userReleaseDate": "30\/Dec\/10",
                    "archived": false,
                    "releaseDate": "2010-12-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10018",
                    "id": 10018,
                    "name": "Zend_Mail",
                    "description": "high-level utility to build MIME-compliant messages and send using a mail transport adapter",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44074",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coling",
                        "name": "coling",
                        "displayName": "Colin Guthrie",
                        "active": true
                    },
                    "body": "Patch to implement this new feature.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coling",
                        "name": "coling",
                        "displayName": "Colin Guthrie",
                        "active": true
                    },
                    "created": "2011-01-20T06:37:29.000+0000",
                    "updated": "2011-01-20T06:37:29.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44076",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coling",
                        "name": "coling",
                        "displayName": "Colin Guthrie",
                        "active": true
                    },
                    "body": "I noticed a typo in my original code after a refactor... count() was still included after pushing it out to a variable rather than checking the array directly. Very minor change.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coling",
                        "name": "coling",
                        "displayName": "Colin Guthrie",
                        "active": true
                    },
                    "created": "2011-01-20T07:21:14.000+0000",
                    "updated": "2011-01-20T07:21:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/45462",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coling",
                        "name": "coling",
                        "displayName": "Colin Guthrie",
                        "active": true
                    },
                    "body": "Ping? Some kind of feedback would be nice :)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coling",
                        "name": "coling",
                        "displayName": "Colin Guthrie",
                        "active": true
                    },
                    "created": "2011-03-09T04:21:27.000+0000",
                    "updated": "2011-03-09T04:21:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/45797",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mkliewe",
                        "name": "mkliewe",
                        "displayName": "Michael Kliewe",
                        "active": true
                    },
                    "body": "Thank you Colin for this nice patch, I also had the problem to attach inline images, and your code produces mails that are more compatible to mail clients.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mkliewe",
                        "name": "mkliewe",
                        "displayName": "Michael Kliewe",
                        "active": true
                    },
                    "created": "2011-04-04T13:59:42.000+0000",
                    "updated": "2011-04-04T13:59:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/45856",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=paulb",
                        "name": "paulb",
                        "displayName": "Paul Brand",
                        "active": true
                    },
                    "body": "Thanks a lot, Colin. Your patch solved an issue with inline images in a HTML mail in Mail on OSX.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=paulb",
                        "name": "paulb",
                        "displayName": "Paul Brand",
                        "active": true
                    },
                    "created": "2011-04-12T08:14:36.000+0000",
                    "updated": "2011-04-12T08:14:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46474",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lfms",
                        "name": "lfms",
                        "displayName": "Walter Hop",
                        "active": true
                    },
                    "body": "The author of this patch is a god amongst men.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lfms",
                        "name": "lfms",
                        "displayName": "Walter Hop",
                        "active": true
                    },
                    "created": "2011-05-05T20:15:57.000+0000",
                    "updated": "2011-05-05T20:15:57.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46475",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coling",
                        "name": "coling",
                        "displayName": "Colin Guthrie",
                        "active": true
                    },
                    "body": "While I appreciate the kudos, I believe gods have the ability to commit to upstream subversion, but sadly I do not. I cannot even smite the maintainer for not acknowledging it thus far... :p",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coling",
                        "name": "coling",
                        "displayName": "Colin Guthrie",
                        "active": true
                    },
                    "created": "2011-05-05T20:55:41.000+0000",
                    "updated": "2011-05-05T20:55:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48304",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tche",
                        "name": "tche",
                        "displayName": "Tche",
                        "active": true
                    },
                    "body": "Very good. Thanks Colin. It saved my day. Multipart\/related is definitely required for some mail clients (Thunderbird at least).\r\n\r\nI just had one issue when patching in Eclipse. \r\nIf you get the error \"Call to a member function getParts() on a non-object in ... Abstract.php on line 239\". It just means that the patch partially succeeded on Mail.php file. \r\nYou have to add this line to the __contruct():\r\n $this->_htmlRelatedAttachments = new Zend_Mime_Message();",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tche",
                        "name": "tche",
                        "displayName": "Tche",
                        "active": true
                    },
                    "created": "2011-09-01T11:29:59.000+0000",
                    "updated": "2011-09-01T11:29:59.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10970\/transitions"
}