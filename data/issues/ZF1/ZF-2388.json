{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2388",
    "key": "ZF-2388",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Mysqli: Statement object cannot be reused (again)"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2388\/votes",
                "votes": 6,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10530",
                    "id": 10530,
                    "description": "Mini Release",
                    "name": "1.11.3",
                    "userReleaseDate": "01\/Feb\/11",
                    "archived": false,
                    "releaseDate": "2011-02-01",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-01-22T08:40:45.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gw128",
                "name": "gw128",
                "displayName": "Mike Wossen",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-01-07T04:45:40.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-01-22T08:40:46.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "h3. Problem\n\nFixing issue ZF-1778 created new issue:\n\n{code:title=Testcase.php|borderStyle=solid}\n$db = Zend_Db::factory('mysqli', ...);\n\n$stmt1 = $db->prepare('UPDATE A SET B=?');\n$result1 = $stmt1->execute(array('1'));\n\n$stmt2 = $db->prepare('UPDATE B SET C=?');\n$result2 = $stmt2->execute(array('2'));\n\n\/\/ this will fail (return false), because initiating stmt2 will close stmt1.\n$result3 = $stmt1->execute(array('3'));\n{code}\n\n\nh3. Solution\n\nZend\/Db\/Adapter\/Mysqli.php\n\n{code:title=Current code|borderStyle=solid}\n\/**\n* Prepare a statement and return a PDOStatement-like object.\n*\n* @param  string  $sql  SQL query\n* @return Zend_Db_Statement_Mysqli\n*\/\npublic function prepare($sql)\n{\n\t$this->_connect();\n\tif ($this->_stmt) {\n\t    $this->_stmt->close();\n\t}\n\t$stmt = new Zend_Db_Statement_Mysqli($this, $sql);\n\tif ($stmt === false) {\n\t    return false;\n\t}\n\t$stmt->setFetchMode($this->_fetchMode);\n\t$this->_stmt = $stmt;\n\treturn $stmt;\n}\n{code}\n\nshould be changed back to ( version commit [pre 5906|http:\/\/framework.zend.com\/fisheye\/viewrep\/Zend_Framework\/branch\/release-1.0\/library\/Zend\/Db\/Adapter\/Mysqli.php?r1=5867&r2=5906]):\n\n\n{code:title=Fixed code|borderStyle=solid}\n\/**\n* Prepare a statement and return a PDOStatement-like object.\n*\n* @param  string  $sql  SQL query\n* @return Zend_Db_Statement_Mysqli\n*\/\npublic function prepare($sql)\n{\n\t$this->_connect();\n\t$stmt = new Zend_Db_Statement_Mysqli($this, $sql);\n\tif ($stmt === false) {\n\t    return false;\n\t}\n\t$stmt->setFetchMode($this->_fetchMode);\n\treturn $stmt;\n}\n{code}\n\nh3. Should be reconsidered\n\nNB! Fixing this problem rises ZF-1778 again, thus logic should be reconsidered.\n\nIMHO \"Fixed code\" is more correct because same logic is used in pdo abstraction class Zend\/Db\/Adapter\/Pdo\/Abstract.php\n\n{code:title=Abstract.php|borderStyle=solid}\n\/**\n* Prepares an SQL statement.\n*\n* @param string $sql The SQL statement with placeholders.\n* @param array $bind An array of data to bind to the placeholders.\n* @return PDOStatement\n*\/\npublic function prepare($sql)\n{\n\t$this->_connect();\n\t$stmt = new Zend_Db_Statement_Pdo($this, $sql);\n\t$stmt->setFetchMode($this->_fetchMode);\n\treturn $stmt;\n}\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/6",
                "name": "N\/A"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2388\/watchers",
                "isWatching": false,
                "watchCount": 6
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10031",
                    "id": 10031,
                    "description": "Major Release",
                    "name": "1.0.0",
                    "userReleaseDate": "30\/Jun\/07",
                    "archived": true,
                    "releaseDate": "2007-06-30",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10110",
                    "id": 10110,
                    "description": "Mini Release",
                    "name": "1.0.1",
                    "userReleaseDate": "30\/Jul\/07",
                    "archived": true,
                    "releaseDate": "2007-07-30",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10130",
                    "id": 10130,
                    "description": "Mini Release",
                    "name": "1.0.2",
                    "userReleaseDate": "25\/Sep\/07",
                    "archived": true,
                    "releaseDate": "2007-09-25",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10140",
                    "id": 10140,
                    "description": "Mini Release",
                    "name": "1.0.3",
                    "userReleaseDate": "30\/Nov\/07",
                    "archived": true,
                    "releaseDate": "2007-11-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10131",
                    "id": 10131,
                    "name": "Zend_Db_Adapter_Mysqli",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/20317",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Please categorize\/fix as needed.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-03-25T20:43:55.000+0000",
                    "updated": "2008-03-25T20:43:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/27856",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "body": "the questions is wheather ZF-1778 also appears for PDO. I think it only works when using with mysql and set to unbuffered resultsets. I will try maybe...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=beberlei",
                        "name": "beberlei",
                        "displayName": "Benjamin Eberlei",
                        "active": true
                    },
                    "created": "2009-01-07T16:45:38.000+0000",
                    "updated": "2009-01-07T16:45:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28150",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Reassigning to Ralph to bring closure to this issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2009-01-13T10:34:30.000+0000",
                    "updated": "2009-01-13T10:34:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44014",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vipsoft",
                        "name": "vipsoft",
                        "displayName": "Anthon Pang, VIP Software Technologies Inc.",
                        "active": true
                    },
                    "body": "It would be nice to get this fixed, as it's contrary to advice given. (see ZF-10930)\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vipsoft",
                        "name": "vipsoft",
                        "displayName": "Anthon Pang, VIP Software Technologies Inc.",
                        "active": true
                    },
                    "created": "2011-01-12T09:54:36.000+0000",
                    "updated": "2011-01-12T09:54:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44121",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "This is a limitation in mysqli, not Zend_Db.  Mysqli can only have a single buffered statement open at a time, that is why the previous statement must be closed before a new one can be utilized.  This is the reason why mysqli_multi_query().  In order for us to be able to accomplish this, we'd have to do a dance with mysqli_store_result() inbetween preparations.  Since we have no context for how you are using the Statement or more specifically, how much data you have in a result set, we cannot simply assume that you'd like to store that in PHP space (as opposed to keeping the data inside the mysql connection).\r\n\r\nLong story short, if you need multiple statements at once, you should be looking at PDO.\r\n\r\n-ralph",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2011-01-22T08:40:45.000+0000",
                    "updated": "2011-01-22T08:40:45.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2388\/transitions"
}