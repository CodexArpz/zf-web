{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10487",
    "key": "ZF-10487",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "ZendAMF serialization slow? - Supplied patch not applied"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/21",
                "name": "Performance Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10487\/votes",
                "votes": 4,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10530",
                    "id": 10530,
                    "description": "Mini Release",
                    "name": "1.11.3",
                    "userReleaseDate": "01\/Feb\/11",
                    "archived": false,
                    "releaseDate": "2011-02-01",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-06-03T21:20:58.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mreiden",
                "name": "mreiden",
                "displayName": "Mark Reidenbach",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-09-22T14:04:32.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-06-18T03:07:48.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I've compared ZendAMF to AMFPHP, by returning a dataset with 5000+ rows from a table, using the exact same code (both in PHP, and AS3).  ZendAMF averages a 16 second return time, whereas AMFPHP returns in 3 seconds.  I'm guessing the added time is coming from the process of serializing data to send back to Flash."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10487\/watchers",
                "isWatching": false,
                "watchCount": 4
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-7493",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7493",
                    "type": {
                        "name": "Duplicate",
                        "direction": "OUTBOUND",
                        "description": "duplicates"
                    }
                },
                {
                    "issueKey": "ZF-8186",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8186",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13310",
                    "filename": "Amf.Combined-NoObjectsByRef.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mreiden",
                        "name": "mreiden",
                        "displayName": "Mark Reidenbach",
                        "active": true
                    },
                    "created": "2010-09-22T14:04:36.000+0000",
                    "size": 20004,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13310\/Amf.Combined-NoObjectsByRef.diff"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13311",
                    "filename": "Amf.data-as-refs.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mreiden",
                        "name": "mreiden",
                        "displayName": "Mark Reidenbach",
                        "active": true
                    },
                    "created": "2010-09-22T14:04:45.000+0000",
                    "size": 17239,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13311\/Amf.data-as-refs.diff"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13312",
                    "filename": "Amf.noref-writeString.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mreiden",
                        "name": "mreiden",
                        "displayName": "Mark Reidenbach",
                        "active": true
                    },
                    "created": "2010-09-22T14:04:45.000+0000",
                    "size": 537,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13312\/Amf.noref-writeString.diff"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13313",
                    "filename": "Amf.perform.ref-writeString-1.10.5.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mreiden",
                        "name": "mreiden",
                        "displayName": "Mark Reidenbach",
                        "active": true
                    },
                    "created": "2010-09-22T14:04:45.000+0000",
                    "size": 1223,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13313\/Amf.perform.ref-writeString-1.10.5.patch"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13314",
                    "filename": "Amf.perform.ref-writeString.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mreiden",
                        "name": "mreiden",
                        "displayName": "Mark Reidenbach",
                        "active": true
                    },
                    "created": "2010-09-22T14:04:45.000+0000",
                    "size": 730,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13314\/Amf.perform.ref-writeString.diff"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13316",
                    "filename": "Amf.ResponseTest.php.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mreiden",
                        "name": "mreiden",
                        "displayName": "Mark Reidenbach",
                        "active": true
                    },
                    "created": "2010-09-22T14:04:45.000+0000",
                    "size": 1268,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13316\/Amf.ResponseTest.php.diff"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13315",
                    "filename": "Amf.Response_Body_By_Value.diff",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mreiden",
                        "name": "mreiden",
                        "displayName": "Mark Reidenbach",
                        "active": true
                    },
                    "created": "2010-09-22T14:04:45.000+0000",
                    "size": 852,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13315\/Amf.Response_Body_By_Value.diff"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13317",
                    "filename": "largeArrayData.bin",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mreiden",
                        "name": "mreiden",
                        "displayName": "Mark Reidenbach",
                        "active": true
                    },
                    "created": "2010-09-22T14:04:45.000+0000",
                    "size": 632254,
                    "mimeType": "application\/octet-stream",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13317\/largeArrayData.bin"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10490",
                    "id": 10490,
                    "description": "Mini Release",
                    "name": "1.10.8",
                    "userReleaseDate": "25\/Aug\/10",
                    "archived": false,
                    "releaseDate": "2010-08-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10350",
                    "id": 10350,
                    "name": "Zend_Amf",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42335",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mreiden",
                        "name": "mreiden",
                        "displayName": "Mark Reidenbach",
                        "active": true
                    },
                    "body": "I cloned bug ZF-7493 in hopes that having a bug that has not been \"fixed\" will get someone to notice that the correct patch has not been applied yet.\r\n\r\nPlease apply patch \"Amf.perform.ref-writeString-1.10.5.patch\".",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mreiden",
                        "name": "mreiden",
                        "displayName": "Mark Reidenbach",
                        "active": true
                    },
                    "created": "2010-09-22T14:10:50.000+0000",
                    "updated": "2010-09-22T14:10:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43235",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Re-assigning to wade to have a look at suggested fix.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2010-11-21T07:21:52.000+0000",
                    "updated": "2010-11-21T07:21:52.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43786",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ogrethegreat",
                        "name": "ogrethegreat",
                        "displayName": "Ogre The Great",
                        "active": true
                    },
                    "body": "In addition to Mark's patch, the issue also effects Object serialization. Even with Mark's patch if one is encoding a large dataset of objects, the issue still appears. I've taken Mark's logic and used spl_object_hash() to get vastly improved performance for my needs. In essence, the performance drops exponentially as size of the array increases. Its even worse with the object array_search than it is with strings. I went ahead and put up the diff but this piece should probably be fixed to use SPL where available and otherwise require a UUID on any object passed to the serializer or some other logic along the lines. Point being is to build a hash to search on rather than exhaustive object comparison. Note this diff is based on the original. Mark made some other changes to pass the marker type which are not shown here. \r\n\r\n@@ -386,7 +386,7 @@ \r\n             $object = &$objectByVal; \r\n         } \r\n  \r\n- $ref = array_search($object, $this->_referenceObjects,true); \r\n+ $ref = array_key_exists(spl_object_hash($object), $this->_referenceObjects) ? $this->_referenceObjects[spl_object_hash($object)] : false; \r\n  \r\n         \/\/ quickly handle object references \r\n         if ($ref !== false){ \r\n@@ -394,7 +394,7 @@ \r\n             $this->writeInteger($ref); \r\n             return true; \r\n         } \r\n- $this->_referenceObjects[] = $object; \r\n+ $this->_referenceObjects[spl_object_hash($object)] = count($this->_referenceObjects); \r\n         return false; \r\n     }\r\n \r\n \r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ogrethegreat",
                        "name": "ogrethegreat",
                        "displayName": "Ogre The Great",
                        "active": true
                    },
                    "created": "2010-12-21T09:47:38.000+0000",
                    "updated": "2010-12-21T09:47:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44208",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I've applied both Mark's patch as well as the improvements suggested in the previous comment (with minor modifications -- I store the object hash locally so it doesn't need to be computed multiple times). The changes are in trunk in r23682. Please test, and, if the changes pose no issues AS WELL AS demonstrate better performance, please post a comment so I can merge to the 1.11 release branch.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2011-01-28T09:55:17.000+0000",
                    "updated": "2011-01-28T09:55:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46892",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Can someone test this?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2011-05-28T21:39:08.000+0000",
                    "updated": "2011-05-28T21:39:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46963",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mreiden",
                        "name": "mreiden",
                        "displayName": "Mark Reidenbach",
                        "active": true
                    },
                    "body": "I checked out revision 24104 and everything works for our project.  It also looks like Amf.perform.ref-writeString-1.10.5.patch is included in ZF 1.11.7 so this bug could be closed?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mreiden",
                        "name": "mreiden",
                        "displayName": "Mark Reidenbach",
                        "active": true
                    },
                    "created": "2011-06-03T15:08:17.000+0000",
                    "updated": "2011-06-03T15:08:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46967",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Marking as resolved, as patch was merged in time for 1.11.3.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2011-06-03T21:20:58.000+0000",
                    "updated": "2011-06-03T21:20:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47201",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=doobywho",
                        "name": "doobywho",
                        "displayName": "Ryan Masten",
                        "active": true
                    },
                    "body": "I am still having horrible performance. What took 200ms on AMFPHP takes 5s on ZendAMF 1.11.7\r\nThoughts?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=doobywho",
                        "name": "doobywho",
                        "displayName": "Ryan Masten",
                        "active": true
                    },
                    "created": "2011-06-16T02:42:57.000+0000",
                    "updated": "2011-06-16T02:42:57.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47214",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jcrocks",
                        "name": "jcrocks",
                        "displayName": "pt",
                        "active": true
                    },
                    "body": "X2 on this comment => \"I am still having horrible performance. What took 200ms on AMFPHP takes 5s on ZendAMF 1.11.7\"\r\n\r\nReturning small simple arrays is fine but other than that, very slow. Returning ~200 objects with some properties containing objects takes about 5 seconds. It's not the function that creates the objects either. I capture the micro-time at the beginning of the function and immediately before the return and it's less than half a second. So it takes 4.5 seconds to return the objects to Flex.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jcrocks",
                        "name": "jcrocks",
                        "displayName": "pt",
                        "active": true
                    },
                    "created": "2011-06-18T03:07:48.000+0000",
                    "updated": "2011-06-18T03:07:48.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10487\/transitions"
}