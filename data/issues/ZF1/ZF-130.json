{
    "expand": "html",
    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-130",
    "key": "ZF-130",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "the incubator version of Zend_Http_Client don't support \"Transfer-Encoding: chunked\""
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issueType\/11",
                "name": "Patch",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-130\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/version\/10000",
                    "id": 10000,
                    "description": "Preview Release",
                    "name": "0.1.4",
                    "userReleaseDate": "29\/Jun\/06",
                    "archived": true,
                    "releaseDate": "2006-06-29",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2006-06-24T23:37:22.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=ishinao",
                "name": "ishinao",
                "displayName": "Naoto Ishikawa",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2006-06-22T00:49:15.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-05T14:44:29.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "The incubator version of Zend_Http_Client uses HTTP\/1.1 by default setting,\nbut it does not support Transfer-Encoding: chunked decoding.\n\nRFC2068#3.6 ( http:\/\/rfc.net\/rfc2068.html#s3.6 )\n> All HTTP\/1.1 applications MUST be able to receive and decode the\n>  \"chunked\" transfer coding\n\nFor example Amazon ECS with REST API returns chunked encoded response, \nif client requests using HTTP\/1.1.\n\nI wrote Zend_Http_Client::_read to support chunked encoding.\n\n    protected function _read($socket)\n    {\n        $response = '';\n\n        $transferEncodings = array();\n\n        \/\/ read headers\n        while (!feof($socket)) {\n            $buff = fgets($socket);\n            $response .= $buff;\n            if (trim($buff, \"\\r\\n\") == '') {break;}\n            if (preg_match('\/^transfer-encoding:\/i', $buff)) {\n                $transferEncodings = explode(',',\n                    str_replace(' ', '',\n                        strtolower(\n                            substr(trim($buff), strlen('transfer-encoding:'))\n                        )\n                    )\n                );\n            }\n        }\n\n        $chunked = false;\n        if (in_array('chunked', $transferEncodings)) {\n            $chunked = true;\n            unset($transferEncodings[array_search('chunked', $transferEncodings)]);\n        }\n        if (count($transferEncodings) > 0) {\n            throw new Zend_Http_Exception('Unsupported Transfer-Encoding: ' . implode(', ', $transferEncodings));\n        }\n\n        \/\/ read body\n        if ($chunked) {\n            while (!feof($socket)) {\n                $buff = fgets($socket, 8192);\n                @list($size, $ext) = explode(' ', trim($buff));\n\n                \/\/ TODO - support chunk-ext\n\n                $size = base_convert($size, 16, 10);\n                if ($size == 0) {break;}\n                $buff = '';\n                while (strlen($buff) < $size) {\n                    $buff .= fread($socket, $size - strlen($buff));\n                    if (feof($socket)) {\n                        throw new Zend_Http_Exception('HTTP stream abnormaly disconnected');\n                    }\n                }\n                $response .= $buff;\n\n                $buff = fgets($socket); \/\/ CRLF\n            }\n            \n            \/\/ TODO - support entity-header\n        } else {\n            while (!feof($socket)) {\n                $buff = fread($socket, 8192);\n                $response .= $buff;\n            }\n        }\n\n        fclose($socket);\n        return $response;\n    }\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-130\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                "name": "shahar",
                "displayName": "Shahar Evron",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/component\/10015",
                    "id": 10015,
                    "name": "Zend_Http_Client",
                    "description": "performs HTTP requests",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/10148",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "body": "Hi,\n\nIn your code, you create an array out of the Transfer Encoding header by spiliting it's value on \",\" (commas).\n\nI am not sure I understand why you do this - it seems to me that the only possible value of \"Trasfer-Encoding\" in HTTP\/1.1 (or in HTTP\/1.0 for that matter) is \"chunked\" - no standard defines any other possible value.\n\nAlso, HTTP\/1.1 itself states that Trasfer-Encoding should contain (one) token - not a comma seperated list of tokens. It also states that a client should ignore Transfer-Encoding methods that it does not understand - so I am not sure if throwing an exception is the correct thing - I would suggest simply returning the body without decoding it, thus allowing the user to deal with it.\n\nCan you point me to a website \/ server that returns comma seperated list of encodings or some similar behaviour so I can analyze it and test with it?\n\nThank you.\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "created": "2006-06-22T16:01:25.000+0000",
                    "updated": "2006-06-22T16:01:25.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/10152",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=ishinao",
                        "name": "ishinao",
                        "displayName": "Naoto Ishikawa",
                        "active": true
                    },
                    "body": "Sorry, I was misunderstanding about treatment of \"Transfer-Encoding\" .\n(and read obsolete RFC, too)\n\nYour point is right, and in my code \"Transfer-Encoding\" header was treated wrong way.\n\nit will be fixed at following points\n\n* ignore unknown encodings, and not throw exception\n* one \"Transfer-Encoding\" header line has no comma-separated values.(but it can allow transfer-extension separated by \";\")\n",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=ishinao",
                        "name": "ishinao",
                        "displayName": "Naoto Ishikawa",
                        "active": true
                    },
                    "created": "2006-06-22T22:52:30.000+0000",
                    "updated": "2006-06-22T22:52:30.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/10161",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "body": "I have modified the Zend_Http_Response class to support chunked body decoding (in the getBody() method) - the idea is to also implement things like gzip decompression or other decoding in the same place.\n\nI also added the getRawBody() method to the response to allow access to the raw (undecoded) body.\n\nBefore I commit this, I would like to run some tests - I have tested with http:\/\/jigsaw.w3.org\/HTTP\/ChunkedScript and it looks fine. I didn't really find a way to \"force\" chunked encoding on Apache - so it is hard for me to test this feature. Can you direct me to web pages you had problems with?\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "created": "2006-06-23T13:50:22.000+0000",
                    "updated": "2006-06-23T13:50:22.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/10162",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=ishinao",
                        "name": "ishinao",
                        "displayName": "Naoto Ishikawa",
                        "active": true
                    },
                    "body": "I had chunked encoding problems with Amazon ECS REST API.\n(to use Zend_Service_Amazon with incubator version of Zend_Http_Client)\n\nTest code to get a response using chunked encoding is here.\n----\n$socket = fsockopen('webservices.amazon.co.jp', 80);\nfwrite($socket, \"GET \/onca\/xml?ResponseGroup=Request&SubscriptionId=1CM8G848FE80MFK7JK02&Service=AWSECommerceService&Operation=ItemLookup&ItemId=4774128104 HTTP\/1.1\\r\\n\");\nfwrite($socket, \"Host: webservices.amazon.co.jp\\r\\n\");\nfwrite($socket, \"Connection: close\\r\\n\");\nfwrite($socket, \"\\r\\n\");\nwhile (!feof($socket)) {\n    echo fread($socket, 8192);\n}\nfclose($socket);\n----\nand response is\n----\nHTTP\/1.1 200 OK\nDate: Sat, 24 Jun 2006 09:42:54 GMT\nServer: Server\nx-amz-id-1: 035SS9PYS085GC8MAC70\nx-amz-id-2: wvBNFEXLw1SCXiU3XP8eaFkPe4f\/9qChbXRsJr8VTb8=\nConnection: close\nTransfer-Encoding: chunked\nContent-Type: text\/xml; charset=UTF-8\n\n36f\n<?xml version=\"1.0\" encoding=\"UTF-8\"?><ItemLookupResponse xmlns=\"http:\/\/webservices.amazon.com\/AWSECommerceService\/2005-10-05\"><OperationRequest><HTTPHeaders><Header Name=\"UserAgent\"><\/Header><\/HTTPHeaders><RequestId>035SS9PYS085GC8MAC70<\/RequestId><Arguments><Argument Name=\"SubscriptionId\" Value=\"1CM8G848FE80MFK7JK02\"><\/Argument><Argument Name=\"ResponseGroup\" Value=\"Request\"><\/Argument><ArgumentName=\"Operation\" Value=\"ItemLookup\"><\/Argument><Argument Name=\"Service\" Value=\"AWSECommerceService\"><\/Argument><Argument Name=\"ItemId\" Value=\"4774128104\"><\/Argument><\/Arguments><RequestProcessingTime>0.0157420635223389<\/RequestProcessingTime><\/OperationRequest><Items><Request><IsValid>True<\/IsValid><ItemLookupRequest><ItemId>4774128104<\/ItemId><ResponseGroup>Request<\/ResponseGroup><\/ItemLookupRequest><\/Request><Item><ASIN>4774128104<\/ASIN><\/Item><\/Items><\/ItemLookupResponse>\n0\n----",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=ishinao",
                        "name": "ishinao",
                        "displayName": "Naoto Ishikawa",
                        "active": true
                    },
                    "created": "2006-06-24T03:51:46.000+0000",
                    "updated": "2006-06-24T03:51:46.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/10164",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "body": "I tested the url you sent and the new code seemed to be working properly. I got a well-formed XML response back.\n\nI have commited the new Response.php - please test your code again with revision 706\n\nIf it is fixed- please report here.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "created": "2006-06-24T15:35:19.000+0000",
                    "updated": "2006-06-24T15:35:19.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/10165",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=ishinao",
                        "name": "ishinao",
                        "displayName": "Naoto Ishikawa",
                        "active": true
                    },
                    "body": "I tested my code with Zend_Http_Reponse version 706 and It works fine.\nThank you.\n",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=ishinao",
                        "name": "ishinao",
                        "displayName": "Naoto Ishikawa",
                        "active": true
                    },
                    "created": "2006-06-24T18:48:50.000+0000",
                    "updated": "2006-06-24T18:48:50.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/10166",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "body": "Fixed by adding Zend_Http_Response the ability to decode chunked messages.\nNo changes to Zend_Http_Client.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "created": "2006-06-24T23:37:22.000+0000",
                    "updated": "2006-06-24T23:37:22.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-130\/transitions"
}