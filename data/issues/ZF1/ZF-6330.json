{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6330",
    "key": "ZF-6330",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Paginator_Adapter_DbSelect make incorrect SQL query when use join keyword"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6330\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10340",
                    "id": 10340,
                    "description": "Mini Release",
                    "name": "1.8.4",
                    "userReleaseDate": "23\/Jun\/09",
                    "archived": false,
                    "releaseDate": "2009-06-23",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-06-18T20:13:43.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ccppprogrammer",
                "name": "ccppprogrammer",
                "displayName": "Nikolay Goldschmidt",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-04-16T17:55:17.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-06-18T20:13:43.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "distinct",
                "group",
                "join",
                "joinleft",
                "zend_paginator"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Hello,\n\nOS: centos x64\nPHP: PHP 5.1.6 (cli) (built: Apr  7 2009 08:00:18) x64\nDB: psql (PostgreSQL) 8.3.7 x64\n\nZend_Paginator_Adapter_DbSelect make incorrect SQL query when use join keyword.\nIt make few columns as argument that passed to DISTINCT function than DISTINCT function make multi column result that COUNT function didn't understand.\n\nThe error is:\n{quote}\n\"Fatal error: Uncaught exception 'Zend_Db_Statement_Exception' with message 'SQLSTATE[42883]: Undefined function: 7 ERROR: function count(bigint, character varying, character varying) does not exist at character 8 HINT: No function matches the given name and argument types. You might need to add explicit type casts.\" when use Zend_Paginator with joinLeft functions.\n{quote}\nPostgresql log:\nERROR:  function count(bigint, character varying, character varying) does not exist at character 8\nHINT:  No function matches the given name and argument types. You might need to add explicit type casts.\nSTATEMENT: \n{code}\nSELECT COUNT(DISTINCT \"a\".\"id\",\"a\".\"name\",\"a\".\"description\") AS \"zend_paginator_row_count\" FROM \"a\"\n         LEFT JOIN \"c\" ON c.a_id = a.id\n         LEFT JOIN \"b\" ON c.b_id = b.id\n{code}\n\nMy model for table \"a\" is:\n{code}\nclass A extends Zend_Db_Table_Abstract\n{\n    protected $_name = 'a';\n    protected $_primary = 'id';\n    public function fetchAllPaginator($pageNumber = 1, $itemCountPerPage = 20)\n    {\n        $select = $this->select()\n        ->from(\"$this->_schema.$this->_name\", array('id' => 'a.id', 'name' => 'a.name', 'description' => 'a.description'))\n        ->joinLeft('c', \"c.a_id = $this->_schema.$this->_name.id\", array())\n        ->joinLeft('b', \"c.b_id = b.id\", array('b_count' => 'COUNT(b.id)'))\n        ->group(array('id' => 'a.id', 'name' => 'a.name', 'description' => 'a.description'))\n        ->order(\"$order\")\n        ->setIntegrityCheck(false);\n\n        $paginator = Zend_Paginator::factory($select);\n        Zend_View_Helper_PaginationControl::setDefaultViewPartial('index\/paginator.phtml');\n        Zend_Paginator::setDefaultScrollingStyle('Sliding');\n        $paginator->setItemCountPerPage($itemCountPerPage);\n        $paginator->setPageRange(Zend_Registry::get('configuration')->pagerange);\n        $paginator->setCurrentPageNumber($pageNumber);\n\n        return $paginator;\n    }\n}\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/2",
                "name": "Critical"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6330\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                "name": "norm2782",
                "displayName": "Jurrien Stutterheim",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10300",
                    "id": 10300,
                    "description": "Mini Release",
                    "name": "1.7.8",
                    "userReleaseDate": "30\/Mar\/09",
                    "archived": false,
                    "releaseDate": "2009-03-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10315",
                    "id": 10315,
                    "name": "Zend_Paginator",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30184",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "body": "Could you try this with the ZF 1.8.0 alpha release and see if this issue still exists?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "created": "2009-04-16T18:32:25.000+0000",
                    "updated": "2009-04-16T18:32:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30209",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ccppprogrammer",
                        "name": "ccppprogrammer",
                        "displayName": "Nikolay Goldschmidt",
                        "active": true
                    },
                    "body": "The problem exists in ZendFramework-1.8.0a1 too.\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ccppprogrammer",
                        "name": "ccppprogrammer",
                        "displayName": "Nikolay Goldschmidt",
                        "active": true
                    },
                    "created": "2009-04-17T05:35:33.000+0000",
                    "updated": "2009-04-17T05:35:33.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30218",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ccppprogrammer",
                        "name": "ccppprogrammer",
                        "displayName": "Nikolay Goldschmidt",
                        "active": true
                    },
                    "body": "I write patch that solve my problem:\n\n{code} \n--- Zend\/Paginator\/Adapter\/DbSelect.php-       2009-02-22 02:25:39.000000000 +0300\n+++ Zend\/Paginator\/Adapter\/DbSelect.php        2009-04-17 17:28:19.000000000 +0400\n@@ -191,6 +191,7 @@\n                 $groupPart = implode(',', $groupParts);\n             }\n\n+            if (count($groupParts) > 0) $groupPart = $groupParts[0];\n             $countPart  = empty($groupPart) ? 'COUNT(*)' : 'COUNT(DISTINCT ' . $groupPart . ')';\n             $expression = new Zend_Db_Expr($countPart . ' AS ' . $db->quoteIdentifier(self::ROW_COUNT_COLUMN));\n{code} ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ccppprogrammer",
                        "name": "ccppprogrammer",
                        "displayName": "Nikolay Goldschmidt",
                        "active": true
                    },
                    "created": "2009-04-17T06:33:31.000+0000",
                    "updated": "2009-04-17T06:33:31.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31681",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mratzloff",
                        "name": "mratzloff",
                        "displayName": "Matthew Ratzloff",
                        "active": true
                    },
                    "body": "I don't think randomly removing group clauses is the desired functionality.  ;-)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mratzloff",
                        "name": "mratzloff",
                        "displayName": "Matthew Ratzloff",
                        "active": true
                    },
                    "created": "2009-06-08T14:20:12.000+0000",
                    "updated": "2009-06-08T14:20:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31682",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mratzloff",
                        "name": "mratzloff",
                        "displayName": "Matthew Ratzloff",
                        "active": true
                    },
                    "body": "This isn't a blocking issue, so I'm lowering priority to critical.  An alternative exists: passing a query to setRowCount().",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mratzloff",
                        "name": "mratzloff",
                        "displayName": "Matthew Ratzloff",
                        "active": true
                    },
                    "created": "2009-06-08T14:22:09.000+0000",
                    "updated": "2009-06-08T14:22:09.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31972",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "body": "Resolved in r16151, merged to release-1.8 in r16152",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "created": "2009-06-18T20:13:42.000+0000",
                    "updated": "2009-06-18T20:13:42.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6330\/transitions"
}