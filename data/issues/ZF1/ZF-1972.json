{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1972",
    "key": "ZF-1972",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Loader should validate class names"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1972\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=stas",
                "name": "stas",
                "displayName": "Stanislav Malyshev",
                "active": false
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-09-19T17:59:43.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-11-25T13:13:59.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Zend_Loader should check that class names passed to it do not contain path characters (like \"\/\" and \"\\\") and maybe also other \"bad\" characters. This would help to protect code that uses user data as part of the class name (e.g., MVC) from being tricked into accessing files that they should not. "
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1972\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/10000",
                "name": "Postponed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10110",
                    "id": 10110,
                    "description": "Mini Release",
                    "name": "1.0.1",
                    "userReleaseDate": "30\/Jul\/07",
                    "archived": true,
                    "releaseDate": "2007-07-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10001",
                    "id": 10001,
                    "name": "Zend_Loader",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/16836",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Assigning to [~bkarwin] to initiate issue review.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-09-20T08:15:13.000+0000",
                    "updated": "2007-09-20T08:15:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/17292",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Changing to 'Unassigned'",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-10-17T15:28:46.000+0000",
                    "updated": "2007-10-17T15:28:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/17789",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                        "name": "jordanryanmoore",
                        "displayName": "Jordan Ryan Moore",
                        "active": true
                    },
                    "body": "Adding this somewhere before {{$path}} is defined in {{Zend_Loader::loadClass()}} would work:\n\n{{$class = preg_replace('\/[a-zA-Z0-9_\\x7f-\\xff]\/', '', $class);}}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                        "name": "jordanryanmoore",
                        "displayName": "Jordan Ryan Moore",
                        "active": true
                    },
                    "created": "2007-12-04T17:37:10.000+0000",
                    "updated": "2007-12-04T17:37:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/17897",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                        "name": "jordanryanmoore",
                        "displayName": "Jordan Ryan Moore",
                        "active": true
                    },
                    "body": "Patch:\n\n{code}\nIndex: \/library\/Zend\/Loader.php\n===================================================================\n--- \/library\/Zend\/Loader.php\t(revision 7100)\n+++ \/library\/Zend\/Loader.php\t(working copy)\n@@ -66,6 +66,8 @@\n             $dirs = (array) $dirs;\n         }\n \n+        \/\/ remove invalid class name characters\n+        $class = preg_replace('\/[a-zA-Z0-9_\\x7f-\\xff]\/', '', $class);\n         \/\/ autodiscover the path from the class name\n         $path = str_replace('_', DIRECTORY_SEPARATOR, $class);\n         if ($path != $class) {\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jordanryanmoore",
                        "name": "jordanryanmoore",
                        "displayName": "Jordan Ryan Moore",
                        "active": true
                    },
                    "created": "2007-12-13T11:23:25.000+0000",
                    "updated": "2007-12-13T11:23:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26578",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "loadClass() uses the _securityCheck() method internally which already performs these checks.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-11-22T09:11:57.000+0000",
                    "updated": "2008-11-22T09:11:57.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26686",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eovidiu",
                        "name": "eovidiu",
                        "displayName": "Ovidiu EFTIMIE",
                        "active": true
                    },
                    "body": "I have tried this code \n$className = 'Mypackage_Filter_'.ucfirst(strtolower($_GET['module']));\ntry{\n   Zend_Loader::loadClass($className);\n}catch(Zend_Exception $e){\n   echo $e->getMessage();\n}\n\nand when passed something like module=..\/..\/otherfile  in the url, it will automatically include the file. It seems that the _securitiCheck() is not correctly applied.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eovidiu",
                        "name": "eovidiu",
                        "displayName": "Ovidiu EFTIMIE",
                        "active": true
                    },
                    "created": "2008-11-25T09:26:06.000+0000",
                    "updated": "2008-11-25T09:26:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26688",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "The security check is for filenames, not for classes. loadClass() normalizes the class name to an appropriate file name; securityCheck() simply checks that no invalid filesystem characters are used in the path provided, and both '.' and '\/' are valid characters.\n\nThat said, '.' and '\/' are not valid characters for class names, and PHP will fail the class_exists() check within loadClass(), raising an exception.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-11-25T09:53:08.000+0000",
                    "updated": "2008-11-25T09:53:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26691",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eovidiu",
                        "name": "eovidiu",
                        "displayName": "Ovidiu EFTIMIE",
                        "active": true
                    },
                    "body": "Hi Mathew,\nActually the class_exists and interface_exists will not fail. I've just run the debugger on that . It all comes to passing the wrong file name to _securityCheck function\n\n{code}\n$classNameAfterloadClassFunction = 'Mypackage\\Filter\\..\/..\/..\/checkpoint.php';\n\nif (preg_match('\/[^a-z0-9\\\\\/\\\\\\\\_.-]\/i', $classNameAfterloadClassFunction)) {\n            throw new Zend_Exception('Security check: Illegal character in filename');\n}else{\n\techo \"no exception\";\n}\ndie();\n{code}\n\nI'm on win xp sp2 \/ php 5.24 \/ apache 2.2.4.\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eovidiu",
                        "name": "eovidiu",
                        "displayName": "Ovidiu EFTIMIE",
                        "active": true
                    },
                    "created": "2008-11-25T10:02:40.000+0000",
                    "updated": "2008-11-25T10:02:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26694",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Okay, let me run this by you. I have the following:\n\n{code}\n$className = 'Zend_Acl\/..\/..\/..\/..\/..\/..\/tmp\/foo';\nZend_Loader::loadClass($className);\n{code}\n\nIn side foo.php, I have the following:\n\n{code}\necho \"This got executed\\n\";\n{code}\n\nIf I execute the original script, I get the following:\n\n{code}\nThis got executed\nPHP Fatal error:  Uncaught exception 'Zend_Exception' with message 'File \"Zend\/Acl\/..\/..\/..\/..\/..\/..\/tmp\/foo.php\" does not exist or class \"Zend_Acl\/..\/..\/..\/..\/..\/..\/tmp\/foo\" was not found in the file' in \/home\/matthew\/git\/framework-standard\/trunk\/library\/Zend\/Loader.php:88\nStack trace:\n#0 \/home\/matthew\/tmp\/test.php(18): Zend_Loader::loadClass('Zend_Acl\/..\/..\/...')\n#1 {main}\n  thrown in \/home\/matthew\/git\/framework-standard\/trunk\/library\/Zend\/Loader.php on line 88\n\nZend_Exception: File \"Zend\/Acl\/..\/..\/..\/..\/..\/..\/tmp\/foo.php\" does not exist or class \"Zend_Acl\/..\/..\/..\/..\/..\/..\/tmp\/foo\" was not found in the file in \/home\/matthew\/git\/framework-standard\/trunk\/library\/Zend\/Loader.php on line 88\n\nCall Stack:\n    0.0002      51000   1. {main}() \/home\/matthew\/tmp\/test.php:0\n    0.0009      98644   2. Zend_Loader::loadClass() \/home\/matthew\/tmp\/test.php:18\n{code}\n\nIf I change foo.php to create the following:\n\n{code}\nclass Zend_Acl\/..\/..\/..\/..\/..\/..\/tmp\/foo\n{\n}\n{code}\n\nI instead get this:\n\n{code}\nPHP Parse error:  syntax error, unexpected '\/', expecting '{' in \/home\/matthew\/tmp\/foo.php on line 2\nPHP Stack trace:\nPHP   1. {main}() \/home\/matthew\/tmp\/test.php:0\nPHP   2. Zend_Loader::loadClass() \/home\/matthew\/tmp\/test.php:18\n\nParse error: syntax error, unexpected '\/', expecting '{' in \/home\/matthew\/tmp\/foo.php on line 2\n\nCall Stack:\n    0.0002      51000   1. {main}() \/home\/matthew\/tmp\/test.php:0\n    0.0009      98644   2. Zend_Loader::loadClass() \/home\/matthew\/tmp\/test.php:18\n{code}\n\nWhat I'm driving at here is that loadClass() is going to generate either an exception because the class does not exist, or a parse error because invalid characters were used to define the class name.\n\nWhat *YOU* are trying to get across is that Zend_Loader::loadClass() allows a user to include an arbitrary file. This will be true if you use include\/require or their *_once variants by themselves as it is. The question is whether or not we should add a check for invalid class name characters or path separators prior to calling the include. While I can see value in this, it also adds significant overhead to Zend_Loader, particularly as we already have the _securityCheck() method running as well. (If you don't believe this adds up, try running a typical ZF app through a debugger sometime.)\n\n_securityCheck() is for determining valid filesystem characters -- removing '\/' or '.' from that would make it basically unusable. The only way to prevent this is to add an additional check to the class name -- which, as noted, would be more overhead.\n\nI'm going to reopen the issue and mark it as postponed, as I need to discuss it with a few others prior to making a decision.\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-11-25T10:39:42.000+0000",
                    "updated": "2008-11-25T10:39:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/26712",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eovidiu",
                        "name": "eovidiu",
                        "displayName": "Ovidiu EFTIMIE",
                        "active": true
                    },
                    "body": "You completely described my issue :). The file I was using (checkpoint.php) generates an rss feed, so the error was added to the generated file but not displayed by Firefox (only viewable in view source).  ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eovidiu",
                        "name": "eovidiu",
                        "displayName": "Ovidiu EFTIMIE",
                        "active": true
                    },
                    "created": "2008-11-25T13:13:59.000+0000",
                    "updated": "2008-11-25T13:13:59.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1972\/transitions"
}