{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7997",
    "key": "ZF-7997",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Automatically initialize multiple databases..."
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/2",
                "name": "New Feature",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7997\/votes",
                "votes": 3,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10360",
                    "id": 10360,
                    "description": "Minor Release",
                    "name": "1.10.0",
                    "userReleaseDate": "27\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-27",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-03-01T05:17:53.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=chidera",
                "name": "chidera",
                "displayName": "Travis Elkins",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-10-01T10:43:38.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-03-01T05:17:54.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "application",
                "bootstrap",
                "connection",
                "database",
                "db",
                "multiple",
                "resource",
                "zend_application",
                "zend_application_resource_db"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I think that it would be nice to introduce the ability to have Zend_Application automatically initialize multiple databases.\n\nFor example, one can define a database in a configuration file that will drive the initialization of a Zend_Db adapter.  (See here: http:\/\/framework.zend.com\/manual\/en\/zend.application.available-resources.html#zend.application.available-resources.db)\n\nI suspect that there are a handful of situations where an application will use multiple database connections.  Sometimes completely different hosts may be used.  Sometimes the same database may be used, but as a different user.  Sometimes the same host will be used, but with a different database.  I'm guessing what kinds of situations people might be using, however there is an application that I work on that has some data on an \"internal\" server and other data on an \"external\" server.  Both databases need to be used.\n\nI realize that it's quite easy to set up multiple db adapters, each with different connection parameters, but one loses the ability to use the configuration file to drive this....a feature I very much enjoy and want to continue to use.\n\nI noticed that there was a semi-related \"new feature\" issue already in the tracker system: http:\/\/framework.zend.com\/issues\/browse\/ZF-6719.  This issue is asking for the ability to have multiple configuration files, allowing, among other things, the ability to clean up and separate configuration information into smaller, focused files....kind of like Apache's HTTP conf files of late.  I can see a focused DB configuration file that would simply declare which database(s) to connect to automatically.  The ability to name each database and declare one as a default would be great.\n\nSo, that's it, in a nutshell.  If, for some reason, someone doesn't understand what I'm talking about, please let me know and I'll try to explain it better."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7997\/watchers",
                "isWatching": false,
                "watchCount": 4
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-6719",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6719",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10362",
                    "id": 10362,
                    "description": "Mini Release",
                    "name": "1.9.3",
                    "userReleaseDate": "22\/Sep\/09",
                    "archived": false,
                    "releaseDate": "2009-09-22",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10390",
                    "id": 10390,
                    "name": "Zend_Application",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35037",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=paul+verhoeven",
                        "name": "paul verhoeven",
                        "displayName": "Paul Verhoeven",
                        "active": true
                    },
                    "body": "This is already possible and very easily with application.ini\n\nhttp:\/\/jaybill.com\/2007\/09\/12\/using-the-zend-framework-with-multiple-databases",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=paul+verhoeven",
                        "name": "paul verhoeven",
                        "displayName": "Paul Verhoeven",
                        "active": true
                    },
                    "created": "2009-10-01T12:38:15.000+0000",
                    "updated": "2009-10-01T12:38:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35038",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=chidera",
                        "name": "chidera",
                        "displayName": "Travis Elkins",
                        "active": true
                    },
                    "body": "@Paul: Thanks for the feedback, but I don't think that you understand what I'm asking for....\n\nI have been doing something similar to what is described in the link you provided for quite some time.  That's not a problem.\n\nHowever, what I am asking for is the ability to initialize multiple databases using Zend_Application_Resource_Db (part of Zend_Application and the automated bootstrapping functionality).  Check out the first link in the description I wrote.\n\nIf I've misunderstood something, please let me know.  I've been wrong a few times before.  ;-)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=chidera",
                        "name": "chidera",
                        "displayName": "Travis Elkins",
                        "active": true
                    },
                    "created": "2009-10-01T13:04:19.000+0000",
                    "updated": "2009-10-01T13:04:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35226",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=joeworks",
                        "name": "joeworks",
                        "displayName": "Joe Lee",
                        "active": true
                    },
                    "body": "Has anyone give much thought on how this is going to be implemented?\r\n\r\nMy proposal (subjected to everyone's scrutiny) is through a new Resource Plugins {{Zend_Application_Resource_DbAlias}} :\r\n\r\n{code:title=application.ini|borderStyle=solid}\r\n\r\nresources.dbAlias.alias.maindb.adapter = \"PDO_MYSQL\"\r\nresources.dbAlias.alias.maindb.params.dbname = \"myMainDb\"\r\nresources.dbAlias.alias.maindb.params.host = \"host1.example.com\"\r\nresources.dbAlias.alias.maindb.params.username = \"dbuser1\"\r\nresources.dbAlias.alias.maindb.params.password = \"password1\"\r\n\r\nresources.dbAlias.alias.legacydb.adapter = \"PDO_MSSQL\"\r\nresources.dbAlias.alias.legacydb.params.dbname = \"myLegacyDb\"\r\nresources.dbAlias.alias.legacydb.params.host = \"host2.example.com\"\r\nresources.dbAlias.alias.legacydb.params.username = \"dbuser2\"\r\nresources.dbAlias.alias.legacydb.params.password = \"password2\"\r\n\r\nresources.dbAlias.defaultTableAlias = \"maindb\"\r\n\r\n{code}\r\n\r\nTogether with my proposed new {{Zend_Db_Alias}} class and additional code to {{Zend_Db_Table_Abstract}} ^code listed further down below^,  we can support multiple Database Adapters in a much cleaner and easier way and with less coding. See example:\r\n\r\n{code:title=Table Data Gateway examples|borderStyle=solid}\r\n\r\nclass MySite_Model_DbTable_MyMainTable1 extends Zend_Db_Table_Abstract\r\n{\r\n    protected $_dbAlias = \"maindb\";\r\n    protected $_name = \"MyTable1\";\r\n}\r\n\r\nclass MySite_Model_DbTable_MyMainTable2 extends Zend_Db_Table_Abstract\r\n{\r\n    \/\/ uses the defaultTableAlias, i.e. maindb\r\n    protected $_name = \"MyTable2\";\r\n}\r\n\r\n\r\nclass MySite_Model_DbTable_MyLegacyTable1 extends Zend_Db_Table_Abstract\r\n{\r\n    protected $_dbAlias = \"legacydb\";\r\n    protected $_name = \"MyTable1\";\r\n}\r\n\r\n{code}\r\n\r\n\r\nThis proposal also allows implement *without* using {{Zend_Application}}. See example:\r\n\r\n{code:title=database.ini|borderStyle=solid}\r\n\r\n[maindb]\r\nadapter = \"PDO_MYSQL\"\r\nparams.dbname = \"myMainDb\"\r\nparams.host = \"host1.example.com\"\r\nparams.username = \"dbuser1\"\r\nparams.password = \"password1\"\r\n\r\n[legacydb]\r\nadapter = \"PDO_MSSQL\"\r\nparams.dbname = \"myLegacyDb\"\r\nparams.host = \"host2.example.com\"\r\nparams.username = \"dbuser2\"\r\nparams.password = \"password2\"\r\n\r\n{code} \r\n\r\n\r\n{code:title=Bootstrap|borderStyle=solid}\r\n\r\nZend_Db_Alias::setConfig( \r\n    new Zend_Config_Ini( APPLICATION_PATH.\"\/configs\/database.ini\" )\r\n);\r\nZend_Db_Table_Abstract::setDefaultAlias( 'maindb' );\r\n\r\n{code}\r\n\r\n\r\nHere is my code of {{Zend_Db_Alias}}:\r\n\r\n{code:title=Zend\/Db\/Alias.php|borderStyle=solid}\r\n\r\nclass Zend_Db_Alias \r\n{\r\n    \/**\r\n     * Configuration of aliases\r\n     *\r\n     * @var Zend_Config\r\n     *\/\r\n    protected static $_config = NULL;\r\n    \r\n    \/**\r\n     * Set the configuration of aliases\r\n     * \r\n     * @param $config Zend_Config\r\n     * @return void\r\n     *\/\r\n    public static function setConfig( Zend_Config $config ) {\r\n        self::$_config = $config;\r\n    }\r\n    \r\n    \/**\r\n     * Get the configuration of aliases\r\n     * \r\n     * @return Zend_Config\r\n     *\/\r\n    public static function getConfig() {\r\n        return self::$_config;\r\n    }\r\n\r\n    \/**\r\n     * Get Zend_Db_Adapter_Abstract from alias\r\n     * \r\n     * @param $alias string\r\n     * @return Zend_Db_Adapter_Abstract\r\n     *\/\r\n    public static function getAdapter( $alias ) {\r\n        \r\n        $reg_key = __CLASS__.\"_Adapter_\".$alias;\r\n        if ( Zend_Registry::isRegistered( $reg_key ) ) {\r\n            return Zend_Registry::get( $reg_key );\r\n        }\r\n        \r\n        if ( isset( self::$_config->$alias ) ) {\r\n            \r\n            $db = Zend_Db::factory( self::$_config->$alias );\r\n            \r\n            Zend_Registry::set( $reg_key, $db );\r\n            return $db;\r\n            \r\n        } else {\r\n            \r\n            throw new Zend_Db_Exception(\"Alias '{$alias}' not found.\");\r\n            \r\n        }\r\n        \r\n    }\r\n    \r\n}\r\n{code}\r\n\r\nand additional changes to {{Zend_Db_Table_Abstract}}:\r\n\r\n{code:title=Two new properties|borderStyle=solid}\r\n    \r\n    \/**\r\n     * Default Db Alias.\r\n     *\r\n     * @var string\r\n     *\/\r\n    protected static $_defaultDbAlias = null;\r\n    \r\n    \/**\r\n     * The database alias.\r\n     *\r\n     * @var string\r\n     *\/\r\n    protected $_dbAlias = null;\r\n\r\n{code}\r\n\r\n{code:title=Four new methods|borderStyle=solid}\r\n\r\n    \/**\r\n     * Set default database alias.\r\n     *\r\n     * @param $alias string\r\n     * @return void\r\n     *\/\r\n    public static function setDefaultAlias( $alias = null )\r\n    {\r\n        self::$_defaultDbAlias = $alias;\r\n        self::setDefaultAdapter( Zend_Db_Alias::getAdapter( $alias ) );\r\n    }\r\n    \r\n    \/**\r\n     * Get default database alias.\r\n     *\r\n     * @return string\r\n     *\/\r\n    public static function getDefaultAlias( )\r\n    {\r\n        return self::$_defaultDbAlias;\r\n    }\r\n    \r\n    \/**\r\n     * Set database alias.\r\n     *\r\n     * @param $alias string\r\n     * @return void\r\n     *\/\r\n    public function setAlias( $alias )\r\n    {\r\n        $this->_dbAlias = $alias;\r\n    }\r\n    \r\n    \/**\r\n     * Get database alias.\r\n     *\r\n     * @return string\r\n     *\/\r\n    public function getAlias( )\r\n    {\r\n        return $this->_dbAlias;\r\n    }\r\n    \r\n}\r\n\r\n{code}\r\n\r\n{code:title=Change to _setupDatabaseAdapter() method|borderStyle=solid}\r\n\r\n\/**\r\n * Initialize database adapter.\r\n *\r\n * @return void\r\n *\/\r\nprotected function _setupDatabaseAdapter()\r\n{\r\n    \/\/ Start of added code\r\n    if ( $this->_dbAlias ) {\r\n        $this->_db = Zend_Db_Alias::getAdapter( $this->_dbAlias );\r\n    }\r\n    \/\/ End of added code\r\n    \r\n    if (! $this->_db) {\r\n        $this->_db = self::getDefaultAdapter();\r\n        if (!$this->_db instanceof Zend_Db_Adapter_Abstract) {\r\n            require_once 'Zend\/Db\/Table\/Exception.php';\r\n            throw new Zend_Db_Table_Exception('No adapter found for ' . get_class($this));\r\n        }\r\n    }\r\n}\r\n\r\n{code}\r\n\r\n\r\n*TODO* Code for {{Zend_Application_Resource_DbAlias}} \r\n\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=joeworks",
                        "name": "joeworks",
                        "displayName": "Joe Lee",
                        "active": true
                    },
                    "created": "2009-10-15T03:09:29.000+0000",
                    "updated": "2009-10-20T02:20:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35423",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=chidera",
                        "name": "chidera",
                        "displayName": "Travis Elkins",
                        "active": true
                    },
                    "body": "@Joe: Thanks for your feedback\/input.\r\n\r\nYes, I've thought a bit about how it could be implemented.  I posted a potential solution at http:\/\/zfgroove.blogspot.com.  (It's my first blog article, so keep that in mind if you read it.)\r\n\r\nI like what you proposed for Zend_Db_Table_Abstract.  It does seem to offer a cleaner, nicer way of tying the DB adapter to the individual tables...in a way that is still consistent with the other aspects of Zend_Db_Table_Abstract.\r\n\r\nWith regards to Zend_Db_Alias, I didn't like it at first...although I'm quickly warming up to it.  ;-)  The way I see it, it appears to be the (necessary) liaison between the multiple databases and the Zend_Db_Table_Abstract descendants.  It's short and sweet and has minimal impact on Zend_Db_Table_Abstract.  I wonder, though, how many other classes may need to be impacted.  Any ideas...?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=chidera",
                        "name": "chidera",
                        "displayName": "Travis Elkins",
                        "active": true
                    },
                    "created": "2009-10-20T10:01:17.000+0000",
                    "updated": "2009-10-20T10:01:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38899",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "body": "Added [Zend_Application_Resource_Multidb|http:\/\/framework.zend.com\/manual\/en\/zend.application.available-resources.html#zend.application.available-resources.multidb] in 1.10.0.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "created": "2010-03-01T05:17:53.000+0000",
                    "updated": "2010-03-01T05:17:53.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7997\/transitions"
}