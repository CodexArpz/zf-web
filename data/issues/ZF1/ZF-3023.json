{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3023",
    "key": "ZF-3023",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_View error with custom layout path inside view base path"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3023\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10160",
                    "id": 10160,
                    "description": "Major Release",
                    "name": "Next Major Release",
                    "archived": false,
                    "released": false
                }
            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tbarstow",
                "name": "tbarstow",
                "displayName": "Taylor Barstow",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-04-02T09:40:51.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-02-13T00:44:36.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "The following order of events causes an error where the view renderer cannot find a view script that is definitely in the right place:\r\n\r\n1. In your bootstrap, initialize Zend_Layout's MVC support\r\n2. Set a custom layout path within the view base path for the default module: \/path\/to\/modules\/default\/views\/layouts\r\n3. Request an action that is in some other module\r\n4. In a plugin that executes its postDispatch() AFTER the layout plugin, forward to an action in the default module\r\n5. The view renderer cannot render the view script for the new action, because the view object's script path does not include \/path\/to\/modules\/default\/views\/scripts\r\n\r\nYou might ask how I found this.  Actually the easiest way to trigger it is to cause the \"forward\" in step 4 by making the view renderer throw an exception, which makes the error handler plugin forward to the error controller.\r\n\r\nNow, I've already spent a good amount of time tracking this down, so I'll share my insights on why this is happening.\r\n\r\nAfter the initial action request, the layout plugin's postDispatch() calls Zend_Layout's render() method.  This adds the following script path (line 725 of Zend\/Layout.php @ 1.5.1):\r\n\r\n\/path\/to\/modules\/default\/views\/layout\r\n\r\nThen, a later plugin (in my example, the error handler) comes along and forwards to the default module.  This causes the view renderer's initView() method to get called, which will try to add the new module's view base path to the view:\r\n\r\n\/path\/to\/modules\/default\/views\r\n\r\nBut there is a problem in this case.  Take a look at the view renderer's initView() method.  You'll see the following starting on line 481 (1.5.1):\r\n\r\n\/\/ Determine if this path has already been registered\r\n$currentPaths = $this->view->getScriptPaths();\r\n$path         = str_replace(array('\/', '\\\\'), '\/', $path);\r\n$pathExists   = false;\r\nforeach ($currentPaths as $tmpPath) {\r\n  $tmpPath = str_replace(array('\/', '\\\\'), '\/', $tmpPath);\r\n  if (strstr($tmpPath, $path)) {\r\n    $pathExists = true;\r\n    break;\r\n  }\r\n}\r\nif (!$pathExists) {\r\n  $this->view->addBasePath($path, $prefix);\r\n\r\nNotice the strstr about halfway down, then take a look at those paths again.  The second path never gets added, so the error\/error.phtml script isn't found.\r\n\r\nObviously, the workaround is to keep your layout path outside of your view base path, or just stick to the default. \r\n\r\nBut this is still a bug.  It seemed perfectly natural to me (and potentially others) to put my layouts in \/path\/to\/modules\/default\/view\/layouts, and it took me quite a while to track down the problem."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/customFieldOption\/10037",
                "value": "   Must Have"
            }
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3023\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/10000",
                "name": "Postponed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11202",
                    "filename": "build.zip",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tbarstow",
                        "name": "tbarstow",
                        "displayName": "Taylor Barstow",
                        "active": true
                    },
                    "created": "2008-04-02T09:42:25.000+0000",
                    "size": 8566,
                    "mimeType": "application\/zip",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11202\/build.zip"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10174",
                    "id": 10174,
                    "description": "Mini Release",
                    "name": "1.5.1",
                    "userReleaseDate": "25\/Mar\/08",
                    "archived": true,
                    "releaseDate": "2008-03-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10026",
                    "id": 10026,
                    "name": "Zend_View",
                    "description": "View portion of the ZF MVC",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/20644",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tbarstow",
                        "name": "tbarstow",
                        "displayName": "Taylor Barstow",
                        "active": true
                    },
                    "body": "Very concise test case illustrating the issue.  Install it and make a request to Test_IndexController::indexAction() to see the exception.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tbarstow",
                        "name": "tbarstow",
                        "displayName": "Taylor Barstow",
                        "active": true
                    },
                    "created": "2008-04-02T09:42:25.000+0000",
                    "updated": "2008-04-02T09:42:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/20649",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Assigning to Ralph to review.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-04-02T10:07:12.000+0000",
                    "updated": "2008-04-02T10:07:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21703",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Scheduling for next mini release.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-05-09T12:47:07.000+0000",
                    "updated": "2008-05-09T12:47:07.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23123",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "It seems as though fixing this issue (by changing the comparison to (tmpPath == $path) instead of (strstr($tmpPath, $path)) would introduce a regression that breaks the current unit tests.  For that reason, it seems like we are gonna have to find another way to fix this in 1.6, perhaps a new feature that would better manage script paths in viewrenderer - or it will have to wait until 2.0.\n\nMatthew, do you have any ideas in this department?\n\nMy only suggestion in the interim is to not keep layouts inside of your default modules views\/ directory.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2008-07-26T14:05:26.000+0000",
                    "updated": "2008-07-26T14:05:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37571",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tbarstow",
                        "name": "tbarstow",
                        "displayName": "Taylor Barstow",
                        "active": true
                    },
                    "body": "Since no one else seems too worried about this, and I worked around it a long time ago, maybe this one should just go away?  It's technically a bug, but does anyone care?  I don't.  Just my .02.  I'm going to unwatch it.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tbarstow",
                        "name": "tbarstow",
                        "displayName": "Taylor Barstow",
                        "active": true
                    },
                    "created": "2010-01-11T12:57:18.000+0000",
                    "updated": "2010-01-11T12:57:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44355",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=intiilapa",
                        "name": "intiilapa",
                        "displayName": "Beno\u00eet Durand",
                        "active": true
                    },
                    "body": "The status Postponed means that the fix's version is the next major release.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=intiilapa",
                        "name": "intiilapa",
                        "displayName": "Beno\u00eet Durand",
                        "active": true
                    },
                    "created": "2011-02-13T00:44:35.000+0000",
                    "updated": "2011-02-13T00:44:35.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3023\/transitions"
}