{
    "expand": "html",
    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-744",
    "key": "ZF-744",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "getWeekday - bugs, logical type issues, efficiency problems"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-744\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/version\/10020",
                    "id": 10020,
                    "description": "Preview Release; I18N, Acl, Auth, Session",
                    "name": "0.7.0",
                    "userReleaseDate": "18\/Jan\/07",
                    "archived": true,
                    "releaseDate": "2007-01-18",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-01-15T14:50:47.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                "name": "gavin",
                "displayName": "Gavin",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-01-12T14:50:10.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-05T14:43:39.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "There are several similar functions, but since getWeekday() provides a good example to study.\n\nh3. getWeekday() returns a Zend_Date in the range 1 to 7 x number of seconds in day\n\nWhy does getWeekday() return 1 to 7, when the normal range for PHP date related functions is 0 to 6, with 0 = Sunday?\n\nFor example, the {{date()}} function returns 1 to 7 for \"day of the week\".\n\nh3. setWeekday() results in incorrect dates\n\nI will soon add a new unit test.  The results of setWeekday() do not match expectations, in that setWeek($digit) does not result in a date matching 1970\/01\/0<digit> 00:00:00.\n\nh3. Logical Typing Issues (timezone information lost)\n\nThe result of {{$date->setWeekday(3);}} is an *actual* timestamp for the current timezone, not for GMT, but that information is lost after {{$date->setWeekday(3);}}.\nThe {{setWeekday($anInteger)}} method creates an object with a GMT timestamp if {{0}}, and then sets the timestamp to the 3rd weekday of the current local timezone, but no information in $date shows that it was for a particular local timezone.\n\n{code}\n$date1 = new Zend_Date();\n$date2 = new Zend_Date(null, null, true);\n$date1->settWeekday(3);\n$date2->setWeekday(3, true);\n{code}\n\nNow $date1 and $date2 have different timestamps, since $date1 should contain the GMT timestamp corresponding to the 3rd day of the week for the local timezone (set by TZ environment variable, or date_default_timezone_set(), or the date.timezone ini option.\n\nSo {{$date1->_Date->unixtimestamp != $date2->_Date->unixtimestamp}}.\nThe $date1 object is actually an abstraction representing weekday 3 for the local timezone, but $date2 is an abstraction representing weekday 3 for GMT timezone.\nThis difference, this distinction, this information is lost after the calls to setWeekday.  Nothing remains in the instance objects to distinguish the fact that these two object represent the same concept (3rd day of the week), but in different time zones.\n\nNow, a problem happens when developers try to use $date1 and $date2.\nThey are different kinds of dates (one in local timezone, the other in GMT timezone).\nIf the developer uses them together, bad results will happen, unless they are first converted to the same timezone.\n\nh3. Unecessary Localization\n\nThe localization is irrelevant and not needed.  We only need to understand which timezone to use with the timestamp, in order to obtain a numeric weekday.  That number may then be multiplied by 86400 and added tot he current _unixtimestamp.\n\nThe getWeekday() method basically converts $this->_Date->_unixtimestamp into a localized, textual representation of the weekday name, then converts that back into a timestamp offset that is added to 1970\/01\/01 00:00:00.\n\n\n{code}\n    \/\/ current SVN code:\n    public function getWeekday($gmt = false, $locale = null)\n    {\n        if ($locale === null) {\n            $locale = $this->getLocale();\n        }\n\n        return new Zend_Date($this->get(Zend_Date::WEEKDAY, $gmt, $locale), Zend_Date::WEEKDAY, $gmt, $locale);\n    }\n{code}\n\n{code}\n\/\/ the unecessary localization:\ncase Zend_Date::WEEKDAY :\n                $weekday = strtolower($this->_Date->date('D', $this->_Date->getTimestamp(), $gmt));\n                $day = Zend_Locale_Data::getContent($locale, 'day', array('gregorian', 'wide', $weekday));\n                return $day[$weekday];\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-744\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/version\/10040",
                    "id": 10040,
                    "description": "Preview Release; MVC maturation, HTTP client, Gdata",
                    "name": "0.6.0",
                    "userReleaseDate": "16\/Dec\/06",
                    "archived": true,
                    "releaseDate": "2006-12-16",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/component\/10072",
                    "id": 10072,
                    "name": "Zend_Date",
                    "description": "Zend_Date is the basic library for the handling of all date, time and calendar-related issues.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12211",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "body": "After looking at changeset 2717, I propose:\n* merging Zend_Date and Zend_Date_DateObject by making Zend_Date extend Zend_Date_DateObject\n* eliminating the instance variable Zend_Date::_GMT, and using the instance variable Zend_Date_DateObject::_offset instead\n\nThus, after making Zend_Date a subclass of Zend_Date_DateObject:\n{code}\n$date1 = new Zend_Date();\n$date1->setTimeZone('America\/Los_Angeles');\n$date1->setWeekday(1);\n\n$date2 = new Zend_Date('Europe\/Vienna');\n$date2->setTimeZone('America\/Los_Angeles');\n$date2->setWeekday(1);\n\nassert($date1->_timestamp == $date2->_timestamp);\nassert($date1->_offset != $date2->_offset);\n{code}\n\nThe $date->_offset would be different in the two examples above.  The offset would be used by default when outputing weekday names, and nearly all date formats that are not expressed as a GMT\/UTC date. When we echo $date1->toString(), we could make it output the right value for $date1's timezone (according to $date1->_offset).  Likewise, the same thing for $date2.\n\nAll internal calculations could always be done in GMT, but output would be adjusted for $date->_offset.  Thus, the time zone information would not be \"lost\" as described above under \"logical typing issues\"",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "created": "2007-01-12T17:53:06.000+0000",
                    "updated": "2007-01-12T17:53:06.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12214",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "API rework will be done by Gavin",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2007-01-13T12:55:52.000+0000",
                    "updated": "2007-01-13T12:55:52.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12218",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "body": "Gavin has completed the refactor to make Zend_Date a subclass of Zend_Date_DateObject.\nWe have 19 unit tests to work on now that do not pass, probably nearly all related to the other refactoring to migrate $gmt out of the parameters of most methods in Zend_Date.\n\nReassigning remainder of this issue to Thomas.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=gavin",
                        "name": "gavin",
                        "displayName": "Gavin",
                        "active": true
                    },
                    "created": "2007-01-13T14:12:57.000+0000",
                    "updated": "2007-01-13T14:12:57.000+0000"
                },
                {
                    "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/comment\/12248",
                    "author": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "API has completly reworked as with SVN 2786.\nAll unit tests pass and functions work as expected.\n\nIf something does not work as expected please add unit tests showing the problems and add a new issue.",
                    "updateAuthor": {
                        "self": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2007-01-15T14:50:47.000+0000",
                    "updated": "2007-01-15T14:50:47.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/framework.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-744\/transitions"
}