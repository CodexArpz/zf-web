{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2461",
    "key": "ZF-2461",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Throwing Exceptions within a plugins causes application failures"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField",
            "value": {
                "timeoriginalestimate": 240,
                "timeestimate": 240
            }
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2461\/votes",
                "votes": 3,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10240",
                    "id": 10240,
                    "description": "Minor Release",
                    "name": "1.6.0",
                    "userReleaseDate": "02\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-02",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-08-06T14:08:22.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=radhad",
                "name": "radhad",
                "displayName": "Dennis Becker",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-01-21T03:12:05.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-01-24T03:55:38.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I have written a small \"TestPlugin\" with the following code:\n{code}<?php\nclass TestPlugin extends Zend_controller_Plugin_Abstract\n{\n\tpublic function routeStartup()\n\t{\n\t}\n\n\tpublic function dispatchLoopStartup()\n\t{\n\t}\n\n\tpublic function preDispatch()\n\t{\n\t}\n\n\tpublic function postDispatch()\n\t{\n\t}\n}{code}\nThen I started to throw an exception in each method per request, to try out how Zend_Layout it handles. And now the failures begin: within routeStartup() and dispatchLoopStartup() the page get's rendered twice: the errorAction + the page I requested inside the \"content\" placeholder.\n\n\n\nWhen an ecxeption is thrown within preDispatch() oder postDispatch(), I get the following exception:\n\nFatal error: Uncaught exception 'Zend_Exception' in \/var\/www\/dlm\/application\/plugins\/TestPlugin.php:16 Stack trace:\n#0 \/var\/www\/library\/Zend\/Controller\/Plugin\/Broker.php(316): TestPlugin->preDispatch(Object(Zend_Controller_Request_Http))\n#1 \/var\/www\/library\/Zend\/Controller\/Front.php(914): Zend_Controller_Plugin_Broker->preDispatch(Object(Zend_Controller_Request_Http))\n#2 \/var\/www\/public\/index.php(37): Zend_Controller_Front->dispatch()\n#3 {main} thrown in \/var\/www\/application\/plugins\/TestPlugin.php on line 16"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/1",
                "name": "Blocker"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/customFieldOption\/10037",
                "value": "   Must Have"
            }
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2461\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10050",
                    "id": 10050,
                    "description": "Minor Release Candidate",
                    "name": "1.6.0RC2",
                    "userReleaseDate": "11\/Aug\/08",
                    "archived": true,
                    "releaseDate": "2008-08-11",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10270",
                    "id": 10270,
                    "name": "Zend_Layout",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19413",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Unsetting 'fix version priority' until this issue is reviewed. Assigning to Matthew for review.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-02-25T13:48:52.000+0000",
                    "updated": "2008-02-25T13:48:52.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21255",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=radhad",
                        "name": "radhad",
                        "displayName": "Dennis Becker",
                        "active": true
                    },
                    "body": "This bug still exists - on zfforum.de another user has described the problem with doubled rendered layouts while an exception has occured (this does not happen on every exception). \"mvcSuccessfulActionOnly\" is \"true\"! I use ZF Version 1.5.1 at the moment.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=radhad",
                        "name": "radhad",
                        "displayName": "Dennis Becker",
                        "active": true
                    },
                    "created": "2008-04-22T01:22:06.000+0000",
                    "updated": "2008-04-22T01:22:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21261",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Assigning to Ralph to evaluate.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2008-04-22T10:08:08.000+0000",
                    "updated": "2008-04-22T10:08:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21331",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Updating project management info.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2008-04-22T11:37:46.000+0000",
                    "updated": "2008-04-22T11:37:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21841",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=radhad",
                        "name": "radhad",
                        "displayName": "Dennis Becker",
                        "active": true
                    },
                    "body": "I have found an solution. I set \"mvcSuccessfulActionOnly\" to \"false\" and called in the errorAction() of the ErrorController \"$this->getResponse()->clearBody();\"\n\nThis works not only in controller-actions, it also works well with Exceptions thrown in Plugins!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=radhad",
                        "name": "radhad",
                        "displayName": "Dennis Becker",
                        "active": true
                    },
                    "created": "2008-05-20T06:44:27.000+0000",
                    "updated": "2008-05-20T06:44:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/23306",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "So this is a non issue now?  I assume you might have found this issue before mvcSuccessfulActionOnly was implemented.\n\nCan i close as non-an-issue?\n\n-Ralph",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2008-08-05T08:53:50.000+0000",
                    "updated": "2008-08-05T08:53:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24036",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Updating for the 1.6.0 release.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-09-02T10:39:13.000+0000",
                    "updated": "2008-09-02T10:39:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41920",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=andrewsharpe79",
                        "name": "andrewsharpe79",
                        "displayName": "Andrew Sharpe",
                        "active": true
                    },
                    "body": "I'm not sure that \"resolved\" is adequate ATM, given the information above.\r\n\r\nUsing ZF 1.9.5 I am seeing this issue when a front controller plugin throws an exception during preDispatch(), and at least one problem with this \"resolution\" is that the originally requested action still runs and the issue is worked around in the error controller.\r\n\r\nI am not using mvcSuccessfulActionOnly because I'm using the ContextSwitch helper for an XML response.\r\n\r\nIt appears that throwing an exception in preDispatch() is pointless because the action runs anyway.  To handle the exception immediately the plugin needs to redirect the request to the error handler.  Alternately you can exit Zend_Controller_Plugin_Broker::preDispatch() with an error if you set Zend_Controller_Front::throwExceptions to true, but then in dispatch() of the FrontController you don't get a chance to handle the exception because the exception is thrown again (because of throwExceptions!).\r\n\r\nGiven this situation it might be useful to have a helper method for plugins to alter the request to send it to the error controller, much the same was as in postDispatch() of the ErrorHandler plugin.  This helper method could then be used in preDispatch() of other plugins (instead of throwing exceptions), or the whole plugin preDispatch() error handling situation could be reviewed.\r\n\r\nThere's also the possibility that I'm barking up the wrong tree and should NEVER throw an exception in a front controller plugin!\r\n\r\nCould we please have comment on whether;\r\na) throwing exceptions from front controller plugins is acceptable and what we should do instead if it's not, and\r\nb) running the originally requested action if an exception is thrown by a plugin during preDispatch is desirable\/useful\/acceptable\r\n\r\nFor basic context I have a plugin that is performing authentication (of the CAS variety) and if we have an issue upstream then I'd like to propagate it.\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=andrewsharpe79",
                        "name": "andrewsharpe79",
                        "displayName": "Andrew Sharpe",
                        "active": true
                    },
                    "created": "2010-08-09T03:38:26.000+0000",
                    "updated": "2010-08-09T03:38:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44147",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cduv",
                        "name": "cduv",
                        "displayName": "Claude Duvergier",
                        "active": true
                    },
                    "body": "I'm asking myself the same questions as Andrew Sharpe is. And it's because of the same situation:\r\nI have a Controller Plugin (extending from {{Zend_Controller_Plugin_Abstract}}) that may throw an Exception in it's {{dispatchLoopStartup()}} method.\r\n\r\nWhat I would like is that this Exception gets somehow handled by the {{Zend_Controller_Plugin_ErrorHandler}} (just like any Exception thrown from a {{Zend_Controller_Action}}) but :\r\nAsking the FrontController to throw exceptions results in a {{Exception}} displayed by PHP without going through ErrorHandler plugin.\r\nOtherwise (FrontController not throwing exceptions), the {{Exception}} gets added to {{Zend_Controller_Response_Http}} object by {{Zend_Controller_Plugin_Broker::dispatchLoopStartup()}}.\r\n\r\nShould I need to create my own ErrorHandler Plugin that checks {{Zend_Controller_Response_Http}} object for any {{Exception}} and intercept them (forwarding to defined controller\/action, e.g. \"\/error\/error\")?\r\n\r\nPS: My plugin is also a plugin that deals with authentification (retrieving users informations from an LDAP server)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=cduv",
                        "name": "cduv",
                        "displayName": "Claude Duvergier",
                        "active": true
                    },
                    "created": "2011-01-24T03:55:37.000+0000",
                    "updated": "2011-01-24T03:55:37.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2461\/transitions"
}