{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10179",
    "key": "ZF-10179",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Http_Client failes to decode reply"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10179\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jazz",
                "name": "jazz",
                "displayName": "john",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-07-19T07:38:37.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T21:37:33.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I am trying to use Zend_Http_Client to fetch a specific page (www . nu . nl). I am using this code\r\n\r\n$client = new Zend_Http_Client($url,\r\n    array(\r\n        'maxredirects' => 5, \r\n        'timeout' => 30,\r\n        'useragent' => 'Mozilla\/5.0 (X11; U; Linux i686; en-US; rv:0.9.3) Gecko\/20010801 '\r\n    )\r\n);\r\n$code = $client->request(\"GET\");\r\n$pageBody = $code->getBody();\r\n\r\nFor this specific site, $pagebody is empty (0). Using xdebug, it seems that it fetches the encoded response but fails on the decoding. Also, and this is wierd to me, sometimes it works with no problem! So, it is not deterministically reproducible. On my tests, it failed most of the time.\r\n\r\nFor many other pages I have tried, it works with absolutely no problem. The error has been confirmed both on a Wamp server and on a Lamp one (on different locations, different network providers).\r\n\r\nEdit: The raw data can be found here:  http:\/\/pastebin.com\/raw.php?i=r5xe2xzC \r\nNote that this is from a dynamic site so each request does not necessarily get the same data, so the above refers to the data sent for that specific request.\r\n\r\nEdit2: Full response including headers can be downloaded from here: http:\/\/rapidshare.com\/files\/408267267\/rawresp210710.rar"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10179\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10015",
                    "id": 10015,
                    "name": "Zend_Http_Client",
                    "description": "performs HTTP requests",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41596",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bittarman",
                        "name": "bittarman",
                        "displayName": "Ryan Mauger",
                        "active": true
                    },
                    "body": "Could you supply which encoding in question causes this failure? without this, it would be difficult to produce a reliable test case to prove any fix for this issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bittarman",
                        "name": "bittarman",
                        "displayName": "Ryan Mauger",
                        "active": true
                    },
                    "created": "2010-07-19T07:43:22.000+0000",
                    "updated": "2010-07-19T07:43:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41598",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jazz",
                        "name": "jazz",
                        "displayName": "john",
                        "active": true
                    },
                    "body": "As I understand, it is gzip encoded.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jazz",
                        "name": "jazz",
                        "displayName": "john",
                        "active": true
                    },
                    "created": "2010-07-19T08:01:59.000+0000",
                    "updated": "2010-07-19T08:01:59.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41609",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "body": "Can you stringify a response that fails, and save it to a file and attach it here?\r\n\r\nEg:\r\n\r\n{code}\r\n$debugFile = '\/tmp\/response.txt';\r\n\r\n$code = $client->request('GET');\r\n$pageBody = $code->getBody();\r\n\r\nif (! $pageBody) {\r\n   file_put_contents($debugFile, $code->asString());\r\n}\r\n{code}\r\n\r\nAnd attach $pageBody to this report?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "created": "2010-07-19T12:59:26.000+0000",
                    "updated": "2010-07-19T12:59:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41614",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jazz",
                        "name": "jazz",
                        "displayName": "john",
                        "active": true
                    },
                    "body": "I can't reproduce it at this time on either Windows or Linux. I run a test 100 times on both and it was successful.\r\n\r\nI notice they use \"Juniper Networks NitroCache\/v1.0\" so it is possible that there was a glitch on the server side and not on the framework.\r\n\r\nI will be monitoring it for the next days. Stupidly enough, I did not record the raw data on the first day I noticed the problems. I am very sorry if I acted too fast and unwise on this.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jazz",
                        "name": "jazz",
                        "displayName": "john",
                        "active": true
                    },
                    "created": "2010-07-19T15:09:48.000+0000",
                    "updated": "2010-07-19T15:09:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41622",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "body": "np, don't worry about it :)\r\n\r\nIf you're able to capture the raw request, we can easily make a test case out if it. \r\n\r\nIf you can't reproduce this for some time, feel free to close the bug. \r\n\r\nShahar.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "created": "2010-07-20T01:34:08.000+0000",
                    "updated": "2010-07-20T01:34:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41640",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jazz",
                        "name": "jazz",
                        "displayName": "john",
                        "active": true
                    },
                    "body": "I have finally managed to capture it. :)\r\n\r\nI have uploaded the result from getRawBody() (base64encoded) here: http:\/\/pastebin.com\/raw.php?i=r5xe2xzC\r\n\r\nThis decodes to an empty string with getBody().",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jazz",
                        "name": "jazz",
                        "displayName": "john",
                        "active": true
                    },
                    "created": "2010-07-20T19:29:11.000+0000",
                    "updated": "2010-07-20T19:29:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41641",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jazz",
                        "name": "jazz",
                        "displayName": "john",
                        "active": true
                    },
                    "body": "Updated with more information",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jazz",
                        "name": "jazz",
                        "displayName": "john",
                        "active": true
                    },
                    "created": "2010-07-20T19:39:08.000+0000",
                    "updated": "2010-07-20T19:39:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41642",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "body": "Hi,\r\n\r\nI was specifically asking for the entire response (incl. headers) because the body by itself can't tell us what Http_Client was trying to do with it (e.g. what Transfer-Encoding, Content-Transfer-Encoding etc. headers are sent).\r\n\r\nCan you please try it again and this time grab the entire output of $response->asString() and paste it there? (or upload as a file). \r\n\r\nBTW the body is a base64-encoded gzipped HTML page, which is AFAIK not a method of transporting content described in any HTTP standard. \r\n\r\nThanks.\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shahar",
                        "name": "shahar",
                        "displayName": "Shahar Evron",
                        "active": true
                    },
                    "created": "2010-07-20T20:33:18.000+0000",
                    "updated": "2010-07-20T20:33:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41662",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jazz",
                        "name": "jazz",
                        "displayName": "john",
                        "active": true
                    },
                    "body": "Hi,\r\n\r\nThank you for you input. I will try to do as you instructed and update this.\r\n\r\nPlease note that I encoded it in base64 in order to upload it as string in pastebin. The raw response was *not* in base64 encoding, it looked binary to me. So I used base64 to make sure that it did not get corrupted when I uploaded it to pastebin.\r\n\r\nThank you.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jazz",
                        "name": "jazz",
                        "displayName": "john",
                        "active": true
                    },
                    "created": "2010-07-21T13:57:25.000+0000",
                    "updated": "2010-07-21T13:57:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41664",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jazz",
                        "name": "jazz",
                        "displayName": "john",
                        "active": true
                    },
                    "body": "New response recorded using asString() method.\r\n\r\nPlease download it form here: http:\/\/rapidshare.com\/files\/408267267\/rawresp210710.rar\r\n\r\nThe rar contains 2 files, created with the following code.\r\n{code}\r\n            $raw = $code->asString();\r\n            $fp = fopen('rawresp-base64.txt', \"w\");\r\n            fwrite($fp, base64_encode($raw));\r\n            fclose($fp);\r\n            $fp2 = fopen('rawresp3.txt', \"wb\");\r\n            fwrite($fp2, $raw);\r\n            fclose($fp2);\r\n{code}\r\n\r\nBest regards,\r\n\r\nJohn",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jazz",
                        "name": "jazz",
                        "displayName": "john",
                        "active": true
                    },
                    "created": "2010-07-21T14:16:00.000+0000",
                    "updated": "2010-07-21T14:16:00.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10179\/transitions"
}