{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2017",
    "key": "ZF-2017",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Illogic syntax in method Zend_Db_Select->query() while using binding parameters"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField",
            "value": {
                "timeoriginalestimate": 4320,
                "timeestimate": 4320
            }
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2017\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10241",
                    "id": 10241,
                    "description": "Minor Release",
                    "name": "1.8.0",
                    "userReleaseDate": "30\/Apr\/09",
                    "archived": false,
                    "releaseDate": "2009-04-30",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-03-29T01:56:08.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=doctorrock83",
                "name": "doctorrock83",
                "displayName": "julien PAULI",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-09-30T07:54:26.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-06-29T09:18:07.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Zend_Db_Select->query() should behave exactly like Zend_Db_Adapter->select().\nYou may not actually pass binding parameters to Zend_Db_Select->query(), while you may throught Zend_Db_Adapter->query(), whitch is a strange behavior.\n\nActual Zend_Db_Select code :\n{code}\n    public function query($fetchMode = null)\n    {\n        $stmt = $this->_adapter->query($this);\n        if ($fetchMode == null) {\n            $fetchMode = $this->_adapter->getFetchMode();\n        }\n        $stmt->setFetchMode($fetchMode);\n        return $stmt;\n    }\n{code}\n\nImprovement to consider binding parameters :\n{code}\n    public function query($fetchMode = null, $bind = array() )\n    {\n        $stmt = $this->_adapter->query($this, $bind);\n        if ($fetchMode == null) {\n            $fetchMode = $this->_adapter->getFetchMode();\n        }\n        $stmt->setFetchMode($fetchMode);\n        return $stmt;\n    }\n{code}\n\nLike this, both Select and Adapter's query() methods have the same behavior.\nUse case :\n{code}\n$select = $db->select();\n$select->from('test', array('id','champ'))\n      ->where('id > :id');\n$statement = $select->query(Zend_Db::FETCH_OBJ,array(':id'=> 2));\n\/* behaves exactly as this :\n*$db->setFetchMode(Zend_Db::FETCH_OBJ);\n*$statement = $db->query($select,array(':id'=> 2));\n*\/\n{code}\n\nWe could as well improve Zend_Db_Select->query() by specifing a fetch mode directly :\n{code}\n    public function query($fetchMode = null, $bind = array())\n    {\n        if ($fetchMode != null) {\n           $this->_adapter->setFetchMode($fetchMode);\n        }        \n        return $this->_adapter->query($this,$bind);\n    }\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date",
            "value": "2009-01-23"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/customFieldOption\/10039",
                "value": "  Should Have"
            }
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2017\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                "name": "norm2782",
                "displayName": "Jurrien Stutterheim",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-3220",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3220",
                    "type": {
                        "name": "Dependency",
                        "direction": "INBOUND",
                        "description": "is dependecy of"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11847",
                    "filename": "zf-2017.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "created": "2009-03-28T18:46:05.000+0000",
                    "size": 5810,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11847\/zf-2017.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10132",
                    "id": 10132,
                    "name": "Zend_Db_Select",
                    "description": "OO interface to building a SELECT SQL query.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/17035",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Assigned to Bill",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2007-10-01T12:24:50.000+0000",
                    "updated": "2007-10-01T12:24:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/19908",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "body": "I like the idea, although the latter 'fetchMode' example may need to be changed slightly. With the example shown, it will change the state of the fetchmode for the entire adapter, whereas currently the fetchmode is only applied on a per-statement basis. But yes, the $bind param is a great idea.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=peptolab",
                        "name": "peptolab",
                        "displayName": "Simon Mundy",
                        "active": true
                    },
                    "created": "2008-03-13T22:43:45.000+0000",
                    "updated": "2008-03-13T22:43:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/20413",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Resetting 'fix version priority' and 'fix version' to be re-evaluated for next release.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-03-25T22:06:44.000+0000",
                    "updated": "2008-03-25T22:06:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/25297",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rhunwicks",
                        "name": "rhunwicks",
                        "displayName": "Roger Hunwicks",
                        "active": true
                    },
                    "body": "I think that this is a great idea, as it is much better to use binding at the database level, rather than quoting at the Zend_Db_Adapter level.\n\nIf we do allow Zend_Db_Select->query() to include a bind, we should also include a bind() method to allow the bind to be set up in advance.\n\nUsing Zend_Paginator is a use case:\n{code:none}\n        $table = new Bugs();\n        $select = $table->select()->where(\"bug_status = :bug_status\")\n                                  ->bind(array(':bug_status' => $this->_getParam('status')));\n        $paginator = Zend_Paginator::factory($select, 'DbTableSelect')\n        $paginator->setCurrentPageNumber($this->_getParam('page')); \n        $this->view->paginator = $paginator;\n{code}\n\nWithout the bind() function there is no easy way to set up the bind variables before passing the Zend_Db_Table_Select to the Zend_Paginator, and consequently you can't use all that Zend_Paginator, View_Renderer, Front_Controller, etc. magic to just fetch the correct rows.\n\nI think this was planned at one time: see [http:\/\/framework.zend.com\/issues\/browse\/ZF-105]\n\nMy additions to Zend_Db_Select to support this:\n{code:none}    \/**\n     * Variables to bind when executing the query\n     *\n     * @var array\n     *\/\n    protected $_bind = array();\n\n    \/**\n     * Set the bind variables for future use\n     *\n     * @param array    $bind\n     * @return Zend_Db_Select This Zend_Db_Select object.\n     *\/\n    public function bind($bind)\n    {\n        $this->_bind = $bind;\n        return $this;\n    }\n\n    \/**\n     * Get the bind variables currently stored for future use\n     *\n     * @return array    $bind\n     *\/\n    public function getBind()\n    {        \n        return $this->_bind;\n    }{code}\n\nAnd then an updated query, slightly different to the one proposed in the Description:\n{code:none}    \/**\n     * Execute the Select statement and return the results\n     * \n     * @param integer $fetchMode OPTIONAL\n     * @param array   $bind      OPTIONAL\n     * @return PDO_Statement|Zend_Db_Statement\n     *\/\n    public function query($fetchMode = null, $bind = array())\n    {\n        if (!empty($bind)) {\n            $this->bind($bind);\n        }\n        $stmt = $this->_adapter->query($this, $this->getBind());\n        if ($fetchMode == null) {\n            $fetchMode = $this->_adapter->getFetchMode();\n        }\n        $stmt->setFetchMode($fetchMode);\n        return $stmt;\n    }{code}\n\nThe getBind() function is required because I think a change to Zend_Db_Table_Abstract is also required. The _fetch() method selects rows using a Zend_Db_Table_Select (which inherits from Zend_Db_Select). This method needs to be aware of the stored bind variables and use them. Hence, the original code:\n{code:none}    protected function _fetch(Zend_Db_Table_Select $select)\n    {\n        $stmt = $this->_db->query($select);\n        $data = $stmt->fetchAll(Zend_Db::FETCH_ASSOC);\n        return $data;\n    }{code}\nwould be replaced by:\n{code:none}    protected function _fetch(Zend_Db_Table_Select $select)\n    {\n        $stmt = $this->_db->query($select, $select->getBind());\n        $data = $stmt->fetchAll(Zend_Db::FETCH_ASSOC);\n        return $data;\n    }{code}\n\nIn particular this is required because Zend_Paginator_Adapter_DbSelect executes $this->_select->getTable()->fetchAll($this->_select) to get the rows, and therefore fetchAll (and hence _fetch) need to know how to access the bind variables it they have been set.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rhunwicks",
                        "name": "rhunwicks",
                        "displayName": "Roger Hunwicks",
                        "active": true
                    },
                    "created": "2008-10-22T08:28:53.000+0000",
                    "updated": "2008-10-22T08:28:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/27822",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "This issue has gone unaddressed for too long. I'm re-assigning to Ralph for re-evaluation and categorization.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2009-01-06T14:30:25.000+0000",
                    "updated": "2009-01-06T14:30:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/27959",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Will evaluate within 2 weeks",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2009-01-10T09:49:46.000+0000",
                    "updated": "2009-01-10T09:49:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29786",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "body": "Attached patch with most suggestions in this thread applied. Will see if I can write some unit tests later on. Ralph, do you have the time to look at this?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "created": "2009-03-27T18:16:21.000+0000",
                    "updated": "2009-03-27T18:16:21.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29794",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "body": "Added an updated patch file, complete with unit tests.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "created": "2009-03-28T16:55:15.000+0000",
                    "updated": "2009-03-28T16:55:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29797",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "body": "Resolved in r. 14528",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=norm2782",
                        "name": "norm2782",
                        "displayName": "Jurrien Stutterheim",
                        "active": true
                    },
                    "created": "2009-03-29T01:56:07.000+0000",
                    "updated": "2009-03-29T01:56:07.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32274",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hedgehog",
                        "name": "hedgehog",
                        "displayName": "Sergey Kolesov",
                        "active": true
                    },
                    "body": "Still does not work properly as of 1.8.4.\n\nDb\\Select.php\n\nline 674 should be:\n\n$stmt = $this->_adapter->query($this, $this->getBind());",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hedgehog",
                        "name": "hedgehog",
                        "displayName": "Sergey Kolesov",
                        "active": true
                    },
                    "created": "2009-06-29T09:18:05.000+0000",
                    "updated": "2009-06-29T09:18:05.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-2017\/transitions"
}