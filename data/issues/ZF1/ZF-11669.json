{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11669",
    "key": "ZF-11669",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Service_Amazon_S3::copyObject is not working"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11669\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tflessak",
                "name": "tflessak",
                "displayName": "Thiago Flessak",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-08-15T22:48:45.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-12-04T16:41:24.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "Zend_Service_Amazon_S3"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "After debugging I found out that the problem is related with Zend_Http_Client:\r\n\r\n{noformat} \r\nif (($method == self::POST || $method == self::PUT || $method == self::DELETE) && $this->enctype === null) {\r\n    $this->setEncType(self::ENC_URLENCODED);\r\n}\r\n{noformat} \r\n\r\nAs copyObject executes a PUT request, I realized that encType can't be URLENCODED."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11669\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zimuel",
                "name": "zimuel",
                "displayName": "Enrico Zimuel",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-11030",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11030",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10980",
                    "id": 10980,
                    "description": "Mini Release",
                    "name": "1.11.10",
                    "userReleaseDate": "04\/Aug\/11",
                    "archived": false,
                    "releaseDate": "2011-08-04",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10022",
                    "id": 10022,
                    "name": "Zend_Service_Amazon",
                    "description": "utility functions for using Amazon web services",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47973",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "body": "Related with ZF-11030 see [r24269|http:\/\/framework.zend.com\/code\/diff.php?repname=Zend+Framework&path=\/standard\/trunk\/library\/Zend\/Http\/Client.php&rev=24269]",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ramon",
                        "name": "ramon",
                        "displayName": "Ramon Henrique Ornelas",
                        "active": true
                    },
                    "created": "2011-08-16T14:24:38.000+0000",
                    "updated": "2011-08-16T14:25:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47974",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tflessak",
                        "name": "tflessak",
                        "displayName": "Thiago Flessak",
                        "active": true
                    },
                    "body": "This issue started after 1.11.10, as long as I know, the ZF 11030 path was applied in this version, consequently, it broke other services.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tflessak",
                        "name": "tflessak",
                        "displayName": "Thiago Flessak",
                        "active": true
                    },
                    "created": "2011-08-16T14:40:56.000+0000",
                    "updated": "2011-08-16T14:40:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48382",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamplumb",
                        "name": "adamplumb",
                        "displayName": "Adam Plumb",
                        "active": true
                    },
                    "body": "I just found this ticket after running into this bug myself.  I'm using 1.11.10 and copyObject isn't working because the signatures aren't matching.  This seems to be because of a urlencoding issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamplumb",
                        "name": "adamplumb",
                        "displayName": "Adam Plumb",
                        "active": true
                    },
                    "created": "2011-09-09T15:05:42.000+0000",
                    "updated": "2011-09-09T15:05:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48568",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tflessak",
                        "name": "tflessak",
                        "displayName": "Thiago Flessak",
                        "active": true
                    },
                    "body": "I can confirm it is related with ZF 11030. After this path, the content-type header is always set if not explicity defined.\r\nThe problem is that for copy operation, if content-type was specified, Amazon S3 expects that it were included in auth header signature.\r\n\r\nI propose the follow path:\r\n\r\n{noformat}\r\n--- S3.php (revision 24083)\r\n+++ S3.php (working copy)\r\n@@ -524,10 +524,12 @@\r\n     {\r\n         $sourceObject = $this->_fixupObjectName($sourceObject);\r\n         $destObject   = $this->_fixupObjectName($destObject);\r\n+        $sourceInfo = $this->getInfo($sourceObject);\r\n \r\n         $headers = (is_array($meta)) ? $meta : array();\r\n         $headers['x-amz-copy-source'] = $sourceObject;\r\n         $headers['x-amz-metadata-directive'] = $meta === null ? 'COPY' : 'REPLACE';\r\n+        $headers['Content-type'] = $sourceInfo['type'];\r\n \r\n         $response = $this->_makeRequest('PUT', $destObject, null, $headers);\r\n\r\n{noformat}\r\n\r\nThis way, content-type header is explicity defined as the same of original object.\r\nIn my tests, this issue doesn't affect  other operations.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tflessak",
                        "name": "tflessak",
                        "displayName": "Thiago Flessak",
                        "active": true
                    },
                    "created": "2011-09-30T14:43:21.000+0000",
                    "updated": "2011-09-30T14:43:21.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49422",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=voukka",
                        "name": "voukka",
                        "displayName": "Vladimir Grigor",
                        "active": true
                    },
                    "body": "I confirm that Thiago's patch works for me.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=voukka",
                        "name": "voukka",
                        "displayName": "Vladimir Grigor",
                        "active": true
                    },
                    "created": "2012-01-05T16:25:44.000+0000",
                    "updated": "2012-01-05T16:25:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49593",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hopka",
                        "name": "hopka",
                        "displayName": "Jan Hapke",
                        "active": true
                    },
                    "body": "Thiago's patch would force the Content-type header to the Content-type of the source object and make it impossible to change the Content-type during the copy operation by passing the $meta array.\r\n\r\nI suggest to only add the header if it is not already specified in the $meta array.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hopka",
                        "name": "hopka",
                        "displayName": "Jan Hapke",
                        "active": true
                    },
                    "created": "2012-02-01T21:51:55.000+0000",
                    "updated": "2012-02-01T21:51:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50655",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dubnut",
                        "name": "dubnut",
                        "displayName": "J B",
                        "active": true
                    },
                    "body": "Came up against this tonight while using 1.11.10. Upgraded to 1.11.11 and still had the problem. Rolled back to an old 1.11.4 just cuz it was there, and the S3 moveObject + copyObject calls started to work again... Point being: Appears to be a problem in .10 + 1.11.11",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dubnut",
                        "name": "dubnut",
                        "displayName": "J B",
                        "active": true
                    },
                    "created": "2012-05-15T05:11:03.000+0000",
                    "updated": "2012-05-15T05:11:03.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52941",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mikereid79",
                        "name": "mikereid79",
                        "displayName": "Michael Reid",
                        "active": true
                    },
                    "body": "I encountered this problem today in the latest build from Zend.  This can be coded around though, rather than using a patch.\r\n\r\n{code:php} \r\n$s = $s3->getInfo($source);\r\n$meta['Content-type'] = $s['type'];\r\nreturn $this->getS3()->copyObject($source, $destination, $meta); \r\n{code} \r\n\r\nHope this helps.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mikereid79",
                        "name": "mikereid79",
                        "displayName": "Michael Reid",
                        "active": true
                    },
                    "created": "2012-12-04T16:41:24.000+0000",
                    "updated": "2012-12-04T16:41:24.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11669\/transitions"
}