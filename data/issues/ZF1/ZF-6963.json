{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6963",
    "key": "ZF-6963",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Search_Lucene::addDocument() fails with invalid file permissions"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6963\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-05-09T02:14:45.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=akzincdig",
                "name": "akzincdig",
                "displayName": "Ashley Kitson",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-06-09T05:42:23.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-05-09T02:14:45.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "If I use following construct to create and use an index:\n    \t$file =  \"\/generated\/search\/index\";\n    \tif (!file_exists($file)) {\n    \t\tself::$_index = Zend_Search_Lucene::create($file);\n    \t} else {\n    \t\tself::$_index = Zend_Search_Lucene::open($file);\n    \t}\n\nAnd a later call to \n\nself::$_index->addDocument($document);\n\nscenario 1 - no index exists\n-------------------------------------\nIf I delete the index directory, the 'Zend_Search_Lucene::create($file)' gets called and the document appears to get indexed except I get a\nFatal error: Exception thrown without a stack frame in Unknown on line 0\n\nReading documentation I added \nself::$_index->commit();\nafter the addDocument() but this doesn't make any difference (i.e. same error).\n\nthe index directory and its components (AFAIK) are created.\n\nscenario 2 - index directory exists (after previous call as per scenario 1)\n------------------------------------------------------------------------------------------------\nfails with \nUncaught 0, code:\nMessage: fopen(\/generated\/search\/index\/write.lock.file) [<a href='function.fopen'>function.fopen<\/a>]: failed to open stream: Permission denied \n\nI checked file permissions and they are:\n\n--w--wx-wT 1 nobody webdev  732 Jun  9 13:25 _0.cfs\n--w--wx-wT 1 nobody webdev    0 Jun  9 13:25 optimization.lock.file\n-rw-rw-rw- 1 nobody webdev    0 Jun  9 13:27 read.lock.file\n-rw-rw-rw- 1 nobody webdev   20 Jun  9 13:25 segments_1\n-rw-rw-rw- 1 nobody webdev   20 Jun  9 13:25 segments.gen\n--w--wx-wT 1 nobody webdev    0 Jun  9 13:25 write.lock.file\n\nMy system details:\nOS = Red Hat RHEL5 64bit\nPHP Version \t5.2.4\nServer Software  \tApache\/2.2.4 \n\nI've searched across the issue tracker and the only thing that seems to crop up is that the system is 64bit and there have been some problems in that area. Is this one of them?  Are there other checks I can make to try and determine if this is a bug?"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/1",
                "name": "Blocker"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6963\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                "name": "adamlundrigan",
                "displayName": "Adam Lundrigan",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10330",
                    "id": 10330,
                    "description": "Mini Release",
                    "name": "1.8.2",
                    "userReleaseDate": "27\/May\/09",
                    "archived": false,
                    "releaseDate": "2009-05-27",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10021",
                    "id": 10021,
                    "name": "Zend_Search_Lucene",
                    "description": "pure PHP robust, general purpose text search engine",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32280",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gkamp",
                        "name": "gkamp",
                        "displayName": "Gerrit Kamp",
                        "active": true
                    },
                    "body": "Hi, I have the same problem. Funny thing is that it works fine in one folder with one owner and it does not work in another folder with another owner so it cannot be the OS or the 64bit. Issue is serious for me because one site with paying customers now don't have search... ;-(. Please let me know how I can help to resolve this asap. Cheers, Gerrit",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gkamp",
                        "name": "gkamp",
                        "displayName": "Gerrit Kamp",
                        "active": true
                    },
                    "created": "2009-06-29T15:22:50.000+0000",
                    "updated": "2009-06-29T15:22:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32281",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gkamp",
                        "name": "gkamp",
                        "displayName": "Gerrit Kamp",
                        "active": true
                    },
                    "body": "I have some info that may help. As explained, I run the same reindex script from two different user accounts. First one:\n\/home\/user1\/public_html\/var\/search_index\/\nStart with emtpy var\/search_index folder.\nRun 'reindex' script.\nCreates:\n1 segments_xx file\nset of .cfs files\noptimization.lock.file (0 bytes)\nread.lock.file (0 b)\nwrite.lock.file (0 b)\nsegments.gen (20 b)\nset of .sti files\n\nOwner of all files is user_1, owner of the folders in which the script is run. File rights in var\/search_index\/ are all 0666. Folder rights are 0755.\n\n\nPrecisely script for user_2, same script, same data.\nStart with empty var\/search_index folder.\nRun 'reindex' script.\nCreates:\n1 segments_1 file\nread.lock.file (0b)\nwrite.lock.file (0b)\nsegments.gen (20b)\n\nNothing more, no error stack, script hangs (white screen).\n\nOwner of all files and folders is user_2\n\n\nNow, I create the full index on a local machine and then copy it to the var\/search_index folder for user_2, as user_2.\nThen, of course, the search works. But still cannot reindex.\nChown 666 (was 664)\nRun 'reindex' script.\nAn extra segments_xy file is added, size 20b, the older segments_xx file is not removed. Index is not updated.\nRun 'reindex' script again: an extra segments_xz file is added, size 20b, the older segment_xx and xy files are not removed. Index not updated.\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gkamp",
                        "name": "gkamp",
                        "displayName": "Gerrit Kamp",
                        "active": true
                    },
                    "created": "2009-06-29T17:47:50.000+0000",
                    "updated": "2009-06-29T17:47:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32402",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gkamp",
                        "name": "gkamp",
                        "displayName": "Gerrit Kamp",
                        "active": true
                    },
                    "body": "Hi guys,\nYou can ignore my comments, I have solved it for me. Turns out that one of the classes of the Zend Framework was not copied to my 2nd instance which caused the error. Had nothing to do with the permissions.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=gkamp",
                        "name": "gkamp",
                        "displayName": "Gerrit Kamp",
                        "active": true
                    },
                    "created": "2009-07-05T11:35:16.000+0000",
                    "updated": "2009-07-05T11:35:16.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6963\/transitions"
}