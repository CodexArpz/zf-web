{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1354",
    "key": "ZF-1354",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Controller_Action lacks view dependency injection"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1354\/votes",
                "votes": 2,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10023",
                    "id": 10023,
                    "description": "Release Candidate 1",
                    "name": "1.0.0 RC1",
                    "userReleaseDate": "28\/May\/07",
                    "archived": true,
                    "releaseDate": "2007-05-28",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-05-24T15:28:58.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-05-06T14:09:19.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-05T14:44:08.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I would consider ZF feature complete when I can use ZF and build and entire basic application with commonplace methods, without having once to extend a single class.  IMO, to extend is to add value that is too specific for the 80\/20.\n\nOne of the last pieces of that puzzle for me, in the case of Zend_Controller_Action, is to not have to extend Zend_Controller_Action to be able to inject a specific view object.  To me its important to have a single view object since now view helpers can optionally share a variable space within that view.\n\nTo accomplish this level of dependency injection, I suggest that the current initView() \/ render() \/ getScriptName() undergo some mutation.\n\nInitially, i think the following invoke parameters should be allowed for view configuration:\nview\nviewSetBasePath\nviewAddScriptPath\nviewAddHelperPath\nviewAddHelperPrefix\nviewAddFilterPath\nviewScriptName\n\nAdditionally, I would like to add the following proof-of-concept (Xend_Controller_Action) that runtime view object configuration is not only possible but adds much value to Zend_Controller_Action.  It would allow the following simple usage (as well as others in init())\n\n{code}\n\/\/ in bootstrap file\n    $controller->setControllerDirectory('..\/application\/user\/default\/controllers')\n               ->setParam('viewSetBasePath', ':moduleDir\/views\/')\n               ->setParam('viewScriptName', ':action-name.phtml')\n               ->setParam('view', $view);\n{code}\n\n{code}\n<?php\n\n\/** Zend_Controller_Exception *\/\nrequire_once 'Zend\/Controller\/Action.php';\n\nabstract class Xend_Controller_Action extends Zend_Controller_Action\n{\n\n    \/**\n     * View object\n     * @var Zend_View_Interface\n     *\/\n    public $view = null;\n\n    \/**\n     * View script base path\n     * @see {render()}\n     * @var string\n     *\/\n    public $viewBasePath = ':moduleDir\/views\/';\n    \n    \/**\n     * View script file name\n     * @see {render()}\n     * @var string\n     *\/\n    public $viewScriptName = ':controller_name\/:action_name.phtml';\n    \n    \/**\n     * Render a view\n     *\n     * Renders a view. By default, views are found in the view script path as\n     * <controller>\/<action>.phtml. You may change the script suffix by \n     * resetting {@link $viewSuffix}. You may omit the controller directory\n     * prefix by specifying boolean true for $noController.\n     *\n     * By default, the rendered contents are appended to the response. You may \n     * specify the named body content segment to set by specifying a $name.\n     *\n     * @see Zend_Controller_Response_Abstract::appendBody()\n     * @param  string|null $action Defaults to action registered in request object\n     * @param  string|null $name Response object named path segment to use; defaults to null\n     * @param  bool $noController  Defaults to false; i.e. use controller name as subdir in which to search for view script\n     * @return void\n     *\/\n    public function render($action = null, $name = null, $noController = false)\n    {\n        $view   = $this->initView();\n        $script = $this->getViewScript($action);\n\n        $this->getResponse()->appendBody(\n            $view->render($script),\n            $name\n        );\n    }\n    \n    \/**\n     * Initialize View object \n     *\n     * Initializes {@link $view} if not otherwise a Zend_View_Interface.\n     *\n     * If {@link $view} is not otherwise set, instantiates a new Zend_View \n     * object, using the 'views' subdirectory at the same level as the \n     * controller directory for the current module as the base directory. \n     * It uses this to set the following:\n     * - script path = views\/scripts\/\n     * - helper path = views\/helpers\/\n     * - filter path = views\/filters\/\n     * \n     * @return Zend_View_Interface\n     * @throws Zend_Controller_Exception if base view directory does not exist\n     *\/\n    public function initView()\n    {\n        $viewConfigure   = $this->getInvokeArg('viewConfigure');\n        $viewSetBasePath = $this->getInvokeArg('viewSetBasePath');\n        \n        require_once 'Zend\/View\/Interface.php';\n        if (isset($this->view) && ($this->view instanceof Zend_View_Interface)) {\n            return $this->view;\n        } elseif ( ($invokeView = $this->getInvokeArg('view')) instanceof Zend_View_Interface) {\n            $this->view = $invokeView;\n        } else {\n            require_once 'Zend\/View.php';\n            $this->view = new Zend_View();\n            $viewConfigure = true;\n        }\n        \n        if ($viewConfigure || (count(array_intersect(array('viewSetBasePath', 'viewAddScriptPath', 'viewAddHelperPath', 'viewAddHelperPrefix', 'viewAddFilterPath', 'viewScriptName'), array_keys($this->getInvokeArgs()))) > 0) ) {\n            $this->viewConfigure();\n        }\n        \n        return $this->view;\n    }\n\n    \/**\n     * Construct view script path\n     *\n     * Used by render() to determine the path to the view script.\n     * \n     * @param  string $action Defaults to action registered in request object\n     * @param  bool $noController  Defaults to false; i.e. use controller name as subdir in which to search for view script\n     * @return string\n     * @throws Zend_Controller_Exception with bad $action\n     *\/\n    public function getViewScript($action = null, $noController = false)\n    {\n        $request = $this->getRequest();\n        if (null === $action) {\n            $action = $request->getActionName();\n        } elseif (!is_string($action)) {\n            throw new Zend_Controller_Exception('Invalid action specifier for view render');\n        }\n\n        $viewScriptName = $this->getInvokeArg('viewScriptName');\n        if ($viewScriptName === null) {\n            $viewScriptName = $this->viewScriptName;\n        }\n        \n        $script = $this->_translateViewPath($viewScriptName);\n        \n        return $script;\n    }\n        \n    public function viewConfigure()\n    {\n        \n        $available_directives = array('viewSetBasePath', 'viewAddScriptPath', 'viewAddHelperPath', 'viewAddHelperPrefix', 'viewAddFilterPath', 'viewScriptName');\n        $executable_directives = array_intersect($available_directives, array_keys($this->getInvokeArgs()));\n        \n        if (count($executable_directives) == 0) {\n            $executable_directives = array('viewSetBasePath');\n        }\n        foreach ($executable_directives as $execute_directive) {\n            switch ($execute_directive) {\n                case 'viewSetBasePath':\n                    $basePath = ($this->getInvokeArg('viewSetBasePath')) ? $this->getInvokeArg('viewSetBasePath') : $this->viewBasePath;\n                    $this->view->setBasePath($this->_translateViewPath($basePath));\n                    break;\n                case 'viewAddScriptPath':\n                case 'viewAddFilterPath':\n                    $command = str_replace('view', '', $execute_directive);\n                    $this->view->$command($this->_translateViewPath($this->getInvokeArg($execute_directive)));\n                    break;\n                case 'viewAddHelperPath':\n                    $this->addHelperPath($this->getInvokeArg($execute_directive), $this->getInvokeArg('viewAddHelperPrefix'));\n                    break;\n            }\n        }\n    }\n\n    private function _translateViewPath($path)\n    {\n        $available_replacements = array('moduleDir', 'controllerDir', 'controllerName', 'controller_name', 'actionName', 'action_name');\n        \n        \/\/ gather some info from outside.\n        $request        = $this->_request;\n        $wordDelim      = $this->getFrontController()->getDispatcher()->getWordDelimiter();\n        $controllerDirs = $this->getFrontController()->getControllerDirectory();\n        $controllerDir  = (array_key_exists($request->getModuleName(), $controllerDirs)) ? $controllerDirs[$request->getModuleName()] : $controllerDirs['default'];\n        $moduleDir      = dirname($controllerDir);\n        \n        \/\/ eval'ed for performance - on demand\n        $replacements = array(\n            ':controllerDir'   => '$rpath = $controllerDir;',\n            ':moduleDir'       => '$rpath = $moduleDir;',\n            ':moduleName'      => '$rpath = str_replace(\" \", \"\", ucwords(strreplace($wordDelim, \" \", strtolower($request->getModuleName()))));',\n            ':module_name'     => '$rpath = str_replace(\" \", \"_\", str_replace($wordDelim, \" \", strtolower($request->getModuleName())));',\n            ':module-name'     => '$rpath = str_replace(\" \", \"-\", str_replace($wordDelim, \" \", strtolower($request->getModuleName())));',\n            ':controllerName'  => '$rpath = str_replace(\" \", \"\", ucwords(str_replace($wordDelim, \" \", strtolower($request->getControllerName()))));',\n            ':controller_name' => '$rpath = str_replace(\" \", \"_\", str_replace($wordDelim, \" \", strtolower($request->getControllerName())));',\n            ':controller-name' => '$rpath = str_replace(\" \", \"-\", str_replace($wordDelim, \" \", strtolower($request->getControllerName())));',\n            ':actionName'      => '$rpath = str_replace(\" \", \"\", ucwords(str_replace($wordDelim, \" \", strtolower($request->getActionName()))));',\n            ':action_name'     => '$rpath = str_replace(\" \", \"_\", str_replace($wordDelim, \" \", strtolower($request->getActionName())));',\n            ':action-name'     => '$rpath = str_replace(\" \", \"-\", str_replace($wordDelim, \" \", strtolower($request->getActionName())));'\n            );\n        \n        foreach ($replacements as $replacement_key => $replacement_value) {\n            if (preg_match('\/'.$replacement_key.'\/', $path)) {\n                eval($replacement_value);\n                $path = preg_replace('\/'.$replacement_key.'\/', $rpath, $path);\n            }\n        }\n\n        return $path;\n    }\n\n}\n\n{code}\n\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1354\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10070",
                    "id": 10070,
                    "description": "Beta Release; bug fixes",
                    "name": "0.9.2",
                    "userReleaseDate": "06\/Apr\/07",
                    "archived": true,
                    "releaseDate": "2007-04-06",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10011",
                    "id": 10011,
                    "name": "Zend_Controller",
                    "description": "front controller, including router and dispatcher",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14484",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kingcrunch",
                        "name": "kingcrunch",
                        "displayName": "Sebastian Krebs",
                        "active": true
                    },
                    "body": "Especially for specify an own viewScriptName i would prefer such a behaviour, because i use naming for Views like its used by Controllers (Index\/IndexView.phtml). Now i have to overwrite the hole initView-Method",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kingcrunch",
                        "name": "kingcrunch",
                        "displayName": "Sebastian Krebs",
                        "active": true
                    },
                    "created": "2007-05-06T16:07:02.000+0000",
                    "updated": "2007-05-06T16:07:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14515",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shakie",
                        "name": "shakie",
                        "displayName": "Shaun Rowe",
                        "active": true
                    },
                    "body": "I would be very keen to see this improvement brought to the core. I also have in place a similar extension to Zend_Controller_Action",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=shakie",
                        "name": "shakie",
                        "displayName": "Shaun Rowe",
                        "active": true
                    },
                    "created": "2007-05-07T19:04:32.000+0000",
                    "updated": "2007-05-07T19:04:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14562",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=klassicd",
                        "name": "klassicd",
                        "displayName": "michael depetrillo",
                        "active": true
                    },
                    "body": "This is a good idea but I don't think you need all those parameters.\n\nIf Zend_Controller_Action could simply look for a param named 'view' in the front controller then subclassing the action controller would not be necessary.\n\nDevelopers should be able to set the view script\/helper\/filter path in the bootstrap or via a plugin.  \n\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=klassicd",
                        "name": "klassicd",
                        "displayName": "michael depetrillo",
                        "active": true
                    },
                    "created": "2007-05-11T23:26:41.000+0000",
                    "updated": "2007-05-11T23:26:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14563",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "if you set a hard coded path in your bootstrap, then you leave out the possibilities (and best practices IMO) of being able to house your modules view scripts within your modules directory.  Since there could be many different paths to your modules, you can't set a hard coded path at bootstrap time, you only know the skeleton of the path RELATIVE to the dispatched module\/controller.. and the script name is relative to the action dispatched.  So if I have deployed an application with the Conventional\/or Classical Modular Directory Structure (http:\/\/framework.zend.com\/wiki\/display\/ZFDEV\/Choosing+Your+Application%27s+Directory+Layout), then your path to your view scripts will not be completely known until the actions initView() and getScriptName() methods are called.\n\nMake sense?\n-ralph",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2007-05-12T09:27:58.000+0000",
                    "updated": "2007-05-12T09:27:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14665",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I've spoken briefly with Ralph about this off-list, but I'm bringing it back here. I'm worried about adding code such as he suggests as it introduces a lot of coupling between the components. While I realize that both Zend_Controller_Action and Zend_View are components of MVC and should have some coupling, I'm worried that introducing this type of functionality explicitly in the action controller will lead to maintenance headaches later should, for instance, the design of Zend_View change.\n\nIt appears to me that the following goals are desired:\n\n* Globally available view object for all controllers and actions\n* No need to explicitly instantiate view object within controllers\n* Class prefixes for view helpers and filters based on current module; ability to autospecify these\n* Ability to set default view rendering options for all controllers\n* Ability to autorender (i.e., no explicit call to render() required\n\nAs it turns out, we already have a way to accomplish all of the above: via an action controller helper.\n\nIf you set an action controller helper from your bootstrap, it will be globally available to any action controller. Additionally, action controller helpers tie in to preDispatch() and postDispatch(), allowing us to set options in the view object automatically prior to executing a controller's action method, and also perform actions after the action method is done -- such as rendering.  Additionally, we have access to the request object, allowing us to determine the current module, and thus the path to view scripts and a class prefix to use with helpers and filters.\n\nI'm attaching a proof of concept below. The usage is pretty nice:\n\n{code}\n\/\/ in your bootstrap (needed so helper is present at preDispatch()):\nZend_Controller_Action_HelperBroker::addHelper(new Zend_Controller_Action_Helper_View());\n\n\/\/ and a controller class, foo module:\nclass Foo_BarController extends Zend_Controller_Action\n{\n    \/\/ renders bar\/index.phtml by default; no action required\n    public function indexAction()\n    {\n    }\n\n    \/\/ render bar\/form.phtml instead of bar\/baz.phtml\n    public function bazAction()\n    {\n        $this->_helper->view('form');\n    }\n\n    \/\/ don't render anything\n    public function hideAction()\n    {\n        $this->_helper->view->noRender();\n    }\n\n    \/\/ renders bar\/populate.phtml with variable 'foo' set to 'bar'\n    public function populateAction()\n    {\n        $this->view->foo = 'bar';\n    }\n}\n\n\/\/ in one of your view scripts:\n<?php $this->foo(); \/\/ call Foo_Bar_View_Helper_Foo::foo() ?>\n{code}\n\nAs you can see, it simplifies code tremendously in the controllers, and offers quite a lot of flexibility. You can also at any time set a customized view object into it, or pull out the view object and modify it (clear variables, set new paths, etc.).\n\nThe advantage to this is that it keeps the action controller code very specific to its primary task; it simply acts as the glue between a controller and a view.  Additionally, it's completely optional: if you don't want to use it, you don't have to; if your code requires a different approach to views, dont' use it.\n\nThoughts?\n\n{code}\n<?php\nclass Zend_Controller_Action_Helper_View extends Zend_Controller_Action_Helper_Abstract\n{\n    \/**\n     * @var Zend_View_Interface\n     *\/\n    public $view;\n\n    \/**\n     * Front controller instance\n     * @var Zend_Controller_Front\n     *\/\n    protected $_frontController;\n\n    \/**\n     * Whether or not to use a controller name as a subdirectory when rendering\n     * @var boolean\n     *\/\n    protected $_noController    = false;\n\n    \/**\n     * Whether or not to autorender postDispatch\n     * @var boolean\n     *\/\n    protected $_noRender        = false;\n\n    \/**\n     * Which named segment of the response to utilize\n     * @var string\n     *\/\n    protected $_responseSegment = null;\n\n    \/**\n     * Which action view script to render\n     * @var string\n     *\/\n    protected $_scriptAction    = null;\n\n    \/**\n     * View script suffix\n     * @var string\n     *\/\n    protected $_viewSuffix      = 'phtml';\n\n    public function setView(Zend_View_Interface $view)\n    {\n        $this->view = $view;\n    }\n\n    \/**\n     * Retrieve front controller instance\n     * \n     * @return Zend_Controller_Front\n     *\/\n    public function getFrontController()\n    {\n        if (null === $this->_frontController) {\n            $this->_frontController = Zend_Controller_Front::getInstance();\n        }\n\n        return $this->_frontController;\n    }\n\n    protected function _generateDefaultPrefix()\n    {\n        if (null === $this->_actionController) {\n            return 'Zend_View_Helper';\n        }\n\n        $class = get_class($this->_actionController);\n\n        if (!strstr($class, '_')) {\n            $prefix = 'Zend_View_Helper';\n        } else {\n            $prefix = substr($class, 0, strpos($class, '_')) . '_View_Helper';\n        }\n\n        return $prefix;\n    }\n\n    \/**\n     * Retrieve base path based on location of \n     * \n     * @return void\n     *\/\n    protected function _getBasePath()\n    {\n        if (null === $this->_actionController) {\n            return '.' . DIRECTORY_SEPARATOR . 'views';\n        }\n\n        $front      = $this->getFrontController();\n        $modulePath = $front->getControllerDirectory($this->getRequest()->getModuleName());\n        if (null === $modulePath) {\n            throw new Zend_Controller_Action_Exception('Cannot determine view base path: invalid module \"' . $module . '\"in request');\n\n        }\n        $path = realpath($modulePath . DIRECTORY_SEPARATOR . '..' . DIRECTORY_SEPARATOR . 'views');\n        return $path;\n    }\n\n    \/**\n     * Initialize the view object\n     *\n     * $options may contain the following keys:\n     * - noController - flag indicating whether or not to look for view scripts in subdirectories named after the controller\n     * - noRender - flag indicating whether or not to autorender postDispatch()\n     * - responseSegment - which named response segment to render a view script to\n     * - scriptAction - what action script to render\n     * - viewSuffix - what view script filename suffix to use\n     * \n     * @param  string $path \n     * @param  string $prefix \n     * @param  array $options \n     * @return void\n     *\/\n    public function initView($path = null, $prefix = null, array $options = array())\n    {\n        if (null === $this->view) {\n            $this->setView(new Zend_View());\n        }\n\n        if (null === $path) {\n            $path = $this->_getBasePath();\n        }\n\n        if (null === $prefix) {\n            $prefix = $this->_generateDefaultPrefix();\n        }\n\n        $this->view->addBasePath($path, $prefix);\n\n        $this->_noRender        = false;\n        $this->_responseSegment = null;\n        $this->_scriptAction    = null;\n\n        foreach ($options as $key => $value)\n        {\n            switch ($key) {\n                case 'noController':\n                case 'noRender':\n                    $property = '_' . $key;\n                    $this->{$property} = ($value) ? true : false;\n                    break;\n                case 'responseSegment':\n                case 'scriptAction':\n                case 'viewSuffix':\n                    $property = '_' . $key;\n                    $this->{$property} = (string) $value;\n                    break;\n                default:\n                    break;\n            }\n        }\n\n        if ((null !== $this->_actionController) && (null === $this->_actionController->view)) {\n            $this->_actionController->view       = $this->view;\n            $this->_actionController->viewSuffix = $this->_viewSuffix;\n        }\n    }\n\n    \/**\n     * preDispatch - initialize view\n     * \n     * @return void\n     *\/\n    public function preDispatch()\n    {\n        $this->initView();\n    }\n\n    \/**\n     * Set the noRender flag (i.e., whether or not to autorender)\n     * \n     * @param  boolean $flag \n     * @return Wopnet_Controller_Helper_View\n     *\/\n    public function setNoRender($flag = true)\n    {\n        $this->_noRender = ($flag) ? true : false;\n        return $this;\n    }\n\n    \/**\n     * Retrieve noRender flag value\n     * \n     * @return boolean\n     *\/\n    public function getNoRender()\n    {\n        return $this->_noRender;\n    }\n\n    \/**\n     * Set the view script to use\n     * \n     * @param  string $name \n     * @return Wopnet_Controller_Helper_View\n     *\/\n    public function setScriptAction($name)\n    {\n        $this->_scriptAction = (string) $name;\n        return $this;\n    }\n\n    \/**\n     * Retrieve view script name\n     * \n     * @return string\n     *\/\n    public function getScriptAction()\n    {\n        return $this->_scriptAction;\n    }\n\n    \/**\n     * Set the response segment name\n     * \n     * @param  string $name \n     * @return Wopnet_Controller_Helper_View\n     *\/\n    public function setResponseSegment($name)\n    {\n        $this->_responseSegment = (string) $name;\n        return $this;\n    }\n\n    \/**\n     * Retrieve named response segment name\n     * \n     * @return string\n     *\/\n    public function getResponseSegment()\n    {\n        return $this->_responseSegment;\n    }\n\n    \/**\n     * Set the noController flag (i.e., whether or not to render into controller subdirectories)\n     * \n     * @param  boolean $flag \n     * @return Wopnet_Controller_Helper_View\n     *\/\n    public function setNoController($flag = true)\n    {\n        $this->_noController = ($flag) ? true : false;\n        return $this;\n    }\n\n    \/**\n     * Retrieve noController flag value\n     * \n     * @return boolean\n     *\/\n    public function getNoController()\n    {\n        return $this->_noController;\n    }\n\n    \/**\n     * Set options for rendering a view script\n     * \n     * @param  string $action View script to render\n     * @param  string $name Response named segment to render to\n     * @param  boolean $noController Whether or not to render within a subdirectory named after the controller\n     * @return Wopnet_Controller_Helper_View\n     *\/\n    public function setRender($action = null, $name = null, $noController = false)\n    {\n        $this->_scriptAction    = (string) $action;\n        $this->_responseSegment = (string) $name;\n        $this->_noController    = ($noController) ? true : false;\n\n        return $this;\n    }\n\n    \/**\n     * postDispatch - auto render a view\n     *\n     * Only autorenders if: \n     * - _noRender is false\n     * - action controller is present\n     * - request has not been re-dispatched (i.e., _forward() has not been called)\n     * \n     * @return void\n     *\/\n    public function postDispatch()\n    {\n        if (!$this->_noRender \n            && (null !== $this->_actionController)\n            && $this->getRequest()->isDispatched())\n        {\n            $this->_actionController->render($this->_scriptAction, $this->_responseSegment, $this->_noController);\n        }\n    }\n\n    \/**\n     * Use this helper as a method; proxies to setRender()\n     * \n     * @param  string $action \n     * @param  string $name \n     * @param  boolean $noController \n     * @return void\n     *\/\n    public function direct($action = null, $name = null, $noController = false)\n    {\n        $this->setRender($action, $name, $noController);\n    }\n}\n{code}\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2007-05-18T12:57:17.000+0000",
                    "updated": "2007-05-18T12:57:17.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14673",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Ralph and I have discussed this offline, and are breaking it into two phases.\n\n* ViewRenderer action helper (as proposed above) to tackle view injection\n* ability to specify view base path and view script path spec via router like paths\n\nThe first has been committed to the incubator. The second will be worked on separately, and may be incorporated in the ViewRenderer at a later date.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2007-05-18T15:05:57.000+0000",
                    "updated": "2007-05-18T15:05:57.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14707",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I have added a new method to Zend_Controller_Action, renderScript(), which takes a specific script path and name, as well as a response segment; this will allow helpers such as the ViewRenderer to implement their own logic for determining the script name and then rendering it. At this point, the infrastructure is now in place to allow injection of the sort Ralph outlines.\n\nI have received the go-ahead to commit the ViewRenderer to core, and will do so this week.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2007-05-22T07:39:04.000+0000",
                    "updated": "2007-05-22T07:39:04.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14709",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I've promoted the component to core, and contacted Ralph to see if he wants to implement the script path customizations now or at a later date.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2007-05-22T13:51:50.000+0000",
                    "updated": "2007-05-22T13:51:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14750",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I have implemented the initial functionality to allow script path customizations to core, but it currently breaks tests; I should have changes ready sometime Thursday, 24 May 2007.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2007-05-24T08:29:26.000+0000",
                    "updated": "2007-05-24T08:29:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14754",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Zend_Controller_Action_Helper_ViewRenderer is in core and supports the following:\n\n* Initialize view object in action controller automatically\n* Render view automatically when action ends\n* Allow injecting custom path specifications to use when setting view base path and view script paths\n\nThis helper will be on by default with the 1.0.0RC1 release.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2007-05-24T15:28:58.000+0000",
                    "updated": "2007-05-24T15:28:58.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1354\/transitions"
}