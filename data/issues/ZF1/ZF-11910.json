{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11910",
    "key": "ZF-11910",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_View_Helper_HeadMeta fatal error when no View object is set"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11910\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-05-08T18:38:25.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=arleen",
                "name": "arleen",
                "displayName": "Tymoteusz Paul",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-11-24T12:47:14.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-05-08T18:38:25.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "error"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "$headmeta = new Zend_View_Helper_HeadMeta();\r\n$width = 320;\r\n$min_scale = 1;\r\n$max_scale = 1;\r\n$headmeta->headMeta()->appendName('viewport',\"$width, minimum-scale=$min_scale, maximum-scale=$max_scale, user-scalable=no\");\r\n\r\nThis is part of source code of My_Controller_Plugin_DevicePresets extends Zend_Controller_Plugin_Abstract, so it's a plugin controller. Running this code causes a fatal error:\r\nFatal error: Call to a member function doctype() on a non-object in ZendFramework\\library\\Zend\\View\\Helper\\HeadMeta.php on line 212.\r\n\r\nWhich is (roughly):\r\n\r\nif (!$this->view->doctype()->isRdfa()\r\n\r\nI noticed this bug when decided to update ZF lib from 1.11.2 to 1.11.6, and that it's also there with latest release."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11910\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "FixForZF1.12",
                "View_Helper",
                "zf-caretaker-adamlundrigan",
                "zf-crteam-review"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                "name": "adamlundrigan",
                "displayName": "Adam Lundrigan",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/14967",
                    "filename": "ZF-11910.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2012-03-20T23:37:47.000+0000",
                    "size": 2259,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/14967\/ZF-11910.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10580",
                    "id": 10580,
                    "description": "Mini Release",
                    "name": "1.11.6",
                    "userReleaseDate": "05\/May\/11",
                    "archived": false,
                    "releaseDate": "2011-05-05",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10680",
                    "id": 10680,
                    "description": "Mini Release",
                    "name": "1.11.7",
                    "userReleaseDate": "02\/Jun\/11",
                    "archived": false,
                    "releaseDate": "2011-06-02",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10780",
                    "id": 10780,
                    "description": "Mini Release",
                    "name": "1.11.8",
                    "userReleaseDate": "07\/Jul\/11",
                    "archived": false,
                    "releaseDate": "2011-07-07",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10880",
                    "id": 10880,
                    "description": "Mini Release",
                    "name": "1.11.9",
                    "userReleaseDate": "14\/Jul\/11",
                    "archived": false,
                    "releaseDate": "2011-07-14",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10980",
                    "id": 10980,
                    "description": "Mini Release",
                    "name": "1.11.10",
                    "userReleaseDate": "04\/Aug\/11",
                    "archived": false,
                    "releaseDate": "2011-08-04",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10981",
                    "id": 10981,
                    "description": "Mini Release",
                    "name": "1.11.11",
                    "userReleaseDate": "29\/Sep\/11",
                    "archived": false,
                    "releaseDate": "2011-09-29",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10026",
                    "id": 10026,
                    "name": "Zend_View",
                    "description": "View portion of the ZF MVC",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49190",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "The {{Zend_View_Helper_HeadMeta}} class requires an instance of {{Zend_View}}, and does not adequately check to ensure one is provided before trying to call other view helpers.  I would either pull the instance of {{Zend_View}} from your application and inject it into HeadMeta...but passing in a new instance works too:\r\n{code}\r\n$headmeta = new Zend_View_Helper_HeadMeta();\r\n$headmeta->setView(new Zend_View());\r\n...\r\n{code}\r\n\r\nI think the view helper should be updated to do the above automatically if no {{Zend_View}} instance is provided to the helper before it's used.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-11-30T14:19:06.000+0000",
                    "updated": "2011-11-30T14:20:04.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49191",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=arleen",
                        "name": "arleen",
                        "displayName": "Tymoteusz Paul",
                        "active": true
                    },
                    "body": "I worked around it by rolling back ZF library to 1.11.2 and this is my main issue here - is that a change i have missed (and if it is, then why helper doesn't throw an exception about missing view before error strikes?) or just an error somewhere?\r\nI don't really have the time to do a regression test and check where the problem lays.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=arleen",
                        "name": "arleen",
                        "displayName": "Tymoteusz Paul",
                        "active": true
                    },
                    "created": "2011-11-30T14:37:55.000+0000",
                    "updated": "2011-11-30T14:37:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49194",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "The code causing the issue (call to $this->view->doctype()->isRdfa()) was added in 1.11.3 (see ZF-9743), and so any use of {{Zend_View_Helper_HeadMeta}} without first providing a {{Zend_View}} object is broken since that release.\r\n\r\nThe simplest fix is this: \r\n{code}\r\nIndex: library\/Zend\/View\/Helper\/HeadMeta.php\r\n===================================================================\r\n--- library\/Zend\/View\/Helper\/HeadMeta.php (revision 24569)\r\n+++ library\/Zend\/View\/Helper\/HeadMeta.php (working copy)\r\n@@ -209,7 +209,7 @@\r\n         }\r\n\r\n         \/\/ <meta property= ... \/> is only supported with doctype RDFa\r\n-        if (!$this->view->doctype()->isRdfa()\r\n+        if ( !is_null($this->view) && !$this->view->doctype()->isRdfa()\r\n             && $item->type === 'property') {\r\n             return false;\r\n         }\r\n{code}\r\nIf there is no view then there is no doctype to parse, and so we have to assume it's HTML (and not RDF) so we can safely short-circuit that if statement in this case.  I'll work up a more complete fix w\/ unit tests when I get a chance.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-11-30T14:58:52.000+0000",
                    "updated": "2011-11-30T14:58:52.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50086",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Attached patch which protects helper against calls to {{$this->view}} when no view has been provided.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2012-03-20T23:37:47.000+0000",
                    "updated": "2012-03-20T23:37:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50524",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Fixed in trunk (1.12.0): r24776",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2012-05-08T18:38:25.000+0000",
                    "updated": "2012-05-08T18:38:25.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11910\/transitions"
}