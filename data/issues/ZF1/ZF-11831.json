{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11831",
    "key": "ZF-11831",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Form's default translator incorrectly passed to subforms, causing override of subform elements' default translators"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11831\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/11080",
                    "id": 11080,
                    "description": "Mini Release",
                    "name": "1.11.12",
                    "userReleaseDate": "22\/Jun\/12",
                    "archived": false,
                    "releaseDate": "2012-06-22",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-10-21T01:33:01.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coolsurfers",
                "name": "coolsurfers",
                "displayName": "Bjoern Mueller",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-10-19T21:01:18.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-10-21T01:56:36.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "Zend_Form"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "If a form is validated, the translator of the form will be passed through all subforms. It's the same bug as ZF-9330 (for form elements) which was resolved long ago except that subforms were left out while fixing. \r\n\r\nOnly add \"$this->hasTranslator()\" in Form.php line 2261 (1.11.11) as it was done in line 2246 for elements\r\n\r\n        foreach ($this->getSubForms() as $key => $form) {\r\n            if (null !== $translator && $this->hasTranslator()\r\n                    && !$form->hasTranslator()) {\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11831\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "translation",
                "validating",
                "zend-form",
                "zf-caretaker-adamlundrigan"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                "name": "adamlundrigan",
                "displayName": "Adam Lundrigan",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-9364",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9364",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/14699",
                    "filename": "ZF-11831.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-10-20T18:12:05.000+0000",
                    "size": 2541,
                    "mimeType": "text\/x-patch",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/14699\/ZF-11831.patch"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/14700",
                    "filename": "ZF-11831_v2.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-10-21T00:50:59.000+0000",
                    "size": 2311,
                    "mimeType": "text\/x-patch",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/14700\/ZF-11831_v2.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10981",
                    "id": 10981,
                    "description": "Mini Release",
                    "name": "1.11.11",
                    "userReleaseDate": "29\/Sep\/11",
                    "archived": false,
                    "releaseDate": "2011-09-29",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48749",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "The Form\/SubForm case is a special one. As a Form and an Element are completely separate entities, they can each have their own default translators (set via {{setDefaultTranslator}} method). However, SubForm is a sub-class of Form, and since the default translator is stored in a static class variable of {{Zend_Form}}, all forms and sub-forms share the same default translator.  Determining an element's translator is a four step process:\r\n# If a validator was set with {{setValidator}}, return it.\r\n# If no validator was set, but a default validator was set with {{setDefaultValidator}}, return it.\r\n# If no default validator was set either, look up the key {{Zend_Validate}} in {{Zend_Registry}} and return it.\r\n# If no key {{Zend_Validate}} exists in {{Zend_Registry}}, return null\r\n\r\nThe only case where your suggested addition would make an impact is when {{$this->hasTranslator()}} is false while the two existing conditions are true.  In this case, {{$translator}} contains the default translator instance, and that instance is passed down to all the sub-forms.  Since all forms (both Form and SubForm) always have the same default translator definition, that's not a problem.  I've attached a patch with a unit test showing this behaviour. \r\n\r\nUnless you can provide a specific example where the existing behavior is a problem, I will recommend that this issue be closed as \"Not an Issue\". ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-10-20T18:11:47.000+0000",
                    "updated": "2011-10-20T18:11:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48750",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coolsurfers",
                        "name": "coolsurfers",
                        "displayName": "Bjoern Mueller",
                        "active": true
                    },
                    "body": "Let me try to explain:\r\n\r\nduring initalisation I'm setting up two translation objects: \"Zend_Registry::set('Zend_Translate', $translate)\" [1] to my own Tramslate Object and setting a Default Translater for Validate: Zend_Validate_Abstract::setDefaultTranslator( $validateTranslation ); [2]\r\n\r\nIf a form exists with 2 elements and an additional subform with 2 elements (all 4 elements with a float validator for example) the error message of the elements of the form are translated by [2 - Default Translator of Zend_Validate] while the elements of the subform are translated by [1, cause the default Validation Translator is overwritten by the subform translator]",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coolsurfers",
                        "name": "coolsurfers",
                        "displayName": "Bjoern Mueller",
                        "active": true
                    },
                    "created": "2011-10-20T18:34:25.000+0000",
                    "updated": "2011-10-20T18:34:25.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48753",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "@Bjoern:\r\n\r\nAha! I figured I was missing the point, but I couldn't see where at the time.  The attached test (ZF-11831_v2.patch) should reproduce the issue you are seeing.  The result when I run it against trunk is:\r\n{code}\r\nThere was 1 failure:\r\n\r\n1) Zend_Form_FormTest::testElementsOfSubFormReceiveCorrectDefaultTranslator\r\nSubForm element received wrong validator\r\nFailed asserting that two strings are equal.\r\n--- Expected\r\n+++ Actual\r\n@@ @@\r\n-Element\r\n+Default\r\n{code}\r\n\r\nAfter adapting the fix applied in ZF-9364 for elements to this case:\r\n{code}\r\nIndex: library\/Zend\/Form.php\r\n===================================================================\r\n--- library\/Zend\/Form.php       (revision 24514)\r\n+++ library\/Zend\/Form.php       (working copy)\r\n@@ -2254,7 +2254,8 @@\r\n             }\r\n         }\r\n         foreach ($this->getSubForms() as $key => $form) {\r\n-            if (null !== $translator && !$form->hasTranslator()) {\r\n+            if (null !== $translator && $this->hasTranslator()\r\n+                    && !$form->hasTranslator()) {\r\n                 $form->setTranslator($translator);\r\n             }\r\n             if (isset($data[$key]) && !$form->isArray()) {\r\n{code}\r\nThe failing test above passes, as does the entire {{Zend_Form}} suite. \r\n\r\nThanks for your help and patience in sorting this issue out!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-10-21T00:50:38.000+0000",
                    "updated": "2011-10-21T00:50:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48754",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Fixed in trunk r24515\nMerged to release-1.11 in r24516 r24517.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-10-21T01:33:01.000+0000",
                    "updated": "2011-10-21T01:33:01.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48755",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "ZF2 Pull Request issued.\r\nhttps:\/\/github.com\/zendframework\/zf2\/pull\/517",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-10-21T01:50:18.000+0000",
                    "updated": "2011-10-21T01:50:18.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11831\/transitions"
}