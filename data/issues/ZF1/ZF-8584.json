{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8584",
    "key": "ZF-8584",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Add format to rest routes"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8584\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=doug316",
                "name": "doug316",
                "displayName": "Doug P",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-12-18T11:52:30.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T21:38:06.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "The goal is to be able to request a specific content type in a REST URL:\r\n\r\n  \/controller.json or \/controller\/index.json\r\n  \/controller\/22.json\r\n\r\nThis patch will remove the extension after the period and place it in params['format'].\r\n\r\nCode assumes that actions don't use periods (i.e. index.xml mapping to indexXmlAction).\r\n\r\n\r\n{noformat} \r\n--- Route.php\t2009-11-19 16:36:49.000000000 -0800\r\n+++ Route2.php\t2009-12-18 11:50:26.000000000 -0800\r\n@@ -67,6 +67,12 @@ class Zend_Rest_Route extends Zend_Contr\r\n     protected $_front;\r\n \r\n     \/**\r\n+     * Array keys to use for format. Should be taken out of request.\r\n+     * @var string\r\n+     *\/\r\n+    protected $_formatKey = 'format';\r\n+\t\r\n+    \/**\r\n      * Constructor\r\n      *\r\n      * @param Zend_Controller_Front $front Front Controller object\r\n@@ -129,10 +135,14 @@ class Zend_Rest_Route extends Zend_Contr\r\n             \/\/ Determine Controller\r\n             $controllerName = $this->_defaults[$this->_controllerKey];\r\n             if (count($path) && !empty($path[0])) {\r\n-                if ($this->_checkRestfulController($moduleName, $path[0])) {\r\n-                    $controllerName = $path[0];\r\n-                    $values[$this->_controllerKey] = array_shift($path);\r\n+\t\t\t\tpreg_match('\/([^\\.]+)(\\.(.+))?\/', $path[0], $matches);\r\n+                if ($this->_checkRestfulController($moduleName, $matches[1])) {\r\n+                    $controllerName = $matches[1];\r\n+                    $values[$this->_controllerKey] = $matches[1];\r\n+\t\t\t\t\tif (!empty($matches[3]))\r\n+\t\t\t\t\t\t$values[$this->_formatKey] = $matches[3];\r\n                     $values[$this->_actionKey] = 'get';\r\n+\t\t\t\t\tarray_shift($path);\r\n                 } else {\r\n                     \/\/ If Controller in URI is not found to be a RESTful\r\n                     \/\/ Controller, return false to fall back to other routes\r\n@@ -145,13 +155,23 @@ class Zend_Rest_Route extends Zend_Contr\r\n \r\n             \/\/ Check for leading \"special get\" URI's\r\n             $specialGetTarget = false;\r\n-            if ($pathElementCount && array_search($path[0], array('index', 'new')) > -1) {\r\n-                $specialGetTarget = array_shift($path);\r\n+\t\t\tpreg_match('\/([^\\.]+)(\\.(.+))?\/', $path[0], $matches);\r\n+            if ($pathElementCount && array_search($matches[1], array('index', 'new')) > -1) {\r\n+                $specialGetTarget = $matches[1];\r\n+\t\t\t\tif (!empty($matches[3]))\r\n+\t\t\t\t\t$values[$this->_formatKey] = $matches[3];\r\n+                array_shift($path);\r\n             } elseif ($pathElementCount && $path[$pathElementCount-1] == 'edit') {\r\n                 $specialGetTarget = 'edit';\r\n-                $params['id'] = $path[$pathElementCount-2];\r\n+                preg_match('\/([^\\.]+)(\\.(.+))?\/', $path[$pathElementCount-2], $matches);\r\n+                $params['id'] = $matches[1];\r\n+\t\t\t\tif (!empty($matches[3]))\r\n+\t\t\t\t\t$values[$this->_formatKey] = $matches[3];\r\n             } elseif ($pathElementCount == 1) {\r\n-                $params['id'] = array_shift($path);\r\n+                preg_match('\/([^\\.]+)(\\.(.+))?\/', array_shift($path), $matches);\r\n+                $params['id'] = $matches[1];\r\n+\t\t\t\tif (!empty($matches[3]))\r\n+\t\t\t\t\t$values[$this->_formatKey] = $matches[3];\r\n             } elseif ($pathElementCount == 0 || $pathElementCount > 1) {\r\n                 $specialGetTarget = 'index';\r\n             }\r\n@@ -199,13 +219,14 @@ class Zend_Rest_Route extends Zend_Contr\r\n         $this->_values = $values + $params;\r\n \r\n         $result = $this->_values + $this->_defaults;\r\n-        \r\n+\r\n         if ($partial && $result)\r\n         \t$this->setMatchedPath($request->getPathInfo());\r\n-        \t\r\n+\r\n         return $result;\r\n     }\r\n \r\n+\r\n     \/**\r\n      * Assembles user submitted parameters forming a URL path defined by this route\r\n      *\r\n{noformat} "
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8584\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10390",
                    "id": 10390,
                    "description": "Mini Release",
                    "name": "1.9.6",
                    "userReleaseDate": "24\/Nov\/09",
                    "archived": false,
                    "releaseDate": "2009-11-24",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10422",
                    "id": 10422,
                    "name": "Zend_Rest_Route",
                    "description": "Includes both Zend_Rest_Route and Zend_Rest_Controller",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37061",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Hmm... typically, this sort of thing should be specified in the Accept header, not as part of the URI. As such, you can determine the format dynamically, and dispatch to the appropriate view. This also can be done on-demand in plugins, without further complicating the route logic. ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-12-18T12:04:22.000+0000",
                    "updated": "2009-12-18T12:04:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37062",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=doug316",
                        "name": "doug316",
                        "displayName": "Doug P",
                        "active": true
                    },
                    "body": "Accept headers are nice but so is a tidy URI with a format specifier which simplifies API usage and eases debug. Rails routes support this by default.\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=doug316",
                        "name": "doug316",
                        "displayName": "Doug P",
                        "active": true
                    },
                    "created": "2009-12-18T12:40:51.000+0000",
                    "updated": "2009-12-18T12:40:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37063",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lcrouch",
                        "name": "lcrouch",
                        "displayName": "Luke Crouch",
                        "active": true
                    },
                    "body": "This can already be easily done with ContextSwitch in the controller and a format parameter on the URI:\r\n{code}\r\nclass NewsController\r\n{\r\n    public function init()\r\n    {\r\n        parent::init();\r\n        $this->_contextSwitch->addActionContexts(array('index' => array('json', 'xml')));\r\n        $this->_contextSwitch->initContext();\r\n    }\r\n}\r\n{code}\r\n\/news\/index\/format\/xml\r\n\/news\/index\/?format=xml\r\n\/news\/index\/format\/json\r\n\/news\/index\/?format=json",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lcrouch",
                        "name": "lcrouch",
                        "displayName": "Luke Crouch",
                        "active": true
                    },
                    "created": "2009-12-18T12:52:34.000+0000",
                    "updated": "2009-12-18T12:53:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37144",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=doug316",
                        "name": "doug316",
                        "displayName": "Doug P",
                        "active": true
                    },
                    "body": "The suggested workaround ideas are appreciated, but are not quite the same. There are good reasons for mapping URI's using file type extensions.\r\n\r\nNot sure but it appears there might be a general resistance to extend the framework. The rest route appears to not yet have many important features which I suppose we'll implement in our own proprietary libraries. Nested resources, implicit controller specification, file type extensions, and overall the general ability to control what URI's look like are important.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=doug316",
                        "name": "doug316",
                        "displayName": "Doug P",
                        "active": true
                    },
                    "created": "2009-12-22T12:39:58.000+0000",
                    "updated": "2009-12-22T12:39:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37149",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lcrouch",
                        "name": "lcrouch",
                        "displayName": "Luke Crouch",
                        "active": true
                    },
                    "body": "\"There are good reasons for mapping URI's using file type extensions.\"\r\n\r\nWithout knowing what these \"good reasons\" are, yes - I am still resisting this change. It has to do with the whole \"URI opacity\" axiom - http:\/\/www.w3.org\/DesignIssues\/Axioms.html#opaque I.e., according to REST architectural principles, there's no difference between \/news\/index.json and \/news\/index\/?format=json\r\n\r\nFurthermore, this route is just one method of implementing RESTful architecture in ZF - specifically, it's a method that leverages Zend_Controller_Router_Rewrite. We can easily use static or regexp routing to implement more URI control like RoR or django.\r\n\r\nTo implement features like nested resources, implicit controllers, etc. we should use the proposal process and not a single JIRA ticket. I've been working on a proposal to enhance the 'Resource' part of Zend_Rest here:\r\n\r\nhttp:\/\/framework.zend.com\/wiki\/display\/ZFPROP\/Zend_Rest_Resource\r\n\r\nFinally, RESTful implementation could be going thru a renovation as we work on ZF 2.0 so we may want to make a new 'Zend_Rest_2.0' proposal.\r\n\r\nIn either case, the feature request of this ticket is more appropriate for a proposal I think.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lcrouch",
                        "name": "lcrouch",
                        "displayName": "Luke Crouch",
                        "active": true
                    },
                    "created": "2009-12-22T13:58:50.000+0000",
                    "updated": "2009-12-22T13:58:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38769",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maurice",
                        "name": "maurice",
                        "displayName": "Moritz Mertinkat",
                        "active": true
                    },
                    "body": "I really appreciate Doug's enhancement, although I've not yet screened the patch.\r\n\r\nCurrently we're using the Accept-header approach but when working with people that are not really familiar with HTTP headers it sometimes gets a bit confusing. For example, {{file_get_contents}} does not send any {{Accept}} headers (without defining a context).\r\n\r\n@Luke: You're right that \"there's no difference between \/news\/index.json and \/news\/index\/?format=json\" but I myself would prefer the former so that REST API users won't have to mess with additional parameters. It's just convenience and the way Rails is doing it.\r\n\r\n+1 for this issue\/enhancement.\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maurice",
                        "name": "maurice",
                        "displayName": "Moritz Mertinkat",
                        "active": true
                    },
                    "created": "2010-02-26T03:12:14.000+0000",
                    "updated": "2010-02-26T03:12:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/38955",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=doug316",
                        "name": "doug316",
                        "displayName": "Doug P",
                        "active": true
                    },
                    "body": "@Luke: No objections over standards such as URI opacity. However I haven't convinced myself there's no place for what I'm doing here, at least in development mode.\r\n\r\nAs I use Rails as my model for best practices, I'll have to research their justification for this with respect to the same.\r\n\r\n@Moritz: thanks for the support.\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=doug316",
                        "name": "doug316",
                        "displayName": "Doug P",
                        "active": true
                    },
                    "created": "2010-03-03T10:30:05.000+0000",
                    "updated": "2010-03-03T10:30:05.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8584\/transitions"
}