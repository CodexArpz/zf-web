{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12053",
    "key": "ZF-12053",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "The 'Identical' validator on a Form's text element appears to compare filtered to unfiltered value."
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12053\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=sootsnoot",
                "name": "sootsnoot",
                "displayName": "Rich Peterson",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2012-02-11T03:45:58.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-03-13T23:47:18.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "Zend_Form",
                "Zend_Validate"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "We use lowercased email addresses for account names.  Creating a new account involves a form with two text fields for email address, the second one to confirm spelling.  Since we lowercase the names anyway for storage (we don't want to allow different accounts to differ only in alphabetic case), we use the StringToLower filter on both fields.  But when we use the Identical validator on the confirmation field, specifying the token to compare to as the email field, I've verified with Xdebug that the validator compares the filtered value of the token (email) field to the unfiltered value of the confirmation field.  The end result for a user that tends to spell their email address in mixed case is that the validation always fails, but when the form re-displays with the error message, in fact the original field and the confirmation field show as being identical because by that time both have been filtered.  If this isn't a bug in the code, it surely deserves some mention in the documentation...\r\n\r\nHere is the code we were using:\r\n{noformat}\r\n    $email = new Zend_Form_Element_Text('email');\r\n    $email->setLabel('Email ');\r\n    $email->setOptions(array('class' => 'field-input-signup'))\r\n          ->setRequired(true)\r\n          ->addFilter('StringToLower')\r\n          ->addFilter('StringTrim')\r\n          ->addValidator('NotEmpty', true,array(\r\n            'messages' => array(\r\n              Zend_Validate_NotEmpty::IS_EMPTY\r\n                => $this->getView()->translate(\"Please enter email address\"))))\r\n          ->addValidator('EmailAddress', true);\r\n\r\n    $cemail = new Zend_Form_Element_Text('cemail');\r\n    $cemail->setLabel('Confirm Email ');\r\n    $cemail->setOptions(array('class' => 'field-input-signup'))\r\n           ->setRequired(true)\r\n           ->addFilter('StringToLower')\r\n           ->addFilter('StringTrim')\r\n           ->addValidator('NotEmpty', true,array(\r\n             'messages' => array(\r\n               Zend_Validate_NotEmpty::IS_EMPTY\r\n                 => $this->getView()->translate(\"Please enter confirm email address\"))))\r\n           ->addValidator('Identical', false, array(\r\n             'token' => 'email',\r\n             'messages' => array(\r\n                Zend_Validate_Identical::NOT_SAME\r\n                  => $this->getView()->translate(\r\n                     \"'Email' and 'Confirm Email' do not match. Please try again.\"))));\r\n{noformat}\r\nIMHO, given the name 'Identical', I would expect it always to compare the unfiltered values.\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12053\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "zend-form-element",
                "zf-crteam-review"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10501",
                    "id": 10501,
                    "description": "Mini Release",
                    "name": "1.11.1",
                    "userReleaseDate": "30\/Nov\/10",
                    "archived": false,
                    "releaseDate": "2010-11-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10140",
                    "id": 10140,
                    "name": "Zend_Validate",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49672",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "I don't have much experience with Zend_Form, so I may be doing it wrong, but I am seeing a different problem against trunk: even identical lowercased value comparisons fail.  When I run this unit test, which is very similar to your reproduction case:\r\n{code}\r\nIndex: tests\/Zend\/Form\/ElementTest.php\r\n===================================================================\r\n--- tests\/Zend\/Form\/ElementTest.php     (revision 24624)\r\n+++ tests\/Zend\/Form\/ElementTest.php     (working copy)\r\n@@ -2189,6 +2189,27 @@\r\n         $validator = $username->getValidator('regex');\r\n         $this->assertTrue($validator->zfBreakChainOnFailure);\r\n     }\r\n+\r\n+    \/**\r\n+     * @group ZF-12053\r\n+     *\/\r\n+    public function testIdenticalValidatorComparesFilteredFormElementValuesCorrectly()\r\n+    {\r\n+        $f1 = new Zend_Form_Element('f1');\r\n+        $f1->addFilter('StringToLower');\r\n+\r\n+        $f2 = new Zend_Form_Element('f2');\r\n+        $f2->addFilter('StringToLower')\r\n+           ->addValidator('Identical', false, array(\r\n+               'token' => 'f1',\r\n+           ));\r\n+\r\n+        $form = new Zend_Form(array('elements' => array($f1,$f2)));\r\n+        \/\/ Identically-cased values matching filtered result entered in each field\r\n+        $this->assertTrue($form->isValid(array('f1'=>'foobar', 'f2'=>'foobar')));\r\n+        \/\/ Differently-cased values entered in each field\r\n+        $this->assertTrue($form->isValid(array('f1'=>'FooBar', 'f2'=>'FOOBAR')));\r\n+    }\r\n }\r\n\r\n class Zend_Form_ElementTest_Decorator extends Zend_Form_Decorator_Abstract\r\n{code}\r\n\r\nI get a failure at the first assert.  Even when I follow the exact example in the manual ([here|http:\/\/framework.zend.com\/manual\/en\/zend.validate.set.html#zend.validate.set.identical.formelements]) I get the same result.\r\n\r\nbq. IMHO, given the name 'Identical', I would expect it always to compare the unfiltered values.\r\n\r\nI don't see any mention of it in the manual, but the docblock for Zend_Form_Element::isValid has this:\r\n\r\n{code}\r\nNote: The *filtered* value is validated.\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2012-02-22T21:38:53.000+0000",
                    "updated": "2012-02-22T21:38:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/49981",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=grizzm0",
                        "name": "grizzm0",
                        "displayName": "Kristofer Karlsson",
                        "active": true
                    },
                    "body": "I just noticed this on my own site and I too found it weird that the identical field is validated against the unfiltered value.\r\nUsing StringToLower as filter and identical validator on field2 I'll add some examples below.\r\n\r\nFails as field2 will be validated as \"test\" against \"TEST\" from field1.\r\nField1: TEST\r\nField2: TEST\r\n\r\nFails as field2 will be validated as \"test\" against \"Test\" from field1.\r\nField1: Test\r\nField2: test\r\n\r\nSuccess as both fields will be \"test\" during validation.\r\nField1: test\r\nField2: Test",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=grizzm0",
                        "name": "grizzm0",
                        "displayName": "Kristofer Karlsson",
                        "active": true
                    },
                    "created": "2012-03-10T08:08:53.000+0000",
                    "updated": "2012-03-10T08:08:53.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12053\/transitions"
}