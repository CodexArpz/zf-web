{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7228",
    "key": "ZF-7228",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Loader will include a file multiple times (no include_once)"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7228\/votes",
                "votes": 3,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10360",
                    "id": 10360,
                    "description": "Minor Release",
                    "name": "1.10.0",
                    "userReleaseDate": "27\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-27",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-01-12T13:51:16.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jeffmace",
                "name": "jeffmace",
                "displayName": "Jeff Mace",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-07-08T13:18:26.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-01-12T13:51:17.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "In ZF-2923 (SVN 12769), the include_once call on line #83 was changed to include.  This created some cases where a single file could be included multiple times and cause a 'Cannot redeclare class' fatal error.\n\n{code}\n\/\/ Register the ZF autoload function\nrequire_once 'Zend\/Loader\/AutoLoader.php';\n$loader = Zend_Loader_Autoloader::getInstance();\n$loader->setFallbackAutoloader(true);\n$loader->suppressNotFoundWarnings();\n\nZend_Locale::$compatibilityMode = false;\n$localeExists = class_exists('Locale') \/\/ Should equal false, but includes Zend\/Locale.php\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7228\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10340",
                    "id": 10340,
                    "description": "Mini Release",
                    "name": "1.8.4",
                    "userReleaseDate": "23\/Jun\/09",
                    "archived": false,
                    "releaseDate": "2009-06-23",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10001",
                    "id": 10001,
                    "name": "Zend_Loader",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32481",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jeffmace",
                        "name": "jeffmace",
                        "displayName": "Jeff Mace",
                        "active": true
                    },
                    "body": "Sorry, I just remembered to check the trunk and it looks like it has already been updated there.  When will that be moved into a tag?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jeffmace",
                        "name": "jeffmace",
                        "displayName": "Jeff Mace",
                        "active": true
                    },
                    "created": "2009-07-08T13:38:50.000+0000",
                    "updated": "2009-07-08T13:38:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32482",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jeffmace",
                        "name": "jeffmace",
                        "displayName": "Jeff Mace",
                        "active": true
                    },
                    "body": "Ok, double sorry.  I'm not used to Fisheye so I was looking at an old version.  The latest trunk does not have include_once.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jeffmace",
                        "name": "jeffmace",
                        "displayName": "Jeff Mace",
                        "active": true
                    },
                    "created": "2009-07-08T13:46:46.000+0000",
                    "updated": "2009-07-08T13:46:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32484",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "First, are you absolutely sure about the error and the fix? \n\nZend_Loader::loadClass() does a class_exists() check before it ever attempts to load a class via include(). We switched from include_once() to include() as (a) the aforementioned class_exists() check typically short circuits the call in the first place, and (b) it provides some performance gain over its _once() cousin (which must do a stat() call internally to check against its internal path cache).\n\nSecond, the case that you present indicates that your include_path is set incorrectly. if class_exists('Locale') is including Zend_Locale, that means that you have library\/Zend\/ on your include_path -- instead of just library\/ -- which is what should be on the path. \n\nFinally, I'd recommend against using the autoloader as a fallback autoloader. One of the key reasons it was developed was to provide a namespaced autoloader -- which helps prevent the very issues you're running against. Always, always, always prefix your classes with your vendor\/personal class prefix -- it prevents naming collisions, and assists the autoloader in preventing false positive lookups.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-07-08T18:41:49.000+0000",
                    "updated": "2009-07-08T18:41:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32495",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jeffmace",
                        "name": "jeffmace",
                        "displayName": "Jeff Mace",
                        "active": true
                    },
                    "body": "To your first points, I can understand that you want to get the performance benefits of dropping include_once to just include, but it does add the possibility in some edge cases for including a file multiple times.  The only reason we've found it is because of some practices which are probably more lazy than anything on our part.  But I'll get into that after addressing the include_path.\n\nA standard PHP include path looks something like '.:{PEAR libraries}'.  Since there is a '.' in the include path, an attempt to load a class of name 'Locale' will include the Zend\/Locale.php file because the Loader.php file also sits in that Zend directory.  That can be solved by shifting your include_path to ensure the real Locale file gets included before the Zend locale or by removing the '.'.  But that is only a fix if there is a Locale.php file elsewhere that you are trying to include.\n\nIn this particular case we are running class_exists with the string 'Locale', which doesn't exist.  If class_exists returns false, we prepend a prefix and run the check again.  The second check finds the proper class and we continue running.  This is why the class_exists check doesn't protect us from the include call.\n\n{code}Zend_Locale::$compatibilityMode = false;{code}\n* This calls the autoloader with 'Zend_Locale', which includes the Zend\/Locale.php file\n\n{code}$localeExists = class_exists('Locale'){code}\n* This call the auto loader with 'Locale', which should return false but causes a fatal error\n* The class_exists check before the include call returns false because no file has been included that defines the class Locale\n* The include call sees the '.' in the include path and includes Zend\/Locale.php because the Loader.php file is in the Zend directory\n* At that point the fatal error is thrown saying that Zend_Locale cannot be redeclared\n\nIf you are interested in keeping the benefits of the include call over include_once, could I suggest adding a setting to Zend_Loader that determines if it should use include or include_once?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jeffmace",
                        "name": "jeffmace",
                        "displayName": "Jeff Mace",
                        "active": true
                    },
                    "created": "2009-07-09T06:30:32.000+0000",
                    "updated": "2009-07-09T06:30:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34962",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tdm",
                        "name": "tdm",
                        "displayName": "Patrick van Dissel",
                        "active": true
                    },
                    "body": "I'm with Jeff Mace.\nI just got the same problem, we're looping over 2 different namespaces to autoload a class depending on the first namespace that it finds it in.\nWith include_once it works perfectly, but with the current 1.9.2 and 1.9.3PL1 it just give me a blank error page without error.\n\nNote that I only have this problem running it on Zend Platform Enterprise Edition with code acceleration and such options enabled, locally on a WAMPserver it does not occur.\nAlso note that the Zend_Loader::loadFile() function has an option to use include or include_one, but it's not used withing the loadClass() function when you do not give it any directories.\n\nI think all includes should be an include_once\/require_once, no matter what.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tdm",
                        "name": "tdm",
                        "displayName": "Patrick van Dissel",
                        "active": true
                    },
                    "created": "2009-09-29T06:27:27.000+0000",
                    "updated": "2009-09-29T06:27:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34967",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tdm",
                        "name": "tdm",
                        "displayName": "Patrick van Dissel",
                        "active": true
                    },
                    "body": "Addition to my comment above:\n\nZend_Loader @line: 82&83:\n{code}\nself::_securityCheck($file);\ninclude $file;\n{code}\ncan be replaced by the following line:\n{code}\nself::loadFile($file, null, true);\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tdm",
                        "name": "tdm",
                        "displayName": "Patrick van Dissel",
                        "active": true
                    },
                    "created": "2009-09-29T07:47:47.000+0000",
                    "updated": "2009-09-29T07:47:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37423",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=salac.r",
                        "name": "salac.r",
                        "displayName": "Radek",
                        "active": true
                    },
                    "body": "I have just the same problem, Our class Auth was included as Zend_Auth and it caused problem \"Cannot redeclare class\". I spent 4 hours  to figure out the reason. Please repair these bug.\r\nThanks",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=salac.r",
                        "name": "salac.r",
                        "displayName": "Radek",
                        "active": true
                    },
                    "created": "2010-01-05T23:52:46.000+0000",
                    "updated": "2010-01-05T23:52:46.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/37639",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Fixed in trunk, to release with 1.10.0.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2010-01-12T13:51:16.000+0000",
                    "updated": "2010-01-12T13:51:16.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7228\/transitions"
}