{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6324",
    "key": "ZF-6324",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Integrating Zend_Amf in MVC"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/9",
                "name": "Docs:  Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6324\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-11-20T20:52:34.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mojojojo",
                "name": "mojojojo",
                "displayName": "Nikita Y Volkov",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-04-16T11:47:38.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T20:52:34.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "amf",
                "mvc"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "An example controller for integrating in MVC:\n\n{code}\nrequire_once 'Zend\/Amf\/Server.php';\nrequire_once 'Zend\/Controller\/Action.php';\nclass Services_AmfController extends Zend_Controller_Action\n{\n\t\/**\n\t * @var Zend_Amf_Server\n\t *\/\n\tprotected $_server;\n\t\n\tpublic function init ()\n\t{\n\t\t\/\/\tset the server up \n\t\t$this->_server = new Zend_Amf_Server();\n\t\t$this->_server->addDirectory(dirname(dirname(__FILE__)) . '\/services\/');\n\t\t\n\t\t\/\/\tturn the renderer off\n\t\t$this->_helper->viewRenderer->setNoRender();\n\t}\n\t\n\tpublic function postDispatch ()\n\t{\n\t\t\/\/\tshut the layout off\n\t\t$this->_helper->layout->disableLayout();\n\t\t\/\/\tset the correct header if no error or forwarding occurred during dispatch  \n\t\t$this->_response->setHeader('Content-Type', 'application\/x-amf', true);\n\t}\n\n\tpublic function indexAction ()\n\t{\n\t\t\/\/\tprocess the request and set the response\n\t\t$amfResponse = $this->_server->handle();\n\t\t$this->_response->setBody($amfResponse);\n\t}\n\n}\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6324\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "customfield_10000": {
            "name": "Language",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/customFieldOption\/10000",
                "value": "English"
            }
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10350",
                    "id": 10350,
                    "name": "Zend_Amf",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31435",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rocksocke",
                        "name": "rocksocke",
                        "displayName": "Matthias Steinb\u00f6ck",
                        "active": true
                    },
                    "body": "concerning the $amfResponse variable you are using: do you want to give it an AMF-Byte-String or the object that should be serialized?\n\nFor integration in MVC you already have different possibilities:\n\n*1. Register $this in the extended ActionController-Class (in your case \"Services AmfController\") as the handling class and let it call its methods:*\n\n{code}\n\/\/ in your library-folder:\nclass YourNS_Controller_Action_AMF extends Zend_Controller_Action\n{\n    protected $_server;\n\n    public function init() {\n        $this->_server = new Zend_Amf_Server();\n        $this->_server->setClass($this);\n        $this->_helper->viewRenderer->setNoRender(); \n        echo $this->_server->handle();\n        exit;\n    }\n}\n\n\/\/ in your application\/controllers folder\nclass MyController extends YourNS_Controller_Action_AMF\n{\n    public function funcToBeCalledByFlash($a, $b) {\n        return $a+$b;\n    }\n}\n{code}\n\nthis has the downside, that any public function Zend_Action_Controller has can be called by AMF.\n\n*2. create the request yourself and change the target to handle this yourself (and allow only methods you want it to allow):*\n\n{code}\nclass YourNS_Controller_Action_AMF extends Zend_Controller_Action\n{\n    private $_server;\n    private $_forbiddenMethods = array();\n    private static $_originalTargetMethods = array();\n\n    public function init () {\n        $this->_server = new Zend_Amf_Server();\n        $this->_server->setClass($this);\n        \/\/ make a reflection of this class (YourNS_Controller_Action_AMF) and get all methods of it, so we can forbid them\n        $this->_forbiddenMethods = array(); \/\/ TODO\n\n        $this->_request = new Zend_AMF_Request_Http();\n\n        \/\/ iterate over the requests bodies\n        $responseBody = $this->_request->getAmfBodies();\n\n        foreach($responseBody as $body) {\n            \/\/ on each $body get its targetURI (dont forget about AMF0\/AMF3-switching)\n            \/\/ with $body->getTargetURI()\n            $method = '...TODO:get the correct method out of target URI...';\n            if (in_array($method, $this->_forbiddenMethods))\n                throw new Zend_Amf_Server_Exception('Method \"' . $method . '\" must not be called');\n\n            self::$_originalTargetMethods[] = $method;\n\n            \/\/ now set the target URI to our own function\n            \/\/ also concern 0\/3 switch here\n            $body->setTargetURI('TODO:getthecorrectleading'.'handlerFunction');\n        }\n\n        \/\/ now handle it\n        echo $this->_server->handle();\n        exit;\n    }\n\n    public function handlerFunction() {\n        $method = array_shift(self::$_originalTargetMethods);\n        \/\/ TODO: make a reflection of $this and call $method on it with this functions arguments\n        \/\/ TODO: now you can look inside the response created in your function\n        return $this->_response->getBody();\n    }\n}\n{code}\n\n\nIs this what you intended or did i understand you wrong?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rocksocke",
                        "name": "rocksocke",
                        "displayName": "Matthias Steinb\u00f6ck",
                        "active": true
                    },
                    "created": "2009-05-28T10:34:03.000+0000",
                    "updated": "2009-05-28T10:34:03.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31438",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mojojojo",
                        "name": "mojojojo",
                        "displayName": "Nikita Y Volkov",
                        "active": true
                    },
                    "body": "That was the solution what I posted, not an issue. The only purpose of it is to integrate Zend_Amf server into your MVC application instead of separating it to a different one, so that you could use your controller plugins and leave a single entry-point making the strucure of your application more understandable and stable.\n\nThis is a single controller with single action which serves as an entry-point for amf server. And the only thing that could be changed in it throughout different applications is mapping of classes. That's it. All the rest is done by Zend_Amf calling services you make.\n\nOn your proposal. I think this is an example of what is called over-programming. Looks like a solution of inexistent problem. As I understood all its intensions conclude in turning your controller into a service. This triggers a list of questions, but I'll skip to the main one: what in hell could make you need that?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mojojojo",
                        "name": "mojojojo",
                        "displayName": "Nikita Y Volkov",
                        "active": true
                    },
                    "created": "2009-05-28T11:23:18.000+0000",
                    "updated": "2009-05-28T11:23:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31441",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rocksocke",
                        "name": "rocksocke",
                        "displayName": "Matthias Steinb\u00f6ck",
                        "active": true
                    },
                    "body": "sorry, i totally missed the point in your first post - thought you search for a solution -  should read things better before commenting on them..... sry again. i'm new on zf issues and didn't saw that you made this post a doc improvement.\n\nand yes - you're totally right - why the hell would i like to do so? in a current project i'm working on we use Zend_AMF exactly the way you described it - i posted the second solution only because i thought you're trying to do so - so once again: sorry.\n\nin our project we use the following code - i hope this corresponds with your proposal (what dou you think about that?):\n\n{code}\n\tpublic function indexAction()\n\t{\n\t\ttry {\n\t\t\tZend_Registry::get('logger')->log('creating amf server', Zend_Log::DEBUG);\n\t\t\t$server = new Zend_Amf_Server();\n\t\t\t$server->setProduction(false);\n\t\t\t\n\t\t\t$classes = glob(APPLICATION_PATH.'\/models\/*.php');\n\t\t\tforeach ($classes as $class) {\n\t\t\t\t$class = basename($class);\n\t\t\t\t$class = substr($class, 0, strlen($class) - 4);\n\t\t\t\t$server->setClassMap($class, $class);\n\t\t\t}\n\t\t\t\n\t\t\t$fileName = basename(\n\t\t\t\t$this->getRequest()->getParam('service', 'Default').\n\t\t\t\t'Service.php'\n\t\t\t);\n\t\t\t\n\t\t\t\/\/ check if service really exists\n\t\t\tif (!file_exists(APPLICATION_PATH.'\/services\/OurNs\/'.$fileName)) {\n\t\t\t\tthrow new Zend_Amf_Exception('Service '.\n\t\t\t\t\t$this->getRequest()->getParam('service', 'Default').\n\t\t\t\t\t' not found!');\n\t\t\t}\n\t\t\t$server->setClass('OurNs_'.\n\t\t\t\t$this->getRequest()->getParam('service', 'Default').\n\t\t\t\t'Service');\n\t\t\t\n\t\t\t$response = $server->handle();\n\t\t\tZend_Registry::get('logger')->log('responding', Zend_Log::DEBUG);\n\t\t\techo $response;\n\t\t} catch (Exception $e) {\n\t\t\tZend_Registry::get('logger')->log('Error handling AMF-Request: '.\n\t\t\t\t$e->getMessage().\"\\n\".$e->getTraceAsString(), Zend_Log::ERR);\n\t\t}\n\t\texit;\n\t}\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rocksocke",
                        "name": "rocksocke",
                        "displayName": "Matthias Steinb\u00f6ck",
                        "active": true
                    },
                    "created": "2009-05-28T11:49:53.000+0000",
                    "updated": "2009-05-28T11:49:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31445",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mojojojo",
                        "name": "mojojojo",
                        "displayName": "Nikita Y Volkov",
                        "active": true
                    },
                    "body": "No problem.\n\nOn your question. Yes it kinda does the same thing, but doesn't correctly realize Zend MVC, though in most general cases you won't feel the difference.\n\nYou break two secret rules of Zend MVC:\n1. Never echo anything - you have a response object for that.\n2. Never exit or die the process - thus the postDispatch and other dispatch-cycles of the front controller get ignored.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mojojojo",
                        "name": "mojojojo",
                        "displayName": "Nikita Y Volkov",
                        "active": true
                    },
                    "created": "2009-05-28T12:21:28.000+0000",
                    "updated": "2009-05-28T12:21:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31451",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rocksocke",
                        "name": "rocksocke",
                        "displayName": "Matthias Steinb\u00f6ck",
                        "active": true
                    },
                    "body": "Thanks a lot for your comments!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rocksocke",
                        "name": "rocksocke",
                        "displayName": "Matthias Steinb\u00f6ck",
                        "active": true
                    },
                    "created": "2009-05-28T14:53:58.000+0000",
                    "updated": "2009-05-28T14:53:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52337",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "body": "Bulk change of all issues last updated before 1st January 2010 as \"Won't Fix\".\r\n\r\nFeel free to re-open and provide a patch if you want to fix this issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "created": "2012-11-20T20:52:34.000+0000",
                    "updated": "2012-11-20T20:52:34.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6324\/transitions"
}