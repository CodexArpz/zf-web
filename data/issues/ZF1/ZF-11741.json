{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11741",
    "key": "ZF-11741",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Issues with file inputs in subforms"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11741\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-09-29T18:11:14.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=azt3k",
                "name": "azt3k",
                "displayName": "Aaron",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-09-15T03:27:34.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-09-29T18:11:15.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "using inputs with names structured like this:\r\n\r\nsubform[subsubform][name] i.e. Zend_SubForm style, eg files[0][file]\r\n\r\nkills Zend_File_Transfer_Adapter_Abstract::_detectMimeType\r\n\r\n--\r\n\r\nZF currently creates file inputs in subforms with names as: \"name\" rather than \"subform[subsubform][name]\" - which is the naming syntax for all other subform elements, which I can only presume is because the transfer atapter wont accept file inputs in that structure.  This however causes \"namespace\" clashes and is not consistent with the naming conventions for all other subform elements.\r\n\r\nmanually creating file elements with names subform[subsubform][name] confuses Zend_File_Transfer_Atapter_Http::_prepareFiles() and it does not produce usable output.\r\n\r\nThe mods below to Zend_File_Transfer_Atapter_Http will produce usable output for elements structured as form[subform][name] , but will proably break in other situations.  additionally to recieve the file you need to manually set the name for the file element as $form->subform->subsubform->fileinput->setName('subform_subsubform_name'); so this is not a usable solution, more something to illustrate the problem.\r\n\r\n{noformat} \r\n\r\n    \/**\r\n     * Helps the _prepareFiles method make the $_FILES array to match the internal syntax of one file per entry\r\n     *\r\n     * @param\tarray\t$content\r\n\t * @param\tstr\t\t$form\r\n     * @return\tvoid\r\n     *\/\r\n    protected function _prepareNestedFileArray($content, $form)\t\t\r\n    {\r\n\t\tif($form){\r\n\t\t\t\r\n\t\t\tif(is_array($content) && !array_key_exists('name', $content)){\r\n\t\t\t\t\r\n\t\t\t\tforeach ($content as $parent => $child) {\r\n\t\t\t\t\t$this->_prepareNestedFileArray($child, $parent);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}elseif(is_array($content)){\r\n\r\n\t\t\t\tif (is_array($content['name'])) {\r\n\r\n\t\t\t\t\tforeach ($content as $param => $file) {\r\n\t\t\t\t\t\tif(is_array($file)){\r\n\t\t\t\t\t\t\tforeach ($file as $number => $target) {\r\n\t\t\t\t\t\t\t\tif(is_array($target)){\r\n\t\t\t\t\t\t\t\t\tforeach($target as $name => $val){\r\n\t\t\t\t\t\t\t\t\t\t$this->_files[$form. '_' . $number . '_'. $name][$param] = $val;\r\n\t\t\t\t\t\t\t\t\t\t$this->_files[$form]['multifiles'][$number] = $form. '_' . $number. '_'. $name  ;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t$this->_files[$form . '_'. $number . '_' ][$param]      = $target;\r\n\t\t\t\t\t\t\t\t\t$this->_files[$form]['multifiles'][$number] = $form . '_' . $number . '_'  ;\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\/\/echo print_r($_FILES,1);\r\n\t\t\t\t\t\/\/echo \"\\n\\n post processed files \".print_r($this->_files,1);\r\n\t\t\t\t\t\/\/echo print_r($this->_files[$form]['multifiles'],1);\r\n\t\t\t\t\t\/\/die();\r\n\t\t\t\t\t\r\n\t\t\t\t\t$this->_files[$form]['name'] = $form;\r\n\r\n\t\t\t\t\tforeach($this->_files[$form]['multifiles'] as $key => $value) {\r\n\r\n\t\t\t\t\t\t$this->_files[$value]['options']   = $this->_options;\r\n\t\t\t\t\t\t$this->_files[$value]['validated'] = false;\r\n\t\t\t\t\t\t$this->_files[$value]['received']  = false;\r\n\t\t\t\t\t\t$this->_files[$value]['filtered']  = false;\r\n\r\n\t\t\t\t\t\t\/\/echo '  '.$value ;\r\n\t\t\t\t\t\t\/\/die(print_r($this->_files[$value],1));\r\n\t\t\t\t\t\t\/\/if (empty($this->_files[$value]['name'])) die(); \/\/die(print_r($this->_files,1));\r\n\r\n\t\t\t\t\t\t$mimetype = $this->_detectMimeType($this->_files[$value]);\r\n\t\t\t\t\t\t$this->_files[$value]['type'] = $mimetype;\r\n\r\n\t\t\t\t\t\t$filesize = $this->_detectFileSize($this->_files[$value]);\r\n\t\t\t\t\t\t$this->_files[$value]['size'] = $filesize;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\/\/this is where it all goes wrong\r\n\t\t\t\t\t\tif ($this->_options['detectInfos']) {\r\n \t\t\t\t\t\t\tif(is_array($_FILES[$form]['type'][$key])){\r\n\t\t\t\t\t\t\t\t$k = trim(str_replace($form.'_','',str_replace($key.'_','',$value)),'_');\r\n\t\t\t\t\t\t\t\t$_FILES[$form]['type'][$key][$k] = $mimetype;\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t$_FILES[$form]['type'][$key] = $mimetype;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(is_array($_FILES[$form]['type'][$key])){\r\n\t\t\t\t\t\t\t\t$_FILES[$form]['size'][$key][$k] = $filesize;\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t$_FILES[$form]['size'][$key] = $filesize;\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$this->_files[$form]              = $content;\r\n\t\t\t\t\t$this->_files[$form]['options']   = $this->_options;\r\n\t\t\t\t\t$this->_files[$form]['validated'] = false;\r\n\t\t\t\t\t$this->_files[$form]['received']  = false;\r\n\t\t\t\t\t$this->_files[$form]['filtered']  = false;\r\n\r\n\t\t\t\t\t$mimetype = $this->_detectMimeType($this->_files[$form]);\r\n\t\t\t\t\t$this->_files[$form]['type'] = $mimetype;\r\n\r\n\t\t\t\t\t$filesize = $this->_detectFileSize($this->_files[$form]);\r\n\t\t\t\t\t$this->_files[$form]['size'] = $filesize;\r\n\r\n\t\t\t\t\tif ($this->_options['detectInfos']) {\r\n\t\t\t\t\t\t$_FILES[$form]['type'] = $mimetype;\r\n\t\t\t\t\t\t$_FILES[$form]['size'] = $filesize;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t}\t\r\n\t}\r\n    \/**\r\n     * Prepare the $_FILES array to match the internal syntax of one file per entry\r\n     *\r\n     * @param  array $files\r\n     * @return array\r\n     *\/\r\n    protected function _prepareFiles()\r\n    {\r\n\t\tif(empty($this->_files) || !count($this->_files)){\r\n\t\t\t\r\n\t\t\t$this->_files = array();\r\n\r\n\t\t\t\/\/echo \"\\n\\n preparefiles called \\n\\n \";\/\/.print_r(debug_backtrace(false),1);\r\n\t\t\t\/\/echo \"\\n\\n pre processed files \".print_r($this->_files,1);\r\n\t\t\t\/\/echo \"\\n\\n _FILES \".print_r($_FILES,1);\r\n\t\t\t\/\/echo \"\\n\\n _options \".print_r($this->_options,1);\r\n\t\t\t\r\n\t\t\tforeach ($_FILES as $form => $content) {\r\n\r\n\t\t\t\t$this->_prepareNestedFileArray($content, $form);\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\r\n        return $this;\r\n    }  \r\n\r\n{noformat}\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11741\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10980",
                    "id": 10980,
                    "description": "Mini Release",
                    "name": "1.11.10",
                    "userReleaseDate": "04\/Aug\/11",
                    "archived": false,
                    "releaseDate": "2011-08-04",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10320",
                    "id": 10320,
                    "name": "Zend_File_Transfer",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48460",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "No, this is a limitation of php's file upload capability.\r\nFrom ZF's manual:\r\n\r\n{quote}\r\nFile elements in Subforms\r\n            \r\nWhen you use file elements in subforms you must set unique names. For example, if you name a file element in subform1 \"file\", you must give any file element in subform2 a different name.\r\n\r\nIf there are 2 file elements with the same name, the second element is not be displayed or submitted.\r\n\r\nAdditionally, file elements are not rendered within the sub-form. So when you add a file element into a subform, then the element will be rendered within the main form.\r\n{quote}\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2011-09-19T06:30:50.000+0000",
                    "updated": "2011-09-19T06:30:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48560",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Closing as wont fix as there is actually no way to solve this limitation",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2011-09-29T18:11:15.000+0000",
                    "updated": "2011-09-29T18:11:15.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11741\/transitions"
}