{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9704",
    "key": "ZF-9704",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Undefined offset in Zend_Db_Table_Row_Abstract::findDependentRowset()"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9704\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=iliavlad",
                "name": "iliavlad",
                "displayName": "Ilia",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-04-18T20:51:27.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T21:37:44.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Create tables like in http:\/\/framework.zend.com\/manual\/en\/zend.db.table.relationships.html .\r\nExecute Example #1.\r\n\r\nHow to reproduce.\r\n1. Add to class BugsProducts properties $_cols and $_primary.\r\n2. Execute Example #1.\r\n\r\nProblem: Undefined offset in Zend_Db_Table_Row_Abstract on line 902.\r\n\r\nReason.\r\nWhen $_cols and $_primary defined in class, metadata of table is not filled out and $dependentInfo[Zend_Db_Table_Abstract::METADATA] contains empty array (in Zend_Db_Table_Row_Abstract on line 902)."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9704\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10440",
                    "id": 10440,
                    "description": "Mini Release",
                    "name": "1.10.3",
                    "userReleaseDate": "01\/Apr\/10",
                    "archived": false,
                    "releaseDate": "2010-04-01",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10133",
                    "id": 10133,
                    "name": "Zend_Db_Table",
                    "description": "Lightweight OO interface to database tables and rowsets.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40164",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=iliavlad",
                        "name": "iliavlad",
                        "displayName": "Ilia",
                        "active": true
                    },
                    "body": "There is same problem (undefined index) for find() function Zend_Db_Table_Abstract on line 1265",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=iliavlad",
                        "name": "iliavlad",
                        "displayName": "Ilia",
                        "active": true
                    },
                    "created": "2010-04-20T23:01:11.000+0000",
                    "updated": "2010-04-20T23:01:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40514",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jpieper",
                        "name": "jpieper",
                        "displayName": "Jan Pieper",
                        "active": true
                    },
                    "body": "Can you please provide a bit more information on how your modified class looks like? I am not able to reproduce this error.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jpieper",
                        "name": "jpieper",
                        "displayName": "Jan Pieper",
                        "active": true
                    },
                    "created": "2010-05-17T14:45:59.000+0000",
                    "updated": "2010-05-17T14:45:59.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40517",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=iliavlad",
                        "name": "iliavlad",
                        "displayName": "Ilia",
                        "active": true
                    },
                    "body": "Hi,\r\nCould you please take a look to code below?\r\n\r\n{code}\r\n\r\n<?php\r\n\r\n\/*\r\n\r\nCREATE TABLE `test`.`accounts` (\r\n`id` INT NOT NULL AUTO_INCREMENT PRIMARY KEY ,\r\n`name` VARCHAR( 5 ) NOT NULL\r\n) ENGINE = MYISAM ;\r\n\r\nINSERT INTO `test`.`accounts` (\r\n`id` ,\r\n`name`\r\n)\r\nVALUES (\r\n'1234', 'test'\r\n);\r\n\r\n\r\nCREATE TABLE `test`.`bugs` (\r\n`id` INT NOT NULL AUTO_INCREMENT PRIMARY KEY ,\r\n`reported_by` INT NOT NULL\r\n) ENGINE = MYISAM ;\r\n\r\nINSERT INTO `test`.`bugs` (\r\n`id` ,\r\n`reported_by`\r\n)\r\nVALUES (\r\n'1', '1234'\r\n);\r\n\r\n*\/\r\n\r\nrequire_once 'Zend\/Db\/Table\/Abstract.php';\r\n\r\n$db_config = array(\r\n\t'adapter'         => 'PDO_MYSQL',\r\n\t'params' => array (\r\n\t\t'dbname' => 'test',\r\n\t\t'host'   => 'localhost',\r\n\t\t'username' => 'root',\r\n\t\t'password' => '',\r\n\t),\r\n);\r\n\r\n$db = Zend_Db::factory($db_config['adapter'], $db_config['params']);\r\n\r\n$db->setFetchMode(Zend_Db::FETCH_ASSOC);\r\nZend_Db_Table_Abstract::setDefaultAdapter($db);\r\n\r\nclass Accounts extends Zend_Db_Table_Abstract\r\n{\r\n    protected $_name            = 'accounts';\r\n    protected $_dependentTables = array('Bugs');\r\n\t\r\n\tprotected $_cols = array('id', 'name');\r\n\tprotected $_primary = 'id';\r\n}\r\n\r\n\r\nclass Bugs extends Zend_Db_Table_Abstract\r\n{\r\n    protected $_name            = 'bugs';\r\n    protected $_referenceMap    = array(\r\n        'Reporter' => array(\r\n            'columns'           => 'reported_by',\r\n            'refTableClass'     => 'Accounts',\r\n            'refColumns'        => 'id'\r\n        ),\r\n    );\r\n\tprotected $_cols = array('id', 'reported_by');\r\n\tprotected $_primary = 'id';\t\r\n}\r\n\r\n\r\n$accountsTable = new Accounts();\r\n$accountsRowset = $accountsTable->find(1234);\r\n$user1234 = $accountsRowset->current();\r\n$bugsReportedByUser = $user1234->findDependentRowset('Bugs');\r\n\r\nvar_dump($bugsReportedByUser->toArray());\r\n\r\n{code}\r\n\r\nand run it\r\n\r\n{quote}\r\nD:\\>php testbug.php\r\nPHP Notice:  Undefined index: id in \\Zend\\Db\\Table\\Abstract.php on line 1265\r\nPHP Stack trace:\r\nPHP   1. main D:\\testbug.php:0\r\nPHP   2. Zend_Db_Table_Abstract->find(1234) D:\\testbug.php:78\r\n\r\nNotice: Undefined index: id in \\Zend\\Db\\Table\\Abstract.php on line 1265\r\n\r\nCall Stack:\r\n    0.0005     332816   1. main D:\\testbug.php:0\r\n    0.0247    1792376   2. Zend_Db_Table_Abstract->find(1234) D:\\testbug.php:78\r\n\r\nPHP Notice:  Undefined index: reported_by in \\Zend\\Db\\Table\\Row\\Abstract.php on line\r\n 902\r\nPHP Stack trace:\r\nPHP   1. main D:\\testbug.php:0\r\nPHP   2. Zend_Db_Table_Row_Abstract->findDependentRowset($dependentTable = 'Bugs', $ruleKey = *uninitialized*, $select = *uninitialized*) D:\\testbug.php:80\r\n\r\nNotice: Undefined index: reported_by in \\Zend\\Db\\Table\\Row\\Abstract.php on line 902\r\n\r\nCall Stack:\r\n    0.0005     332816   1. main D:\\testbug.php:0\r\n    0.0440    2217512   2. Zend_Db_Table_Row_Abstract->findDependentRowset('Bugs', ???, ???) D:\\testbug.php:80\r\n\r\narray(1) \r\n  [0]=>\r\n  array(2) \r\n    [\"id\"]=>\r\n    string(1) \"1\"\r\n    [\"reported_by\"]=>\r\n    string(4) \"1234\"\r\n  \r\n\r\n{quote}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=iliavlad",
                        "name": "iliavlad",
                        "displayName": "Ilia",
                        "active": true
                    },
                    "created": "2010-05-17T16:34:39.000+0000",
                    "updated": "2010-05-17T16:34:39.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40519",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jpieper",
                        "name": "jpieper",
                        "displayName": "Jan Pieper",
                        "active": true
                    },
                    "body": "Thanks, now I am able to reproduce this error.\r\n\r\nYour tables are a bit different than these in the manual.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jpieper",
                        "name": "jpieper",
                        "displayName": "Jan Pieper",
                        "active": true
                    },
                    "created": "2010-05-17T23:42:54.000+0000",
                    "updated": "2010-05-17T23:42:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40520",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jpieper",
                        "name": "jpieper",
                        "displayName": "Jan Pieper",
                        "active": true
                    },
                    "body": "This could be a possible fix but I need to verify to not break backward compatibility and\/or any unittest.\r\n\r\n{code}Index: library\/Zend\/Db\/Table\/Abstract.php\r\n===================================================================\r\n--- library\/Zend\/Db\/Table\/Abstract.php\t(revision 22190)\r\n+++ library\/Zend\/Db\/Table\/Abstract.php\t(working copy)\r\n@@ -844,6 +844,8 @@\r\n         if (null === $this->_cols) {\r\n             $this->_setupMetadata();\r\n             $this->_cols = array_keys($this->_metadata);\r\n+        } elseif (empty($this->_metadata)) {\r\n+            $this->_setupMetadata();\r\n         }\r\n         return $this->_cols;\r\n     }\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jpieper",
                        "name": "jpieper",
                        "displayName": "Jan Pieper",
                        "active": true
                    },
                    "created": "2010-05-18T00:34:32.000+0000",
                    "updated": "2010-05-18T00:36:05.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/40533",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=iliavlad",
                        "name": "iliavlad",
                        "displayName": "Ilia",
                        "active": true
                    },
                    "body": "I add $_cols and $_primary to prevent \"DESCRIBE `table`\" request which called from _setupMetadata(). But you want to change this behavior. Is it possible to fix the bug without calling _setupMetadata()?\r\n\r\nThanks.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=iliavlad",
                        "name": "iliavlad",
                        "displayName": "Ilia",
                        "active": true
                    },
                    "created": "2010-05-18T15:44:47.000+0000",
                    "updated": "2010-05-18T15:44:47.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-9704\/transitions"
}