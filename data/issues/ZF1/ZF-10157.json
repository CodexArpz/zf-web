{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10157",
    "key": "ZF-10157",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "The body of an email when sent from a controller action includes extraneous \u00c2"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10157\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2010-07-16T13:50:51.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jhworth",
                "name": "jhworth",
                "displayName": "John Worthington",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-07-14T16:56:15.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-07-16T13:50:51.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I have tried using both Zend_Mail and PHPMailer to send email from a controller action.\r\nThe Htmlbody is - 'This is a test message '\r\n\r\nThe received message is - '\u00c2 This is a test message '\r\n\r\nIn checking the body via dump, its content does not include the \u00c2.  \r\n\r\nWith a larger body, the A circ appears on paragraph breaks, copyrights.\r\ne.g. \r\nThis email confirms that you have requested to be added to the Healthy Aging\u00c2\u00ae\u00c2 Newsletter mailing list.\u00c2  Every month,you will receive an email newsletter containing news, ideas, and tips for positive aging from Healthy Aging\u00c2\u00ae.\u00c2 \r\n\r\nWithout using the framework, both mailers work properly.  I have used different smtp servers identical results\r\n\r\nMy platform is XP sp3 and xampp.\r\n\r\nCan you guide me to a solution?\r\n\r\nThanks"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/5",
                "name": "Trivial"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10157\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                "name": "freak",
                "displayName": "Dolf Schimmel (Freeaqingme)",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10012",
                    "id": 10012,
                    "name": "Zend_Db",
                    "description": "interfaces, APIs, and adapters for various third-party data stores",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10018",
                    "id": 10018,
                    "name": "Zend_Mail",
                    "description": "high-level utility to build MIME-compliant messages and send using a mail transport adapter",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41472",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "Can you please provide some code with which the issue can be reproduced?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2010-07-14T16:59:13.000+0000",
                    "updated": "2010-07-14T16:59:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41489",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jhwrthngtn",
                        "name": "jhwrthngtn",
                        "displayName": "John Worthington",
                        "active": true
                    },
                    "body": "In creating a subset of my application, I was able to successfully send emails from module controllers with both Zend_Mail and PHPMailer.\r\n\r\nThis allowed me to focus on the source of my problem.  The email body is created under dijit editor and saved in a MySql table. When the content is passed from the table row to the BodyHtml, it gets corrupted.  The corruption is not obvious.  I can copy the html source from the editor, place it in a var and pass this to Body.  This works fine.\r\n\r\nThe question becomes - How do I insure that the editor output is not corrupted?\r\n\r\nThe code for sending is: Echoing the column matches what is in the $msg.  $values['htmltext'] is the column values.\r\n\r\n$values['htmltext'] email has the body sample 'The Body\u00c2 with comments'.\r\n\r\nCODE\r\n\tpublic function sendAction() {\r\n$msg = '<div><span style=\"font-size: medium;\"><h3><b><span style=\"FONT-SIZE: x-large\">This is a test message<\/span><\/b><\/h3><h3><div><span style=\"FONT-SIZE: 12px; FONT-STYLE: italic; FONT-FAMILY: Arial\">You \r\ndon\\'t grow old... ';\r\n$msg .= 'you become old by not growing! \u00a0Say NO to retirement with \r\nthe\u00a0<a href=\"http:\/\/www.cardpartner.com\/app\/healthy-aging\">Healthy \r\nAging<\/a>card<\/span><\/div><\/h3><\/span><\/div>'; echo $msg;\r\n$msg = '<span style=\"font-size: x-large\">The Body<\/span> with comments';\t\t\r\n\t\t$recid = $this->_getParam('recid', 0); echo $recid;\r\n\t\t$_clientModel = new Hdb_Model_Project();;\r\n\t \t$row = $_clientModel->getAutoresprow($recid);\r\n\t\tforeach($row as $rowd) {\r\n\t\t\tbreak;\r\n\t\t\t} \r\n\t\t$values = $rowd->toArray();\r\n\t\t$msg = $values['htmltext'];\r\necho  $values['htmltext'];\r\n\r\n\t   $mail = new Zend_Mail();\r\n\r\n\r\ntry { \r\n$mail->setBodyHtml($msg)\r\n\t->setFrom('jhwrthngtn@snet.net', 'Some Sender')\r\n\t->addTo('jhwrthngtn@snet.net', 'Some Recipient')\r\n\t->setSubject('TestSubject')\r\n\/\/\t->addAttachment($at)\r\n\t->send(); var_dump($mail);\r\n}\r\ncatch (Exception $e) {\r\n  echo 'Error: ' . $e->getMessage(); \/\/Boring error messages from anything else!\r\n}\r\n}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jhwrthngtn",
                        "name": "jhwrthngtn",
                        "displayName": "John Worthington",
                        "active": true
                    },
                    "created": "2010-07-15T10:24:31.000+0000",
                    "updated": "2010-07-15T10:24:31.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41499",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jhwrthngtn",
                        "name": "jhwrthngtn",
                        "displayName": "John Worthington",
                        "active": true
                    },
                    "body": "The problem is the dijit editor adds '\/\u00c2\/' in the post params from the form editor.\r\n\r\nMy approach is to filter the '\/\u00c2\/' before saving in the DB.\r\n\r\nI wonder why I need to do this filtering.\r\n\r\nAre there parameters that I should set in the form to get clean output?\r\n\r\nThe form code is below.\r\n<?php\r\nclass Hdb_Form_AutorespEdit extends Zend_Dojo_Form \r\n{\r\n\tpublic $_codeOptions;\r\n\t\r\n\tpublic function __construct( $options=null)\r\n    {\r\n \t\t\r\n          Zend_Dojo::enableForm($this);    \r\n    \t\r\n        $recid = new Zend_Form_Element_Hidden('recid');\r\n\t\t$this->setDisableLoadDefaultDecorators(true);\r\n\t\t$this->setDecorators(array(\r\n\t\t\tarray('ViewScript',\r\n\t\t\tarray('viewScript'=>'\/autoresp\/_autorespedit.phtml')\r\n\t\t\t\t\t\t\t\t\t),'Form'\r\n\t\t\t));\r\n        \r\n\t   $created = new Zend_Form_Element_Text ('created',\r\n\t\t\t\t\t\tarray('decorators'=> array('ViewHelper'),\r\n\t\t\t\t\t\t'readonly' => true,\r\n\t\t\t\t\t\t));\r\n\t   \r\n\t   $updated = new Zend_Form_Element_Text ('updated',\r\n\t\t\t\t\t\tarray('decorators'=> array('ViewHelper'),\r\n\t\t\t\t\t\t'readonly' => true,\r\n\t\t\t\t\t\t));\r\n\t   \r\n\t   $recid = new Zend_Form_Element_Text('recid',\r\n\t\t\t\t\t\tarray('decorators'=> array('ViewHelper'),\r\n\t\t\t\t\t\t'readonly' => true,\r\n\t\t\t\t\t\t));\r\n\r\n       $parent = new Zend_Form_Element_Text('parent',\r\n\t\t\t\t\t\tarray('decorators'=> array('ViewHelper'),\r\n\t\t\t\t\t\t'size' => '60px',\r\n\t\t\t\t\t\t'maxlength' => '63',\r\n\t\t\t\t\t\t));\r\n\r\n        \r\n        $imgurl = new Zend_Form_Element_Text('imgurl',\r\n\t\t\t\t\t\tarray('decorators'=> array('ViewHelper'),\r\n\t\t\t\t\t\t'size' => '60px',\r\n\t\t\t\t\t\t'maxlength' => '63',\r\n\t\t\t\t\t\t));\r\n\t\t\t\t\t\t\r\n\t\t$subject = new Zend_Form_Element_Text('subject',\r\n\t\t\t\t\t\tarray('decorators'=> array('ViewHelper'),\r\n\t\t\t\t\t\t'size' => '80px',\r\n\t\t\t\t\t\t'maxlength' => '255',\r\n\t\t\t\t\t\t));\r\n\t\t\t\t\t\t\r\n\/\/\t\t$htmltext = new Zend_Form_Element_Editor('htmltext',\r\n\/\/\t\t\t\t\t\tarray('decorators'=> array('ViewHelper'),));\r\n        $this->addElement(\r\n            'editor',\r\n            'htmltext',\r\n            array(\r\n                'label'        => 'Editor',\r\n                'inheritWidth' => 'true',\r\n \/\/           \t'extraplugins' => array('viewsource','foreColor','hiliteColor')\r\n            )\r\n        );\r\n        $ed = $this->getElement('htmltext');\r\n        $fmt =array('viewsource', 'bold','italic','underline','strikethrough','insertOrderedList','insertUnorderedList','blockquote','link','unlink','image');\r\n        array_push( $fmt,'foreColor','hiliteColor','cut','copy','paste','|','bold','italic','underline','strikethrough','subscript','superscript','|');\r\n        array_push($fmt, 'indent', 'outdent', 'justifyLeft', 'justifyCenter', 'justifyRight','fontName','fontSize','formatBlock');\r\n        $ed->addPlugins($fmt);\r\n\t\t\t\t\t\t\r\n\t\t$update = new Zend_Form_Element_Submit('update');\r\n        $update->setAttrib('id', 'submitbutton')\r\n        \t\t->setLabel('Update');\r\n\r\n        $insert = new Zend_Form_Element_Submit('insert');\r\n        $insert->setAttrib('id', 'submitbutton')\r\n        \t\t->setLabel('Send');\r\n        \t\t\r\n        $this->addElements(array($recid, $parent,$imgurl, $subject, \r\n              \t\t\t\t\t $insert, $update,$created,$updated));\r\n       \t\t\t\t\t\t\r\n\t}\t\t\t\t\r\n}\t\t\t\t\t\t\r\n?>\t\t\t\t\t\t",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jhwrthngtn",
                        "name": "jhwrthngtn",
                        "displayName": "John Worthington",
                        "active": true
                    },
                    "created": "2010-07-15T16:06:52.000+0000",
                    "updated": "2010-07-15T16:06:52.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41529",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jhwrthngtn",
                        "name": "jhwrthngtn",
                        "displayName": "John Worthington",
                        "active": true
                    },
                    "body": "On further investigation, I find that my problem is in reading the DB_Table_Row.\r\n\r\nA value such as 'Aging\u00ae' will store in the row properly.\r\n\r\nWhen the row is read the value is 'Aging\ufffd '.\r\n\r\nI do not see in the documentation how to retrieve rows containing special characters.\r\n\r\nThe escaping of '\u00ae' does not work.\r\n\r\nGuidance would be appreciated.\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jhwrthngtn",
                        "name": "jhwrthngtn",
                        "displayName": "John Worthington",
                        "active": true
                    },
                    "created": "2010-07-16T13:46:03.000+0000",
                    "updated": "2010-07-16T13:46:03.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/41530",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "You probably forgot to set a charset somewhere correctly. Please seek help through the proper support channels (mailinglists, irc, forums, etc).\r\n\r\nGood luck!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2010-07-16T13:50:51.000+0000",
                    "updated": "2010-07-16T13:50:51.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10157\/transitions"
}