{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5818",
    "key": "ZF-5818",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "parse_url() warnings and headers already sent when debugging with Zend Studio"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5818\/votes",
                "votes": 7,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10241",
                    "id": 10241,
                    "description": "Minor Release",
                    "name": "1.8.0",
                    "userReleaseDate": "30\/Apr\/09",
                    "archived": false,
                    "releaseDate": "2009-04-30",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-04-14T19:05:07.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                "name": "woutersamaey",
                "displayName": "Wouter Samaey",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-02-17T13:31:56.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-09-18T11:57:20.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "Zend_Controller_Request_Http",
                "parse_url"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "This may be a problem with ZF, or Zend Studio or both...but it's a blocker and something should be done.\n\nI've been using ZF for a half year now, upgrading everytime a new release is out. I used all versions since 1.5, and now when reaching 1.7.3 I ran into trouble.\n\nSince 1.7.3 Zend_Controller_Request_Http::setRequestUri() has been changed, and now uses parse_url() on the request uri. When debugging with Zend Studio, this line (see  <== PROBLEMATIC LINE below) causes a number of Warnings, and causing the headers to be already sent. All new versions (1.7.4 and 1.7.5) also have the same problem.\n\nThe debugging URL Zend Studio constructs is the following:\n\nbq. http:\/\/127.0.0.1\/melzoo\/public_html\/?use_remote=1&debug_session_id=1012&start_debug=1&debug_start_session=1&debug_host=10.37.129.2%2C10.211.55.2%2C192.168.0.193%2C127.0.0.1&debug_no_cache=1234905594362&debug_fastfile=1&debug_port=10137&send_sess_end=1&original_url=http:\/\/127.0.0.1\/melzoo\/public_html\/\n\nAnd this fails on the parse_url() line.\n\nAs I said, this may not be a bug, but it's a blocker for me, being stuck at version 1.7.2, and not being able to upgrade.\n\n\nh3. New problematic code:\n{code} \n public function setRequestUri($requestUri = null)\n    {\n        if ($requestUri === null) {\n            if (isset($_SERVER['HTTP_X_REWRITE_URL'])) { \/\/ check this first so IIS will catch\n                $requestUri = $_SERVER['HTTP_X_REWRITE_URL'];\n            } elseif (isset($_SERVER['REQUEST_URI'])) {\n                $requestUri = $_SERVER['REQUEST_URI'];\n                if (isset($_SERVER['HTTP_HOST']) && strstr($requestUri, $_SERVER['HTTP_HOST'])) {\n                    $pathInfo    = parse_url($requestUri, PHP_URL_PATH); \/\/ <== PROBLEMATIC LINE\n                    $queryString = parse_url($requestUri, PHP_URL_QUERY);\n                    $requestUri  = $pathInfo\n                                 . ((empty($queryString)) ? '' : '?' . $queryString);\n                }\n            } elseif (isset($_SERVER['ORIG_PATH_INFO'])) { \/\/ IIS 5.0, PHP as CGI\n                $requestUri = $_SERVER['ORIG_PATH_INFO'];\n                if (!empty($_SERVER['QUERY_STRING'])) {\n                    $requestUri .= '?' . $_SERVER['QUERY_STRING'];\n                }\n            } else {\n                return $this;\n            }\n        } elseif (!is_string($requestUri)) {\n            return $this;\n        } else {\n            \/\/ Set GET items, if available\n            if (false !== ($pos = strpos($requestUri, '?'))) {\n                \/\/ Get key => value pairs and set $_GET\n                $query = substr($requestUri, $pos + 1);\n                parse_str($query, $vars);\n                $this->setQuery($vars);\n            }\n        }\n\n        $this->_requestUri = $requestUri;\n        return $this;\n    }\n{code} \n\nh3. Old working code:\n{code}\npublic function setRequestUri($requestUri = null)\n    {\n        if ($requestUri === null) {\n            if (isset($_SERVER['HTTP_X_REWRITE_URL'])) { \/\/ check this first so IIS will catch\n                $requestUri = $_SERVER['HTTP_X_REWRITE_URL'];\n            } elseif (isset($_SERVER['REQUEST_URI'])) {\n                $requestUri = $_SERVER['REQUEST_URI'];\n                if (isset($_SERVER['HTTP_HOST']) && strstr($requestUri, $_SERVER['HTTP_HOST'])) {\n                    $requestUri = preg_replace('#^[^:]*:\/\/[^\/]*\/#', '\/', $requestUri);  \/\/ <== ORIGINAL LINE\n                }\n            } elseif (isset($_SERVER['ORIG_PATH_INFO'])) { \/\/ IIS 5.0, PHP as CGI\n                $requestUri = $_SERVER['ORIG_PATH_INFO'];\n                if (!empty($_SERVER['QUERY_STRING'])) {\n                    $requestUri .= '?' . $_SERVER['QUERY_STRING'];\n                }\n            } else {\n                return $this;\n            }\n        } elseif (!is_string($requestUri)) {\n            return $this;\n        } else {\n            \/\/ Set GET items, if available\n            if (false !== ($pos = strpos($requestUri, '?'))) {\n                \/\/ Get key => value pairs and set $_GET\n                $query = substr($requestUri, $pos + 1);\n                parse_str($query, $vars);\n                $this->setQuery($vars);\n            }\n        }\n\n        $this->_requestUri = $requestUri;\n        return $this;\n    }\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/1",
                "name": "Blocker"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5818\/watchers",
                "isWatching": false,
                "watchCount": 5
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-7364",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7364",
                    "type": {
                        "name": "Duplicate",
                        "direction": "INBOUND",
                        "description": "is duplicated by"
                    }
                },
                {
                    "issueKey": "ZF-5965",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5965",
                    "type": {
                        "name": "Dependency",
                        "direction": "INBOUND",
                        "description": "is dependecy of"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11762",
                    "filename": "buggy.zip",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "created": "2009-02-18T02:20:21.000+0000",
                    "size": 15745,
                    "mimeType": "application\/zip",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11762\/buggy.zip"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11855",
                    "filename": "Http.php.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tony4d",
                        "name": "tony4d",
                        "displayName": "Tony Ford",
                        "active": true
                    },
                    "created": "2009-04-04T00:13:42.000+0000",
                    "size": 1378,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11855\/Http.php.patch"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/11857",
                    "filename": "HttpTest.php.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tony4d",
                        "name": "tony4d",
                        "displayName": "Tony Ford",
                        "active": true
                    },
                    "created": "2009-04-04T12:18:37.000+0000",
                    "size": 3758,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/11857\/HttpTest.php.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10250",
                    "id": 10250,
                    "description": "Mini Release",
                    "name": "1.7.3",
                    "userReleaseDate": "19\/Jan\/09",
                    "archived": false,
                    "releaseDate": "2009-01-19",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10011",
                    "id": 10011,
                    "name": "Zend_Controller",
                    "description": "front controller, including router and dispatcher",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28901",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Is the debugging URL you provided the one that causes the failure, or some other URL?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-02-17T13:53:19.000+0000",
                    "updated": "2009-02-17T13:53:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28902",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "body": "The URL I provided is what Zend Studio creates when you click the \"Debug\" button.\nIt takes the simple URL (in my case: http:\/\/127.0.0.1\/melzoo\/public_html\/ ) and adds serveral values for debugging purposes. Surfing to the basic URL works fine, but I cannot debug this way. This is why I suggested that this may be a Zend Studio issue, and not a ZF issue.\n\nHowever, it's a blocker for anyone using ZF on Zend Studio.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "created": "2009-02-17T14:02:08.000+0000",
                    "updated": "2009-02-17T14:02:08.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28903",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "body": "If it's in anyway possible, I'd like to see the old implementation back in the new versions.\nNot sure how this would effect everything else though.\n\nOr if there's another way...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "created": "2009-02-17T14:14:27.000+0000",
                    "updated": "2009-02-17T14:14:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28906",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "parse_url() was introduced for two reasons: 1) to fix another bug that was showing, and 2) because it did all the work we needed (i.e., why reinvent the wheel?)\n\nI think this is likely a Studio problem, and I'll try and get somebody from the Studio team to look into why it fails.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-02-17T19:45:50.000+0000",
                    "updated": "2009-02-17T19:45:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28907",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I'm fairly certain this is one of two things:\n\n* A bug with Studio\n* A PHP version issue\n\nThe second argument to parse_url() was added in PHP 5.1.2; check to make sure that the PHP interpreter that you're using with Zend Studio is at least that version (better, yet, make sure it's at least our minimum supported version of 5.2.4).\n\nAdditionally, note this caveat in the documentation for parse_url: \"On seriously malformed URLs, parse_url() may return FALSE and emit a E_WARNING.\" That said, I took the URL you provided above verbatim, and did the following:\n\n{code}\nerror_reporting(E_ALL | E_STRICT);\nini_set('display_errors', true);\n\n$url = 'http:\/\/127.0.0.1\/melzoo\/public_html\/?use_remote=1&debug_session_id=1012&start_debug=1&debug_start_session=1&debug_host=10.37.129.2%2C10.211.55.2%2C192.168.0.193%2C127.0.0.1&debug_no_cache=1234905594362&debug_fastfile=1&debug_port=10137&send_sess_end=1&original_url=http:\/\/127.0.0.1\/melzoo\/public_html\/';\necho parse_url($url, PHP_URL_PATH);\n{code}\n\nThat code emitted no warnings, and returned the expected \"\/melzoo\/public_html\/\" (run on PHP 5.2.8). This tells me that it's definitely environment related.  Check the items I note above.\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-02-17T19:52:44.000+0000",
                    "updated": "2009-02-17T19:52:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28912",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "body": "Thanks for getting into this on such short notice.\n\nI have read your advice carefully, but could not find any issues with my environment. I do have 5.2.5, which should be OK.\nI also tested your code fragment, and that worked fine too, but I think ZF only runs the parse_url() function on a part of the URL, not the entire URL.\n\n...and yes, I have checked it now and what really happens is this:\n\n$pathInfo    = parse_url(\"\/buggy\/public_html\/?use_remote=1&debug_session_id=1004&start_debug=1&debug_start_session=1&debug_host=10.37.129.2%2C10.211.55.2%2C192.168.0.193%2C127.0.0.1&debug_no_cache=1234951691096&debug_fastfile=1&debug_port=10137&send_sess_end=1&original_url=http:\/\/127.0.0.1\/\", PHP_URL_PATH);\n\/\/ THIS LINE RETURNS FALSE AND CAUSES THE WARNING\n\nBasically, the host part is left out.\n\nI have also tried to recreate the problem in a small project, and was succesfull. The project runs, but throws a lot of these parse_url() warnings.\nIn my original project, I get a \"headers already sent\" problem, caused by the warnings.\n\nI'm attaching the project archive now.\n\nMaybe you could look into this, or pass it along to the Zend Studio people.\nEither way, I'm stuck on 1.7.2 for the time being.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "created": "2009-02-18T02:18:59.000+0000",
                    "updated": "2009-02-18T02:18:59.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28913",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "body": "Zend Studio (Eclipse) Archive which should illustrate the problem.\nSimply import it into your workspace",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "created": "2009-02-18T02:20:30.000+0000",
                    "updated": "2009-02-18T02:20:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28914",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "body": "I have posted more info and a test project",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "created": "2009-02-18T02:21:45.000+0000",
                    "updated": "2009-02-18T02:21:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29010",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "body": "Daniel Freudenberger contacted me today with some more info.\nSince he can't post on the issue tracker, I'm posting his message.\nMaybe his insight can be of further use.\n\nHe wrote:\n\nThe line which causes the problem is not the line you've mentioned (the one with parse_url in it). The problem is caused by the if statement above.\n\nif (isset($_SERVER['HTTP_HOST']) && strstr($requestUri, $_SERVER['HTTP_HOST'])) {\n\nIn some cases, $requestUri contains the complete URL (including protocol and hostname). In this case the if-statement should be triggered.\nYou're case is different: $requestUri doesn't contain the protocol and hostname, but it contains the hostname as a get-parameter ($original_url). In this case the if statement should evaluate to false, but it doesn't.\n\nA fix for this problem would be following:\n\n$pos = strpos($requestUri, ':\/\/');\n$str = substr($requestUri, $pos);\n\nif (isset($_SERVER['HTTP_HOST']) && strpos($requestUri,  $_SERVER['HTTP_HOST']) === 0) {\n ...\n}\n\nSorry for my bad english, but I hope you got the problem :)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "created": "2009-02-22T10:46:45.000+0000",
                    "updated": "2009-02-22T10:46:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29081",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nicktelford",
                        "name": "nicktelford",
                        "displayName": "Nick Telford",
                        "active": true
                    },
                    "body": "I've come up against this problem as well. The issue is, as Daniel Freudenberger wrote, with the line: \n\nif (isset($_SERVER['HTTP_HOST']) && strstr($requestUri, $_SERVER['HTTP_HOST'])) {\n\nThe issue is simple, the second part of that line checks for the existence of the server's hostname ANYWHERE in the request URI.\n\nThe issue only affects requests where the hostname of the server exists elsewhere in the request URI. For this reason it affects most OpenID callback requests causing them to fail!\n\nI was going to fix this on our local copy, but I'd be more comfortable with an upstream fix.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nicktelford",
                        "name": "nicktelford",
                        "displayName": "Nick Telford",
                        "active": true
                    },
                    "created": "2009-02-25T06:48:00.000+0000",
                    "updated": "2009-02-25T06:48:00.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29082",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nicktelford",
                        "name": "nicktelford",
                        "displayName": "Nick Telford",
                        "active": true
                    },
                    "body": "Perhaps a solution would be to check that the first character isn't a slash (\/) as well?\n\nif (isset($_SERVER['HTTP_HOST']) && strpos('\/', $requestUri) !== 0 && strstr($requestUri, $_SERVER['HTTP_HOST'])) {\n\nThis would also yeild better performance for the (more common) scenario where the REQUEST_URI is a relative path.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nicktelford",
                        "name": "nicktelford",
                        "displayName": "Nick Telford",
                        "active": true
                    },
                    "created": "2009-02-25T06:55:11.000+0000",
                    "updated": "2009-02-25T06:55:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29083",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "body": "If you find a solution, can you post it here, please?\nFor some strange reason I'm not experiencing this problem anymore.\n\nI've upgraded Zend Studio to 6.1.1 (up from 6.1.0), maybe this has something to do with it...\n\nI'm now successfully using ZF 1.7.5 instead of 1.7.2.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "created": "2009-02-25T06:56:44.000+0000",
                    "updated": "2009-02-25T06:56:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29084",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nicktelford",
                        "name": "nicktelford",
                        "displayName": "Nick Telford",
                        "active": true
                    },
                    "body": "Typo in the fix, got the parameter ordering wrong. Should be:\nif (isset($_SERVER['HTTP_HOST']) && strpos($requestUri, '\/') !== 0 && strstr($requestUri, $_SERVER['HTTP_HOST'])) {",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nicktelford",
                        "name": "nicktelford",
                        "displayName": "Nick Telford",
                        "active": true
                    },
                    "created": "2009-02-25T06:57:20.000+0000",
                    "updated": "2009-02-25T06:57:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29319",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=noopable",
                        "name": "noopable",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "body": "I got hit with the same problem. This is the repro code.\n{code}\n<?php\necho parse_url(\"\/path\/to\/?test=http:\/\/www.example.com\", PHP_URL_PATH);\n{code}\nresult:\n*PHP Warning:  parse_url(\/path\/to\/?test=http:\/\/www.example.com): Unable to parse url in \/root\/- on line 2*\n\nThis is unformed request's problem, not Zend Studio's.The one at fault is the bad request, But any client can request it.\n\nI tested Nick's code. It works fine.\nBy the way ,In this case,  Doesn't it have to throw \"Bad Request Exception\" ? \n\nThanks.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=noopable",
                        "name": "noopable",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "created": "2009-03-06T23:33:58.000+0000",
                    "updated": "2009-03-06T23:33:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29328",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "body": "It seems there's a solution available.\nWhere do we go from here?\nI don't know how to publish the solution.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=woutersamaey",
                        "name": "woutersamaey",
                        "displayName": "Wouter Samaey",
                        "active": true
                    },
                    "created": "2009-03-08T06:49:19.000+0000",
                    "updated": "2009-03-08T06:49:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29671",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thing2b",
                        "name": "thing2b",
                        "displayName": "thing2b",
                        "active": true
                    },
                    "body": "I may be showing my ignorance, but wouldn't the code in Zend_Controller_Request_Http::setRequestUri() be better as something like:\n\n\/\/ Try to parse Url\n$pathInfo = @parse_url($requestUri, PHP_URL_PATH);\nif (!$pathInfo){\n    \/\/ We have an invalid url, that we need to handle here.\n}\n\nWhy can't ZF just suppress the error and handle the case where a URL is not passable if the result is false?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thing2b",
                        "name": "thing2b",
                        "displayName": "thing2b",
                        "active": true
                    },
                    "created": "2009-03-22T13:26:15.000+0000",
                    "updated": "2009-03-22T13:26:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29815",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tony4d",
                        "name": "tony4d",
                        "displayName": "Tony Ford",
                        "active": true
                    },
                    "body": "Rather than check if it starts with a \/ wouldn't it be much more accurate and less prone to future bugs if you did a regexp? Like:\n\n\n{code}\nif (isset($_SERVER['HTTP_HOST']) && preg_match('\/^https?:\\\/\\\/'.$_SERVER['HTTP_HOST'].'\/', $requestUri)) {\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tony4d",
                        "name": "tony4d",
                        "displayName": "Tony Ford",
                        "active": true
                    },
                    "created": "2009-03-30T09:30:15.000+0000",
                    "updated": "2009-03-30T09:30:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29925",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tony4d",
                        "name": "tony4d",
                        "displayName": "Tony Ford",
                        "active": true
                    },
                    "body": "OK, considering this bit of code happens on every request I made an effort to not have to use a regexp for performance sake. On top of that, I was able to get rid of the parse_url calls all together, using a simple substr and strlen, which is also gonna help performance some. And, I think I've also avoided future bugs by using the built in getScheme and getHttpHost methods, so now we'll make sure to check protocol and port. We were not checking either before.\n\nMatthew, please checkout the patch files I attached here. I've included the bug fix in Http.php.patch and also made good improvements to the unit testing for this section of the code (HttpTest.php.patch). You had two different tests before, and one case was not covered, which is what this bug is. Furthermore, the tests were not even checking http over ssl and non-standard ports. As I said before though, considering the code didn't even support that, I guess we couldn't test for it ;) Anyway, now there is one test that tests all cases. BTW, the test I removed you had labeled it @group ZFI-233. Not even sure what that refers to (ZFI)? So, I left it in as an additional group for that new comprehensive test case.\n\nLast but not least. This bug was actually introduced as a result of a request I made a long time ago (which you fixed):\n\nZF-3161\n\nConsidering I didn't provide much help outside of reporting that bug, I guess I owe you and its only fitting that I provide a fix for this bug :)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tony4d",
                        "name": "tony4d",
                        "displayName": "Tony Ford",
                        "active": true
                    },
                    "created": "2009-04-04T00:26:17.000+0000",
                    "updated": "2009-04-04T00:28:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/29939",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tony4d",
                        "name": "tony4d",
                        "displayName": "Tony Ford",
                        "active": true
                    },
                    "body": "I uploaded a new unit test patch file. I had a couple bugs in the other one and I think this is better with 3 separate tests anyway.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=tony4d",
                        "name": "tony4d",
                        "displayName": "Tony Ford",
                        "active": true
                    },
                    "created": "2009-04-04T12:19:32.000+0000",
                    "updated": "2009-04-04T12:19:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30126",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Fixed in trunk. The patched code was missing a ':\/\/' when building the host and scheme, but that was quickly found and detected; the tests worked perfectly as use cases - thanks!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-04-14T19:04:57.000+0000",
                    "updated": "2009-04-14T19:04:57.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5818\/transitions"
}