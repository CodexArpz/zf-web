{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10489",
    "key": "ZF-10489",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Mail_Protocol_Imap : problem to get multiline response"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10489\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vincentc",
                "name": "vincentc",
                "displayName": "Vincent Clair",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-09-23T01:37:58.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T21:38:16.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Hello,\r\n\r\nI have a problem with multiline send by IMAP server. \"_nextTaggedLine()\" doesn't decode it correctly.\r\n\r\nMultiple lines are sent with something similar to that string \"{123}\\n\". So, if a tagged line contains this at the end, get next lines and add them to current one, while there is a tagged line. Please find here a quick patch :\r\n\r\n{code:xml}\r\npublic function readLine(&$tokens = array(), $wantedTag = '*', $dontParse = false)\r\n    {\r\n        $line = $this->_nextTaggedLine($tag); \r\n\r\n        while (preg_match('\/\\{\\d+\\}\\s*$\/', $line))\r\n        {\r\n         $line = preg_replace('\/\\{\\d+\\}\\s*$\/', '', $line) . $this->_nextLine(); \r\n        }\r\n        \r\n        if (!$dontParse) {\r\n            $tokens = $this->_decodeLine($line);\r\n        } else {\r\n            $tokens = $line;\r\n        }\r\n\r\n        \/\/ if tag is wanted tag we might be at the end of a multiline response\r\n        return $tag == $wantedTag;\r\n    }\r\n{code} "
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/2",
                "name": "Critical"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10489\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10490",
                    "id": 10490,
                    "description": "Mini Release",
                    "name": "1.10.8",
                    "userReleaseDate": "25\/Aug\/10",
                    "archived": false,
                    "releaseDate": "2010-08-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10018",
                    "id": 10018,
                    "name": "Zend_Mail",
                    "description": "high-level utility to build MIME-compliant messages and send using a mail transport adapter",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42340",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vincentc",
                        "name": "vincentc",
                        "displayName": "Vincent Clair",
                        "active": true
                    },
                    "body": "It seems the problem is more complex. The end \"{123}\\n\" depends of some requests I think.\r\n\r\nWhen i use $imap->fetch('RFC822.HEADERS', 1), the response for the server look like this :\r\n{code:none}\r\n* 42 FETCH (RFC822.HEADER {1606}\r\nReturn-Path: <test@test.com>\r\nX-Original-To: test@test.com\r\nDelivered-To: test@test.com\r\nReceived: from xxx.ovh.net (localhost.localdomain [127.0.0.1])\r\n[...]\r\n{code}\r\n {1606} correspond to the number of bytes to get for the response.\r\n\r\nBut when i use $imap->requestAndResponse('FETCH', array(1, 'BODYSTRUCTURE'), false), it fails. I expected to get one line, for all response. Following, as you can see, {9} and others are not the bytes of line length.\r\n\r\n{code:none}\r\n* 44 FETCH (FLAGS (\\Seen) RFC822.SIZE 486546 UID 99 BODYSTRUCTURE ((\"application\" \"pdf\" (\"name\" {9}\r\n16\"35.pdf) NIL NIL \"base64\" 485408 NIL (\"inline\" (\"filename\" {9}\r\n16\"35.pdf)) NIL NIL) \"mixed\" (\"boundary\" \"Apple-Mail-1--762503508\") NIL NIL NIL) ENVELOPE (\"Thu, 16 Sep 2010 13:00:57 +0200\" {36}\r\ntest piece jointe avec \" dans le nom ((\"Vincent Clair\" NIL \"test\" \"test.com\")) ((\"Vincent Clair\" NIL \"test\" \"test.com\")) ((\"Vincent Clair\" NIL \"test\" \"test.com\")) ((NIL NIL \"other\" \"test.com\")) NIL NIL NIL \"<F429783B-8CB2-4D83-9EE8-DFC94DE0DF72@test.com>\"))\r\n{code}\r\n\r\n\r\nMaybe the issue http:\/\/framework.zend.com\/issues\/browse\/ZF-9714 is linked to this.\r\nPlease take this patch, but i'm not sure that is sufficient :\r\n\r\n{code:php}\r\npublic function readLine(&$tokens = array(), $wantedTag = '*', $dontParse = false)\r\n    {\r\n        $line = $this->_nextTaggedLine($tag); \r\n\r\n        if (!$dontParse) {\r\n            $tokens = $this->_decodeLine($line);\r\n        } else {\r\n            while (preg_match('\/\\{\\d+\\}\\s*$\/', $line))\r\n            {\r\n             $line = preg_replace('\/\\{\\d+\\}\\s*$\/', '', $line) . $this->_nextLine(); \r\n            }\r\n        \r\n            $tokens = $line;\r\n        }\r\n\r\n        \/\/ if tag is wanted tag we might be at the end of a multiline response\r\n        return $tag == $wantedTag;\r\n    }\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=vincentc",
                        "name": "vincentc",
                        "displayName": "Vincent Clair",
                        "active": true
                    },
                    "created": "2010-09-23T04:16:57.000+0000",
                    "updated": "2010-09-23T04:19:03.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10489\/transitions"
}