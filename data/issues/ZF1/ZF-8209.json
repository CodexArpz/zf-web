{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8209",
    "key": "ZF-8209",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "database requests return corrupt data when executed as a phpunit test"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8209\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-11-20T05:39:50.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eastzenders",
                "name": "eastzenders",
                "displayName": "Bryn Davies",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-11-03T01:34:58.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-08-25T06:36:56.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Hi,\r\n\r\nI've been trying to create unit tests for my application that includes tests that access a database I've set up. In production code everything works as expected (i.e I can fetch a row, perform Inserts etc) but when running the same code with the same database I get corrupt results on any type of SELECT statement (be it a find(), fetchRow(), fetchAll() etc).  The columns returned end up being either missed completely or named incorrectly (usually with the database\/table name replacing the column name). If I have more than 5 columns in my table fastcgi.exe crashes completely.\r\n\r\nI've created a small test:\r\n\r\n public function testdbAccess()\r\n    {\r\n    \t$db = Zend_Db::factory('Pdo_Mysql', array(\r\n              'host'     => 'localhost',\r\n              'username' => 'root',\r\n              'password' => 'xxxxx',\r\n              'dbname'   => 'testdb'\r\n            ));\r\n\r\n     $sql = \"select * from payment where id = ?\";\r\n     $data = 1; \r\n\r\n     $set = $db->fetchAll($sql,$data);\r\n}\r\n\r\nwhich still gives me problems.\r\n\r\nIn the debugger, the variable window shows:\r\n\r\n$set\r\n   |\r\n   0_            Array[4]\r\n      id         1\r\n      merchant   OUR_REF\r\n      payment    1\r\n      testdb     3\r\n\r\nAnd my Table is actually\r\n\r\ndb:  testdb\r\ntable: payment\r\n    \r\nid | merchant | payment_type_id | order_id | track_id\r\n1     OUR_REF       1                3          1\r\n2   ...\r\n...\r\n\r\n\r\nso I'm getting the table name replacing column 3's name, db name replacing column 4's name and column 5 is missing. If I have another column in the table I get the fastcgi.exe crash.\r\n\r\nDo you have any ideas about this? I found a similar issue reported (search ' too many columns crashes') but it was closed without an answer.\r\n\r\nMany thanks,\r\n\r\nBryn\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8209\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dragonbe",
                "name": "dragonbe",
                "displayName": "Michelangelo van Dam",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/12404",
                    "filename": "error.png",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eastzenders",
                        "name": "eastzenders",
                        "displayName": "Bryn Davies",
                        "active": true
                    },
                    "created": "2009-11-20T07:05:16.000+0000",
                    "size": 35907,
                    "mimeType": "image\/png",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/12404\/error.png",
                    "thumbnail": "http:\/\/fw02.zend.com\/issues\/secure\/thumbnail\/12404\/_thumb_12404.png"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10012",
                    "id": 10012,
                    "name": "Zend_Db",
                    "description": "interfaces, APIs, and adapters for various third-party data stores",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36157",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dragonbe",
                        "name": "dragonbe",
                        "displayName": "Michelangelo van Dam",
                        "active": true
                    },
                    "body": "A simple unit test shows that Zend_Db behaves properly, independent from platform.\r\n\r\n{noformat}\r\n  1 <?php\r\n  2 \r\n  3 require_once 'PHPUnit\/Framework.php';\r\n  4 require_once 'Zend\/Db.php';\r\n  5 class MyDbTest extends PHPUnit_Framework_TestCase\r\n  6 {\r\n  7         \/**\r\n  8          * populated db table 'payment' with 3 rows\r\n  9          *\r\n 10          * id | merchant | payment_type_id | order_id | track_id\r\n 11          * 1|test 1|1|3|1\r\n 12          * 2|test 2|1|3|2\r\n 13          * 3|test 3|1|3|2\r\n 14          *\/\r\n 15         public function testDbAccess()\r\n 16         {\r\n 17                 $db = Zend_Db::factory(\r\n 18                         'Pdo_SQLite',\r\n 19                         array ('dbname' => '.\/testdb.db')\r\n 20                 );\r\n 21 \r\n 22                 $sql = 'SELECT * FROM payment WHERE id = ?';\r\n 23                 $data = 1;\r\n 24                 $set = $db->fetchAll($sql, $data);\r\n 25                 $this->assertType('array', $set);\r\n 26                 $this->assertSame(1, count($set));\r\n 27                 $this->assertArrayHasKey('id', $set[0]);\r\n 28                 $this->assertArrayHasKey('merchant', $set[0]);\r\n 29                 $this->assertArrayHasKey('payment_type_id', $set[0]);\r\n 30                 $this->assertArrayHasKey('order_id', $set[0]);\r\n 31                 $this->assertArrayHasKey('track_id', $set[0]);\r\n 32         }\r\n 33 }\r\n{noformat}\r\n\r\nOutput of PHPUnit is a success:\r\n{noformat}\r\nphpunit MyDbTest .\/zf-8209.php \r\nPHPUnit 3.4.2 by Sebastian Bergmann.\r\n\r\n.\r\n\r\nTime: 0 seconds\r\n\r\nOK (1 test, 7 assertions)\r\n{noformat}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dragonbe",
                        "name": "dragonbe",
                        "displayName": "Michelangelo van Dam",
                        "active": true
                    },
                    "created": "2009-11-19T07:24:20.000+0000",
                    "updated": "2009-11-19T07:24:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36162",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eastzenders",
                        "name": "eastzenders",
                        "displayName": "Bryn Davies",
                        "active": true
                    },
                    "body": "The problems I describe occur only with pdo_mySql and not SQLite - in fact we are using sqlite in  order to get around this issue. More than 4 columns in a table and you get a crash, less than 4 and you get corrupt record names.\r\n\r\nCheers,\r\nBryn",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eastzenders",
                        "name": "eastzenders",
                        "displayName": "Bryn Davies",
                        "active": true
                    },
                    "created": "2009-11-19T08:00:45.000+0000",
                    "updated": "2009-11-19T08:00:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36263",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dragonbe",
                        "name": "dragonbe",
                        "displayName": "Michelangelo van Dam",
                        "active": true
                    },
                    "body": "Ok, let me rework my unit test using a MySQL database then. Which flavor of MySQL are you having this experience with ?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dragonbe",
                        "name": "dragonbe",
                        "displayName": "Michelangelo van Dam",
                        "active": true
                    },
                    "created": "2009-11-20T05:21:48.000+0000",
                    "updated": "2009-11-20T05:21:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36270",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dragonbe",
                        "name": "dragonbe",
                        "displayName": "Michelangelo van Dam",
                        "active": true
                    },
                    "body": "Cannot reproduce the error, had following unit test run against both MySQL 5.0 and 5.1 databases.\r\n\r\nPlease use following unit test to reproduce your error.\r\n\r\n{noformat}\r\n<?php\r\n\r\nrequire_once 'PHPUnit\/Framework.php';\r\nrequire_once 'Zend\/Db.php';\r\nclass MyDbTest extends PHPUnit_Framework_TestCase\r\n{\r\n        \/**\r\n         * populated db table 'payment' with 3 rows\r\n         *\r\n         * id | merchant | payment_type_id | order_id | track_id\r\n         * 1|test 1|1|3|1\r\n         * 2|test 2|1|3|2\r\n         * 3|test 3|1|3|2\r\n         *\/\r\n        public function testDbAccess()\r\n        {\r\n                $db = Zend_Db::factory(\r\n                        'Pdo_MySQL',\r\n                        array (\r\n                                'host'          => 'localhost',\r\n                                'username'      => 'zfbhd',\r\n                                'password'      => 'secret',\r\n                                'dbname'        => 'test'\r\n                        )\r\n                );\r\n\r\n                $sql = 'SELECT * FROM payment WHERE id = ?';\r\n                $data = 1;\r\n                $set = $db->fetchAll($sql, $data);\r\n                $this->assertType('array', $set);\r\n                $this->assertSame(1, count($set));\r\n                $this->assertArrayHasKey('id', $set[0]);\r\n                $this->assertArrayHasKey('merchant', $set[0]);\r\n                $this->assertArrayHasKey('payment_type_id', $set[0]);\r\n                $this->assertArrayHasKey('order_id', $set[0]);\r\n                $this->assertArrayHasKey('track_id', $set[0]);\r\n        }\r\n}\r\n{noformat}\r\n\r\nUntil further notice, I set the status of this issue again to resolved...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dragonbe",
                        "name": "dragonbe",
                        "displayName": "Michelangelo van Dam",
                        "active": true
                    },
                    "created": "2009-11-20T05:39:50.000+0000",
                    "updated": "2009-11-20T05:39:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36278",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eastzenders",
                        "name": "eastzenders",
                        "displayName": "Bryn Davies",
                        "active": true
                    },
                    "body": "Problem summary",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eastzenders",
                        "name": "eastzenders",
                        "displayName": "Bryn Davies",
                        "active": true
                    },
                    "created": "2009-11-20T07:05:19.000+0000",
                    "updated": "2009-11-20T07:05:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36279",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eastzenders",
                        "name": "eastzenders",
                        "displayName": "Bryn Davies",
                        "active": true
                    },
                    "body": "Hi,\r\n\r\nI've attached a screenshot that highlights the issues I have when I run your test code. \r\n\r\nRunning MySQL 5.1.36-community via TCP\/IP\r\n\r\nZend Studio Version 7.1.0.20091014 (Though this issue has appeared in previous versions).\r\n\r\nAs I say, if this test code is chucked into say, a controller, it executes fine. But as a test it becomes corrupt.\r\n\r\nCheers,\r\n\r\nBryn",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=eastzenders",
                        "name": "eastzenders",
                        "displayName": "Bryn Davies",
                        "active": true
                    },
                    "created": "2009-11-20T07:09:19.000+0000",
                    "updated": "2009-11-20T07:09:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/42102",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=marguskoiduste",
                        "name": "marguskoiduste",
                        "displayName": "Margus Koiduste",
                        "active": true
                    },
                    "body": "Hi,\r\n\r\nCheck out my comment on following issue for possible fix: http:\/\/zendframework.com\/issues\/browse\/ZF-7734\r\n\r\nMargus",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=marguskoiduste",
                        "name": "marguskoiduste",
                        "displayName": "Margus Koiduste",
                        "active": true
                    },
                    "created": "2010-08-25T06:36:56.000+0000",
                    "updated": "2010-08-25T06:36:56.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8209\/transitions"
}