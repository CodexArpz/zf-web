{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7214",
    "key": "ZF-7214",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "addTranslation 'clear' option is sticky!"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7214\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10360",
                    "id": 10360,
                    "description": "Minor Release",
                    "name": "1.10.0",
                    "userReleaseDate": "27\/Jan\/10",
                    "archived": false,
                    "releaseDate": "2010-01-27",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-08-25T13:01:25.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=yisraeldov",
                "name": "yisraeldov",
                "displayName": "Yisrael Dov",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-07-07T05:01:24.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-08-25T13:01:25.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "Zend_Translate_Adapter",
                "addTranslation",
                "clear"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When using the Zend_Translate_Adapter->addTranslation() with the 'clear' option.  The clear option sticks and data never gets set. \n\nhere is my work around:\n{quote}\n$adapter->addTranslation($data,$locale,array('clear'=>true));\n \/\/due to a bug in zend , 'clear' is sticky, so we need to unset it !\n$adapter->addTranslation($data,$locale,array('clear'=>false));\n\/\/now you can add more data\n{quote}\n\nThis might be only in the **gettext** adapter "
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7214\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10310",
                    "id": 10310,
                    "description": "Mini Release",
                    "name": "1.8.1",
                    "userReleaseDate": "12\/May\/09",
                    "archived": false,
                    "releaseDate": "2009-05-12",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10340",
                    "id": 10340,
                    "description": "Mini Release",
                    "name": "1.8.4",
                    "userReleaseDate": "23\/Jun\/09",
                    "archived": false,
                    "releaseDate": "2009-06-23",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10099",
                    "id": 10099,
                    "name": "Zend_Translate",
                    "description": "Provides translation functionality, based on standards such as TMX and Gettext.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32448",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "What do you mean with \"sticky\" ?\n\nThe clear options erases previous set data so only the newly given data is available. It works only for the given locale.\n\nAdditionally all set options are internally stored so they don't have to be given again as this would not work when searching through directory structures.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-07-07T05:13:45.000+0000",
                    "updated": "2009-07-07T05:13:45.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32449",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Changing priority as it does not block behaviour.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-07-07T05:14:57.000+0000",
                    "updated": "2009-07-07T05:14:57.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32450",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=yisraeldov",
                        "name": "yisraeldov",
                        "displayName": "Yisrael Dov",
                        "active": true
                    },
                    "body": "actually it does block behavior.\n\nif you call:\n\n$adapter->addTranslation($data,$locale,array('clear'=>true));\n\nand then call \n\n$adapter->addTranslation($data2,$locale);\n\nthe second call will also have option['clear'] set to true. That means that $data2 will overwrite $data.\n\neven worse than this $data and $data2 will be cleared immediately and the translation adapter will have no data!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=yisraeldov",
                        "name": "yisraeldov",
                        "displayName": "Yisrael Dov",
                        "active": true
                    },
                    "created": "2009-07-07T05:20:56.000+0000",
                    "updated": "2009-07-07T05:20:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32451",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Again: This is expected behaviour.\n\nOptions are set and stored so they don't have to be given again as described before.\nA simple call of setOptions() does also set options but will not add data.\n\nAnd the translation adapter does not have no data... the data which are read with the call of addTranslation are always available even if you give the 'clear' option.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-07-07T05:39:41.000+0000",
                    "updated": "2009-07-07T05:39:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32456",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Also to mention as I just saw it:\n\nThe input $data and $data2 is not touched by Zend_Translate. It does not delete given data, it could just access it's own data.\n\nWhat you described is not possible by Zend_Translate. I expect that you access and delete your input data in another way.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-07-07T08:04:27.000+0000",
                    "updated": "2009-07-07T08:04:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32469",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=yisraeldov",
                        "name": "yisraeldov",
                        "displayName": "Yisrael Dov",
                        "active": true
                    },
                    "body": "Here I will show an example that might make it more clear :\n\n\n{code}\n    if(is_readable($data)){\n        print_r($adapter->getMessageIds());\n        \/*\n        Outputs:\n        Array\n        (\n            [0] => afghanistan\n            [1] => aland_islands\n            ...\n            [310] => wrong_phone_length\n            [311] => missingToken\n            [312] => notSame\n        )\n        *\/\n        $adapter->addTranslation($data,$locale,array('clear'=>true));\n        \/\/due to a bug in zend , 'clear' is sticky, so we need to unset it !\n        \/\/$adapter->addTranslation($data,$locale,array('clear'=>false));\n        print_r($adapter->getOptions());\n        \/*\n        Array\n        (\n            [clear] => 1\n            [disableNotices] => \n            [ignore] => .\n            [locale] => he\n            [log] => \n            [logMessage] => Untranslated message within '%locale%': %message%\n            [logUntranslated] => 1\n            [scan] => filename\n            [automatic] => \n        )\n        *\/\n        print_r($adapter->getMessageIds());\n        \/*\n        Array\n        (\n        )\n        NO KEYS !!\n        *\/\n    }\n    \/\/add shared translations\n    $data = $data = APPLICATION_PATH . \"\/languages\/shared\"; \n    if(is_readable($data)){\n        $adapter->addTranslation($data,$adapter->getLocale());\n        print_r($adapter->getOptions());\n        \/*\n        Array\n        (\n            [clear] => 1\n            [disableNotices] => \n            [ignore] => .\n            [locale] => ru\n            [log] => \n            [logMessage] => Untranslated message within '%locale%': %message%\n            [logUntranslated] => 1\n            [scan] => filename\n            [automatic] => \n        )\n        \n        (some how the locale changed !?)\n        *\/\n        \n        print_r($adapter->getMessageIds());\n        \/*\n        Array\n        (\n        )\n        STILL NO KEYS !!\n        *\/\n    }\n{code}\n\nIn the above example my *fix* was commented out.\n\nThe expected behaviour when using clear, is that the old data will be replaced but the new data. Not that it will remain with no data at all! \n\nAdditionally I would expect that the clear would only happen once, not every time I call addTranslation.\n\nBut if I use my *fix* it works like expected.\n\n{code}\n    if(is_readable($data)){\n        print_r($adapter->getMessageIds());\n        \/*\n        Outputs:\n        Array\n        (\n            [0] => afghanistan\n            [1] => aland_islands\n            ...\n            [310] => wrong_phone_length\n            [311] => missingToken\n            [312] => notSame\n        )\n        *\/\n        $adapter->addTranslation($data,$locale,array('clear'=>true));\n        \/\/due to a bug in zend , 'clear' is sticky, so we need to unset it !\n        $adapter->addTranslation($data,$locale,array('clear'=>false));\n        print_r($adapter->getOptions());\n        \/*\n        Array\n        (\n            [clear] => \n            [disableNotices] => \n            [ignore] => .\n            [locale] => en\n            [log] => \n            [logMessage] => Untranslated message within '%locale%': %message%\n            [logUntranslated] => 1\n            [scan] => filename\n            [automatic] => \n        )\n        *\/\n        print_r($adapter->getMessageIds());\n        \/*\n        Array\n        (\n            [0] => Continue\n            [1] => Give Super Forex Your money.\n            [2] => Super Forex\n            [3] => SuperFX\n            [4] => Your email\n        )\n        Now we have KEYS !!\n        *\/\n    }\n    \/\/add shared translations\n    $data = $data = APPLICATION_PATH . \"\/languages\/shared\"; \n    if(is_readable($data)){\n        $adapter->addTranslation($data,$adapter->getLocale());\n        print_r($adapter->getOptions());\n        \/*\n        Array\n        (\n            [clear] => \n            [disableNotices] => \n            [ignore] => .\n            [locale] => en\n            [log] => \n            [logMessage] => Untranslated message within '%locale%': %message%\n            [logUntranslated] => 1\n            [scan] => filename\n            [automatic] => \n        )\n        \n        (now the locale also stayed the same)\n        *\/\n        \n        print_r($adapter->getMessageIds());\n        \/*\n        Array\n        (\n            [0] => Continue\n            [1] => Give Super Forex Your money.\n            [2] => Super Forex\n            [3] => SuperFX\n            [4] => Your email\n            [5] => afghanistan\n            [6] => aland_islands\n            ...\n            [314] => wrong_phone_length\n            [315] => missingToken\n            [316] => notSame\n        )\n            \n        Now we have keys from BOTH data sources!\n        *\/\n    }\n{code}\n\nLet me know if this is still not clear. \n\n(Additionally if the intended behaviour of the 'clear' option was to leave the adapter without any data, then the data paramater should not be required!)\n\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=yisraeldov",
                        "name": "yisraeldov",
                        "displayName": "Yisrael Dov",
                        "active": true
                    },
                    "created": "2009-07-08T03:29:54.000+0000",
                    "updated": "2009-07-08T03:29:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32470",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=yisraeldov",
                        "name": "yisraeldov",
                        "displayName": "Yisrael Dov",
                        "active": true
                    },
                    "body": "I've noticed this problem also in 1.8.1 and 1.8.4",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=yisraeldov",
                        "name": "yisraeldov",
                        "displayName": "Yisrael Dov",
                        "active": true
                    },
                    "created": "2009-07-08T03:56:11.000+0000",
                    "updated": "2009-07-08T03:56:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33904",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Fixed with r17813",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-08-25T13:01:24.000+0000",
                    "updated": "2009-08-25T13:01:24.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7214\/transitions"
}