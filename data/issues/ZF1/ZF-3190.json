{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3190",
    "key": "ZF-3190",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Cache_Frontend_Output::start() to return data for success"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3190\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10240",
                    "id": 10240,
                    "description": "Minor Release",
                    "name": "1.6.0",
                    "userReleaseDate": "02\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-02",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2008-05-28T09:36:13.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                "name": "zendfw",
                "displayName": "Shekar Reddy",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-05-02T13:18:31.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-09-02T10:39:42.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Currently, there is no way to replace place-holder text in an output-cached page's content. The start() method just outputs the data and returns true for cache-hit. We need a way to replace any place-holders in the content before outputting it:\n\n\n{code}\n\nLine: 55\n-   public function start($id, $doNotTestCacheValidity = false)\n+   public function start($id, $doNotTestCacheValidity = false, $echoData = true)\n\nLine: 59\n+   if ( $echoData )\n    {\n       echo ($data);\n       return true;         \/\/ Since data is already output, there is no use with the returned data\n    }\n+   else\n+      return ($data);      \/\/ Developer's responsibility to echo it later\n\n{code}\n\n\nThe above changes are backwards-compatible with a 3rd argument that has a default value. Further, returning a valid data evaluates to true and so existing code will still work without any changes.\n\nHowever, I'm not quite sure off the top of my head if this $echoData argument and returning $data is to be implemented in the start() method or the end() method or both the methods.\n\nIf the above is unclear, all I want to do is save data along with placeholders to cache but just before outputting data, I intend to replace the placeholders inside the data with custom content (such as: Hello Fabien!, Hello Guest!, etc)\n\nThanks!"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3190\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                "name": "fab",
                "displayName": "Fabien MARTY",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10174",
                    "id": 10174,
                    "description": "Mini Release",
                    "name": "1.5.1",
                    "userReleaseDate": "25\/Mar\/08",
                    "archived": true,
                    "releaseDate": "2008-03-25",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10028",
                    "id": 10028,
                    "name": "Zend_Cache",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21806",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "body": "Here is what I figured out as changes needed to the start() and end() methods for the placeholder logic to work:\n\n{code}\n    public function start($id, $doNotTestCacheValidity = false, $echo = true)\n    {\n        $data = $this->load($id, $doNotTestCacheValidity);\n        \/\/\n        if ($data !== false)\n        {\n            if ($echo)\n\t        echo($data);\n            \/\/\n            return $data;\n        }\n        \/\/\n        ob_start();\n        ob_implicit_flush(false);\n        \/\/\n        return false;\n    }\n\n    public function end($tags = array(), $specificLifetime = false, $data = '')\n    {\n    \t$echo = 0;\n    \t\/\/\n    \tif ( ! $data )\n        {\n            $echo = 1;\n            $data = ob_get_contents();\n            ob_end_clean();\n        }\n        \/\/\n        $this->save($data, null, $tags, $specificLifetime);\n        \/\/\n        if ( $echo )\n            echo($data);\n    }\n{code}\n\nHope this helps...",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "created": "2008-05-17T23:54:16.000+0000",
                    "updated": "2008-05-17T23:54:16.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21813",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "ok for next minor release",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2008-05-18T14:35:30.000+0000",
                    "updated": "2008-05-18T14:35:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21831",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "on your last comment, what about sending $data to the browser (in the end() method) in any cases ($data = '', $data != '') ?\n\nHave you have a real example for this particular point ?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2008-05-19T13:23:50.000+0000",
                    "updated": "2008-05-19T13:23:50.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21873",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "I just commited it into SVN trunk. Can you try it ?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2008-05-21T10:48:30.000+0000",
                    "updated": "2008-05-21T10:48:30.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21881",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "body": "Hi Fabien,\n\nIn the end() method, the developer can pass an arbitrary\/pre-captured $data argument which means he\/she has already captured the data and needs to do some pre-processing\/placeholder-replacements with it before echoing it to the browser. In this case where the $data is not null, its the developer's responsibility to echo the output to the browser. However, the save() logic is still delegated to the end() method - saving $data to cache \"before\" any placeholder-replacements are made (in raw form). I have two issues using the new code you proposed in the end() method:\n\n1. Placeholders are not displaying when the page is generated - they are displaying only when the page is loaded from cache which means users will miss out on placeholder data when the page is generated. This is kind of a chicken-n-egg situation but fortunately, not impossible to work around.\n\n2. Output is displayed twice because I need to output it too before invoking end(). I can control this by sending the output to the browser only if it is not an output-cached page but point # 1 above is still an issue ;(\n\n3. In the start() method, we need the $data to be returned if $data !== false (this value is in raw form that was saved to cache earlier without any placeholder replacements) so that we can do post-processing\/placeholder-replacements on it before sending it to the browser.\n\n\nWell, how about this revised script with soft-coded arguments for a fine-grained control (while maintaining the default functionality) and more options for developers which means they can control start\/end logic in whatever way they want:\n\n{code}\n\n    public function start($id, $doNotTestCacheValidity = false, $echo = true)\n    {\n        $data = $this->load($id, $doNotTestCacheValidity);\n        \/\/\n        if ($data !== false)\n        {\n            if ($echo)\n\t        echo($data);\n            \/\/\n            return $data;            \/\/ Return the $data for post-processing\n        }\n        \/\/\n        ob_start();\n        ob_implicit_flush(false);\n        \/\/\n        return false;\n    }\n\n    public function end($tags = array(), $specificLifetime = false, $data = null, $echo = true)\n    {\n    \tif ( is_null( $data ))\n        {\n            $data = ob_get_contents();\n            ob_end_clean();\n        }\n        \/\/\n        $this->save($data, null, $tags, $specificLifetime);\n        \/\/\n        if ( $echo )\n            echo($data);\n    }\n\n{code}\n\n\nHope this is clear... The above code works like a treat for me!\n\nThanks much for a quick turnaround of this task!!\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "created": "2008-05-21T22:42:47.000+0000",
                    "updated": "2008-05-21T22:42:47.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21882",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "body": "An addition to point # 3 I mentioned above on start() method:\n\n3.1) The developer would pass $echo = false, get the $data returned, do placeholder-replacements on it and echo it himself.\n\n\n(PS: this is an exotic behavior taking the echo functionality out of start\/end methods but the default behavior of cache-output-frontend is unchanged).\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "created": "2008-05-21T23:04:36.000+0000",
                    "updated": "2008-05-21T23:04:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21883",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "body": "The same logic applies to end() method:\n\nThe developer passes $echo = false along with raw $data but only after echoing the post-processed $data.\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "created": "2008-05-21T23:10:20.000+0000",
                    "updated": "2008-05-21T23:10:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21922",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "body": "I just commited a new version (svn\/trunk\/9527). Can you try it ?\n\nNote: in the start() method, when $echo=true (default), I must return a boolean and not $data (to avoid an API break)",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fab",
                        "name": "fab",
                        "displayName": "Fabien MARTY",
                        "active": true
                    },
                    "created": "2008-05-25T11:27:54.000+0000",
                    "updated": "2008-05-25T11:27:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21976",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "body": "I have tested these fixes and they seem to be working as expected now. Thanks for the brilliant workaround.\n\nThanks,\n\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "created": "2008-05-27T22:58:56.000+0000",
                    "updated": "2008-05-27T22:58:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/21978",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "body": "Output.php\nLine 92\n\n{code}\n\n-            $data = $forcedDatas;\n+           $data =& $forcedDatas;         \/\/ Assign by reference and avoid duplicate copy in memory\n\n{code}\n\nSince output could be a long string of HTML, it could hog the server's memory if duplicated even for a short duration.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=zendfw",
                        "name": "zendfw",
                        "displayName": "Shekar Reddy",
                        "active": true
                    },
                    "created": "2008-05-27T23:06:52.000+0000",
                    "updated": "2008-05-27T23:06:52.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/24193",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Updating for the 1.6.0 release.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2008-09-02T10:39:42.000+0000",
                    "updated": "2008-09-02T10:39:42.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3190\/transitions"
}