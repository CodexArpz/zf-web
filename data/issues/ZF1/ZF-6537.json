{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6537",
    "key": "ZF-6537",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Disabling Zend_Layout does not work correctly when ActionStack used."
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6537\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-11-20T20:53:32.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lightflowmark",
                "name": "lightflowmark",
                "displayName": "Mark",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-05-05T04:32:53.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T20:53:32.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "actionstack",
                "disableLayout"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "This is partly a Zend_Layout issue and partly a problem with ViewRenderer helper, I think. \n\nSuppose one is using Zend_Layout with the ActionStack, as recommended in the docs, and the stack is set up at dispatchLoopStartup (which seems like the right place for it).  Content from these actions is assigned to response segments using $this->_helper->viewRenderer->setResponseSegment('someSegment'), in order that it can be rendered in the correct place by Zend_Layout.\n\nI want to disable the layout in one of my actions; however, when I do so (using $this->getHelper('layout')->disableLayout()) , any actions previously called by the ActionStack are then appended to the body - there are no layout placeholders (as layout is disabled), and so these items are simply tagged on to the main body.  This is not, I believe, appropriate behaviour.\n\nPsuedo-code may clarify:\n\n{code:title=MyApp_Controller_Plugin_ActionSetup|borderStyle=solid}\n  function dispatchLoopStartup\n  {\n            $actionStack = $front->getPlugin('Zend_Controller_Plugin_ActionStack');\n            $menuAction = clone($request);\n            $menuAction->setActionName('menu')\n                    ->setControllerName('my_controller');\n            $actionStack->pushStack($menuAction);\n  }\n{code} \n\n{code:title=MyController.php|borderStyle=solid}\n  function menuAction\n  {\n     \/\/ stuff ...\n     \/\/ menu viewscript renders like <div id=menu>menu item 1, menu item 2<\/div>\n     $this->_helper->viewRenderer->setResponseSegment('menu');\n  }\n\n  function withLayoutAction\n  {\n     \/\/ stuff ...\n     \/\/ withLayout viewscript renders like <div id=withLayout>some with-layout text<\/div>\n  }\n\n  function noLayoutAction\n  {\n     $this->getHelper('layout')->disableLayout();\n     \/\/ stuff\n     \/\/ noLayout viewscript renders like <div id=noLayout>Some no-layout stuff here<\/div>    \n  }\n{code} \n\n{code:title=layout.phtml|borderStyle=solid}\n<H1>Menu<\/H1>\n<?= $this->layout()->menu ?>\n\n<H1>Main Content<\/H1>\n<?= $this->layout()->content ?>\n{code} \n\n\n\nIf I go to my_controller\/withLayout, I get the menu and withLayout div rendered at the layout placeholders as you'd expect, no problem.\nIf I go to my_controller\/noLayout, I the full output is:\n<div id=noLayout>Some no-layout stuff here<\/div><div id=menu>menu item 1, menu item 2<\/div>\n\nThe content from menuAction is simply appended to the content from noLayoutAction, which is exactly *not* what I want! \n\n\n\n\n\nOne workaround is rather than disable the layout, to use a layout template with only the 'content' placeholder:\n{code:title=no-layout.phtml|borderStyle=solid}\n<?= $this->layout()->content ?>\n{code}\nand then, rather than disabling the layout, change layout script in the controller action\n{code:title=MyController.php|borderStyle=solid}\nfunction noLayoutAction\n{\n  $this->getHelper('layout')->setLayout('no-layout');\n} \n{code}\n\nThis implies to me that a possible fix would be to never actually disable Zend_Layout, but instead force it to use a basic layout template as above; to rewrite disableLayout:\n\n{code:title=Zend_Layout|borderStyle=solid}\npublic function disableLayout()\n{\n  $this->setLayout('no-layout');\n  $this->_enabled = false;\n  return($this);\n}\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6537\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10270",
                    "id": 10270,
                    "name": "Zend_Layout",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30678",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lightflowmark",
                        "name": "lightflowmark",
                        "displayName": "Mark",
                        "active": true
                    },
                    "body": "Markup edit for readability.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=lightflowmark",
                        "name": "lightflowmark",
                        "displayName": "Mark",
                        "active": true
                    },
                    "created": "2009-05-05T04:50:32.000+0000",
                    "updated": "2009-05-05T04:50:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30691",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Assigning to Ralph",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2009-05-05T06:46:02.000+0000",
                    "updated": "2009-05-05T06:46:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/30935",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=doctorrock83",
                        "name": "doctorrock83",
                        "displayName": "julien PAULI",
                        "active": true
                    },
                    "body": "Yeah, good one.\nThis is because the response object sticks all its body segments together when outputed, and the layout , when activated pulls them from the response.\nWhen the layout is disabled, the segment is not pulled out from the response object, so it gets rendered.\n\nA quick patch could be (Plugin\/Layout)\n\n{code}\nif (!$layout->isEnabled()) {\n            if (Zend_Controller_Front::getInstance()->getParam('noViewRenderer') == false && !Zend_Controller_Action_HelperBroker::hasHelper('viewRenderer')) {\n                return;\n            }\n            $segment = Zend_Controller_Action_HelperBroker::getStaticHelper('ViewRenderer')->getResponseSegment();\n            if ($segment != null) {\n                $response = $this->getResponse();\n                $response->setBody('', $segment);\n            }\n            return;\n        }\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=doctorrock83",
                        "name": "doctorrock83",
                        "displayName": "julien PAULI",
                        "active": true
                    },
                    "created": "2009-05-13T11:39:53.000+0000",
                    "updated": "2009-05-13T11:39:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52836",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "body": "Bulk change of all issues last updated before 1st January 2010 as \"Won't Fix\".\r\n\r\nFeel free to re-open and provide a patch if you want to fix this issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "created": "2012-11-20T20:53:32.000+0000",
                    "updated": "2012-11-20T20:53:32.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-6537\/transitions"
}