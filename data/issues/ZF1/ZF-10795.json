{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10795",
    "key": "ZF-10795",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Http_UserAgent_Features_Adapter_WurflApi does not properly pass in configuration paramters to Wurfl library"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10795\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jared.ray",
                "name": "jared.ray",
                "displayName": "Jared Ray",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2010-12-08T09:50:35.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-06-12T16:45:08.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "In {{Zend_Http_UserAgent_Features_Adapter_WurflApi}}, the ZF documentation states that a parameter may be used to configure the wurfl adapter with an array using the {{wurfl_config_array}} key as part of the UserAgent configuration. The array is passed to the wurfl configuration in the code block below:\r\n\r\n{noformat}\r\n$wurflConfig->wurflFile($c['wurfl']['main-file'])\r\n    ->wurflPatch($c['wurfl']['patches'])\r\n    ->persistence($c['persistence']['provider'], $c['persistence']['dir']);\r\n{noformat}\r\n\r\nThere are a couple issues with this.\r\n1. It does not allow configuration of the \"cache provider\" for the wurfl library, something that would be nice to have and differs from the \"persistence\" functionality that is configured here.\r\n2. It does not pass in the {{dir}} parameter in correctly for the \"persistence\" provider. It should be passed as an array with the {{dir}} key specified instead of passing the {{dir}} parameter in directly.\r\n3. It assumes that we are using a persistence provider that requires a {{dir}} parameter, which could very well not be the case, like with Memcache or some other adapter.\r\n\r\nFor example, to get the wurfl persistence provider to use the {{dir}} parameter from a Zend_Config_Xml, one would have to structure it like this:\r\n{code:XML}\r\n<persistence>\r\n    <provider>file<\/provider>\r\n    <dir>\r\n        <dir>\/home\/jray\/htdocs\/newui\/application\/cache\/wurfl\/persistence<\/dir>\r\n    <\/dir>\r\n<\/persistence>\r\n{code}\r\n\r\nA better implementation that would also allow for arbitrary parameters to be passed would be something like this:\r\n{code:XML}\r\n<persistence>\r\n    <provider>file<\/provider>\r\n    <params>\r\n        <dir>\/home\/jray\/htdocs\/newui\/application\/cache\/wurfl\/persistence<\/dir>\r\n    <\/params>\r\n<\/persistence>\r\n{code}\r\n\r\nIf the code in {{Zend_Http_UserAgent_Features_Adapter_WurflApi}} was changed to something like this it would resolve all of the issues above.\r\n{noformat}\r\n$wurflConfig->wurflFile($c['wurfl']['main-file'])\r\n    ->wurflPatch($c['wurfl']['patches'])\r\n    ->persistence($c['persistence']['provider'], $c['persistence']['params'])\r\n    ->cache($c['cache']['provider'], $c['cache']['params']);\r\n{noformat}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10795\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=interakting",
                "name": "interakting",
                "displayName": "Business&Decision \/ Interakting",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-12284",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-12284",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13642",
                    "filename": "ZF-10795.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=craiz",
                        "name": "craiz",
                        "displayName": "Rob Jacoby",
                        "active": true
                    },
                    "created": "2011-02-17T14:13:31.000+0000",
                    "size": 10465,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13642\/ZF-10795.patch"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/attachment\/13520",
                    "filename": "ZF-10795.patch",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jared.ray",
                        "name": "jared.ray",
                        "displayName": "Jared Ray",
                        "active": true
                    },
                    "created": "2010-12-08T09:52:33.000+0000",
                    "size": 956,
                    "mimeType": "text\/plain",
                    "content": "http:\/\/fw02.zend.com\/issues\/secure\/attachment\/13520\/ZF-10795.patch"
                }
            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-11076",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11076",
                    "type": {
                        "name": "Sub-Task",
                        "direction": "OUTBOUND"
                    }
                }
            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10420",
                    "id": 10420,
                    "description": "Minor Release",
                    "name": "1.11.0",
                    "userReleaseDate": "02\/Nov\/10",
                    "archived": false,
                    "releaseDate": "2010-11-02",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10501",
                    "id": 10501,
                    "description": "Mini Release",
                    "name": "1.11.1",
                    "userReleaseDate": "30\/Nov\/10",
                    "archived": false,
                    "releaseDate": "2010-11-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10500",
                    "id": 10500,
                    "name": "Zend_Http_UserAgent",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43519",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jared.ray",
                        "name": "jared.ray",
                        "displayName": "Jared Ray",
                        "active": true
                    },
                    "body": "This patch includes the change mentioned in the description.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jared.ray",
                        "name": "jared.ray",
                        "displayName": "Jared Ray",
                        "active": true
                    },
                    "created": "2010-12-08T09:52:40.000+0000",
                    "updated": "2010-12-08T09:52:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43520",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjh_ca",
                        "name": "mjh_ca",
                        "displayName": "Marc Hodgins",
                        "active": true
                    },
                    "body": "@Jared: Patch needs unit tests to confirm behavior (i.e. 'dir' is currently broken as described in the docs) and then apply your fix and the test should pass.   I'm not familiar with this component, but what if the 'cache' parameter is not passed?  Also need tests to ensure failing to provide these optional params doesn't break something.\r\n\r\nAlso is a documentation patched needed to explain the new ability to pass cache information this way?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mjh_ca",
                        "name": "mjh_ca",
                        "displayName": "Marc Hodgins",
                        "active": true
                    },
                    "created": "2010-12-08T10:48:32.000+0000",
                    "updated": "2010-12-08T10:48:32.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43595",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dcousineau",
                        "name": "dcousineau",
                        "displayName": "Daniel Cousineau",
                        "active": true
                    },
                    "body": "The cache section should be checked to see if it exists, but the ->persistence() portion probably needs to at least be pulled off into a separate ticket and fixed immediately given that it a bug (and not a missing feature like cache).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dcousineau",
                        "name": "dcousineau",
                        "displayName": "Daniel Cousineau",
                        "active": true
                    },
                    "created": "2010-12-14T10:24:54.000+0000",
                    "updated": "2010-12-14T10:24:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43596",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dcousineau",
                        "name": "dcousineau",
                        "displayName": "Daniel Cousineau",
                        "active": true
                    },
                    "body": "Actually there's a secondary bug within WURFL itself, while clearly the config should act as described by Jared, WURFL itself has no idea what it wants (WURFL\/Xml\/PersistenceProvider\/PersistenceProviderManager.php line 54).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dcousineau",
                        "name": "dcousineau",
                        "displayName": "Daniel Cousineau",
                        "active": true
                    },
                    "created": "2010-12-14T10:32:51.000+0000",
                    "updated": "2010-12-14T10:32:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/44421",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=craiz",
                        "name": "craiz",
                        "displayName": "Rob Jacoby",
                        "active": true
                    },
                    "body": "Zend\\Http\\UserAgent\\Features\\Adapter\\WurflApi is in my opinion unfixable for a WURFL 1.1 implementation due to inconsistencies in the WURFL API Config classes.\r\n\r\nIf we pass the config_array in with the 'dir' param instead of 'params' the API will throw a WURFL_WURFLException with the message: Specify a valid Persistence dir in the configuration file\r\n\r\nThis is due to the WURFL_Configuration_InMemoryConfig class setting the persistence array with two keys, 'provider' and 'params' (which is the expected use case), however the WURFL_Xml_PersistenceProvider_FilePersistenceProvider initialize function expects the persistence array to have a key of 'dir' which it will never have due to the keys being set forcefully in InMemoryConfig->persistence().\r\n\r\nMy suggestion would be to remove the ability to configure Wurfl using a wurfl_config_array in Zend\\Http\\UserAgent\\Features\\Adapter\\WurflApi using WURFL 1.1, and add a switch case for WURFL 1.2 allowing it as the bug has been fixed in this WURFL release.\r\n\r\nI have attached a patch to this affect.\r\n\r\nAlso included in this patch is changes to the UserAgentTest file to remove deprecated assertion assertType and replace it with assertInstanceOf",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=craiz",
                        "name": "craiz",
                        "displayName": "Rob Jacoby",
                        "active": true
                    },
                    "created": "2011-02-17T14:13:36.000+0000",
                    "updated": "2011-02-17T14:13:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/45572",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jared.ray",
                        "name": "jared.ray",
                        "displayName": "Jared Ray",
                        "active": true
                    },
                    "body": "Daniel and Rob are correct about the bug in WURFL 1.1. I was using the WURFL 1.2 library and the bug is fixed in version 1.2. I agree with Daniel that the cache section should be checked to see if it exists in the configuration.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jared.ray",
                        "name": "jared.ray",
                        "displayName": "Jared Ray",
                        "active": true
                    },
                    "created": "2011-03-22T16:11:54.000+0000",
                    "updated": "2011-03-22T16:11:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/45840",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mgil",
                        "name": "mgil",
                        "displayName": "Marcin Gil",
                        "active": true
                    },
                    "body": "For the moment it is possible to use WURLF 1.2.1 with following configuration without altering the code:\r\n'wurflapi' => array\r\n\t\t\t\t(\r\n\t\t\t\t\t'wurfl_api_version' => '1.1',\r\n\t\t\t\t\t'wurfl_lib_dir' => BASE_PATH .'\/library\/WURFL\/',\r\n\t\t\t\t\t'wurfl_config_array' => array\r\n\t\t\t\t\t(\r\n\t\t\t\t\t\t'wurfl' => array\r\n\t\t\t\t\t\t(\r\n\t\t\t\t\t\t\t'main-file' => $resourcesDir .'wurfl-2.0.27.zip',\r\n\t\t\t\t\t\t\t'patches' => $resourcesDir .'web_browsers_patch.xml',\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\t'persistence' => array\r\n\t\t\t\t\t\t(\r\n\t\t\t\t\t\t\t'provider' => 'file',\r\n\t\t\t\t\t\t\t'dir' => array('dir' => $cacheDir),\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t)\r\n\t\t\t\t),",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mgil",
                        "name": "mgil",
                        "displayName": "Marcin Gil",
                        "active": true
                    },
                    "created": "2011-04-08T09:41:54.000+0000",
                    "updated": "2011-04-08T09:41:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51074",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=henryhayes",
                        "name": "henryhayes",
                        "displayName": "Henry Hayes",
                        "active": true
                    },
                    "body": "I didn't know about this bug and a bug I created today appears to be a duplicate. However after reading through this bug I believe that the fix in this bug report would break anyone's code who has used the workaround mentioned in my bug report and that mentioned on the [stackoverflow.com article|http:\/\/stackoverflow.com\/questions\/6299986\/wurfl-with-zend-framework-ignoring-cache-directory-configuration].\r\n\r\nThe fix I have suggested is backward compatible:\r\n\r\nhttp:\/\/framework.zend.com\/issues\/browse\/ZF-11743\r\n\r\nNote: My patch also takes into account any other provider\/adapter that does not have a \"dir\" parameter but may have other parameters.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=henryhayes",
                        "name": "henryhayes",
                        "displayName": "Henry Hayes",
                        "active": true
                    },
                    "created": "2012-06-12T15:59:54.000+0000",
                    "updated": "2012-06-12T15:59:54.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51075",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=henryhayes",
                        "name": "henryhayes",
                        "displayName": "Henry Hayes",
                        "active": true
                    },
                    "body": "Wrong issue linked above, corrected link to \"Zend_Http_UserAgent_Features_Adapter_WurflApi Sends Persistence Information using WURFL_Configuration_InMemoryConfig to WURFL_WURFLManagerFactory incorrectly\"\r\n\r\n[http:\/\/framework.zend.com\/issues\/browse\/ZF-12284]",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=henryhayes",
                        "name": "henryhayes",
                        "displayName": "Henry Hayes",
                        "active": true
                    },
                    "created": "2012-06-12T16:02:37.000+0000",
                    "updated": "2012-06-12T16:02:37.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10795\/transitions"
}