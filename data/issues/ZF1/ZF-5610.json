{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5610",
    "key": "ZF-5610",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Solution to fetching\/saving localized Float values using Zend_Db"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5610\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-08-18T13:40:42.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dvp",
                "name": "dvp",
                "displayName": "Dmitry Pereslegin",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-01-22T06:32:49.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-08-18T13:40:42.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels",
            "value": [
                "Float",
                "Zend_Locale"
            ]
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Need solution to fetching\/saving Float values using Zend_Db on locale-aware sites.\n\nCurrently, I have to perform transformations:\n\n{code:title=Saving value}\n$row; \/\/ Zend_Db_Table_Row\n\n$value = '0,6'; \/\/ Localized float value (eg from Form)\n$formatOptions = array(\n    'locale' => Zend_Registry::get('Zend_Locale')\n);\n$row->value = Zend_Locale_Format::getFloat($value, $formatOptions);\n{code}\n\n{code:title=Reading value}\n$row; \/\/ Zend_Db_Table_Row\n\n$formatOptions = array(\n    'locale' => new Zend_Locale('en_US') \/\/ locale of MySQL floats\n);\n$value = Zend_Locale_Format::getFloat($row->value, $formatOptions);\n{code}\n\ninstead of simple:\n\n{code:title=Saving value}\n$row; \/\/ Zend_Db_Table_Row\n\n$value = '0,6'; \/\/ Localized float value (eg from Form)\n$row->value = $value\n{code}\n\n{code:title=Reading value}\n$row; \/\/ Zend_Db_Table_Row\n\n$value = $row->value;\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/6",
                "name": "N\/A"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5610\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                "name": "freak",
                "displayName": "Dolf Schimmel (Freeaqingme)",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-1457",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1457",
                    "type": {
                        "name": "Duplicate",
                        "direction": "OUTBOUND",
                        "description": "duplicates"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10250",
                    "id": 10250,
                    "description": "Mini Release",
                    "name": "1.7.3",
                    "userReleaseDate": "19\/Jan\/09",
                    "archived": false,
                    "releaseDate": "2009-01-19",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10012",
                    "id": 10012,
                    "name": "Zend_Db",
                    "description": "interfaces, APIs, and adapters for various third-party data stores",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28405",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "This is not a issue of Zend_Locale... erased component relation",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-01-22T08:39:49.000+0000",
                    "updated": "2009-01-22T08:39:49.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28406",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "This is definitly the wrong place for float conversion.\n\nWithin the database as also within the code you should ALWAYS work and use the standard float representation.\n\nONLY when you have to DISPLAY or INPUT\/OUTPUT the value to the user you must localize it.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-01-22T08:41:44.000+0000",
                    "updated": "2009-01-22T08:41:44.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28425",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dvp",
                        "name": "dvp",
                        "displayName": "Dmitry Pereslegin",
                        "active": true
                    },
                    "body": "Right, but ...\nWhen fetching float values from Db, they receive in the string representation (eg \"0.6\")\nbefore populating their to form need to perform each float value floatval(), otherwise they will be printed in the presentation of the database\n\n{code:title=bootstrap}\n...\nsetlocale(LC_ALL, 'un_US.UTF-8');\n$locale = new Zend_Locale(Zend_Locale::BROWSER);\nZend_Registry::set('Zend_Locale', $locale);\n...\n{code}\n\n{code:title=populate}\n$row; \/\/ Zend_Db_Table_Row\n\n$floatCols = array('compression', 'piston_stroke'); \/\/ float cols (from metadata)\n\n$form; \/\/ Zend_Form\n\n$data = $row->toArray();\n\n$formatOptions = array(\n    'locale' => Zend_Registry::get('Zend_Locale')\n);\nforeach ($floatCols as $key)\n    if (isset($data[$key]))\n        $data[$key] = Zend_Locale_Format::toFloat($data[$key], $formatOptions);\n\n$form->populate($data);\n{code}\n\nand when fetching data from Form i'am forced to perform transformation\n\n{code:title=save}\n$row; \/\/ Zend_Db_Table_Row\n\n$floatCols = array('compression', 'piston_stroke'); \/\/ float cols (from metadata)\n\n$form; \/\/ Zend_Form\n\n$values = $form->getValues();\n\nforeach ($floatCols as $floatCol)\n{\n    $value = $values[$floatCol];\n    $values[$floatCol] = strlen($value) ? Zend_Locale_Format::getFloat($value) : null;\n}\n\n$row->setFromArray($values);\n{code}\n\nToo difficult for the standard tasks on the locale-aware sites",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dvp",
                        "name": "dvp",
                        "displayName": "Dmitry Pereslegin",
                        "active": true
                    },
                    "created": "2009-01-22T16:18:10.000+0000",
                    "updated": "2009-01-22T16:18:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28426",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dvp",
                        "name": "dvp",
                        "displayName": "Dmitry Pereslegin",
                        "active": true
                    },
                    "body": "Sorry, populate block code bad ... this is right\n\n{code:title=populate}\n$row; \/\/ Zend_Db_Table_Row\n\n$floatCols = array('compression', 'piston_stroke'); \/\/ float cols (from metadata)\n\n$form; \/\/ Zend_Form\n\n$data = $row->toArray();\n\nforeach ($floatCols as $key)\n    if (isset($data[$key]))\n        $data[$key] = floatval($data[$key]);\n\n$form->populate($data);\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dvp",
                        "name": "dvp",
                        "displayName": "Dmitry Pereslegin",
                        "active": true
                    },
                    "created": "2009-01-22T16:20:22.000+0000",
                    "updated": "2009-01-22T16:20:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28436",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maurice",
                        "name": "maurice",
                        "displayName": "Moritz Mertinkat",
                        "active": true
                    },
                    "body": "Yes, this is NOT an issue of Zend_Locale and should NOT become one.\n\nWhat is needed here are INPUT and OUTPUT filters for Zend_Form_Element. I wonder why there isn't anything like that in Zend already.\n\n$element->addInputFilter('toLocaleFloat');\n$element->addOutputFilter('toRealFloat');\n\nFurther we should have $element->populate($value) which calls the InputFilter chain and something like $element->getValue() which applies the OutputFilter chain.\n\nI'm going to add something like that in the next few days as I'm really in need of such a feature for a lot of fields (dates, currency values). If you're interested, just drop me a line. Maybe I'm also writing a proposal...\n\nRegards,\nMaurice",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maurice",
                        "name": "maurice",
                        "displayName": "Moritz Mertinkat",
                        "active": true
                    },
                    "created": "2009-01-23T01:42:27.000+0000",
                    "updated": "2009-01-23T01:42:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33557",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "I definitely would NOT want to see any such feature near Zend_Db. If I want to insert a value '0,03' I expect my rdbms to receive the value '0,03' and not 0.03 . \n\nSame goes for retrieving values; if I have the value '0.03' in my Db, I expect to receive the value 0.03, and not '0,03'. What happens if I want to do some calculations with the floats zend_db returned? Kinda unhandy if they contain comma's.\n\n@Moritz Zend_Form already has the getValues() method, which you can use to apply such a filter.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-08-17T18:08:48.000+0000",
                    "updated": "2009-08-17T18:08:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33567",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Just one note:\nThere is a Zend_Filter_LocalizedToNormalizes which can also convert localized float values to normalized ones and another filter for the reverse conversion.\n\nAnd filters can be applied to Zend_Form elements as also be used standalone.\n\nIn my opinion this issue can be closed as not an issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2009-08-17T23:58:34.000+0000",
                    "updated": "2009-08-17T23:58:34.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33613",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "I'm closing this issue as not-an-issue as the general consensus (here, and on IRC) seems to be that it is definitely not something to be done within Zend_Db, and that such functionality is already provided in places where it's much better located.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-08-18T13:40:27.000+0000",
                    "updated": "2009-08-18T13:40:27.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5610\/transitions"
}