{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8431",
    "key": "ZF-8431",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Cache_Backend_TwoLevels: auto_refresh_fast_cache always saves fast backend"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/11",
                "name": "Patch",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8431\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-12-02T06:10:06.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                "name": "nikosams",
                "displayName": "Niko Sams",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-12-01T07:00:42.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2009-12-04T23:51:13.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "The current behaviour of auto_refresh_fast_cache is that it saves on every load. Saving is much slower (at least for memache) than loading, so this should be avoided whenever possible.\r\n\r\nI'd prefer cache misses from time to time for the slow backend and loading from slowBackend over always saving to fastBackend.\r\n\r\nPossible solution:\r\n{code}\r\nIndex: \/var\/www\/vpcms\/library\/zend\/1.9.0\/Zend\/Cache\/Backend\/TwoLevels.php\r\n===================================================================\r\n--- \/var\/www\/vpcms\/library\/zend\/1.9.0\/Zend\/Cache\/Backend\/TwoLevels.php  (revision 29934)\r\n+++ \/var\/www\/vpcms\/library\/zend\/1.9.0\/Zend\/Cache\/Backend\/TwoLevels.php  (working copy)\r\n@@ -194,16 +194,18 @@\r\n     public function load($id, $doNotTestCacheValidity = false)\r\n     {\r\n         $res = $this->_fastBackend->load($id, $doNotTestCacheValidity);\r\n+        $loadedFromFast = true;\r\n         if ($res === false) {\r\n             $res = $this->_slowBackend->load($id, $doNotTestCacheValidity);\r\n             if ($res === false) {\r\n                 \/\/ there is no cache at all for this id\r\n                 return false;\r\n             }\r\n+            $loadedFromFast = false;\r\n         }\r\n         $array = unserialize($res);\r\n         \/\/ maybe, we have to refresh the fast cache ?\r\n-        if ($this->_options['auto_refresh_fast_cache']) {\r\n+        if ($this->_options['auto_refresh_fast_cache'] && !$loadedFromFast) {\r\n             if ($array['priority'] == 10) {\r\n                 \/\/ no need to refresh the fast cache with priority = 10\r\n                 return $array['data'];\r\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8431\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                "name": "satoruyoshida",
                "displayName": "Satoru Yoshida",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-7972",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7972",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10390",
                    "id": 10390,
                    "description": "Mini Release",
                    "name": "1.9.6",
                    "userReleaseDate": "24\/Nov\/09",
                    "archived": false,
                    "releaseDate": "2009-11-24",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10028",
                    "id": 10028,
                    "name": "Zend_Cache",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36617",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "body": "Hi, Niko.\r\nI think You may need refresh only when the fastBackend returns falses though the lowBackend returns true.\r\nIs it correct for You?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "created": "2009-12-01T14:46:28.000+0000",
                    "updated": "2009-12-01T14:46:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36619",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "Yes, that's what my patch does.\r\n\r\nThis is especially useful when the fastBackend gets cleaned (memcache->flush() was called by another cache, server restart) but the slowBackend not.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2009-12-02T00:56:55.000+0000",
                    "updated": "2009-12-02T00:56:55.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36628",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "body": "I think the load method should set new life time of data in the fastBackend as the data is accessed.\r\n\r\nSo, I will categorize it won't fix.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "created": "2009-12-02T06:10:07.000+0000",
                    "updated": "2009-12-02T06:10:07.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36650",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "So you don't think this extra write is performance wise not optimal?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2009-12-02T23:51:51.000+0000",
                    "updated": "2009-12-02T23:51:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36651",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "body": "If the save method would not update $newFastLifetime at line 217,\r\nwe could change line 206.\r\nBut sadly the change may cause BC problems.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "created": "2009-12-03T00:18:13.000+0000",
                    "updated": "2009-12-03T00:18:13.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36652",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "What about a new option that enables this to keep BC?\r\n'auto_extend_fast_lifetime' or something",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2009-12-03T00:32:43.000+0000",
                    "updated": "2009-12-03T00:32:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36719",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "body": "Hi, Niko.\r\n\r\nHow about to using false for the auto_refresh_fast_cache option?\r\n\r\nIt might lead your problem to be solved, I think.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "created": "2009-12-04T23:16:33.000+0000",
                    "updated": "2009-12-04T23:16:33.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/36722",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "body": "Not in the usecase where slowBackend never gets cleaned and fastBackend does.\r\n\r\nI could disable auto_refresh_fast_cache and implement it myself _if_ ZF-8430 was applied.\r\nThe current behaviour simply doesn't use fastBackend anymore if the cache entry is only in slowBackend.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=nikosams",
                        "name": "nikosams",
                        "displayName": "Niko Sams",
                        "active": true
                    },
                    "created": "2009-12-04T23:51:13.000+0000",
                    "updated": "2009-12-04T23:51:13.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-8431\/transitions"
}