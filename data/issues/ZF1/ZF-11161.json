{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11161",
    "key": "ZF-11161",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "RegisterErrorHandle not work with Xml formatter"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11161\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10880",
                    "id": 10880,
                    "description": "Mini Release",
                    "name": "1.11.9",
                    "userReleaseDate": "14\/Jul\/11",
                    "archived": false,
                    "releaseDate": "2011-07-14",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-07-13T18:23:23.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fabioginzel",
                "name": "fabioginzel",
                "displayName": "Fabio Ginzel",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-03-10T19:20:10.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-07-13T18:23:42.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "If I call the Registererrorhandle Zend_Log with the xml formatter its not works and give error"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11161\/watchers",
                "isWatching": false,
                "watchCount": 5
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10540",
                    "id": 10540,
                    "description": "Mini Release",
                    "name": "1.11.4",
                    "userReleaseDate": "03\/Mar\/11",
                    "archived": false,
                    "releaseDate": "2011-03-03",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10017",
                    "id": 10017,
                    "name": "Zend_Log",
                    "description": "classic logging utility functions",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/45505",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=intiilapa",
                        "name": "intiilapa",
                        "displayName": "Beno\u00eet Durand",
                        "active": true
                    },
                    "body": "@Fabio, Can you provide a code to reproduce your problem?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=intiilapa",
                        "name": "intiilapa",
                        "displayName": "Beno\u00eet Durand",
                        "active": true
                    },
                    "created": "2011-03-13T14:36:18.000+0000",
                    "updated": "2011-03-13T14:36:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/45517",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fabioginzel",
                        "name": "fabioginzel",
                        "displayName": "Fabio Ginzel",
                        "active": true
                    },
                    "body": "Application.ini:\r\n\r\n\r\n{code:title=Application.ini|borderStyle=solid}\r\nresources.log.stream.writerName = Stream\r\nresources.log.stream.writerParams.stream = APPLICATION_PATH \"\/..\/data\/log\/errors.log\"\r\nresources.log.stream.formatterName = Xml\r\n{code} \r\n\r\n\r\n\r\n{code:title=Bootstrap.php|borderStyle=solid}\r\n\tprotected function _initLogger() {\r\n\t$this->bootstrap('log');\r\n\t$log = $this->getResource('log');\r\n\t$log->registerErrorHandler();\r\n\tif ($aa)\r\n\t\techo \"x\";\r\n\r\n\t}\r\n{code} \r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fabioginzel",
                        "name": "fabioginzel",
                        "displayName": "Fabio Ginzel",
                        "active": true
                    },
                    "created": "2011-03-15T19:45:28.000+0000",
                    "updated": "2011-03-15T19:45:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/45518",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fabioginzel",
                        "name": "fabioginzel",
                        "displayName": "Fabio Ginzel",
                        "active": true
                    },
                    "body": "error:\r\n\r\nFatal error: Uncaught exception 'DOMException' with message 'DOMElement::__construct() expects parameter 2 to be string, array given' in D:\\Sistemas\\sas\\sne_inscreve_evento\\library\\Zend\\Log\\Formatter\\Xml.php:152 Stack trace: #0 D:\\Sistemas\\sas\\sne_inscreve_evento\\library\\Zend\\Log\\Formatter\\Xml.php(152): DOMElement->__construct('context', Array) #1 D:\\Sistemas\\sas\\sne_inscreve_evento\\library\\Zend\\Log\\Writer\\Stream.php(131): Zend_Log_Formatter_Xml->format(Array) #2 D:\\Sistemas\\sas\\sne_inscreve_evento\\library\\Zend\\Log\\Writer\\Abstract.php(85): Zend_Log_Writer_Stream->_write(Array) #3 D:\\Sistemas\\sas\\sne_inscreve_evento\\library\\Zend\\Log.php(428): Zend_Log_Writer_Abstract->write(Array) #4 D:\\Sistemas\\sas\\sne_inscreve_evento\\library\\Zend\\Log.php(594): Zend_Log->log('Undefined varia...', 5, Array) #5 D:\\Sistemas\\sas\\sne_inscreve_evento\\application\\Bootstrap.php(10): Zend_Log->errorHandler(8, 'Undefined varia...', 'D:\\Sistemas\\sas...', 10, Array) #6 D:\\Sistemas\\sas\\sne_inscreve_evento\\library\\Zend\\Application\\Bootstrap\\BootstrapAb in D:\\Sistemas\\sas\\sne_inscreve_evento\\library\\Zend\\Log\\Formatter\\Xml.php on line 152",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fabioginzel",
                        "name": "fabioginzel",
                        "displayName": "Fabio Ginzel",
                        "active": true
                    },
                    "created": "2011-03-15T19:46:00.000+0000",
                    "updated": "2011-03-15T19:46:00.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46251",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "@Fabio\r\nI have been able to reproduce your issue.  I created a stock Zend Framework project using Zend_Tool:\r\n{code}\r\nzf create project test\r\ncd test\r\nzf create controller Test\r\nmkdir -p data\/logs\r\ntouch data\/logs\/application.log\r\nchmod 777 data\/logs\/application.log\r\n{code}\r\nThen applied the following changes to add logging to the application (following instructions here: http:\/\/framework.zend.com\/manual\/en\/zend.application.available-resources.html#zend.application.available-resources.log):\r\n{code}\r\ndiff --git a\/application\/Bootstrap.php b\/application\/Bootstrap.php\r\nindex 26169dd..6ea96e7 100644\r\n--- a\/application\/Bootstrap.php\r\n+++ b\/application\/Bootstrap.php\r\n@@ -3,5 +3,11 @@\r\n class Bootstrap extends Zend_Application_Bootstrap_Bootstrap\r\n {\r\n\r\n+    protected function _initLogger()\r\n+    {\r\n+        $this->bootstrap('log');\r\n+        $this->getResource('log')->registerErrorHandler();\r\n+    }\r\n+\r\n }\r\n\r\ndiff --git a\/application\/configs\/application.ini b\/application\/configs\/application.ini\r\nindex d388364..8274c51 100644\r\n--- a\/application\/configs\/application.ini\r\n+++ b\/application\/configs\/application.ini\r\n@@ -8,6 +8,11 @@ appnamespace = \"Application\"\r\n resources.frontController.controllerDirectory = APPLICATION_PATH \"\/controllers\"\r\n resources.frontController.params.displayExceptions = 0\r\n\r\n+resources.log.stream.writerName = \"Stream\"\r\n+resources.log.stream.writerParams.stream = APPLICATION_PATH \"\/..\/data\/logs\/application.log\"\r\n+resources.log.stream.writerParams.mode = \"a\"\r\n+resources.log.stream.formatterName = \"Xml\"\r\n+\r\n [staging : production]\r\n\r\n [testing : production]\r\ndiff --git a\/application\/controllers\/TestController.php b\/application\/controllers\/TestController.php\r\nindex c4758fb..2d75c8d 100644\r\n--- a\/application\/controllers\/TestController.php\r\n+++ b\/application\/controllers\/TestController.php\r\n@@ -11,6 +11,8 @@ class TestController extends Zend_Controller_Action\r\n     public function indexAction()\r\n     {\r\n         \/\/ action body\r\n+        if ( $nonExistentVariable )\r\n+            echo \"Oh dear!\";\r\n     }\r\n\r\n\r\n\r\n{code}\r\nWhen I open up my web browser and go to \/test I see the output of the error handler controller and the following entry in data\/logs\/application.log:\r\n{code}\r\n<logEntry><timestamp>2011-04-30T13:35:17-02:30<\/timestamp><message>Application error<\/message><priority>2<\/priority><priorityName>CRIT<\/priorityName><info>exception 'DOMException' with message 'DOMElement::__construct() expects parameter 2 to be string, array given' in \/usr\/local\/apache2\/htdocs\/lib\/ZendFramework-dev\/library\/Zend\/Log\/Formatter\/Xml.php:153\r\nStack trace:\r\n#0 \/usr\/local\/apache2\/htdocs\/lib\/ZendFramework-dev\/library\/Zend\/Log\/Formatter\/Xml.php(153): DOMElement-&gt;__construct('context', Array)\r\n#1 \/usr\/local\/apache2\/htdocs\/lib\/ZendFramework-dev\/library\/Zend\/Log\/Writer\/Stream.php(131): Zend_Log_Formatter_Xml-&gt;format(Array)\r\n#2 \/usr\/local\/apache2\/htdocs\/lib\/ZendFramework-dev\/library\/Zend\/Log\/Writer\/Abstract.php(85): Zend_Log_Writer_Stream-&gt;_write(Array)\r\n#3 \/usr\/local\/apache2\/htdocs\/lib\/ZendFramework-dev\/library\/Zend\/Log.php(428): Zend_Log_Writer_Abstract-&gt;write(Array)\r\n#4 \/usr\/local\/apache2\/htdocs\/lib\/ZendFramework-dev\/library\/Zend\/Log.php(594): Zend_Log-&gt;log('Undefined varia...', 5, Array)\r\n#5 \/usr\/local\/apache2\/htdocs\/test\/zf\/test\/application\/controllers\/TestController.php(15): Zend_Log-&gt;errorHandler(8, 'Undefined varia...', '\/usr\/local\/apac...', 15, Array)\r\n#6 \/usr\/local\/apache2\/htdocs\/lib\/ZendFramework-dev\/library\/Zend\/Controller\/Action.php(513): TestController-&gt;indexAction()\r\n#7 \/usr\/local\/apache2\/htdocs\/lib\/ZendFramework-dev\/library\/Zend\/Controller\/Dispatcher\/Standard.php(295): Zend_Controller_Action-&gt;dispatch('indexAction')\r\n#8 \/usr\/local\/apache2\/htdocs\/lib\/ZendFramework-dev\/library\/Zend\/Controller\/Front.php(954): Zend_Controller_Dispatcher_Standard-&gt;dispatch(Object(Zend_Controller_Request_Http), Object(Zend_Controller_Response_Http))\r\n#9 \/usr\/local\/apache2\/htdocs\/lib\/ZendFramework-dev\/library\/Zend\/Application\/Bootstrap\/Bootstrap.php(97): Zend_Controller_Front-&gt;dispatch()\r\n#10 \/usr\/local\/apache2\/htdocs\/lib\/ZendFramework-dev\/library\/Zend\/Application.php(366): Zend_Application_Bootstrap_Bootstrap-&gt;run()\r\n#11 \/usr\/local\/apache2\/htdocs\/test\/zf\/test\/public\/index.php(26): Zend_Application-&gt;run()\r\n#12 {main}<\/info><\/logEntry>\r\n\r\n<logEntry><timestamp>2011-04-30T13:35:17-02:30<\/timestamp><message>Request Parameters<\/message><priority>2<\/priority><priorityName>CRIT<\/priorityName><controller>test<\/controller><action>index<\/action><module>default<\/module><\/logEntry>\r\n{code}\r\n\r\nThen I patched Zend_Log_Formatter_Xml to cast the argument to DOMElement to string, like so:\r\n{code}\r\nIndex: library\/Zend\/Log\/Formatter\/Xml.php\r\n===================================================================\r\n--- library\/Zend\/Log\/Formatter\/Xml.php  (revision 23904)\r\n+++ library\/Zend\/Log\/Formatter\/Xml.php  (working copy)\r\n@@ -149,7 +149,7 @@\r\n             if($key == \"message\") {\r\n                 $value = htmlspecialchars($value, ENT_COMPAT, $enc);\r\n             }\r\n-            $elt->appendChild(new DOMElement($key, $value));\r\n+            $elt->appendChild(new DOMElement($key, (string)$value));\r\n         }\r\n\r\n         $xml = $dom->saveXML();\r\n{code}\r\nAnd everything now works as expected:  When visiting \/test in a web browser you see the proper view script, and the application.log file contains:\r\n{code}\r\n<logEntry><timestamp>2011-04-30T13:38:40-02:30<\/timestamp><message>Undefined variable: nonExistentVariable<\/message><priority>5<\/priority><priorityName>NOTICE<\/priorityName><errno>8<\/errno><file>\/usr\/local\/apache2\/htdocs\/test\/zf\/test\/application\/controllers\/TestController.php<\/file><line>15<\/line><context>Array<\/context><\/logEntry>\r\n{code}\r\n\r\nAll tests in Zend_Log test suite still pass after applying my fix.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-04-30T16:12:18.000+0000",
                    "updated": "2011-04-30T16:12:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46252",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Fixed in trunk r23905",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-04-30T16:22:43.000+0000",
                    "updated": "2011-04-30T16:22:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46319",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "body": "Hello, Adam. I will push [solve] button as proxy for You.\nIf You want to release at next mini, You can merge this commit fron trunk to 1.11 branch.\n\nThanks.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "created": "2011-05-03T10:27:11.000+0000",
                    "updated": "2011-05-03T10:27:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46345",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "body": "Fixed 1.11 branch at 23957",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                        "name": "satoruyoshida",
                        "displayName": "Satoru Yoshida",
                        "active": true
                    },
                    "created": "2011-05-03T15:01:31.000+0000",
                    "updated": "2011-05-03T15:01:31.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46362",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Reopened.\nBacked out r23905 from trunk in r23980\nBacked out r23957 from release branch 1.11 in r23981",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2011-05-03T19:02:06.000+0000",
                    "updated": "2011-05-03T19:02:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46384",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=intiilapa",
                        "name": "intiilapa",
                        "displayName": "Beno\u00eet Durand",
                        "active": true
                    },
                    "body": "{code}\r\n<context>Array<\/context>\r\n{code}\r\n\r\nI have a problem with the commit [r23905|http:\/\/framework.zend.com\/code\/revision.php?repname=Zend+Framework&rev=23905]. Yes, it solves the fatal error, but the behavior is wrong. A context with the error handler is always an array.\r\nI think the formatters, and writers can't support array for context. It's related to the problem of array in ZF-10427 for extra info when you use the simple formatter.\r\n\r\nI recommand to delete the optional parameter errcontext of the method Zend_Log::errorHandler().\r\n\r\n{code}\r\nPHP Notice:  Undefined variable: foo in \/tmp\/test.php on line 28\r\n{code}\r\n\r\n{code}\r\n<logEntry>\r\n  <timestamp>2011-05-04T19:17:55+02:00<\/timestamp>\r\n  <message>Undefined variable: foo<\/message>\r\n  <priority>5<\/priority>\r\n  <priorityName>NOTICE<\/priorityName>\r\n  <errno>8<\/errno>\r\n  <file>\/tmp\/test.php<\/file>\r\n  <line>28<\/line>\r\n<\/logEntry>\r\n{code}\r\n\r\nWhy do you need more info than standard display with the context? Just to remind you, the context contains *every variable* in the scope.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=intiilapa",
                        "name": "intiilapa",
                        "displayName": "Beno\u00eet Durand",
                        "active": true
                    },
                    "created": "2011-05-04T17:31:37.000+0000",
                    "updated": "2011-05-04T17:31:37.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46388",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Beno\u00eet,\r\n\r\nThanks for summarizing our IRC chat from yesterday....I hadn't had a chance to do that yet :P\r\n\r\nI completely agree. my patch was intended to prevent Zend_Log_Formatter_Xml::log from throwing a fatal error when non-string data was passed along to DOMElement.  What you've described above better treats the source of the problem rather than just the symptom.  Based on that, this is what I suggest\"\r\n{code}\r\nIndex: library\/Zend\/Log.php\r\n===================================================================\r\n--- library\/Zend\/Log.php        (revision 24002)\r\n+++ library\/Zend\/Log.php        (working copy)\r\n@@ -591,7 +591,7 @@\r\n             } else {\r\n                 $priority = Zend_Log::INFO;\r\n             }\r\n-            $this->log($errstr, $priority, array('errno'=>$errno, 'file'=>$errfile, 'line'=>$errline, 'context'=>$errcontext));\r\n+            $this->log($errstr, $priority, array('errno'=>$errno, 'file'=>$errfile, 'line'=>$errline));\r\n         }\r\n\r\n         if ($this->_origErrorHandler !== null) {\r\n{code}\r\n\r\nIn my opinion, this adequately treats the source of the problem (context data passed to the formatters, which can't handle it) while maintaining backwards compatibility (not changing the errorHandler() method signature and still passing $errcontext along to the original error handler (see Zend\/Log.php:598))\r\n\r\nDo you think this is an adequate solution?  Are there any existing formatters which might want access to 'context'?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-05-04T17:52:57.000+0000",
                    "updated": "2011-05-04T17:53:59.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46399",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "I've been thinking about this some more, and I think a better solution would be to modify the behavior of the existing formatters which are unable to handle the context attribute to ignore it:\r\n* Firebug: Already covered, as context isn't included in it's output\r\n* Simple:  Already covered, as context isn't included in it's output\r\n* Xml: Requires simple modification to ignore context:\r\n{code}\r\nIndex: library\/Zend\/Log\/Formatter\/Xml.php\r\n===================================================================\r\n--- library\/Zend\/Log\/Formatter\/Xml.php  (revision 24002)\r\n+++ library\/Zend\/Log\/Formatter\/Xml.php  (working copy)\r\n@@ -146,10 +146,11 @@\r\n         $elt = $dom->appendChild(new DOMElement($this->_rootElement));\r\n\r\n         foreach ($dataToInsert as $key => $value) {\r\n+            if($key == 'context') continue;\r\n             if($key == \"message\") {\r\n                 $value = htmlspecialchars($value, ENT_COMPAT, $enc);\r\n             }\r\n-            $elt->appendChild(new DOMElement($key, $value));\r\n+            $elt->appendChild(new DOMElement($key, (string)$value));\r\n         }\r\n{code}\r\nI chose to still cast $value to string, as that's what DOMElement constructor expects.\r\n\r\nThis solution solves the issue at hand, as well as still allowing future (or user-created) formatters to use the context element if they see fit. \r\n\r\nComments?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-05-04T22:49:10.000+0000",
                    "updated": "2011-05-04T22:49:53.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46480",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=intiilapa",
                        "name": "intiilapa",
                        "displayName": "Beno\u00eet Durand",
                        "active": true
                    },
                    "body": "People can already use the key *context* with Zend_Log::setEventItem() method. So, potential bc imao.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=intiilapa",
                        "name": "intiilapa",
                        "displayName": "Beno\u00eet Durand",
                        "active": true
                    },
                    "created": "2011-05-06T18:04:18.000+0000",
                    "updated": "2011-05-06T18:04:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46773",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Good point.  How about this as an alternate implementation?\r\n{code}\r\nIndex: library\/Zend\/Log\/Formatter\/Xml.php\r\n===================================================================\r\n--- library\/Zend\/Log\/Formatter\/Xml.php  (revision 24045)\r\n+++ library\/Zend\/Log\/Formatter\/Xml.php  (working copy)\r\n@@ -146,10 +146,12 @@\r\n         $elt = $dom->appendChild(new DOMElement($this->_rootElement));\r\n\r\n         foreach ($dataToInsert as $key => $value) {\r\n-            if($key == \"message\") {\r\n-                $value = htmlspecialchars($value, ENT_COMPAT, $enc);\r\n+            if(empty($value) || is_scalar($value)) {\r\n+                if($key == \"message\") {\r\n+                    $value = htmlspecialchars($value, ENT_COMPAT, $enc);\r\n+                }\r\n+                $elt->appendChild(new DOMElement($key, (string)$value));\r\n             }\r\n-            $elt->appendChild(new DOMElement($key, $value));\r\n         }\r\n\r\n         $xml = $dom->saveXML();\r\n{code}\r\nThis excludes an non-empty, non-scalar value from being included in the formatted output. ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-05-24T00:35:20.000+0000",
                    "updated": "2011-05-24T00:44:21.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46810",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=chl",
                        "name": "chl",
                        "displayName": "Chl",
                        "active": true
                    },
                    "body": "Hello,\r\n\r\nin my case, I quite needed some informations in the $value (which was a POST with a subform). Could we try this ?\r\n{code}\r\nIndex: library\/Zend\/Log\/Formatter\/Xml.php\r\n===================================================================\r\n--- library\/Zend\/Log\/Formatter\/Xml.php\t(revision 24046)\r\n+++ library\/Zend\/Log\/Formatter\/Xml.php\t(copie de travail)\r\n@@ -146,6 +146,9 @@\r\n         $elt = $dom->appendChild(new DOMElement($this->_rootElement));\r\n \r\n         foreach ($dataToInsert as $key => $value) {\r\n+            if ( ! is_scalar($value)) {\r\n+                $value = serialize($value);\r\n+            }\r\n             if($key == \"message\") {\r\n                 $value = htmlspecialchars($value, ENT_COMPAT, $enc);\r\n             }\r\n{code}\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=chl",
                        "name": "chl",
                        "displayName": "Chl",
                        "active": true
                    },
                    "created": "2011-05-26T19:14:02.000+0000",
                    "updated": "2011-05-26T19:14:02.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46872",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "@Chl:\r\n\r\nThat would assume the user of the log - be it a person or a parsing program - understands PHP serialization and can deserialize the value.  My perspective is that the built-in log formatters should be simple, with more complex formatting needs implemented by the application to fit it's own use case.  \r\n\r\nThe purpose of this issue, and the suggested fix, are only aimed at solving the issue at hand: usage of the XML formatter causes an exception to be raised.  Discussions regarding changes to what the formatter outputs should be undertaken in a dedicated issue, on IRC, or on the mailing list. ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-05-28T17:03:46.000+0000",
                    "updated": "2011-05-29T00:37:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46900",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Fixed in trunk r24079\r\nI've committed the patch suggested on 24\/May\/11 (exclude non-empty, non-scalar values from being included in the formatted output)\r\nHoping that 2nd time is the charm ;) ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-05-29T00:47:59.000+0000",
                    "updated": "2011-05-29T00:47:59.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46903",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=intiilapa",
                        "name": "intiilapa",
                        "displayName": "Beno\u00eet Durand",
                        "active": true
                    },
                    "body": "@Chl I agree with Adam.\r\n@Adam Why are you excluded the empty value? It sounds like a little BC.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=intiilapa",
                        "name": "intiilapa",
                        "displayName": "Beno\u00eet Durand",
                        "active": true
                    },
                    "created": "2011-05-29T14:36:04.000+0000",
                    "updated": "2011-05-29T14:36:04.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46904",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "@intiilapa. Sorry, my initial wording was clumsy.  The patch permits only empty and scalar values to be passed on to DOMElement.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-05-29T14:57:56.000+0000",
                    "updated": "2011-05-29T14:57:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47032",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Merged to release-1.11 in r24128",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2011-06-07T23:12:16.000+0000",
                    "updated": "2011-06-07T23:12:16.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47414",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=z3ndm@rt!n",
                        "name": "z3ndm@rt!n",
                        "displayName": "Martin",
                        "active": true
                    },
                    "body": "This fix breaks functionality as described in the [manual|http:\/\/framework.zend.com\/manual\/en\/zend.log.writers.html#zend.log.writers.firebug.preparing-data.exception]. When passing an exception to the log, the message is ignored.\r\n\r\nThe reason for this is the check on line 149 of Zend_Log_Formatter_Xml which uses [is_scalar()|http:\/\/www.php.net\/is_scalar] to check if the message has to be added to the log. An Exception object is not a scalar and is therefore ignored.\r\n\r\nPossible fix:\r\nreplace:\r\n{code}if(empty($value) || is_scalar($value)){code}\r\nwith:\r\n{code}if(empty($value) || is_scalar($value) || (is_object($value) && method_exists($value,'__toString'))){code}\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=z3ndm@rt!n",
                        "name": "z3ndm@rt!n",
                        "displayName": "Martin",
                        "active": true
                    },
                    "created": "2011-07-11T21:04:12.000+0000",
                    "updated": "2011-07-11T21:04:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47497",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Opening due to comment activity",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2011-07-13T18:22:37.000+0000",
                    "updated": "2011-07-13T18:22:37.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/47498",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Added test that uses serializable object in event, and \"applied\" patch from Martin for testing for objects with __toString prior to rendering.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2011-07-13T18:23:23.000+0000",
                    "updated": "2011-07-13T18:23:23.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-11161\/transitions"
}