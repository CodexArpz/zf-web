{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10911",
    "key": "ZF-10911",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Add automatic routing based on browser settings"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/4",
                "name": "Improvement",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10911\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10160",
                    "id": 10160,
                    "description": "Major Release",
                    "name": "Next Major Release",
                    "archived": false,
                    "released": false
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2011-08-26T19:58:18.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mehdi.rande",
                "name": "mehdi.rande",
                "displayName": "Mehdi Rande",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2011-01-05T00:29:49.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-08-26T19:58:18.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Automatical handling of languages as described [here|http:\/\/framework.zend.com\/manual\/1.11\/en\/zend.translate.additional.html#zend.translate.additional.languages.automatic] doesn't work. \r\nFirst because if the context option is a filename not as a directory, the scan option isn't even read, so the translation data will be added as the default local (de_AT).\r\nAnd also because auto local detection does not work when adding a translation via the constructor. "
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10911\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                "name": "thomas",
                "displayName": "Thomas Weidner",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10501",
                    "id": 10501,
                    "description": "Mini Release",
                    "name": "1.11.1",
                    "userReleaseDate": "30\/Nov\/10",
                    "archived": false,
                    "releaseDate": "2010-11-30",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10520",
                    "id": 10520,
                    "description": "Mini Release",
                    "name": "1.11.2",
                    "userReleaseDate": "30\/Dec\/10",
                    "archived": false,
                    "releaseDate": "2010-12-30",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10099",
                    "id": 10099,
                    "name": "Zend_Translate",
                    "description": "Provides translation functionality, based on standards such as TMX and Gettext.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43921",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mehdi.rande",
                        "name": "mehdi.rande",
                        "displayName": "Mehdi Rande",
                        "active": true
                    },
                    "body": "When taking a look a the Adapter code, the last instruction of the Adapter constructor is to set the local, if the current local is different of the $options['locale']. But this is always true if $options['locale'] is set to 'auto'. This patch should fix the bug :\r\n\r\n{code}\r\n\r\nIndex: Zend\/Translate\/Adapter.php\r\n===================================================================\r\n--- Zend\/Translate\/Adapter.php\t(revision 23619)\r\n+++ Zend\/Translate\/Adapter.php\t(working copy)\r\n@@ -176,7 +176,7 @@\r\n             $this->addTranslation($options);\r\n         }\r\n \r\n-        if ($this->getLocale() !== (string) $options['locale']) {\r\n+        if ($this->_automatic !== true && $this->getLocale() !== (string) $options['locale']) {\r\n             $this->setLocale($options['locale']);\r\n         }\r\n     }\r\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mehdi.rande",
                        "name": "mehdi.rande",
                        "displayName": "Mehdi Rande",
                        "active": true
                    },
                    "created": "2011-01-05T00:38:07.000+0000",
                    "updated": "2011-01-05T00:38:07.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43928",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "So you want to use directory options for a single filename. The 'scan' option defines how a directory structure is scanned. It will not be processed when a single file is given.\r\n\r\nThis patch will not be added. Actually your code breaks translation in 40% of the cases. Please give an example what you want to archive and what the actual results are.\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2011-01-05T05:52:42.000+0000",
                    "updated": "2011-01-05T05:52:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43935",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mehdi.rande",
                        "name": "mehdi.rande",
                        "displayName": "Mehdi Rande",
                        "active": true
                    },
                    "body": "Well in fact the part with the scan option not being used when a single file is given is just an error in the documentation, the real problem is that auto local detection does not work when adding a translation via the constructor.\r\nFor exemple :\r\nCreate a file \/tmp\/locales\/my_fr.php :\r\n{code}\r\n<?php\r\nreturn array('MESSAGE_ID' => 'MESSAGE FR');\r\n{code}\r\n\r\nThen let's take the documentation exemple :\r\n{code}\r\n\/\/ \r\n\/\/ Let's expect the browser returns these language settings:\r\n\/\/ HTTP_ACCEPT_LANGUAGE = \"en-US,en;q=0.8,fr;q=0.6\";\r\n\/\/ Example 2:\r\n\/\/ Best found fitting language is 'fr'\r\n$translate = new Zend_Translate(\r\n    array(\r\n        'adapter' => 'Array',\r\n        'content' => '\/tmp\/locales\/',\r\n        'locale'  => 'auto',\r\n        'scan' => Zend_Translate::LOCALE_FILENAME\r\n    )\r\n);\r\n\r\n$local = $translate->getLocale();\r\n$translation = $translate->translate('MESSAGE_ID');\r\nvar_dump($local, $translation);\r\n{code}\r\nExpected Result :\r\n{code}\r\nstring(2) 'fr'\r\nstring(10) 'MESSAGE FR'\r\n{code}\r\nActual Result :\r\n{code}\r\nNotice: The language 'en_US' has to be added before it can be used. in \/var\/www\/lib\/Zend\/Translate\/Adapter.php on line 429\r\n\r\nNotice: No translation for the language 'en' available. in \/var\/www\/lib\/Zend\/Translate\/Adapter.php on line 442\r\nstring(2) \"en\"\r\nstring(10) \"MESSAGE_ID\"\r\n{code}\r\n\r\nIn fact in Zend\/Translate\/Adapter.php the local is correctly setted to 'fr' at line 176 by $this->addTranslation($options); but it's overwritten at line 179. I don't think that the setLocale should be call when $options['locale'] == 'auto' and the local as been correctly detected. \r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mehdi.rande",
                        "name": "mehdi.rande",
                        "displayName": "Mehdi Rande",
                        "active": true
                    },
                    "created": "2011-01-05T09:15:35.000+0000",
                    "updated": "2011-01-05T09:15:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43936",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "With 'scan' you said that the directory \/tmp\/locales\/ should be searched and the language of found translation files can be found within the filename.\r\n\r\nSo \/tmp\/locales\/my_fr degrades to the language my and the language fr and will be added to both locales. Maybe not in older releases of CLDR as my has been added about 8 months ago.\r\n\r\nWith 'locale' you said that the language 'auto' should be used. 'auto' degrades to the users browser. When the user sets 'ar' within his browser Zend_Translate will use the language 'ar'.\r\n\r\nAs you don't have added a translation file for the language 'ar' (or in your case 'en_US') an NOTICE is given.\r\nNote that notices are no exceptions and also no errors.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2011-01-05T10:34:10.000+0000",
                    "updated": "2011-01-05T10:34:10.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/43938",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mehdi.rande",
                        "name": "mehdi.rande",
                        "displayName": "Mehdi Rande",
                        "active": true
                    },
                    "body": "Yes I understand all that, what I say it's that according to the documentation if the user sets 'en' and 'fr' in his browser (for exemple by setting his HTTP_ACCEPT_LANGUAGE to \"en-US,en;q=0.8,fr;q=0.6\"), Zend_Translate should use the best fitting language, so if there is no translation for 'en-US' or 'en', Zend_Translate should fall back on the 'fr' language if there is a translation available in 'fr'.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=mehdi.rande",
                        "name": "mehdi.rande",
                        "displayName": "Mehdi Rande",
                        "active": true
                    },
                    "created": "2011-01-05T12:52:12.000+0000",
                    "updated": "2011-01-05T12:52:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/48220",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "body": "Added in ZF2 with [GH-315|https:\/\/github.com\/zendframework\/zf2\/pull\/315]",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=thomas",
                        "name": "thomas",
                        "displayName": "Thomas Weidner",
                        "active": true
                    },
                    "created": "2011-08-26T19:58:18.000+0000",
                    "updated": "2011-08-26T19:58:18.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-10911\/transitions"
}