{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1325",
    "key": "ZF-1325",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "\"Unwritable session.save_path\" when using defaults in Zend_Session and php.ini"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1325\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10023",
                    "id": 10023,
                    "description": "Release Candidate 1",
                    "name": "1.0.0 RC1",
                    "userReleaseDate": "28\/May\/07",
                    "archived": true,
                    "releaseDate": "2007-05-28",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-05-09T14:37:13.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kritz",
                "name": "kritz",
                "displayName": "Chris van der Wel",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-04-28T15:35:47.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2008-05-08T14:29:39.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "{code}<?php\n\nset_include_path(get_include_path().PATH_SEPARATOR.'\/path\/to\/zend\/framework');\n\nrequire_once 'Zend\/Session.php';\nZend_Session::start();\n\n?>{code}\n\nproduces the following exception when session.save_path is not set in php.ini:\n\nUncaught exception 'Zend_Session_Exception' with message 'Unwritable session.save_path: ' in \/path\/to\/zend\/framework\/Zend\/Session.php:217\n\nAccording to the PHP manual (http:\/\/nl2.php.net\/manual\/nl\/ref.session.php#ini.session.save-path) session.save_path should default to \"\/tmp\", but Zend_Session still complains. The following code works, but the ini_set call shouldn't be necessary.\n\n{code}<?php\n\nset_include_path(get_include_path().PATH_SEPARATOR.'\/path\/to\/zend\/framework');\n\nrequire_once 'Zend\/Session.php';\nini_set('session.save_path','\/tmp');\nZend_Session::start();\n\n?>{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1325\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-3020",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3020",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                },
                {
                    "issueKey": "ZF-3226",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3226",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10070",
                    "id": 10070,
                    "description": "Beta Release; bug fixes",
                    "name": "0.9.2",
                    "userReleaseDate": "06\/Apr\/07",
                    "archived": true,
                    "releaseDate": "2007-04-06",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10096",
                    "id": 10096,
                    "name": "Zend_Session",
                    "description": "A standardized interface to common functionality found in or indigenous to site session implementations. ",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14391",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kritz",
                        "name": "kritz",
                        "displayName": "Chris van der Wel",
                        "active": true
                    },
                    "body": "added code blocks.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kritz",
                        "name": "kritz",
                        "displayName": "Chris van der Wel",
                        "active": true
                    },
                    "created": "2007-04-28T15:36:38.000+0000",
                    "updated": "2007-04-28T15:36:38.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14402",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Looking at the code, I see in Zend\/Session.php at the end of the {{setOptions()}} method:\n\n{code}\n        $savePath = ini_get('session.save_path');\n        if (strpos($savePath, ';') !== false) {\n            $savePath = explode(';', $savePath);\n            $savePath = realpath(array_pop($savePath));\n        }\n        if (self::$_ignore_save_path !== true && !is_writable($savePath)) {\n            throw new Zend_Session_Exception(\"Unwritable session.save_path: $savePath\");\n        }\n{code}\n\nBut when I look at the [PHP manual entry|http:\/\/www.php.net\/manual\/en\/ref.session.php] I see:\n\nbq. session.save_path defines the argument which is passed to the save handler. If you choose the default files handler, this is the path where the files are created. Defaults to \/tmp. See also session_save_path().\nbq. There is an optional N argument to this directive that determines the number of directory levels your session files will be spread around in. For example, setting to '5;\/tmp' may end up creating a session file and location like \/tmp\/4\/b\/1\/e\/3\/sess_4b1e384ad74619bd212e236e52a5a174If . In order to use N you must create all of these directories before use. A small shell script exists in ext\/session to do this, it's called mod_files.sh. Also note that if N is used and greater than 0 then automatic garbage collection will not be performed, see a copy of php.ini for further information. Also, if you use N, be sure to surround session.save_path in \"quotes\" because the separator \\(\\;\\) is also used for comments in php.ini.\n\nIf we consider it a good design decision that Zend_Session throws an Exception if the session path is not writable, then it must also check all of the child directories of the session.save_path when using the optional N argument. I think that this is not a good option, however, and I tend to question the sensibility of throwing an Exception at this point in the code for the purpose of verifying the session.save_path.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-04-30T16:00:12.000+0000",
                    "updated": "2007-04-30T16:00:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14403",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Volley to [~ralph] for additional comment.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-04-30T16:01:26.000+0000",
                    "updated": "2007-04-30T16:01:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14526",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "Ok, after reading through the ext\/session C, I know whats going on and why its going on.  session_start(), regardless of whether or not it actually does start or not, will set its internal state to active. Which means, session_write_close (effectively) will run at RSHUTDOWN, thus changing the state of ext\/session.\n\nAlso, the following code has the added benefit of being able to throw exceptions on ANY mod_handler ext\/session decides to use, be it mm, files, db, or memcached.  The idea as always, is that session_start should emit nothing from PHP and should start clean, otherwise, we should throw an exception as developers might want to be able to handle it at bootstrap time.\n\n{code}\nwebdeveloper@webdevelopment ~ $ cat testerror.php\n<?\n\nini_set('session.save_path', '\/var\/log');\n\nclass Zend_Session\n{\n  public function start()\n  {\n    set_error_handler(array('Zend_Session_Exception', 'handleSessionStartError'), E_ALL);\n    session_start();\n    restore_error_handler();\n    if (Zend_Session_Exception::$sessionStartError !== null) {\n       set_error_handler(array('Zend_Session_Exception', 'handleSilentWriteClose'), E_ALL);\n       session_write_close();\n       restore_error_handler();\n       throw new Zend_Session_Exception(Zend_Session_Exception::$sessionStartError);\n    }\n\n  }\n}\n\nclass Zend_Session_Exception extends Exception\n{\n  static public $sessionStartError = null;\n\n  static public function handleSessionStartError($errno, $errstr)\n  {\n    self::$sessionStartError = $errstr;\n  }\n\n  static public function handleSilentWriteClose($errno, $errstr)\n  { }\n\n}\n\n\n\/\/ this wouldbe bootstrap file\ntry\n{\n  Zend_Session::start();\n} catch (Exception $e) {\n  print_r('setup error: ' . $e->getMessage() . \"\\n\");\n}\n\necho \"End of program\n\n\";\nwebdeveloper@webdevelopment ~ $ php testerror.php\nsetup error: session_start(): open(\/var\/log\/sess_9bae147b205508d3dab70023eab739eb, O_RDWR) failed: Permission denied (13)\nEnd of program\n{code}\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2007-05-08T11:26:07.000+0000",
                    "updated": "2007-05-08T11:26:07.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14527",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "ABOVE IS PROOF-OF-CONCEPT ONLY, see the fixes in the code\n\nFisheye tab above or:\n\n[SVN r4763|http:\/\/framework.zend.com\/fisheye\/changelog\/Zend_Framework?cs=4763]",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2007-05-08T12:28:14.000+0000",
                    "updated": "2007-05-08T12:28:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/14536",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "body": "Confirmed as fixed. Thanks to [~ralph]!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=darby",
                        "name": "darby",
                        "displayName": "Darby Felton",
                        "active": true
                    },
                    "created": "2007-05-09T14:37:13.000+0000",
                    "updated": "2007-05-09T14:37:13.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1325\/transitions"
}