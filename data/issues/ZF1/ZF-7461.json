{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7461",
    "key": "ZF-7461",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Application_Resource_Navigation stores container into Registry with numeric key"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7461\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-09-21T17:08:31.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=st.general",
                "name": "st.general",
                "displayName": "Dmitry Babenko",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-08-04T01:17:49.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2010-04-08T11:43:22.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "application.ini:\n{{resources.navigation.storage.registry = 1}}\n\nbut\n\n{code:title=Zend_Application_Resource_Navigation}\n    protected function _storeRegistry()\n    {\n        $options = $this->getOptions();\n        if(isset($options['storage']) &&\n           isset($options['storage']['registry']) &&\n           isset($options['storage']['registry']['key'])) \/\/ strange, but it is === true\n        {\n...\n{code}\n\nPHP Version 5.2.6\n\nSimple solution is to append one more condition (as it was in 1.8.4):\n{{&& !is_numeric($options['storage']['registry']['key'])}} \n\nAlso, conditions\n{{isset($options['storage']) && isset($options['storage']['registry'])}}\nseems to be redundant"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7461\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                "name": "freak",
                "displayName": "Dolf Schimmel (Freeaqingme)",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10320",
                    "id": 10320,
                    "description": "Minor Release",
                    "name": "1.9.0",
                    "userReleaseDate": "31\/Jul\/09",
                    "archived": false,
                    "releaseDate": "2009-07-31",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10390",
                    "id": 10390,
                    "name": "Zend_Application",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33197",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "Oops, guess that's my bad here. I couldn't think what the is_numeric call was meant for, guess I know again now :)\n\nAnd you're right about the isset issue. I thought not doing it like this would trigger an error if $options['storage'] was not set, but I turn out to be wrong there.\n\nWill fix asap.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-08-04T22:40:52.000+0000",
                    "updated": "2009-08-04T22:40:52.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33791",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hobodave",
                        "name": "hobodave",
                        "displayName": "David Abdemoulaie",
                        "active": true
                    },
                    "body": "I cannot duplicate this on PHP 5.2.5, 5.2.6, 5.2.10, or 5.3.\n\nAre you sure you have the right line in your application.ini ?\n\nWith the following line in application.ini:\n\n{noformat}\nresources.navigation.storage.registry = 1\n{noformat}\n\nThe resulting $options array looks like:\n\n{noformat}\narray(1) {\n  [\"storage\"]=>\n  array(1) {\n    [\"registry\"]=>\n    int(1)\n  }\n}\n{noformat}\n\nThe following test confirms this:\n\n{noformat}\n<?php\nerror_reporting(E_ALL);\n \n$options['storage']['registry'] = 1;\n \nif (isset($options['storage']) &&\n    isset($options['storage']['registry']) &&\n    isset($options['storage']['registry']['key']))\n{\n    echo \"WTF\";\n}\n{noformat}\n\n\nHowever, the multiple isset()'s are redundant and can be simplified to:\n\n{noformat}\nif (isset($options['storage']['registry']['key']) \n{noformat}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hobodave",
                        "name": "hobodave",
                        "displayName": "David Abdemoulaie",
                        "active": true
                    },
                    "created": "2009-08-22T12:36:19.000+0000",
                    "updated": "2009-08-22T12:36:19.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33885",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=st.general",
                        "name": "st.general",
                        "displayName": "Dmitry Babenko",
                        "active": true
                    },
                    "body": "Indeed, test is passed but only if value is not string.\nRun the test when \n{code}$options['storage']['registry'] = '1';{code}\n{code}array\n  'storage' => \n    array\n      'registry' => string '1' (length=1){code}\n\n\nAnd it is string when it comes from the application.ini",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=st.general",
                        "name": "st.general",
                        "displayName": "Dmitry Babenko",
                        "active": true
                    },
                    "created": "2009-08-25T03:43:12.000+0000",
                    "updated": "2009-08-25T03:43:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33900",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hobodave",
                        "name": "hobodave",
                        "displayName": "David Abdemoulaie",
                        "active": true
                    },
                    "body": "Well, this is bizarre. Reproduced using the string '1'.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=hobodave",
                        "name": "hobodave",
                        "displayName": "David Abdemoulaie",
                        "active": true
                    },
                    "created": "2009-08-25T09:44:09.000+0000",
                    "updated": "2009-08-25T09:44:09.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/33936",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=st.general",
                        "name": "st.general",
                        "displayName": "Dmitry Babenko",
                        "active": true
                    },
                    "body": "Yes, but it has an explanation. It happens because of string access by character. And when you try to get symbol by string index that index is converted to integer.\n{code}\n$options['storage']['registry'] = '1';\n$options['storage']['registry']['key']; \/\/ is equal to $options['storage']['registry'][(int)'key'] and $options['storage']['registry'][0]\n{code}\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=st.general",
                        "name": "st.general",
                        "displayName": "Dmitry Babenko",
                        "active": true
                    },
                    "created": "2009-08-26T02:47:14.000+0000",
                    "updated": "2009-08-26T02:47:14.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34788",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jgornick",
                        "name": "jgornick",
                        "displayName": "Joe Gornick",
                        "active": true
                    },
                    "body": "I've also run into this issue where if your specify the {{resources.navigation.storage.registry = true}} option, the code currently set's the key to the {{true}} (1) value.\n\nHowever, there seems to be a semantic problem with the configuration and the code which reads the options.\n\nTake the existing configuration options right now:\n{code:title=application.ini}\nresources.navigation.storage.registry = true\nresources.navigation.storage.registry.key = \"My_New_Key\"\n{code}\n\nYou can not add the {{key}} property to {{registry}} because the {{registry}} property was already set to the value {{true}}.\n\nWhen you do set the {{key}} property to {{registry}}, you get this exception:\n{{Zend_Config_Exception: Cannot create sub-key for 'registry' as key already exists...}}\n\nI propose:\n{code:title=application.ini}\nresources.navigation.storage.registry.enabled = true\nresources.navigation.storage.registry.key = \"My_New_Key\"\n{code}\n\nKeep in mind, that if the user does not specify either option, then it the navigation resource automatically defaults to the storing the view helper.  Also, if the user does specify the {{registry.enabled}} option but not the {{registry.key}} option, then the default registry key is used (Zend_Navigation).\n\nThen, in the source you would have something like:\n{code:title=Zend\/Application\/Resource\/Navigation.php}\n<?php\n  ...\n    public function store()\n    {\n        $options = $this->getOptions();\n        if (isset($options['storage']['registry']['enabled']) &&\n            $options['storage']['registry']['enabled'] == true) {\n            $this->_storeRegistry();\n        } else {\n            $this->_storeHelper();\n        }\n    }\n    \n    protected function _storeRegistry()\n    {\n        $options = $this->getOptions();\n        if(isset($options['storage']['registry']['key']) &&\n           is_string($options['storage']['registry']['key']))\n        {\n            $key = $options['storage']['registry']['key'];\n        } else {\n            $key = self::DEFAULT_REGISTRY_KEY;\n        }\n    \n        Zend_Registry::set($key, $this->getContainer());\n    }\n  ...\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jgornick",
                        "name": "jgornick",
                        "displayName": "Joe Gornick",
                        "active": true
                    },
                    "created": "2009-09-21T15:34:40.000+0000",
                    "updated": "2009-09-21T15:34:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34789",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "First, with your patch BC would be broken, so that's not the most preferable solution.\n\nSecondly, it all kinda works already. When specifying a registry key the storing of the container will automatically be done inside the registry. The reasoning behind this is that it makes no sense to set a registry key while storing it in the view helper ;)\n\nPlease note that {code}var_dump(array('foo' => 'bar') == true);{code} will output: \nbool(true)\n\n(if no response is given within 24 hours this issue will be closed) ",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-09-21T15:46:26.000+0000",
                    "updated": "2009-09-21T15:46:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34790",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jgornick",
                        "name": "jgornick",
                        "displayName": "Joe Gornick",
                        "active": true
                    },
                    "body": "Dolf, thanks for the quick response.\n\nGood point about the backwards-compatibility issue.\n\nPersonally, I think the default behavior of the navigation resource should store it to the registry since the navigation view helper already checks the registry for Zend_Navigation if the container has not been set.\n\nAnother reason why I think it should be stored in the registry by default is so I can gain access to the navigation container in a plugin or action helper.  I do realize I could get it through the view helper, but I feel accessing it in the registry would be the most efficient.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jgornick",
                        "name": "jgornick",
                        "displayName": "Joe Gornick",
                        "active": true
                    },
                    "created": "2009-09-21T15:57:26.000+0000",
                    "updated": "2009-09-21T15:57:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34791",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "body": "Somehow I was managed to get persuaded that this was actually a bug on irc (the reason me not fixing it before was that s\/o forgot to assign it :wink:).  Should be fixed now, will get shipped with 1.9.4 (if I dont forget to merge it).\n\nThe test - see commit message - failed :'(",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=freak",
                        "name": "freak",
                        "displayName": "Dolf Schimmel (Freeaqingme)",
                        "active": true
                    },
                    "created": "2009-09-21T17:08:26.000+0000",
                    "updated": "2009-09-21T17:09:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/39898",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aredamkrik",
                        "name": "aredamkrik",
                        "displayName": "Kirk Madera",
                        "active": true
                    },
                    "body": "This line caused me a lot of confusion:\r\n{code}\r\n$options['storage']['registry'] == true\r\n{code}\r\n\r\nI thought registry was intended to be boolean. I agree with the fix to:\r\n{code}\r\n$options['storage']['registry']['enabled'] == true\r\n{code}\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=aredamkrik",
                        "name": "aredamkrik",
                        "displayName": "Kirk Madera",
                        "active": true
                    },
                    "created": "2010-04-08T11:43:18.000+0000",
                    "updated": "2010-04-08T11:43:18.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-7461\/transitions"
}