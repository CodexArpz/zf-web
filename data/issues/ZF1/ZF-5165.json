{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5165",
    "key": "ZF-5165",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "joinUsing() does not join from the last joined table but instead takes the table used in from()"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5165\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/3",
                "name": "Duplicate"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2009-05-17T07:37:23.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coling",
                "name": "coling",
                "displayName": "Colin Guthrie",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-12-05T07:50:16.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-08-20T15:08:25.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "While looking in to ZF-3309, I noticed that the code does not actually work in the normal flow joining.\r\n\r\nRather than working with the last joined table (as per the SQL USING() clause), it always uses the table used in the from() clause.\r\n\r\nThis is pretty bizarre as I though the syntax was designed to work in a similar way to the USING() SQL clause... perhaps this is an invalid assumption?\r\n\r\nAnyway here is some example code:\r\n{code}\r\n<?php\r\n\r\n\/*\r\n Create the tables:\r\n\r\necho \"\r\n create table foo(foo_id int(10) unsigned auto_increment primary key);\r\n create table bar(bar_id int(10) unsigned auto_increment primary key, foo_id int(10) unsigned);\r\n create table oink(oink_id int(10) unsigned auto_increment primary key, bar_id int(10) unsigned);\r\n\" | mysql -u root test\r\n\r\n*\/\r\n\r\nini_set('include_path', '\/path\/to\/ZendFramewor\/library\/');\r\n\r\nrequire_once('Zend\/Loader.php');\r\nZend_Loader::registerAutoload();\r\n\r\n$params = array(\r\n  'host' => 'localhost',\r\n  'username' => 'root',\r\n  'password' => '',\r\n  'dbname' => 'test',\r\n);\r\n\r\n$db = Zend_Db::factory('Pdo_Mysql', $params);\r\n\r\n$select =\r\n  $db\r\n  ->select()\r\n  ->from(array('a' => 'foo'), array('foo_id'))\r\n  ->joinUsing(array('b' => 'bar'), 'foo_id', array('bar_id'))\r\n  ->joinUsing(array('c' => 'oink'), 'bar_id', array('oink_id'));\r\n\r\necho (string)$select;\r\necho \"\\n\";\r\n\r\ntry\r\n{\r\n  $db->fetchAll($select);\r\n}\r\ncatch (Exception $e)\r\n{\r\n  echo 'Exception: '.$e->getMessage().\"\\n\";\r\n}\r\n{code}\r\n\r\nIf you run this (and ZF-3309 is fixed - see my patch there which may fix it sufficiently) you will get the following output:\r\n{noformat}\r\n[colin@jimmy zend]$ php bug.php\r\nSELECT `a`.`foo_id`, `b`.`bar_id`, `c`.`oink_id` FROM `foo` AS `a`\r\n INNER JOIN `bar` AS `b` ON `b`.foo_id = `a`.foo_id\r\n INNER JOIN `oink` AS `c` ON `c`.bar_id = `a`.bar_id\r\nException: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'a.bar_id' in 'on clause'\r\n{noformat}\r\n\r\nNow you can see that both joins refer back to the initial table. When joining on oink, I'd have expected that it would join bar to oink, not foo to oink.\r\n\r\nChanging this would obviously break anything implemented with the current behaviour... The docs do not explain this (as the examples only show joining on one table) so if this is the intended behaviour I think it would be wise to put up a big warning in the documentation."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5165\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=satoruyoshida",
                "name": "satoruyoshida",
                "displayName": "Satoru Yoshida",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF-3792",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-3792",
                    "type": {
                        "name": "Duplicate",
                        "direction": "OUTBOUND",
                        "description": "duplicates"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10270",
                    "id": 10270,
                    "description": "Mini Release",
                    "name": "1.7.1",
                    "userReleaseDate": "01\/Dec\/08",
                    "archived": false,
                    "releaseDate": "2008-12-01",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10132",
                    "id": 10132,
                    "name": "Zend_Db_Select",
                    "description": "OO interface to building a SELECT SQL query.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/27079",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coling",
                        "name": "coling",
                        "displayName": "Colin Guthrie",
                        "active": true
                    },
                    "body": "Actually the \"fix\" for this is actually very simple.\n\nIt seems that adding an element to an array does not advance the array pointer (certianly not in my version of PHP - the hot of the press 5.2.7)\n\nIn _joinUsing of Zend_Db_Select simply changing:\n{code}\n        $join  = $this->_adapter->quoteIdentifier(key($this->_parts[self::FROM]), true);\n{code}\n\nto\n{code}\n        end($this->_parts[self::FROM]);\n        $join  = $this->_adapter->quoteIdentifier(key($this->_parts[self::FROM]), true);\n{code}\n\nseems to address things nicely in my case.\n\nThis does however leave the array pointer of $this->_parts[self::FROM] in a different possition and I've not looked to see if this is a problem.\n\nThe above quoted query does however work as as indended and there is no exception thrown.\n\nIf someone can comment on what the intended behaviour is, I can look at testing more thoroughly if appropriate.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=coling",
                        "name": "coling",
                        "displayName": "Colin Guthrie",
                        "active": true
                    },
                    "created": "2008-12-05T09:12:40.000+0000",
                    "updated": "2008-12-05T09:12:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/27080",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Duplicate of ZF-3792, which I reported 2008-07-29.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2008-12-05T09:16:52.000+0000",
                    "updated": "2008-12-05T09:16:52.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5165\/transitions"
}