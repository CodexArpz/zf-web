{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5642",
    "key": "ZF-5642",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Form_Decorator_Errors passes invalid $errors array to formErrors when form has _elementsBelongTo set and is more than one level deep"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5642\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/2",
                "name": "Won't Fix"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-11-20T20:52:41.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamenglander",
                "name": "adamenglander",
                "displayName": "Adam Englander",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2009-01-27T09:52:43.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-11-20T21:09:31.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When a sub-form has _elementsBelongTo set and utilizes the \"Errors\" decorator, it will throw warnings when attempting to render the errors.  This is based on the following occurring:\n\nZend_Form_Decorator_Errors::render() calls the getMessages() on form.\n\nWhen there are no  messages for Zend_Form::getMessages() to process, it falls through to the last case which calls the Zend_Form::_attachToArray() function attempts to put the $messages value on to the end of an array based on Zend_Form::getElementsBelongTo() function.  As we have explicitly set that value, Zend_Form::getMessages() returns an array representation of the Zend_Form::getElementsBelongTo() value.\n\nZend_Form_Decorator_Errors::render() then passes the array returned by Zend_Form::getMessages() to Zend_View::__call() by calling formErrors() on the view object.\n\nZend_View::__call() then calls Zend_View_Helper_FormErrors::formErrors() passing the array returned by Zend_Form::getMessages().\n\nIf the \"escape\" parameter for the helper is not set to false and the array passed to Zend_View_Helper_FormErrors::formErrors() is more than one level deep, a warning is generated when it attempts to escape the array returned in the foreach statement.\n\nWhen attempting to render the array passed in as the message, the implode statement will also generate a warning as the second level of the $errors array is an array that it implode is attempting to concatenate.\n\nI have verified that this issue occurs in all release tags from 1.6.1 and newer."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5642\/watchers",
                "isWatching": false,
                "watchCount": 5
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/6",
                "name": "Closed"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User"
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10201",
                    "id": 10201,
                    "description": "Mini Release",
                    "name": "1.6.1",
                    "userReleaseDate": "15\/Sep\/08",
                    "archived": false,
                    "releaseDate": "2008-09-15",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10251",
                    "id": 10251,
                    "description": "Mini Release",
                    "name": "1.6.2",
                    "userReleaseDate": "13\/Oct\/08",
                    "archived": false,
                    "releaseDate": "2008-10-13",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10260",
                    "id": 10260,
                    "description": "Minor Release",
                    "name": "1.7.0",
                    "userReleaseDate": "17\/Nov\/08",
                    "archived": false,
                    "releaseDate": "2008-11-17",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10270",
                    "id": 10270,
                    "description": "Mini Release",
                    "name": "1.7.1",
                    "userReleaseDate": "01\/Dec\/08",
                    "archived": false,
                    "releaseDate": "2008-12-01",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10271",
                    "id": 10271,
                    "description": "Mini Release",
                    "name": "1.7.2",
                    "userReleaseDate": "23\/Dec\/08",
                    "archived": false,
                    "releaseDate": "2008-12-23",
                    "released": true
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10250",
                    "id": 10250,
                    "description": "Mini Release",
                    "name": "1.7.3",
                    "userReleaseDate": "19\/Jan\/09",
                    "archived": false,
                    "releaseDate": "2009-01-19",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10029",
                    "id": 10029,
                    "name": "Zend_Form",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31979",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=11oo10",
                        "name": "11oo10",
                        "displayName": "Neil Delargy",
                        "active": true
                    },
                    "body": "Does this cause an error on line 78 of the FormErrors View Helper (foreach loop expects array)?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=11oo10",
                        "name": "11oo10",
                        "displayName": "Neil Delargy",
                        "active": true
                    },
                    "created": "2009-06-19T03:08:58.000+0000",
                    "updated": "2009-06-19T03:08:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/31988",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamenglander",
                        "name": "adamenglander",
                        "displayName": "Adam Englander",
                        "active": true
                    },
                    "body": "Actually it occurs from line 75 of FormErrors.  I have attached the stack return by Xdebug for the warning:\n\nCall Stack\n#\tTime\tMemory\tFunction\tLocation\n1\t0.0002\t73396\t{main}( )\t..\/index.php:0\n2\t0.0942\t5435712\tZend_Controller_Front->dispatch( )\t..\/index.php:42\n3\t0.1014\t5914980\tZend_Controller_Dispatcher_Standard->dispatch( )\t..\/Front.php:946\n4\t0.1122\t6659440\tZend_Controller_Action->dispatch( )\t..\/Standard.php:293\n5\t0.1574\t7067144\tZend_Controller_Action_HelperBroker->notifyPostDispatch( )\t..\/Action.php:512\n6\t0.1575\t7067144\tZend_Controller_Action_Helper_ViewRenderer->postDispatch( )\t..\/HelperBroker.php:171\n7\t0.1575\t7067144\tZend_Controller_Action_Helper_ViewRenderer->render( )\t..\/ViewRenderer.php:981\n8\t0.1582\t7067620\tZend_Controller_Action_Helper_ViewRenderer->renderScript( )\t..\/ViewRenderer.php:942\n9\t0.1582\t7067620\tZend_View_Abstract->render( )\t..\/ViewRenderer.php:921\n10\t0.1582\t7108888\tZend_View->_run( )\t..\/Abstract.php:787\n11\t0.1583\t7110196\tinclude( '\/virtualhosts\/bbxadmin\/application\/default\/views\/scripts\/rule\/form.ajax.phtml' )\t..\/View.php:107\n12\t0.1583\t7110196\tZend_Form->__toString( )\t..\/Form.php:0\n13\t0.1583\t7110196\tZend_Form->render( )\t..\/Form.php:2611\n14\t0.1930\t7259720\tZend_Form_Decorator_Errors->render( )\t..\/Form.php:2596\n15\t0.1932\t7259720\tZend_View->formErrors( )\t..\/Errors.php:60\n16\t0.1932\t7259720\tZend_View_Abstract->__call( )\t..\/Abstract.php:0\n17\t0.1940\t7277072\tcall_user_func_array ( )\t..\/Abstract.php:318\n18\t0.1940\t7277072\tZend_View_Helper_FormErrors->formErrors( )\t..\/Abstract.php:0\n19\t0.1940\t7277388\tZend_View_Abstract->escape( )\t..\/FormErrors.php:75\n20\t0.1940\t7277388\tcall_user_func ( )\t..\/Abstract.php:804",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamenglander",
                        "name": "adamenglander",
                        "displayName": "Adam Englander",
                        "active": true
                    },
                    "created": "2009-06-19T09:09:43.000+0000",
                    "updated": "2009-06-19T09:09:43.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/34638",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=joust",
                        "name": "joust",
                        "displayName": "Artur Bodera",
                        "active": true
                    },
                    "body": "It's still here in *1.9.2* !\n\nCode to reproduce:\n\n{code}\n$form = new Zend_Form():\n$form->addElement($form->createElement('text','foo'));\n$form->setIsArray(true);\n$form->setElementsBelongTo('arraykey');\n$form->addDecorator('Errors');\n$form->render();\n{code}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=joust",
                        "name": "joust",
                        "displayName": "Artur Bodera",
                        "active": true
                    },
                    "created": "2009-09-18T08:11:20.000+0000",
                    "updated": "2009-09-18T08:11:20.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/35838",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=noopable",
                        "name": "noopable",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "body": "This reproduce in Zend_Form_SubForm too.\r\nrepro:\r\n{code}\r\n$subForm = new Zend_Form_SubForm;\r\n$subForm->setView(new Zend_View);\r\n$subForm->clearDecorators();\r\n$subForm->addDecorator('Errors');\r\necho $subForm;\r\n{code}\r\nIt causes\r\n{code}\r\nWarning: htmlspecialchars() expects parameter 1 to be string,\r\n array given in Zend\\View\\Abstract.php on line 850\r\n{code}\r\n\r\nThis can be solved with $errors to be flattened. Or View_Helper_FormErrors should be accept hierarchical errors.\r\nThis is sample of flat.\r\n{code}\r\nIndex: Form\/Decorator\/Errors.php\r\n===================================================================\r\n--- Form\/Decorator\/Errors.php\t(revision 18722)\r\n+++ Form\/Decorator\/Errors.php\t(working copy)\r\n@@ -57,6 +57,19 @@\r\n \r\n         $separator = $this->getSeparator();\r\n         $placement = $this->getPlacement();\r\n+\r\n+        \/\/ ZF-5642\r\n+        $iterator = new RecursiveIteratorIterator(new RecursiveArrayIterator($errors));\r\n+        foreach ($iterator as $key => $error) {\r\n+            $flat[$key] = $error;\r\n+        }\r\n+        if (!isset($flat)) {\r\n+            return $content;\r\n+        }\r\n+        else {\r\n+            $errors = $flat;\r\n+        }\r\n+\r\n         $errors    = $view->formErrors($errors, $this->getOptions());\r\n \r\n         switch ($placement) {\r\n\r\n{code}\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=noopable",
                        "name": "noopable",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "created": "2009-11-07T01:43:40.000+0000",
                    "updated": "2009-11-07T01:43:40.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52405",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "body": "Bulk change of all issues last updated before 1st January 2010 as \"Won't Fix\".\r\n\r\nFeel free to re-open and provide a patch if you want to fix this issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=rob",
                        "name": "rob",
                        "displayName": "Rob Allen",
                        "active": true
                    },
                    "created": "2012-11-20T20:52:41.000+0000",
                    "updated": "2012-11-20T20:52:41.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/52900",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamenglander",
                        "name": "adamenglander",
                        "displayName": "Adam Englander",
                        "active": true
                    },
                    "body": "And this is why we don;t use Zend Framework anymore.  It took you nearly 4 years to tell me go F myself!",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamenglander",
                        "name": "adamenglander",
                        "displayName": "Adam Englander",
                        "active": true
                    },
                    "created": "2012-11-20T21:09:31.000+0000",
                    "updated": "2012-11-20T21:09:31.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-5642\/transitions"
}