{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4951",
    "key": "ZF-4951",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "CLONE -Can't execute multiple stored procedures with Pdo_Mysql"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField",
            "value": {
                "timeoriginalestimate": 7200,
                "timeestimate": 7200
            }
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4951\/votes",
                "votes": 5,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=robscheibel",
                "name": "robscheibel",
                "displayName": "Rob Scheibel",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2008-11-14T09:26:00.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2011-06-04T21:00:33.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "This bug is not fixed yet. Details: ZF v1.6.2, PHP v5.1.6, Mysql V5.0.45.\n\nIrregardless of how PDO:MYSQL_ATTR_USE_BUFFERED_QUERY is set, or using fetchAll() if you run two store procedures you get the same error:\n\nSQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active. Consider using PDOStatement::fetchAll(). Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.\n\nExample code:\n                $registry = Zend_Registry::getInstance();\n                $tempdata = array();\n                                $stmt = $registry->dbAdapter->query(\"CALL mgmtcomm_yearlybarchart('2008-01-01','2008-10-01')\");\n                                \/\/ Store results in array\n                                $rows = $stmt->fetchAll();\n                                foreach($rows as $row) {\n                                        $tempdata[] = number_format($row['data'],2);\n                                        $numrows++;\n                                }\n                                \/\/ Free DB Query resources\n                      $stmt->closeCursor();\n                        print_r($tempdata);\n                                $stmt = $registry->dbAdapter->query(\"CALL mgmtcomm_yearlybarchart('2008-01-01','2008-10-01')\");\n                                \/\/ Store results in array\n                                $rows = $stmt->fetchAll();\n                                foreach($rows as $row) {\n                                        $tempdata[] = number_format($row['data'],2);\n                                        $numrows++;\n                                }\n                                \/\/ Free DB Query resources\n                      $stmt->closeCursor();\n                        print_r($tempdata);\n\n\nPatrick Calkins writes:\n\n{quote}\nCode:\n\n{code}\n$pdoParams = array(\n    PDO::MYSQL_ATTR_USE_BUFFERED_QUERY => true\n);\n\n$params = array(\n    'host'           => '127.0.0.1',\n    'username'       => 'webuser',\n    'password'       => 'xxxxxx',\n    'dbname'         => 'test',\n    'driver_options' => $pdoParams\n);\n\n$db = Zend_Db::factory('Pdo_Mysql', $params);\n\n\/\/ Stored procedure returns a single row\n$stmt = $db->prepare('CALL get_customer_by_id(:customerId)');\n$stmt->bindParam('customerId', $customerId, PDO::PARAM_INT);\n$stmt->execute();\n$result = $stmt->fetchAll();\nprint_r($result);\n\n$stmt->closeCursor();\n\n\/\/ Stored procedure returns a single row\n$stmt = $db->prepare('CALL get_address_by_id(:customerId)');\n$stmt->bindParam('customerId', $customerId, PDO::PARAM_INT);\n$stmt->execute();\n$result = $stmt->fetchAll();\nprint_r($result);\n{code}\n\nThis will consistently throw this error: 'SQLSTATE[HY000]: General error:\n2014 Cannot execute queries while other unbuffered queries are active.\nConsider using PDOStatement::fetchAll(). Alternatively, if your code is only\never going to run against mysql, you may enable query buffering by setting\nthe PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.'\n\nIf you insert $stmt->nextRowset(); before $stmt->closeCursor(); it will\nthrow this error: 'SQLSTATE[HYC00]: Optional feature not implemented'\n\nThis appears to be a bug, and I haven't found any more info as to its status\nlately. Is this correct??\n{quote}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/6",
                "name": "N\/A"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4951\/watchers",
                "isWatching": false,
                "watchCount": 8
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/1",
                "name": "Open"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10251",
                    "id": 10251,
                    "description": "Mini Release",
                    "name": "1.6.2",
                    "userReleaseDate": "13\/Oct\/08",
                    "archived": false,
                    "releaseDate": "2008-10-13",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10012",
                    "id": 10012,
                    "name": "Zend_Db",
                    "description": "interfaces, APIs, and adapters for various third-party data stores",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/28155",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "body": "Assigning to Ralph to get closure on this issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=wil",
                        "name": "wil",
                        "displayName": "Wil Sinclair",
                        "active": true
                    },
                    "created": "2009-01-13T10:49:26.000+0000",
                    "updated": "2009-01-13T10:49:26.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/32842",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=scips",
                        "name": "scips",
                        "displayName": "S\u00e9bastien Barbieri",
                        "active": true
                    },
                    "body": "Just my 5 cents:\nOn Linux (ubuntu 9.4) with PHP5 from Zend (Zend Server CE), I don't have the issue",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=scips",
                        "name": "scips",
                        "displayName": "S\u00e9bastien Barbieri",
                        "active": true
                    },
                    "created": "2009-07-22T06:35:35.000+0000",
                    "updated": "2009-07-22T06:35:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/46982",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ved2rob",
                        "name": "ved2rob",
                        "displayName": "Rohit Deshmukh",
                        "active": true
                    },
                    "body": "Hi Patric Calkins,\r\ni am relatively new to zend framework but i think i have find solution to this problem.\r\ni can call procedures multiple time. you dont even have to set attribute.\r\nyou can simply avoid this problem using changing cursor name.\r\nbecause even if you call method $stmt->closeCursor(). $stmt still retains the prepare statement properties.\r\nso it will shout error if you try to overwrite its old properties. \r\nyour code might look something like follows\r\n*\r\n$db = Zend_Db::factory('Pdo_Mysql', $params);\r\n\r\n\/\/ Stored procedure returns a single row\r\n$stmt = $db->prepare('CALL get_customer_by_id(:customerId)');\r\n$stmt->bindParam('customerId', $customerId, PDO::PARAM_INT);\r\n$stmt->execute();\r\n$result = $stmt->fetchAll();\r\nprint_r($result);\r\n\r\n$stmt->closeCursor();\r\n\r\n\/\/ Stored procedure returns a single row\r\n$stmt2 = $db->prepare('CALL get_address_by_id(:customerId)');\r\n$stmt2->bindParam('customerId', $customerId, PDO::PARAM_INT);\r\n$stmt2->execute();\r\n$result = $stmt2->fetchAll();\r\nprint_r($result);*\r\n\r\nregards\r\nRohit Deshmukh",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ved2rob",
                        "name": "ved2rob",
                        "displayName": "Rohit Deshmukh",
                        "active": true
                    },
                    "created": "2011-06-04T21:00:33.000+0000",
                    "updated": "2011-06-04T21:00:33.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-4951\/transitions"
}