{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1121",
    "key": "ZF-1121",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend_Db_Select: warning when using Zend_Db_Expr in order()"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1121\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10070",
                    "id": 10070,
                    "description": "Beta Release; bug fixes",
                    "name": "0.9.2",
                    "userReleaseDate": "06\/Apr\/07",
                    "archived": true,
                    "releaseDate": "2007-04-06",
                    "released": true
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2007-04-03T15:21:01.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=idybil",
                "name": "idybil",
                "displayName": "Yan Bilodeau",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2007-03-23T14:02:58.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2007-07-05T14:43:59.000+0000"
        },
        "customfield_10041": {
            "name": "Tags",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:labels"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "When I use a Zend_Db_Expr in the order method of a Zend_Db_Select, a warning is showing up :\n\n{code}\nWarning: preg_match() expects parameter 2 to be string, object given in ZendFramework-HEAD\\Zend\\Db\\Select.php on line 687\n{code}\n\nI'm using PDO_MYSQL as the abstraction layer.\n\nExample : \n\n{code}\n$select = $db->select();\n$select->from('filehistory', array('created',\n\t\t               new Zend_Db_Expr('substring_index(file, \\'\/\\', -1) as file'),\n\t\t               new Zend_Db_Expr('substring_index(substring(file, ' . $len . '), \\'\/\\', 1) as project'),\n\t\t               new Zend_Db_Expr('replace(substr(file, ' . $len . '), substring_index(file, \\'\/\\', -1), \\'\\') as path'),\n\t\t               'userid'));\n\n$select->order(new Zend_Db_Expr('4 DESC');     <-- WARNING HERE.\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1121\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                "name": "bkarwin",
                "displayName": "Bill Karwin",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/10022",
                    "id": 10022,
                    "description": "Beta Release; all components feature complete for 1.0",
                    "name": "0.9.0",
                    "userReleaseDate": "17\/Mar\/07",
                    "archived": true,
                    "releaseDate": "2007-03-17",
                    "released": true
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF",
                "key": "ZF",
                "name": "Zend Framework",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10132",
                    "id": 10132,
                    "name": "Zend_Db_Select",
                    "description": "OO interface to building a SELECT SQL query.",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/13669",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Reformatted description and summary.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-03-23T14:13:56.000+0000",
                    "updated": "2007-03-23T14:13:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/13671",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "I'll try to resolve the warnings, but for what it's worth, you don't have to use Zend_Db_Expr so much as you did in ZF 0.8.0.  We improved the logic in Zend_Db_Select to recognize some patterns and do the expected things with them.  So you can use \"AS\" for column aliases.  Also you can use expressions as long as they contain parentheses, and they will be treated as expressions instead of identifiers.\nThe order() method also recognizes the \"ASC\" and \"DESC\" words.\n\nYou should be able to do the above query in the following way:\n\n{code}\n$select = $db->select();\n$select->from('filehistory', array('created',\n\t\t               'substring_index(file, \\'\/\\', -1) as file',\n\t\t               'substring_index(substring(file, ' . $len . '), \\'\/\\', 1) as project',\n\t\t               'replace(substr(file, ' . $len . '), substring_index(file, \\'\/\\', -1), \\'\\') as path',\n\t\t               'userid'));\n$select->order('4 DESC');\n{code}\n\nIf there is a conflict between the \"as\" notation and the expressions, try this alternative notiation for column aliases that it now supported in Zend_Db_Select:\n\n{code}\n$select = $db->select();\n$select->from('filehistory', array('created',\n\t\t               'file' => 'substring_index(file, \\'\/\\', -1)',\n\t\t               'project' => 'substring_index(substring(file, ' . $len . '), \\'\/\\', 1)',\n\t\t               'path' => 'replace(substr(file, ' . $len . '), substring_index(file, \\'\/\\', -1), \\'\\')',\n\t\t               'userid'));\n$select->order('4 DESC');\n{code}\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-03-23T14:19:42.000+0000",
                    "updated": "2007-03-23T14:19:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/13841",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=idybil",
                        "name": "idybil",
                        "displayName": "Yan Bilodeau",
                        "active": true
                    },
                    "body": "Hi Bill,\n\nThanks for you anwser,  I have updated my FROM wihout using the Zend_Db_Expr and it works very well.  \n\nBut in my Zend_Db_Select::order() I need to use the Zend_Db_Expr because I do not specify the table field name but the position of it.\n\nexample :   \n\n{code}\nSELECT fieldA, fieldB, fieldC, fieldD FROM myTable ORDER BY 3  -> 3 represent the fieldC of my query.\n{code}\n\nWhen I do not use the Zend_Db_Expr in my order, it throws me this exception : Uncaught exception 'Zend_Db_Adapter_Exception' with message 'SQLSTATE[42S22]: Column not found:\n\nThis exception is true, because column 3 does not exists in my query.\n\nSo I turn out using the Zend_Db_Expr which work well, but it show me the warning I post in the issue.\n\n\nIs there any other ways to do what I need to do ?  or do you think this will be fixed in future version of the Framework ?\n\n\nAs of now, I have modified the Zend_Db_Select::order() method to fix my problem.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=idybil",
                        "name": "idybil",
                        "displayName": "Yan Bilodeau",
                        "active": true
                    },
                    "created": "2007-03-30T14:21:06.000+0000",
                    "updated": "2007-03-30T14:21:06.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/13930",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "body": "Fixed in revision 4336.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=bkarwin",
                        "name": "bkarwin",
                        "displayName": "Bill Karwin",
                        "active": true
                    },
                    "created": "2007-04-03T15:21:00.000+0000",
                    "updated": "2007-04-03T15:21:00.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF-1121\/transitions"
}