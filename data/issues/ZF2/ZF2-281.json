{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-281",
    "key": "ZF2-281",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Cannot Count rows in a MySQLi Result Set"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-281\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-06-04T17:09:23.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=erasertwo",
                "name": "erasertwo",
                "displayName": "Pascal Rota",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2012-04-28T05:15:43.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-06-04T17:09:23.000+0000"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I have an issue with the TableGateway, ResultSet classes. If I call after a select the count() method, it will always return 0 (An example is shown below). The first row can be accessed by current()-stmt without a problem. Furthermore it is not possible to loop twice over the same result set with rewind(), current() and next(). Even going through the resultSet after a call to count() is not possible.\r\n\u00a0\r\nHere is a short code snipped to demonstrate the error (short):\r\n{code}\r\nuse Zend\\Db\\TableGateway\\TableGateway;\r\nuse Zend\\Db\\Adapter\\Adapter;\r\n\u00a0\r\n$adapter = new Adapter(array(\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 'driver'\u00a0\u00a0 => 'Mysqli',\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 'database' => <db>,\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 'username' => <username>,\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 'password' => <password>\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ));\r\n$tab\u00a0\u00a0\u00a0\u00a0 = new TableGateway(<db_table>, $adapter);\r\n\u00a0\r\n$resultSet = $tab->select();\r\n\u00a0\r\necho $resultSet->count();\u00a0 \/\/ will always return 0\r\n{code}\r\n\u00a0\r\nI belive that the error is in this case in Zend\\Db\\Adapter\\Driver\\Mysqli\\Result class. The result ressource is a mysqli_stmt class, but no mysqli_stmt::store_result() is called and therefore the result set is never transfered from the query and can only be accessed once.\r\n\u00a0\r\nA possible fix can be found in Pull Request #1080 https:\/\/github.com\/zendframework\/zf2\/pull\/1080.\r\n\u00a0"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-281\/watchers",
                "isWatching": false,
                "watchCount": 2
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF2-262",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-262",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF2",
                "key": "ZF2",
                "name": "Zend Framework 2.0",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10520",
                    "id": 10520,
                    "name": "Zend\\Db",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50618",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dgasparri",
                        "name": "dgasparri",
                        "displayName": "Duccio Gasparri",
                        "active": true
                    },
                    "body": "This appears to be a clone of [ZF2-262] http:\/\/framework.zend.com\/issues\/browse\/ZF2-262\r\n\r\nProposed git pull https:\/\/github.com\/zendframework\/zf2\/pull\/1201 (commit https:\/\/github.com\/dgasparri\/zf2-testserver\/commit\/d8027ac9958eaf67d9cf056e0987d3c9f91a54f8 )",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dgasparri",
                        "name": "dgasparri",
                        "displayName": "Duccio Gasparri",
                        "active": true
                    },
                    "created": "2012-05-12T01:56:18.000+0000",
                    "updated": "2012-05-12T01:56:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50621",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "Not just MySQLi, but also PDO (tested w\/ SQLite). Reproduce script: https:\/\/gist.github.com\/2659662",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2012-05-12T02:24:48.000+0000",
                    "updated": "2012-05-12T02:24:48.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50627",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=erasertwo",
                        "name": "erasertwo",
                        "displayName": "Pascal Rota",
                        "active": true
                    },
                    "body": "I tested the proposed git pull https:\/\/github.com\/zendframework\/zf2\/pull\/1201 and it would fix this problem (at least with the MySQLi backend).",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=erasertwo",
                        "name": "erasertwo",
                        "displayName": "Pascal Rota",
                        "active": true
                    },
                    "created": "2012-05-12T04:34:24.000+0000",
                    "updated": "2012-05-12T04:34:24.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50639",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dgasparri",
                        "name": "dgasparri",
                        "displayName": "Duccio Gasparri",
                        "active": true
                    },
                    "body": "@Adam Lundrigan, could you clarify? do you mean that also PDO has this problem, or that the proposed pull solves also the PDO one? Because PDO calls are handled by a different class (Pdo\\Result instead of Mysqli\\Result), and although the issues are probably the same as the mysqli version, I did not touch the PDO. I did only minor changes on the common class ResultSet\\ResultSet, how did that affect the overall behavior of Pdo?\r\n\r\nWe're writing a Unit Test for the Mysqli, it would be nice to add one for the Pdo too. If you want to take a look (was mixed with another pull, look from the middle of the discussion) https:\/\/github.com\/zendframework\/zf2\/pull\/1201",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dgasparri",
                        "name": "dgasparri",
                        "displayName": "Duccio Gasparri",
                        "active": true
                    },
                    "created": "2012-05-13T01:25:11.000+0000",
                    "updated": "2012-05-13T01:25:11.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50640",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "body": "@Duccio: Sorry, I should have been clearer.  I've been using Zend\\Db with the PDO adapter to connect to a SQLite database, and I am encountering the same issue as explained in this ticket (row count always zero).  I haven't looked in the code to see if the problem with both adapters comes from the same code or if they are separate issues, so instead of opening a new ticket yet I just commented on this one.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=adamlundrigan",
                        "name": "adamlundrigan",
                        "displayName": "Adam Lundrigan",
                        "active": true
                    },
                    "created": "2012-05-13T11:17:27.000+0000",
                    "updated": "2012-05-13T11:17:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50981",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "body": "This is fixed in beta4.  For mysqli, by default it will produce unbuffered result sets.  In order to buffer these results, a buffer() method was added to the ResultInterface.\r\n\r\nCall this before calling count(), and it shall work.  There is also a setting in the Mysqli Statement object to always produce buffered result sets for mysqli.  Since the default PHP behavior is to produce unbuffered sets, this is also the default in the Mysqli driver.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                        "name": "ralph",
                        "displayName": "Ralph Schindler",
                        "active": true
                    },
                    "created": "2012-06-04T17:09:23.000+0000",
                    "updated": "2012-06-04T17:09:23.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-281\/transitions"
}