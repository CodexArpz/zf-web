{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-185",
    "key": "ZF2-185",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "LF\/CR statically given in \\Zend\\Mail\\Headers.php::toString() "
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-185\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-06-12T15:49:31.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jade",
                "name": "jade",
                "displayName": "Ja De",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2012-03-03T06:40:43.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-06-12T16:21:17.000+0000"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "Hi!\r\n\r\nIn \\Zend\\Mail\\Headers and its toString() function are two occurrences of \"\\r\\n\".\r\n\r\nThis breaks mails by adding a blank line between header lines.\r\nIn my case removing the CR helped (i was using a CentOS VM and SmtpTransport).\r\n\r\nWould you please check if it is useful to switch LF vs CR+LF based on the OS in use?\r\nI would prefer the use of __toString() instead of toString(), too.\r\n\r\nThx for having a look at it.\r\nJade\r\n"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/5",
                "name": "Trivial"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-185\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maks3w",
                "name": "maks3w",
                "displayName": "Maks 3w",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF2-154",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-154",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF2",
                "key": "ZF2",
                "name": "Zend Framework 2.0",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10552",
                    "id": 10552,
                    "name": "Zend\\Mail",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50427",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Can you demonstrate a case where this breaks (not just OS)? I.e., what is the actual output?\r\n\r\nThe mail RFCs specify that headers are supposed to be separated using the combination of a CR and a LF (\"\\r\\n\"). Changing this would be very problematic, and I'd argue something to do in specialized *transports* only.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2012-05-02T17:21:35.000+0000",
                    "updated": "2012-05-02T17:21:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50430",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jade",
                        "name": "jade",
                        "displayName": "Ja De",
                        "active": true
                    },
                    "body": "Hi!\r\nI have absolutely no clue if this is related to a specific transport. What i can tell:\r\n\r\nWhen i use the \"\\r\\n\" part ( $headers .= $fieldName . ': ' . $value . \"\\r\\n\"; ) from the method in question, my mail client (Thunderbird, current and last few verions) shows the following mail source code and the output is visually broken:\r\n\r\n----\r\n\r\nX-Envelope-From: <sender.mail@address.com>\r\nX-Envelope-To: <recipient.mail@address.com>\r\nX-Delivery-Time: 1336052195\r\nX-UID: 6720\r\nReturn-Path: <sender.mail@address.com>\r\nX-RZG-CLASS-ID: mi\r\nReceived: from *snip*.tld ([IPv6:*snip*])\r\n\tby *snip*.tld (jored mi19) (RZmta 29.1 OK)\r\n\twith ESMTP id *snip* for <recipient.mail@address.com>;\r\n\tThu, 3 May 2012 15:36:35 +0200 (CEST)\r\nX-RZG-AUTH: :*snip*\r\nTo: recipient.mail@address.com\r\nFrom: sender.mail@address.com\r\nMessage-ID: <*snip*.tld>\r\nX-RZG-CLASS-ID: mo00\r\nReceived: from Some-Mail (*snip*.tld [*snip*])\r\n\tby smtp.*snip*.tld (josoe mo29) (RZmta 29.1 DYNA|AUTH)\r\n\twith ESMTPA id *snip* for <recipient.mail@address.com>;\r\n\tThu, 3 May 2012 15:36:35 +0200 (CEST)\r\nDate: Fri, 04 May 2012 00:36:50 +0200\r\n\r\nSubject: super-important subject\r\n\r\nFrom: Sender Name <sender.mail@address.com>\r\n\r\nTo: Recipient Name <recipient.mail@address.com>\r\n\r\nMime-Version: 1.0\r\n\r\nContent-Type: text\/html; charset=\"UTF-8\"\r\n\r\nContent-Transfer-Encoding: 8bit\r\n\r\nSender: \r\n\r\nCc: \r\n\r\n<html>\r\n\r\n*snip*\r\n\r\n<\/html>\r\n\r\n----\r\n\r\n\r\nWhen i switch to a modified version where i use only \"\\n\\ ( $headers .= $fieldName . ': ' . $value . \"\\n\"; ), the same mail client shows the following mail source code (only relevant changes) - and this email displays well:\r\n\r\n----\r\n\r\nDate: Fri, 04 May 2012 00:36:50 +0200\r\nSubject: super-important subject\r\nFrom: Sender Name <sender.mail@address.com>\r\nTo: Recipient Name <recipient.mail@address.com>\r\nMime-Version: 1.0\r\nContent-Type: text\/html; charset=\"UTF-8\"\r\nContent-Transfer-Encoding: 8bit\r\nSender: \r\nCc: \r\n\r\n<html>\r\n\r\n*snip*\r\n\r\n<\/html>\r\n\r\n----\r\n\r\nA few lines of code from my mail functions:\r\n{code:title=some.function|borderStyle=solid}\r\n\tprotected function sendRegistrationMail(){\r\n \t\ttry {\r\n\t\t\t$transport = $this->getTransport( array('transport' => 'smtp') );\r\n\t\t\t$message = $this->buildMessage();\r\n\t\t\t$transport->send($message);\t\t\r\n\t\t} \r\n\t\tcatch (\\Exception $e) {\r\n\t\t\tthrow new RuntimeException('unable to send registration mail');\r\n\t\t}\r\n\t}\r\n{code}\r\n\r\nand\r\n\r\n{code:title=other.function.from.same.class|borderStyle=solid}\r\n\tprivate function buildMessage(){\r\n\t\t$message = new Message();\r\n\t\t$message->setSubject($this->_email_subject);\r\n\t\t$message->setFrom($this->_email_sender);\r\n\t\t$message->addTo($this->_email_recipient);\r\n\t\t\/\/ get mail content, html with valid markup\r\n\t\t$content = $this->getMessageBody($this->_template_file, $this->_template_vars);\r\n\t\t\/\/ build MIME message & parts\r\n\t\t$mimeMessage = new MimeMessage();\r\n\t\t$htmlPart = new MimePart($content);\r\n\t\t$htmlPart->type = Mime::TYPE_HTML;\r\n\t\t$htmlPart->charset = \"UTF-8\"; \r\n\t\t$mimeMessage->setParts( array( $htmlPart ) );\r\n\t        \/\/ set MIME Message as mail body\r\n\t\t$message->setBody($mimeMessage);\r\n\t\treturn $message;\r\n\t}\t\r\n{code}\r\n\r\n\r\nI can't tell (and have no quick idea on how to investigate) why the blank lines are inserted in the first and broken case. If you want me to give more details, please specify - i'll do my best.\r\n\r\nBest regards,\r\nJade",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jade",
                        "name": "jade",
                        "displayName": "Ja De",
                        "active": true
                    },
                    "created": "2012-05-03T15:06:49.000+0000",
                    "updated": "2012-05-03T15:35:59.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50431",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maks3w",
                        "name": "maks3w",
                        "displayName": "Maks 3w",
                        "active": true
                    },
                    "body": "What is your MTA (Sendmail, Postfix, QMail, ...) and version?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maks3w",
                        "name": "maks3w",
                        "displayName": "Maks 3w",
                        "active": true
                    },
                    "created": "2012-05-03T15:10:12.000+0000",
                    "updated": "2012-05-03T15:10:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50433",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jade",
                        "name": "jade",
                        "displayName": "Ja De",
                        "active": true
                    },
                    "body": "@*Maks 3w*:\r\nIf I understand correctly the internals of sending mail via PHP... the answer is:\r\n\r\nI currently don't send by my own MTA. I use SMTP transport to access a \"use and throw away\" email account from another hoster. I have no clue what software they use to handle my mails. \r\n\r\nBut i have to admit that emails and related stuff is far away from my regular domain of knowledge. So please let me know if i mixed something up.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jade",
                        "name": "jade",
                        "displayName": "Ja De",
                        "active": true
                    },
                    "created": "2012-05-03T15:33:39.000+0000",
                    "updated": "2012-05-03T15:33:39.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50434",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Honestly, this sounds like a b0rked MTA. I'll take a look later, but I'm *very* hesitant to introduce code that will deviate from standards, as this *will* cause things to break.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2012-05-03T16:05:51.000+0000",
                    "updated": "2012-05-03T16:05:51.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51061",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maks3w",
                        "name": "maks3w",
                        "displayName": "Maks 3w",
                        "active": true
                    },
                    "body": "@Ja De I created this PR (https:\/\/github.com\/zendframework\/zf2\/pull\/1475) Could you check if fix your problem?",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maks3w",
                        "name": "maks3w",
                        "displayName": "Maks 3w",
                        "active": true
                    },
                    "created": "2012-06-11T20:07:36.000+0000",
                    "updated": "2012-06-11T20:07:36.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51067",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jade",
                        "name": "jade",
                        "displayName": "Ja De",
                        "active": true
                    },
                    "body": "@Maks 3w:\r\nSorry, can't do. After this incident i switched to a async worker script using PEAR mail which somehow is tolerant to this issue.\r\n\r\nBut as i looked at the PR code:\r\nTweaking the constant Headers::HEADER_EOL will provide a fix to the problem with that specific mail service.\r\nIt would have solved the trouble as it is similiar to the workaround i used back then.\r\n\r\nBest regards,\r\nJade",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=jade",
                        "name": "jade",
                        "displayName": "Ja De",
                        "active": true
                    },
                    "created": "2012-06-12T08:57:04.000+0000",
                    "updated": "2012-06-12T09:05:16.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51072",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maks3w",
                        "name": "maks3w",
                        "displayName": "Maks 3w",
                        "active": true
                    },
                    "body": "I found the real issue!!!!!!!\r\n\r\nThe problem is in Protocol\\Smpt line 304, While the line endings for headers are CRLF, that loop is splitting only by LF beeing the final line CRCRLF\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maks3w",
                        "name": "maks3w",
                        "displayName": "Maks 3w",
                        "active": true
                    },
                    "created": "2012-06-12T14:15:25.000+0000",
                    "updated": "2012-06-12T14:19:27.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51073",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maks3w",
                        "name": "maks3w",
                        "displayName": "Maks 3w",
                        "active": true
                    },
                    "body": "Fixed with the PR https:\/\/github.com\/zendframework\/zf2\/pull\/1475",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maks3w",
                        "name": "maks3w",
                        "displayName": "Maks 3w",
                        "active": true
                    },
                    "created": "2012-06-12T15:49:31.000+0000",
                    "updated": "2012-06-12T15:49:31.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-185\/transitions"
}