{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-509",
    "key": "ZF2-509",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Zend\\Di\\DefinitionList with ClassDefinition collecting supertypes problem"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-509\/votes",
                "votes": 1,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/11185",
                    "id": 11185,
                    "description": "Mini Release",
                    "name": "Next Mini Release",
                    "overdue": true,
                    "userReleaseDate": "04\/Oct\/12",
                    "archived": false,
                    "releaseDate": "2012-10-04",
                    "released": false
                }
            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-09-12T11:23:52.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kosugiatkips",
                "name": "kosugiatkips",
                "displayName": "Tomoaki Kosugi",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2012-08-30T06:43:11.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-09-13T01:22:43.000+0000"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "If DefinitionList has multiple classDefinition, \r\nZend\\Di\\DefinitionList::getClassSupertypes or Zend\\Di\\DefinitionList::getInstantiator call each classDefinition.\r\nA classDefinition instance is per-Class definition. And ClassDefinition::getClassSupertypes($class) returns simply its supertypes .\r\nIn this flow, the class-name-parameter is meaningless.\r\n\r\nhttps:\/\/github.com\/zendframework\/zf2\/blob\/master\/library\/Zend\/Di\/Definition\/ClassDefinition.php#L134\r\n\r\nDefinitionInterface expects getClassSupertypes to return array filtered with the classname parameter.\r\n\r\n    public function getClassSupertypes($class)\r\n    {\r\n        if ($this->class !== $class) return array();\r\n        return $this->supertypes;\r\n    }"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/1",
                "name": "Blocker"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-509\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/version\/11184",
                    "id": 11184,
                    "description": "First stable release",
                    "name": "2.0.0",
                    "overdue": true,
                    "userReleaseDate": "06\/Sep\/12",
                    "archived": false,
                    "releaseDate": "2012-09-06",
                    "released": false
                }
            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF2",
                "key": "ZF2",
                "name": "Zend Framework 2.0",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10620",
                    "id": 10620,
                    "name": "Zend\\Di",
                    "description": "Dependency Injection Component",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51761",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kosugiatkips",
                        "name": "kosugiatkips",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "body": "I made up pull request about this.\r\nhttps:\/\/github.com\/zendframework\/zf2\/pull\/2265#issuecomment-8174727\r\nAnd this is reproductive codes.\r\n{code:title=bad result sample}\r\n<?php \r\n\r\nuse Zend\\Di\\Definition\\ClassDefinition;\r\nuse Zend\\Di\\DefinitionList;\r\n\r\n$definitionClassA = new ClassDefinition(\"A\");\r\n$definitionClassA->setSupertypes(array(\"superA\"));\r\n$definitionClassB = new ClassDefinition(\"B\");\r\n$definitionClassB->setSupertypes(array(\"superB\"));\r\n$definitionList = new DefinitionList(array($definitionClassA, $definitionClassB));\r\n\r\n$resultA = $definitionList->getClassSuperTypes(\"A\");\r\nvar_dump($resultA);\r\n$resultB = $definitionList->getClassSuperTypes(\"B\");\r\nvar_dump($resultB);\r\n{code}\r\nExpected:\r\n\r\nA: array(\"superA\")\r\nB: array(\"superB\")\r\n\r\nActual:\r\nA:\r\narray(2) {\r\n  [0]=>\r\n  string(6) \"superA\"\r\n  [1]=>\r\n  string(6) \"superB\"\r\n}\r\nB:\r\narray(2) {\r\n  [0]=>\r\n  string(6) \"superA\"\r\n  [1]=>\r\n  string(6) \"superB\"\r\n}",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kosugiatkips",
                        "name": "kosugiatkips",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "created": "2012-08-31T00:47:43.000+0000",
                    "updated": "2012-09-02T04:16:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51764",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kosugiatkips",
                        "name": "kosugiatkips",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "body": "And these cause wrong injection to new-instance.\r\nZend\\Di\\Di::newInstance\r\n{code}\r\n        foreach ($definitions->getClassSupertypes($class) as $supertype) {\r\n            $injectionMethods[$supertype] = $definitions->getMethods($supertype);\r\n        }\r\n......snip....\r\n        $this->handleInjectDependencies($instance, $injectionMethods, $params, $class, $alias, $name);\r\n{code}\r\nit collects wrong injectionMethods from wrong supertypes.\r\nand so pass to handleInjectDependencies. In Zend\\Di\\Di::handleInjectDependencies, It uses wrong injection methods and wrong parameters.\r\n\r\n\r\n\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kosugiatkips",
                        "name": "kosugiatkips",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "created": "2012-08-31T10:34:39.000+0000",
                    "updated": "2012-08-31T10:34:39.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51766",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=az",
                        "name": "az",
                        "displayName": "Alrik Zachert",
                        "active": true
                    },
                    "body": "I think it should be discussed whether the ClassDefinition in its current implementation should implement DefinitionInterface.\r\nAs i understand the documentation of DefinitionInterface, it describes\/is a collection of class definitions, whereas ClassDefinition is a single class definition...\r\n\r\nSo, in my opinion, the above solution solves a bug that was caused by a deeper, conceptually problem.\r\n\r\nShouldn't Array-, Builder-, Compiler- and RuntimeDefinitions hold a map of ClassDefinition instances?\r\nMore abstract: Map DefinitionInterface<ClassDefinitionInterface>\r\n\r\n\r\npros:\r\n- operate with ClassDefinitionInterface instances within DefinitionInterfaces rather then with \"plain\" arrays\r\n- more intuitive API (avoid \"if($this->class === $class) ...\" - absurdity for a specific class definition)\r\n\r\ncons:\r\n- BC break",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=az",
                        "name": "az",
                        "displayName": "Alrik Zachert",
                        "active": true
                    },
                    "created": "2012-08-31T12:42:25.000+0000",
                    "updated": "2012-08-31T12:48:18.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51769",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kosugiatkips",
                        "name": "kosugiatkips",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "body": "I agree with you about DefinitionInterface concepts.\r\n\r\nArrayDefinition is \"Class definitions based on a given array\", so it is a Definition for multiple class.\r\nClassDefinition's description is that \"Class definitions for a single class\". \r\nI feel it should be abstractive signature representing the class structure.\r\nFor example, Zend\\Di\\Config::configure makes an ArrayDefinition that it has a collection of ClassDefinition instances.\r\n\r\nOn the other hand, we already have a Definition's collection ,the DefinitionList.\r\nI think the current implementation is not bad. A DefinitionInterface usually has multiple class, but specially it has only a single class.\r\nAnd so single is specially, it should have codes \"if($this->class === $class) ...\"",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kosugiatkips",
                        "name": "kosugiatkips",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "created": "2012-08-31T15:18:58.000+0000",
                    "updated": "2012-08-31T15:18:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51800",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ocramius",
                        "name": "ocramius",
                        "displayName": "Marco Pivetta",
                        "active": true
                    },
                    "body": "[~az] I think there's nothing wrong in having a ClassDefinition implement the DefinitionInterface. It is just a \"map\" with a single element in it. What is weird is that `$definition->getClassSupertypes($class)` seems to retrieve wrong data.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ocramius",
                        "name": "ocramius",
                        "displayName": "Marco Pivetta",
                        "active": true
                    },
                    "created": "2012-09-05T08:30:28.000+0000",
                    "updated": "2012-09-05T08:30:28.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51801",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ocramius",
                        "name": "ocramius",
                        "displayName": "Marco Pivetta",
                        "active": true
                    },
                    "body": "As told on the mailing list, PR #2265 seems fine to me, but should also add checks on the rest of the `ClassDefinition`",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ocramius",
                        "name": "ocramius",
                        "displayName": "Marco Pivetta",
                        "active": true
                    },
                    "created": "2012-09-05T08:56:00.000+0000",
                    "updated": "2012-09-05T08:56:00.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51811",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kosugiatkips",
                        "name": "kosugiatkips",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "body": "I closed the pull-requests #2265,#2277 .And I remade a commit squashed.\r\nhttps:\/\/github.com\/zendframework\/zf2\/pull\/2295\r\nPlease review it.\r\n\r\nThanks.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kosugiatkips",
                        "name": "kosugiatkips",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "created": "2012-09-05T14:07:35.000+0000",
                    "updated": "2012-09-05T14:07:35.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51818",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kosugiatkips",
                        "name": "kosugiatkips",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "body": "I'm sorry. #2295 had several problems.\r\nI made an amendment in it.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kosugiatkips",
                        "name": "kosugiatkips",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "created": "2012-09-06T07:01:12.000+0000",
                    "updated": "2012-09-06T07:01:12.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51871",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kosugiatkips",
                        "name": "kosugiatkips",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "body": "fixed in 2.0.1 \r\nThanks.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=kosugiatkips",
                        "name": "kosugiatkips",
                        "displayName": "Tomoaki Kosugi",
                        "active": true
                    },
                    "created": "2012-09-12T11:23:52.000+0000",
                    "updated": "2012-09-12T11:23:52.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-509\/transitions"
}