{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-273",
    "key": "ZF2-273",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "use weakref will lose the listener object"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-273\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/1",
                "name": "Fixed"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-06-14T20:41:38.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=simonliu",
                "name": "simonliu",
                "displayName": "simon liu",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2012-04-20T05:28:26.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-06-14T20:41:38.000+0000"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "PHP Warning:  call_user_func() expects parameter 1 to be a valid callback, first array member is not a valid class name or object in \/var\/www\/html\/zf2-demo\/vendor\/ZendFramework\/library\/Zend\/EventManager\/EventManager.php on line 441\r\n\r\nI check the code, when some event is triggered, event manager try to fetch callback object from a weakref object, the \"real\" callback object has been disposed, so event manager got null.\r\n\r\nhere is the code when some listeners is being attached, a listener object is created and pass to attach():\r\n\r\n{code:title=Zend\/Module\/Listener\/DefaultListenerAggregate.php:33|borderStyle=solid}\r\n$moduleAutoloader = new ModuleAutoloader($options->getModulePaths());\r\n$this->listeners[] = $events->attach('loadModules.pre', array($moduleAutoloader, 'register'), 1000);\r\n\/\/ $moduleAutoloader will be disposed at the end of the function if no other hard reference point it.\r\n{code}\r\n\r\nhere is the code in attach() method, a CallbackHandler is created with $callback as its argument:\r\n\r\n{code:title=Zend\/EventManager\/EventManager.php|borderStyle=solid}\r\npublic function attach($event, $callback = null, $priority = 1)\r\n{\r\n    \/\/ ......\r\n    $listener = new CallbackHandler($callback, array('event' => $event, 'priority' => $priority));\r\n    \/\/ ......\r\n}\r\n{code}\r\n\r\nhere is the code when a CallbackHandler is being constructed, only weakref object is keeped. When we retrive \"real\" object from weakref, if \"real\" object has been disposed, we got null.\r\nI think we do not expect this.\r\n\r\n{code:title=Zend\/Stdlib\/CallbackHandler.php|borderStyle=solid}\r\n\/\/ We have an array callback with an object as the first argument;\r\n\/\/ pass it to WeakRef, and then register the new callback\r\n$target = new WeakRef($target);\r\n$this->callback = array($target, $method);\r\n{code}"
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/3",
                "name": "Major"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-273\/watchers",
                "isWatching": false,
                "watchCount": 0
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "callback",
                "event",
                "weakref"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralph",
                "name": "ralph",
                "displayName": "Ralph Schindler",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [

            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF2",
                "key": "ZF2",
                "name": "Zend Framework 2.0",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10823",
                    "id": 10823,
                    "name": "Zend\\EventManager",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/50659",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=simonliu",
                        "name": "simonliu",
                        "displayName": "simon liu",
                        "active": true
                    },
                    "body": "I fix it, pull request is here:\r\nhttps:\/\/github.com\/zendframework\/zf2\/pull\/1234",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=simonliu",
                        "name": "simonliu",
                        "displayName": "simon liu",
                        "active": true
                    },
                    "created": "2012-05-16T02:23:15.000+0000",
                    "updated": "2012-05-16T02:23:15.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51123",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maks3w",
                        "name": "maks3w",
                        "displayName": "Maks 3w",
                        "active": true
                    },
                    "body": "PR merged",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=maks3w",
                        "name": "maks3w",
                        "displayName": "Maks 3w",
                        "active": true
                    },
                    "created": "2012-06-14T20:41:38.000+0000",
                    "updated": "2012-06-14T20:41:38.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-273\/transitions"
}