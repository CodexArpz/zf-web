{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-486",
    "key": "ZF2-486",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Individual segments in a route are not filled when using url view helper and url controller plugin"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-486\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/6",
                "name": "Not an Issue"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-08-22T19:12:19.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralf",
                "name": "ralf",
                "displayName": "Ralf Eggert",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2012-08-22T08:08:39.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-08-23T15:46:23.000+0000"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "I have this application module config file in \/module\/Application\/config\/module.config.php\r\n\r\n{code} \r\nreturn array(\r\n    'router' => array(\r\n        'routes' => array(\r\n            'home' => array(\r\n                'type' => 'Literal',\r\n                'options' => array(\r\n                    'route'    => '\/',\r\n                    'defaults' => array(\r\n                        'controller' => 'Application',\r\n                        'action'     => 'index',\r\n                    ),\r\n                ),\r\n            ),\r\n            'application' => array(\r\n                'type'    => 'segment',\r\n                'options' => array(\r\n                    'route'    => '[\/:locale][\/:controller][\/:action][\/:id]',\r\n                    'constraints' => array(\r\n                        'locale'     => '[a-z]{2}',\r\n                        'controller' => '[a-zA-Z][a-zA-Z0-9_-]*',\r\n                        'action'     => '[a-zA-Z][a-zA-Z0-9_-]*',\r\n                        'id'         => '[0-9]+',\r\n                    ),\r\n                    'defaults' => array(\r\n                        'controller' => 'Application',\r\n                        'action'     => 'index',\r\n                        'locale'     => 'de',\r\n                    ),\r\n                ),\r\n                'may_terminate' => true,\r\n                'child_routes' => array(\r\n                    'default' => array(\r\n                        'type'    => 'Wildcard',\r\n                        'options' => array(\r\n                        ),\r\n                    ),\r\n                ),\r\n            ),\r\n        ),\r\n    ),\r\n    'controllers' => array(\r\n        'invokables' => array(\r\n            'Application' => 'Application\\Controller\\IndexController',\r\n        ),\r\n    ),\r\n);\r\n{code} \r\n\r\nThe routing itself works perfectly. But when I want to create an Url with the url view helper or the url controller plugin I don't get the expected result. Here is an example from a view script:\r\n\r\n{code} \r\n<?php echo $this->url('application', array('locale' => 'de', 'action'=>'add', 'controller' => 'application')); ?>\r\n{code} \r\n\r\nAnd here from a controller:\r\n\r\n{code} \r\necho $this->url()->fromRoute('application', array('action' => 'add', 'controller' => 'application', 'locale' => 'de'));\r\n{code} \r\n\r\n\r\nBoth output\r\n\r\n  \/application\/add \r\n\r\nand not the expected\r\n\r\n  \/de\/application\/add \r\n\r\nRenaming the locale segment or changing the order of the segments does not help. But when I clear the default for the locale then it does work."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-486\/watchers",
                "isWatching": false,
                "watchCount": 3
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [

            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                "name": "matthew",
                "displayName": "Matthew Weier O'Phinney",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF2-495",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-495",
                    "type": {
                        "name": "Related",
                        "direction": "INBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF2",
                "key": "ZF2",
                "name": "Zend Framework 2.0",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10532",
                    "id": 10532,
                    "name": "Zend\\Mvc\\Controller",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10577",
                    "id": 10577,
                    "name": "Zend\\Uri",
                    "isAssigneeTypeValid": false
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10580",
                    "id": 10580,
                    "name": "Zend\\View",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51663",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralf",
                        "name": "ralf",
                        "displayName": "Ralf Eggert",
                        "active": true
                    },
                    "body": "corrected code blocks",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralf",
                        "name": "ralf",
                        "displayName": "Ralf Eggert",
                        "active": true
                    },
                    "created": "2012-08-22T08:11:58.000+0000",
                    "updated": "2012-08-22T08:11:58.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51665",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralf",
                        "name": "ralf",
                        "displayName": "Ralf Eggert",
                        "active": true
                    },
                    "body": "Assigned to Shavar Evron by mistake",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralf",
                        "name": "ralf",
                        "displayName": "Ralf Eggert",
                        "active": true
                    },
                    "created": "2012-08-22T12:03:22.000+0000",
                    "updated": "2012-08-22T12:03:22.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51670",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "I've confirmed the reproduce case a this time, and will see if I can fix it.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2012-08-22T18:42:42.000+0000",
                    "updated": "2012-08-22T18:42:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51671",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "Actually, in looking at it, the problem is with your route.\r\n\r\nBecause you have multiple optional segments that are not encapsulated, the router is getting confused about what is truly optional, and what is required. Couple this with a wildcard route, and it's really anybody's guess as to how this should be assembled.\r\n\r\nIf you rewrite the segment route string as follows, it works fine:\r\n\r\n{code}\r\n'route' => '[:locale[\/:controller[\/:action[\/:id]]]]'\r\n{code}\r\n\r\nBased on the use cases you've presented so far, it appears this is what you really want -- the locale should always be the first segment, and it will be optionally followed by the controller, optionally followed by the action, and finally optionally followed by the identifier.\r\n",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2012-08-22T19:10:56.000+0000",
                    "updated": "2012-08-22T19:10:56.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51672",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralf",
                        "name": "ralf",
                        "displayName": "Ralf Eggert",
                        "active": true
                    },
                    "body": "Thanks for your effort. Works now. And sorry for stuffing the issue tracker with this.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=ralf",
                        "name": "ralf",
                        "displayName": "Ralf Eggert",
                        "active": true
                    },
                    "created": "2012-08-22T20:07:42.000+0000",
                    "updated": "2012-08-22T20:07:42.000+0000"
                },
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51673",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "body": "No worries -- it looked like a legitimate bug. It was only when I was tracing execution that I realized what was happening, and why.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=matthew",
                        "name": "matthew",
                        "displayName": "Matthew Weier O'Phinney",
                        "active": true
                    },
                    "created": "2012-08-22T20:09:17.000+0000",
                    "updated": "2012-08-22T20:09:17.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-486\/transitions"
}