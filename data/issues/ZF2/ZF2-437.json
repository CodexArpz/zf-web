{
    "expand": "html",
    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-437",
    "key": "ZF2-437",
    "fields": {
        "summary": {
            "name": "summary",
            "type": "java.lang.String",
            "value": "Router HTTP Segment does not handle defaults correctly when matching"
        },
        "timetracking": {
            "name": "timetracking",
            "type": "com.atlassian.jira.issue.fields.TimeTrackingSystemField"
        },
        "issuetype": {
            "name": "issuetype",
            "type": "com.atlassian.jira.issue.issuetype.IssueType",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issueType\/1",
                "name": "Bug",
                "subtask": false
            }
        },
        "votes": {
            "name": "votes",
            "type": "com.atlassian.jira.issue.fields.VotesSystemField",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-437\/votes",
                "votes": 0,
                "hasVoted": false
            }
        },
        "security": {
            "name": "security",
            "type": "com.atlassian.jira.issue.security.IssueSecurityLevel"
        },
        "resolution": {
            "name": "resolution",
            "type": "com.atlassian.jira.issue.resolution.Resolution",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/resolution\/3",
                "name": "Duplicate"
            }
        },
        "fixVersions": {
            "name": "fixVersions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "resolutiondate": {
            "name": "resolutiondate",
            "type": "java.util.Date",
            "value": "2012-08-01T11:46:27.000+0000"
        },
        "reporter": {
            "name": "reporter",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=fokeyjoe",
                "name": "fokeyjoe",
                "displayName": "Russell Brown",
                "active": true
            }
        },
        "created": {
            "name": "created",
            "type": "java.util.Date",
            "value": "2012-08-01T10:32:49.000+0000"
        },
        "updated": {
            "name": "updated",
            "type": "java.util.Date",
            "value": "2012-08-01T11:46:27.000+0000"
        },
        "description": {
            "name": "description",
            "type": "java.lang.String",
            "value": "This might be same problem as (ZF2-408), but didn't want to piggyback in case it isn't.\r\n\r\nWhen reassembling a URL from a routematch that contains defaults, it does not reconstruct the URL properly.\r\nMy router config:\r\n{noformat}\r\n'media' => array (\r\n    'type' => 'Zend\\Mvc\\Router\\Http\\Segment',\r\n    'options' => array (\r\n        'route' => '\/media[\/:title][\/:mediatype][\/:item][\/]',\r\n        'constraints' => array (\r\n            'mediatype' => ('videos|screenshots'),\r\n            'title' => ('shakespeare|pinter')\r\n        ),\r\n        'defaults' => array (\r\n            'mediatype' => '',\r\n            'action' => 'index',\r\n            'controller' => 'MyModule\\Controller\\MediaController',\r\n        ),\r\n    ),\r\n),\r\n{noformat}\r\n\r\nIf I enter a url of {{\/media\/videos\/}}, my RouteMatch looks like this:\r\n{noformat}\r\nobject(Zend\\Mvc\\Router\\Http\\RouteMatch)[190]\r\n  protected 'length' => int 25\r\n  protected 'params' => \r\n    array\r\n      'subpage' => string 'videos' (length=11)\r\n      'action' => string 'index' (length=5)\r\n      'controller' => string 'MyModule\\Controller\\MediaController' (length=35)\r\n      'title' => string '' (length=0)\r\n  protected 'matchedRouteName' => null\r\n{noformat}\r\nThis URL works and is accessible. However, if I am assembling this URL using this RouteMatch object, i.e. for a redirect, e.g.:\r\n{noformat}\r\n$router = $event->getRouter();\r\n$params = $routeMatch->getParams();\r\n$redirectUrl = $router->assemble($params, array(\r\n   'name' => $routeMatch->getMatchedRouteName()\r\n));\r\n{noformat}\r\n$redirectUrl ends up looking like: {{\/media\/\/videos\/}}. This is because title is present as an empty string instead of being null or not present at all. I have tried setting title => null in the defaults config, but this doesn't do anything. Nor do I want to be explicit in the redirector because it serves as a sitewide redirector.\r\n\r\nHaving looked at the source, it looks to me like the problem lies with the array_merge in match() when it's building the RouteMatch object (see https:\/\/github.com\/zendframework\/zf2\/blob\/master\/library\/Zend\/Mvc\/Router\/Http\/Segment.php line 337). The regexp returns this:\r\n{noformat}\r\narray\r\n  0 => string '\/media\/videos\/' (length=15)\r\n  'param1' => string '' (length=0)\r\n  1 => string '' (length=0)\r\n  'param2' => string 'videos' (length=6)\r\n  2 => string 'videos' (length=6)\r\n{noformat}\r\nSo you get empty strings for the optional parameters when they're not found. These are then combined with the defaults and unfortunately override the defaults, so in the case above the \"title\" parameter will be empty string. To give the arguments that \"optional\" feel, if the regexp returns an empty string it should unset or return null in the RouteMatch that it builds."
        },
        "priority": {
            "name": "priority",
            "type": "com.atlassian.jira.issue.priority.Priority",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/priority\/4",
                "name": "Minor"
            }
        },
        "duedate": {
            "name": "duedate",
            "type": "java.util.Date"
        },
        "customfield_10022": {
            "name": "Fix Version Priority",
            "type": "com.atlassian.jira.plugin.system.customfieldtypes:select"
        },
        "watcher": {
            "name": "watcher",
            "type": "watcher",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-437\/watchers",
                "isWatching": false,
                "watchCount": 1
            }
        },
        "worklog": {
            "name": "worklog",
            "type": "worklog",
            "value": [

            ]
        },
        "status": {
            "name": "status",
            "type": "com.atlassian.jira.issue.status.Status",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/status\/5",
                "name": "Resolved"
            }
        },
        "labels": {
            "name": "labels",
            "type": "com.atlassian.jira.issue.label.Label",
            "value": [
                "defaults",
                "routing",
                "segment",
                "url"
            ]
        },
        "assignee": {
            "name": "assignee",
            "type": "com.opensymphony.user.User",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dasprid",
                "name": "dasprid",
                "displayName": "Ben Scholzen",
                "active": true
            }
        },
        "links": {
            "name": "links",
            "type": "issuelinks",
            "value": [
                {
                    "issueKey": "ZF2-408",
                    "issue": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-408",
                    "type": {
                        "name": "Related",
                        "direction": "OUTBOUND",
                        "description": "is related to"
                    }
                }
            ]
        },
        "attachment": {
            "name": "attachment",
            "type": "attachment",
            "value": [

            ]
        },
        "sub-tasks": {
            "name": "sub-tasks",
            "type": "issuelinks",
            "value": [

            ]
        },
        "versions": {
            "name": "versions",
            "type": "com.atlassian.jira.project.version.Version",
            "value": [

            ]
        },
        "project": {
            "name": "project",
            "type": "com.atlassian.jira.project.Project",
            "value": {
                "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/project\/ZF2",
                "key": "ZF2",
                "name": "Zend Framework 2.0",
                "roles": {

                }
            }
        },
        "components": {
            "name": "components",
            "type": "com.atlassian.jira.bc.project.component.ProjectComponent",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/component\/10722",
                    "id": 10722,
                    "name": "Zend\\Mvc\\Router",
                    "isAssigneeTypeValid": false
                }
            ]
        },
        "comment": {
            "name": "comment",
            "type": "com.atlassian.jira.issue.fields.CommentSystemField",
            "value": [
                {
                    "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/comment\/51506",
                    "author": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dasprid",
                        "name": "dasprid",
                        "displayName": "Ben Scholzen",
                        "active": true
                    },
                    "body": "It is in fact the same issue.",
                    "updateAuthor": {
                        "self": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/user?username=dasprid",
                        "name": "dasprid",
                        "displayName": "Ben Scholzen",
                        "active": true
                    },
                    "created": "2012-08-01T11:46:27.000+0000",
                    "updated": "2012-08-01T11:46:27.000+0000"
                }
            ]
        }
    },
    "transitions": "http:\/\/fw02.zend.com\/issues\/rest\/api\/latest\/issue\/ZF2-437\/transitions"
}